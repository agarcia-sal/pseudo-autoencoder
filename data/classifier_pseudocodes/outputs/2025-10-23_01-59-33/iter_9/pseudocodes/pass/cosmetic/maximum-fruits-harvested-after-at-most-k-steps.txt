CLASS Solution  
    FUNCTION maxTotalFruits(fruits AS list of list of integers, startPos AS integer, k AS integer) RETURNS integer  
        SET resultMax TO 0  
        SET currSum TO 0  
        SET windowStart TO 0  
        
        SET rightPtr TO 0  
        WHILE rightPtr < LENGTH(fruits)  
            SET currPos TO fruits[rightPtr][0]  
            SET currCount TO fruits[rightPtr][1]  
            SET currSum TO currSum + currCount  
            
            WHILE windowStart <= rightPtr  
                SET leftPos TO fruits[windowStart][0]  
                SET rightPos TO fruits[rightPtr][0]  
                SET leftCondInclusive TO (startPos - k)  
                SET rightCondInclusive TO (startPos + k)  
                SET distLeft TO ABS(leftPos - startPos)  
                SET distRight TO ABS(rightPos - startPos)  
                SET minDist TO IF distLeft < distRight THEN distLeft ELSE distRight  
                SET rangeSpan TO rightPos - leftPos  
                SET condition1 TO (leftCondInclusive <= leftPos) AND (leftPos <= rightCondInclusive)  
                SET condition2 TO (leftCondInclusive <= rightPos) AND (rightPos <= rightCondInclusive)  
                SET condition3 TO ((minDist + rangeSpan) <= k)  
                IF NOT (condition1 AND condition2 AND condition3) THEN  
                    SET currSum TO currSum - fruits[windowStart][1]  
                    SET windowStart TO windowStart + 1  
                ELSE  
                    BREAK  
                END IF  
            END WHILE  
            
            IF resultMax < currSum  
                SET resultMax TO currSum  
            END IF  
            SET rightPtr TO rightPtr + 1  
        END WHILE  
        
        RETURN resultMax  
    END FUNCTION  
END CLASS