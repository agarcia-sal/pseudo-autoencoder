CLASS Solution
    FUNCTION isValid(code)
        IMPORT regular expression module
        DEFINE cdata_regex AS the pattern: literal "<![CDATA[" concatenated with any characters repeated reluctantly followed by "]]>"
        SET code TO the output of substituting all matches of cdata_regex in code with empty string using regular expression substitution
        ASSIGN pile TO an empty list
        ASSIGN position TO 0
        WHILE position < LENGTH(code)
            IF code[position] = "<"
                ASSIGN end_pos TO the index of ">" found in code starting from position + 1
                IF end_pos = -1
                    RETURN false
                END IF
                ASSIGN content TO SUBSTRING(code, position + 1, end_pos)
                IF content IS EMPTY
                    RETURN false
                END IF
                IF content[0] = "/"
                    ASSIGN tag TO SUBSTRING(content, 1, LENGTH(content))
                    IF pile IS EMPTY OR pile[ LENGTH(pile) - 1 ] ≠ tag
                        RETURN false
                    END IF
                    REMOVE the element at pile[ LENGTH(pile) - 1 ]
                ELSE
                    IF content[0] = "!"
                        RETURN false
                    OTHERWISE
                        DEFINE is_valid_tag AS (LENGTH(content) ≥ 1) AND (LENGTH(content) ≤ 9)
                        ASSIGN is_valid_tag TO is_valid_tag AND ALL(char IS UPPERCASE LETTER FOR EACH char IN content)
                        IF NOT is_valid_tag
                            RETURN false
                        END IF
                        APPEND content TO pile
                    END IF
                END IF
                ASSIGN position TO end_pos + 1
            OTHERWISE
                INCREMENT position BY 1
            END IF
        END WHILE
        DEFINE valid_tag_expr AS the pattern: "<" + one or more uppercase letters + ">" + any characters any number of times + "</" + one or more uppercase letters + ">"
        RETURN (pile IS EMPTY) AND (COUNT OF ALL MATCHES OF valid_tag_expr IN code > 0)
    END FUNCTION
END CLASS