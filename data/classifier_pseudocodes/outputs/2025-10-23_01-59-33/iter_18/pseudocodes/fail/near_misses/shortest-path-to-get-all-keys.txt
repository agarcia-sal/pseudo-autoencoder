CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        SET directions TO list CONTAINING tuple zero zero and zero negative one and one zero and negative one zero  
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF element at position zero of grid  
        SET start TO no value  
        SET num_keys TO zero  
        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF element at position i of grid THEN element at position j EQUALS at symbol  
                    SET start TO tuple i and j  
                ELSE IF element at position i of grid THEN element at position j IS lowercase letter  
                    INCREMENT num_keys BY one  
                END IF  
            END FOR  
        END FOR  
        INITIALIZE queue AS a double ended queue CONTAINING tuple element at position zero of start and element at position one of start and zero and zero  
        INITIALIZE visited AS a set CONTAINING tuple element at position zero of start and element at position one of start and zero  
        WHILE queue IS NOT empty  
            REMOVE and RETURN leftmost element OF queue INTO x and y and keys and steps  
            FOR each tuple dx and dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n  
                    SET cell TO element at position nx of grid THEN element at position ny  
                    IF cell EQUALS hash symbol  
                        CONTINUE TO next iteration  
                    END IF  
                    IF cell IS uppercase letter  
                        SET key_needed TO one LEFT SHIFTED BY the alphabetic position of lowercase version of cell MINUS the alphabetic position of lowercase letter a  
                        IF keys AND key_needed EQUALS zero  
                            CONTINUE TO next iteration  
                        END IF  
                    END IF  
                    IF cell IS lowercase letter  
                        SET new_keys TO keys OR one LEFT SHIFTED BY the alphabetic position of cell MINUS the alphabetic position of lowercase letter a  
                        IF new_keys EQUALS one LEFT SHIFTED BY num_keys MINUS one  
                            RETURN steps PLUS one  
                        END IF  
                    ELSE  
                        SET new_keys TO keys  
                    END IF  
                    IF tuple nx and ny and new_keys IS NOT IN visited  
                        ADD tuple nx and ny and new_keys TO visited  
                        APPEND tuple nx and ny and new_keys and steps PLUS one TO queue  
                    END IF  
                END IF  
            END FOR  
        END WHILE  
        RETURN negative one  
    END FUNCTION  
END CLASS