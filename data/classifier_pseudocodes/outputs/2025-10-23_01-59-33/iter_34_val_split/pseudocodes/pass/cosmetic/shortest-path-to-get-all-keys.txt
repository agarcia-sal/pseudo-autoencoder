CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        ASSIGN [(0,1), (0,-1), (1,0), (-1,0)] TO directions_list  
        ASSIGN LENGTH(grid) TO rows_count  
        ASSIGN LENGTH(grid[0]) TO cols_count  
        ASSIGN NULL TO start_position  
        ASSIGN 0 TO total_keys  
        SET outer_index TO 0  
        WHILE outer_index < rows_count  
            SET inner_index TO 0  
            WHILE inner_index < cols_count  
                IF grid[outer_index][inner_index] == '@' THEN  
                    ASSIGN (outer_index, inner_index) TO start_position  
                ELSE IF grid[outer_index][inner_index] >= 'a' AND grid[outer_index][inner_index] <= 'z' THEN  
                    total_keys = total_keys + 1  
                END IF  
                inner_index = inner_index + 1  
            END WHILE  
            outer_index = outer_index + 1  
        END WHILE  
        ASSIGN deque([(start_position[0], start_position[1], 0, 0)]) TO queue_container  
        ASSIGN set({(start_position[0], start_position[1], 0)}) TO visited_states  
        LOOP WHILE queue_container IS NOT EMPTY  
            ASSIGN queue_container.POP_LEFT() TO (curr_x, curr_y, curr_keys, curr_steps)  
            SET index_dir TO 0  
            WHILE index_dir < LENGTH(directions_list)  
                ASSIGN directions_list[index_dir] TO (delta_x, delta_y)  
                ASSIGN curr_x + delta_x TO next_x  
                ASSIGN curr_y + delta_y TO next_y  
                IF next_x >= 0 AND next_x < rows_count AND next_y >= 0 AND next_y < cols_count THEN  
                    ASSIGN grid[next_x][next_y] TO current_cell  
                    IF current_cell == '#' THEN  
                        index_dir = index_dir + 1  
                        CONTINUE  
                    END IF  
                    IF current_cell >= 'A' AND current_cell <= 'Z' THEN  
                        ASSIGN (1 << (ORD(LOWER(current_cell)) - ORD('a'))) TO required_key  
                        IF (curr_keys & required_key) == 0 THEN  
                            index_dir = index_dir + 1  
                            CONTINUE  
                        END IF  
                    END IF  
                    IF current_cell >= 'a' AND current_cell <= 'z' THEN  
                        ASSIGN curr_keys | (1 << (ORD(current_cell) - ORD('a'))) TO updated_keys  
                        IF updated_keys == (1 << total_keys) - 1 THEN  
                            RETURN curr_steps + 1  
                        END IF  
                    ELSE  
                        ASSIGN curr_keys TO updated_keys  
                    END IF  
                    IF NOT (next_x, next_y, updated_keys) IN visited_states THEN  
                        visited_states.ADD((next_x, next_y, updated_keys))  
                        queue_container.APPEND((next_x, next_y, updated_keys, curr_steps + 1))  
                    END IF  
                END IF  
                index_dir = index_dir + 1  
            END WHILE  
        END LOOP  
        RETURN -1  
    END FUNCTION  
END CLASS