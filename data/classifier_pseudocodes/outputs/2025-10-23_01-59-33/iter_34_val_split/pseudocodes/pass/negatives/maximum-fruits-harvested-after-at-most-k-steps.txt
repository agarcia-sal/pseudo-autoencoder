```
set maxF, total = 0,0; left = 0
for right in 0..len(fruits)-1:
    posR, amtR = fruits[right]
    total += amtR
    while left ≤ right and not (
          startPos - k ≤ fruits[left][0] ≤ startPos + k and
          startPos - k ≤ posR ≤ startPos + k and
          min(|posR - startPos|, |fruits[left][0] - startPos|) + posR - fruits[left][0] ≤ k):
        total -= fruits[left][1]
        left += 1
    maxF = max(maxF, total)
return maxF
```