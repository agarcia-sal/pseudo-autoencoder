CLASS Solution
    FUNCTION numDistinctIslands2(grid)
        FUNCTION dfs(x, y, island)
            IF (x < 0) OR (x >= LENGTH grid) OR (y < 0) OR (y >= LENGTH grid[0]) OR (grid[x][y] = 0)
                RETURN
            END IF
            ASSIGN 0 TO grid[x][y]
            APPEND (x, y) TO island
            dfs(x + 1, y, island)
            dfs(x - 1, y, island)
            dfs(x, y + 1, island)
            dfs(x, y - 1, island)
        END FUNCTION

        FUNCTION normalize(island)
            ASSIGN [] TO shapes
            ASSIGN [(1, 1), (1, -1), (-1, 1), (-1, -1)] TO directions
            FOR each (a, b) IN directions
                ASSIGN [] TO transformed
                FOR each (px, py) IN island
                    APPEND (px * a, py * b) TO transformed
                END FOR
                SORT transformed BY ascending order
                ASSIGN minimum x value from transformed TO base_x
                ASSIGN minimum y value from transformed TO base_y
                ASSIGN []
                    TO normalized
                FOR each (qx, qy) IN transformed
                    APPEND (qx - base_x, qy - base_y) TO normalized
                END FOR
                APPEND TUPLE(normalized) TO shapes
            END FOR

            ASSIGN LENGTH shapes TO n
            FOR idx FROM 0 TO n - 1
                ASSIGN rotated_shape TO []
                FOR each (cx, cy) IN shapes[idx]
                    APPEND (cy, -cx) TO rotated_shape
                END FOR
                APPEND TUPLE(rotated_shape) TO shapes
            END FOR
            
            RETURN minimal element IN shapes USING lex order
        END FUNCTION

        ASSIGN empty set TO distinct_set
        ASSIGN LENGTH grid TO row_count
        ASSIGN LENGTH grid[0] TO col_count
        FOR row FROM 0 TO row_count - 1
            FOR col FROM 0 TO col_count - 1
                IF grid[row][col] = 1 THEN
                    ASSIGN [] TO current_island
                    CALL dfs(row, col, current_island)
                    INSERT normalize(current_island) INTO distinct_set
                END IF
            END FOR
        END FOR

        RETURN SIZE OF distinct_set
    END FUNCTION
END CLASS