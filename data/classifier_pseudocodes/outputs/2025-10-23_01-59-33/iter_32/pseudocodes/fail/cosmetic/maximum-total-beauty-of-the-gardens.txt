CLASS Solution  
    FUNCTION maximumBeauty(flowers newFlowers target full partial)  
        CALL flowers SORT IN ASCENDING ORDER  
        SET length_of_flowers TO the LENGTH OF flowers  
        SET highest_beauty TO 0  
        DEFINE prefix_accumulation AS A LIST WITH length_of_flowers PLUS one ELEMENTS INITIALIZED TO 0  
        
        SET idx TO 0  
        WHILE idx < length_of_flowers  
            SET prefix_accumulation[idx + 1] AS prefix_accumulation[idx] + flowers[idx]  
            SET idx TO idx + 1  
        END WHILE  
        
        SET count_full_gardens TO 0  
        SET pointer TO length_of_flowers - 1  
        LOOP  
            IF pointer < 0 THEN  
                BREAK  
            ENDIF  
            
            IF flowers[pointer] >= target THEN  
                SET count_full_gardens AS count_full_gardens + 1  
                SET pointer AS pointer - 1  
            ELSE  
                BREAK  
            ENDIF  
        END LOOP  
        
        SET flowers_left TO newFlowers  
        SET incomplete_max_flowers TO 0  
        
        SET current_index TO count_full_gardens  
        WHILE current_index <= length_of_flowers  
            
            IF current_index > 0 THEN  
                SET flowers_left AS flowers_left - (target - flowers[length_of_flowers - current_index])  
                IF NOT (flowers_left >= 0) THEN  
                    BREAK  
                ENDIF  
            ENDIF  
            
            SET low_bound TO 0  
            SET high_bound TO length_of_flowers - current_index - 1  
            
            WHILE low_bound <= high_bound  
                SET midpoint TO (low_bound + high_bound) DIVIDED BY 2 USING INTEGER DIVISION  
                
                SET required_flowers TO (flowers[midpoint] * (midpoint+1)) - (prefix_accumulation[midpoint + 1])  
                
                IF required_flowers > flowers_left THEN  
                    SET high_bound TO midpoint - 1  
                ELSE  
                    SET low_bound TO midpoint + 1  
                ENDIF  
            END WHILE  
            
            IF high_bound >= 0 THEN  
                SET numerator TO flowers_left - ((flowers[high_bound] * (high_bound + 1)) - prefix_accumulation[high_bound + 1])  
                SET incomplete_max_flowers AS flowers[high_bound] + (numerator DIVIDED BY (high_bound + 1) USING INTEGER DIVISION)  
            ELSE  
                SET incomplete_max_flowers TO 0  
            ENDIF  
            
            SET candidate_beauty TO (current_index * full) + (MIN(incomplete_max_flowers, target - 1) * partial)  
            IF candidate_beauty > highest_beauty THEN  
                SET highest_beauty AS candidate_beauty  
            ENDIF  
            
            SET current_index TO current_index + 1  
        END WHILE  
        
        RETURN highest_beauty  
    END FUNCTION  
END CLASS