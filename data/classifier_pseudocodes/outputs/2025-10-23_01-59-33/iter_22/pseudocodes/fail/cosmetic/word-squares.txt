CLASS Solution
    FUNCTION wordSquares(words)
        SET lookup TO an empty mapping from string to list of strings

        SET w_index TO 0
        WHILE w_index < LENGTH(words)
            SET current_word TO words[w_index]
            SET i TO 0
            WHILE i < LENGTH(current_word)
                SET key TO substring(current_word, 0, i)
                IF NOT lookup HAS KEY key THEN
                    lookup[key] ← an empty list
                END IF
                SET word_list TO lookup[key]
                word_list ← word_list + [current_word]
                lookup[key] ← word_list
                i ← i + 1
            END WHILE
            w_index ← w_index + 1
        END WHILE

        SET output TO an empty list

        FUNCTION backtrack(square)
            IF NOT LENGTH(square) ≠ LENGTH(words[0]) THEN
                output ← output + [square]
                RETURN
            END IF

            SET build_prefix TO ""
            SET idx TO 0
            WHILE idx < LENGTH(square)
                SET temp_word TO square[idx]
                SET prefix_char TO temp_word[LENGTH(square)]
                build_prefix ← build_prefix + prefix_char
                idx ← idx + 1
            END WHILE

            IF lookup HAS KEY build_prefix THEN
                SET candidates_list TO lookup[build_prefix]
                SET c_idx TO 0
                WHILE c_idx < LENGTH(candidates_list)
                    SET next_word TO candidates_list[c_idx]
                    backtrack(square + [next_word])
                    c_idx ← c_idx + 1
                END WHILE
            END IF
        END FUNCTION

        FOR EACH initial_word IN words
            backtrack([initial_word])
        END FOR

        RETURN output
    END FUNCTION
END CLASS