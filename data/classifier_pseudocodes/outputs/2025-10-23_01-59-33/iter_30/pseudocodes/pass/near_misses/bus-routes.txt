CLASS Solution  
  FUNCTION numBusesToDestination(routes PARAMETER, source PARAMETER, target PARAMETER)  
    IF source IS NOT target THEN ELSE  
      RETURN 0  
    END IF  

    DECLARE stopBusMap AS an empty dictionary with empty arrays as values  
    DECLARE routeIndex AS 0  
    WHILE routeIndex < LENGTH OF routes DO  
      DECLARE currentStops AS routes[routeIndex]  
      DECLARE stopIndex AS 0  
      WHILE stopIndex < LENGTH OF currentStops DO  
        DECLARE currentStop AS currentStops[stopIndex]  
        IF currentStop NOT IN stopBusMap THEN  
          ASSIGN stopBusMap[currentStop] TO an empty array  
        END IF  
        APPEND routeIndex TO stopBusMap[currentStop]  
        INCREMENT stopIndex BY 1  
      END WHILE  
      INCREMENT routeIndex BY 1  
    END WHILE  

    DECLARE busStack AS an empty stack  
    DECLARE busesVisited AS an empty set  
    DECLARE stopsVisited AS an empty set  

    DECLARE initialBuses AS stopBusMap[source] IF source IN stopBusMap OTHERWISE an empty array  
    DECLARE idx AS LENGTH OF initialBuses MINUS 1  
    WHILE idx >= 0 DO  
      DECLARE busId AS initialBuses[idx]  
      PUSH (busId, 1) ONTO busStack  
      ADD busId TO busesVisited  
      ADD source TO stopsVisited  
      DECREMENT idx BY 1  
    END WHILE  

    FUNCTION processBus()  
      IF busStack IS EMPTY THEN  
        RETURN -1  
      END IF  
      DECLARE currentPair AS POP FROM busStack  
      DECLARE thisBus AS currentPair[0]  
      DECLARE countBuses AS currentPair[1]  

      DECLARE stopCursor AS 0  
      WHILE stopCursor < LENGTH OF routes[thisBus] DO  
        DECLARE stopId AS routes[thisBus][stopCursor]  
        IF stopId EQUALS target THEN  
          RETURN countBuses  
        END IF  

        IF stopId NOT IN stopsVisited THEN  
          ADD stopId TO stopsVisited  
          DECLARE connectedBuses AS stopBusMap[stopId] IF stopId IN stopBusMap ELSE an empty array  
          DECLARE nextIndex AS LENGTH OF connectedBuses MINUS 1  
          WHILE nextIndex >= 0 DO  
            DECLARE connectedBus AS connectedBuses[nextIndex]  
            IF connectedBus NOT IN busesVisited THEN  
              ADD connectedBus TO busesVisited  
              PUSH (connectedBus, countBuses + 1) ONTO busStack  
            END IF  
            DECREMENT nextIndex BY 1  
          END WHILE  
        END IF  
        INCREMENT stopCursor BY 1  
      END WHILE  
      RETURN processBus()  
    END FUNCTION  

    RETURN processBus()  
  END FUNCTION  
END CLASS