CLASS Solution  
    FUNCTION countPairs(nums k)  
        SET divisorFrequency AS a new counter collection  
        
        SET indexA TO 0  
        WHILE indexA < LENGTH(nums)  
            SET currentNum TO nums[indexA]  
            SET divisorKey TO gcd(currentNum, k)  
            INCREMENT divisorFrequency AT divisorKey BY 1  
            SET indexA TO indexA + 1  
        END WHILE  
        
        SET pairSum TO 0  
        
        SET divisorList TO KEYS(divisorFrequency)  
        SET totalDivisors TO LENGTH(divisorList)  
        
        SET outerIdx TO 0  
        WHILE outerIdx < totalDivisors  
            SET innerIdx TO outerIdx  
            WHILE innerIdx < totalDivisors  
                SET firstDivisor TO divisorList[outerIdx]  
                SET secondDivisor TO divisorList[innerIdx]  
                
                IF (firstDivisor * secondDivisor) MOD k = 0 THEN  
                    IF outerIdx = innerIdx THEN  
                        SET freqVal TO divisorFrequency[firstDivisor]  
                        SET pairSum TO pairSum + (freqVal * (freqVal - 1)) / 2  
                    ELSE  
                        SET pairSum TO pairSum + (divisorFrequency[firstDivisor] * divisorFrequency[secondDivisor])  
                    END IF  
                END IF  
                
                SET innerIdx TO innerIdx + 1  
            END WHILE  
            SET outerIdx TO outerIdx + 1  
        END WHILE  
        
        RETURN pairSum  
    END FUNCTION  
END CLASS