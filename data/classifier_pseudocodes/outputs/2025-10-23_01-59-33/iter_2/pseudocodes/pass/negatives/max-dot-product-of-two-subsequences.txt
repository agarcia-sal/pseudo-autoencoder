```
m, n ← len(nums1), len(nums2)
dp ← matrix (m+1)×(n+1) filled with -∞
for i in 1 to m:
  for j in 1 to n:
    cur ← nums1[i-1] * nums2[j-1]
    dp[i][j] ← max(cur, dp[i-1][j], dp[i][j-1], dp[i-1][j-1] + cur)
return dp[m][n]
```