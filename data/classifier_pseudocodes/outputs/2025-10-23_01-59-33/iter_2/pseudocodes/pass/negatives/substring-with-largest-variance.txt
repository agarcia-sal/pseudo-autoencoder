```
set inf = ∞

func largestVariance(s):
  maxV = 0
  chars = unique chars in s

  func calcVar(sub, a, b):
    maxV = 0; cntA = 0; cntB = 0; hasB = false; firstB = false
    for c in sub:
      if c = a: cntA += 1
      if c = b: cntB += 1; hasB = true
      if cntB > 0: maxV = max(maxV, cntA - cntB)
      else if cntB = 0 and firstB: maxV = max(maxV, cntA - 1)
      if cntB > cntA:
        cntA = 0; cntB = 0; firstB = hasB
    return maxV

  for (a,b) in permutations(chars, 2):
    if a ≠ b:
      maxV = max(maxV, calcVar(s,a,b))

  return maxV
```