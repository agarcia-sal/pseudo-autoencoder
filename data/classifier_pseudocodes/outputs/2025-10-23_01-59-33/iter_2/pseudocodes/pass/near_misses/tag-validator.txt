CLASS Solution  
    FUNCTION isValid(code)  
        SET pattern FOR CDATA TO the string representing less than exclamation mark left square bracket CDATA left square bracket followed by any characters lazy match followed by right square bracket right square bracket greater than  
        SET code TO the result of replacing all matches of the CDATA pattern in code with empty string  
        SET stack TO empty list  
        SET i TO zero  
        WHILE i LESS THAN the LENGTH OF code  
            IF the element at position i of code EQUALS less than  
                SET j TO the position of the first occurrence of greater than in code starting from position i PLUS one  
                IF j EQUALS minus one  
                    RETURN false  
                END IF  
                SET tag_content TO the substring from position i PLUS one TO position j MINUS one of code  
                IF the LENGTH OF tag_content EQUALS zero  
                    RETURN false  
                END IF  
                IF the element at position zero of tag_content EQUALS slash  
                    SET tag_name TO the substring from position one TO the end of tag_content  
                    IF the stack is empty OR the last element of stack NOT EQUALS tag_name  
                        RETURN false  
                    END IF  
                    REMOVE the last element FROM stack  
                ELSE IF the element at position zero of tag_content EQUALS exclamation mark  
                    RETURN false  
                ELSE  
                    IF the LENGTH OF tag_content LESS THAN one OR the LENGTH OF tag_content GREATER THAN nine OR tag_content NOT EQUALS tag_content converted to uppercase  
                        RETURN false  
                    END IF  
                    APPEND tag_content TO stack  
                END IF  
                SET i TO j PLUS one  
            ELSE  
                INCREMENT i BY one  
            END IF  
        END WHILE  
        RETURN the logical NOT of the stack AND the result of finding all matches of the regular expression matching less than followed by one or more uppercase letters followed by greater than followed by any characters followed by less than slash followed by one or more uppercase letters followed by greater than in code returns a nonempty list  
    END FUNCTION  
END CLASS