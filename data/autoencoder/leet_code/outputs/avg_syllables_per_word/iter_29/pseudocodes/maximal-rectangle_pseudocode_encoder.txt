CLASS Solution  
    FUNCTION maximalRectangle(matrix)  
        IF matrix EQUALS empty OR the first element of matrix EQUALS empty  
            RETURN zero  
        END IF  
        
        SET rows TO the LENGTH OF matrix  
        SET cols TO the LENGTH OF the first element of matrix  
        SET heights TO a list of zero repeated cols times  
        SET max_area TO zero  
        
        FOR i FROM zero TO rows MINUS one  
            FOR j FROM zero TO cols MINUS one  
                IF the element at position i of matrix AT position j EQUALS one  
                    INCREMENT the element at position j of heights BY one  
                ELSE  
                    SET the element at position j of heights TO zero  
                END IF  
            END FOR  
            
            SET max_area TO the GREATER OF max_area AND the RESULT OF calling largestRectangleArea WITH heights  
        END FOR  
        
        RETURN max_area  
    END FUNCTION  
    
    FUNCTION largestRectangleArea(heights)  
        SET stack TO empty list  
        SET max_area TO zero  
        SET index TO zero  
        
        WHILE index IS LESS THAN the LENGTH OF heights  
            IF stack IS empty OR the element at position index of heights IS GREATER THAN OR EQUAL TO the element at position at the last element of stack of heights  
                APPEND index TO stack  
                INCREMENT index BY one  
            ELSE  
                REMOVE the last element FROM stack AND ASSIGN TO top_of_stack  
                IF stack IS NOT empty  
                    SET area TO the element at position top_of_stack of heights MULTIPLIED BY (index MINUS the last element of stack MINUS one)  
                ELSE  
                    SET area TO the element at position top_of_stack of heights MULTIPLIED BY index  
                END IF  
                SET max_area TO the GREATER OF max_area AND area  
            END IF  
        END WHILE  
        
        WHILE stack IS NOT empty  
            REMOVE the last element FROM stack AND ASSIGN TO top_of_stack  
            IF stack IS NOT empty  
                SET area TO the element at position top_of_stack of heights MULTIPLIED BY (index MINUS the last element of stack MINUS one)  
            ELSE  
                SET area TO the element at position top_of_stack of heights MULTIPLIED BY index  
            END IF  
            SET max_area TO the GREATER OF max_area AND area  
        END WHILE  
        
        RETURN max_area  
    END FUNCTION  
END CLASS