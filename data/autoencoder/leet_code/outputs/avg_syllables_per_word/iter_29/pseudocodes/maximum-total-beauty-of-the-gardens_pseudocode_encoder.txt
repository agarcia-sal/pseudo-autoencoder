CLASS Solution  
    FUNCTION maximumBeauty(flowers newFlowers target full partial)  
        SORT flowers IN ascending order BY value  
        SET n TO the LENGTH OF flowers  
        SET max_beauty TO zero  
          
        CREATE prefix_sum AS a list OF zeroes WITH length n PLUS one  
        FOR index FROM zero TO n MINUS one  
            SET element at position index PLUS one OF prefix_sum TO element at position index OF prefix_sum PLUS element at position index OF flowers  
        END FOR  
          
        SET complete_gardens TO zero  
        FOR index FROM n MINUS one DOWN TO zero  
            IF element at position index OF flowers GREATER THAN OR EQUAL TO target  
                INCREMENT complete_gardens BY one  
            ELSE  
                BREAK the loop  
            END IF  
        END FOR  
          
        SET remaining_flowers TO newFlowers  
        SET max_incomplete_flowers TO zero  
          
        FOR i FROM complete_gardens TO n  
            IF i GREATER THAN zero  
                SET remaining_flowers TO remaining_flowers MINUS (target MINUS element at position n MINUS i OF flowers)  
                IF remaining_flowers LESS THAN zero  
                    BREAK the loop  
                END IF  
            END IF  
              
            SET left TO zero  
            SET right TO n MINUS i MINUS one  
            WHILE left LESS THAN OR EQUAL TO right  
                SET mid TO the INTEGER division RESULT OF (left PLUS right) DIVIDED BY two  
                SET cost TO element at position mid OF flowers MULTIPLIED BY (mid PLUS one) MINUS element at position mid PLUS one OF prefix_sum  
                IF cost GREATER THAN remaining_flowers  
                    SET right TO mid MINUS one  
                ELSE  
                    SET left TO mid PLUS one  
                END IF  
            END WHILE  
              
            IF right GREATER THAN OR EQUAL TO zero  
                SET max_incomplete_flowers TO element at position right OF flowers PLUS (remaining_flowers MINUS (element at position right OF flowers MULTIPLIED BY (right PLUS one) MINUS element at position right PLUS one OF prefix_sum)) DIVIDED BY (right PLUS one)  
            ELSE  
                SET max_incomplete_flowers TO zero  
            END IF  
              
            SET total_beauty TO i MULTIPLIED BY full PLUS THE MINIMUM OF max_incomplete_flowers AND target MINUS one MULTIPLIED BY partial  
            SET max_beauty TO THE MAXIMUM OF max_beauty AND total_beauty  
        END FOR  
          
        RETURN max_beauty  
    END FUNCTION  
END CLASS