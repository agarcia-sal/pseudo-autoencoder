CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO an empty set  
            SET current_product TO a list containing an empty string  
            WHILE index LESS THAN the LENGTH OF expression  
                SET char TO the character at position index of expression  
                IF char EQUALS the character left brace  
                    SET inner_set AND index TO the result of calling parse_expression WITH index PLUS one  
                    SET new_product TO an empty list  
                    FOR each string_a IN current_product  
                        FOR each string_b IN inner_set  
                            SET concatenated_string TO string_a CONCATENATED WITH string_b  
                            APPEND concatenated_string TO new_product  
                        END FOR  
                    END FOR  
                    SET current_product TO new_product  
                ELSE IF char EQUALS the character right brace  
                    FOR each product_string IN current_product  
                        ADD product_string TO current_set  
                    END FOR  
                    RETURN current_set AND index  
                ELSE IF char EQUALS the character comma  
                    FOR each product_string IN current_product  
                        ADD product_string TO current_set  
                    END FOR  
                    SET current_product TO a list containing an empty string  
                ELSE  
                    SET new_product TO an empty list  
                    FOR each string_a IN current_product  
                        SET concatenated_string TO string_a CONCATENATED WITH char  
                        APPEND concatenated_string TO new_product  
                    END FOR  
                    SET current_product TO new_product  
                END IF  
                INCREMENT index BY one  
            END WHILE  
            FOR each product_string IN current_product  
                ADD product_string TO current_set  
            END FOR  
            RETURN current_set AND index  
        END FUNCTION  
        SET result_set AND unused_index TO the result of calling parse_expression WITH zero  
        RETURN the SORTED list of elements in result_set  
    END FUNCTION  
END CLASS