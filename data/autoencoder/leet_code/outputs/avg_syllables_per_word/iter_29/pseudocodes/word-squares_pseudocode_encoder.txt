CLASS Solution  
    FUNCTION wordSquares(words)  
        CREATE an empty mapping from prefix strings TO lists of words NAMED prefix_to_words  
        
        FOR each word IN words  
            FOR index FROM zero TO the LENGTH OF word MINUS one  
                SET prefix TO the substring from position zero TO position index MINUS one of word  
                APPEND word TO the list corresponding to prefix IN prefix_to_words  
            END FOR  
        END FOR  
        
        CREATE an empty list NAMED results  
        
        FUNCTION backtrack(square)  
            IF the LENGTH OF square EQUALS the LENGTH OF the first element of words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO an empty string  
            FOR each word_element IN square  
                APPEND the character at position equal TO the LENGTH OF square FROM word_element TO prefix  
            END FOR  
            
            FOR each candidate_word IN the list corresponding to prefix IN prefix_to_words  
                CALL backtrack WITH the list formed by concatenating square AND candidate_word  
            END FOR  
        END FUNCTION  
        
        FOR each word_element IN words  
            CALL backtrack WITH a list containing only word_element  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS