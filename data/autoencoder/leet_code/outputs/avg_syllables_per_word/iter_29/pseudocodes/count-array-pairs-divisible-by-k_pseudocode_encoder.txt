CLASS Solution  
    FUNCTION countPairs(nums k)  
        SET gcd_count TO a new mapping from items to counts  
        
        FOR each number IN nums  
            SET current_gcd TO the greatest common divisor of number AND k  
            INCREMENT the count at current_gcd in gcd_count BY one  
        END FOR  
        
        SET total_pairs TO zero  
        
        SET gcd_values TO the list of all keys in gcd_count  
        SET n TO the number of elements in gcd_values  
        
        FOR i FROM zero TO n MINUS one  
            FOR j FROM i TO n MINUS one  
                SET gcd1 TO element at position i of gcd_values  
                SET gcd2 TO element at position j of gcd_values  
                
                SET product_of_gcds TO gcd1 MULTIPLIED BY gcd2  
                SET remainder TO product_of_gcds MODULO k  
                
                IF remainder EQUALS zero THEN  
                    IF i EQUALS j THEN  
                        SET count_at_gcd1 TO count at gcd1 in gcd_count  
                        INCREMENT total_pairs BY count_at_gcd1 MULTIPLIED BY count_at_gcd1 MINUS one DIVIDED BY two  
                    ELSE  
                        INCREMENT total_pairs BY count at gcd1 in gcd_count MULTIPLIED BY count at gcd2 in gcd_count  
                    END IF  
                END IF  
            END FOR  
        END FOR  
        
        RETURN total_pairs  
    END FUNCTION  
END CLASS