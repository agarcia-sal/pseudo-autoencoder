CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(number)  
            SET square_root TO the integer part of the square root of number  
            IF square_root MULTIPLIED BY square_root EQUALS number  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
        
        FUNCTION backtrack(current_path, current_count)  
            IF the LENGTH OF current_path EQUALS the LENGTH OF nums  
                RETURN one  
            END IF  
            
            SET answer TO zero  
            FOR each element IN current_count  
                IF the value of element IN current_count IS GREATER THAN zero AND (the LENGTH OF current_path EQUALS zero OR is_square(the element at the last position of current_path PLUS element))  
                    DECREMENT the value of element IN current_count BY one  
                    INCREMENT answer BY backtrack(current_path WITH element APPENDED, current_count)  
                    INCREMENT the value of element IN current_count BY one  
                END IF  
            END FOR  
            RETURN answer  
        END FUNCTION  
        
        SET count TO a mapping of elements in nums to their respective frequencies  
        RETURN backtrack(an empty list, count)  
    END FUNCTION  
END CLASS