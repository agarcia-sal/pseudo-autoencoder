CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid EQUALS nothing OR the LENGTH OF grid EQUALS zero OR the LENGTH OF element at position zero of grid EQUALS zero  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF element at position zero of grid  
            SET dp TO a new two dimensional list with m elements each containing n elements set TO zero  
            SET count TO zero  
            
            FOR index i FROM zero TO m MINUS one  
                FOR index j FROM zero TO n MINUS one  
                    IF element at position i OF grid AT position j EQUALS one  
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET element at position i OF dp AT position j TO one  
                        ELSE  
                            SET element at position i OF dp AT position j TO the MINIMUM OF element at position i MINUS one OF dp AT position j MINUS one AND element at position i MINUS one OF dp AT position j AND element at position i MINUS one OF dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i OF dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i OF dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid EQUALS nothing OR the LENGTH OF grid EQUALS zero OR the LENGTH OF element at position zero of grid EQUALS zero  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF element at position zero of grid  
            SET dp TO a new two dimensional list with m elements each containing n elements set TO zero  
            SET count TO zero  
            
            FOR index i FROM m MINUS one DOWNTO zero  
                FOR index j FROM zero TO n MINUS one  
                    IF element at position i OF grid AT position j EQUALS one  
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET element at position i OF dp AT position j TO one  
                        ELSE  
                            SET element at position i OF dp AT position j TO the MINIMUM OF element at position i PLUS one OF dp AT position j MINUS one AND element at position i PLUS one OF dp AT position j AND element at position i PLUS one OF dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i OF dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i OF dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        RETURN the RESULT OF count_pyramids_from_top WITH grid PLUS the RESULT OF count_pyramids_from_bottom WITH grid  
    END FUNCTION  
END CLASS