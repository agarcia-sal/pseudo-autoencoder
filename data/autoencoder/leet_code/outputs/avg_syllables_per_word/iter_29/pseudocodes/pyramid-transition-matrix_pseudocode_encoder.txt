CLASS Solution  
    FUNCTION pyramidTransition(bottom, allowed)  
        SET allowed_map TO an empty mapping where each key maps to another mapping where each key maps to an empty list  
        FOR each rule IN allowed  
            SET left TO the element at position one of rule  
            SET right TO the element at position two of rule  
            SET top TO the element at position three of rule  
            APPEND top TO the list obtained from allowed_map at key left and key right  
        END FOR  
        
        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF the LENGTH OF current_bottom EQUALS one  
                RETURN true  
            END IF  
            IF the LENGTH OF current_top EQUALS the LENGTH OF current_bottom MINUS one  
                RETURN the result of calling can_build_pyramid with current_top and an empty list as arguments  
            END IF  
            
            SET position TO the LENGTH OF current_top PLUS one  
            SET left TO the element at position position of current_bottom  
            SET right TO the element at position position PLUS one of current_bottom  
            IF allowed_map CONTAINS left AS a key AND allowed_map at key left CONTAINS right AS a key  
                FOR each top IN the list obtained from allowed_map at key left and key right  
                    SET new_top TO the concatenation of current_top AND top  
                    IF the result of calling can_build_pyramid with current_bottom and new_top as arguments IS true  
                        RETURN true  
                    END IF  
                END FOR  
            END IF  
            RETURN false  
        END FUNCTION  
        
        RETURN the result of calling can_build_pyramid with bottom and an empty list as arguments  
    END FUNCTION  
END CLASS