CLASS Solution  
    FUNCTION numMagicSquaresInside(grid)  
        FUNCTION is_magic(i, j)  
            IF element at position i of grid AND then element at position j OF that element NOT EQUALS five  
                RETURN false  
            END IF  
            SET numbers TO empty set  
            FOR x FROM one LESS THAN i TO one GREATER THAN i  
                FOR y FROM one LESS THAN j TO one GREATER THAN j  
                    IF element at position x of grid AND then element at position y OF that element LESS THAN one OR element at position x of grid AND then element at position y OF that element GREATER THAN nine OR element at position x of grid AND then element at position y OF that element IS IN numbers  
                        RETURN false  
                    END IF  
                    ADD element at position x of grid AND then element at position y OF that element TO numbers  
                END FOR  
            END FOR  
            FOR start FROM one LESS THAN i TO one GREATER THAN i  
                IF sum of elements at positions start of grid AND then positions j MINUS one j AND then j PLUS one OF those elements NOT EQUALS fifteen OR sum of elements at positions i MINUS one i AND then i PLUS one of grid AND then position start OF those elements NOT EQUALS fifteen  
                    RETURN false  
                END IF  
            END FOR  
            IF sum of elements at positions i MINUS one i AND then j MINUS one AND positions i AND j AND positions i PLUS one AND j PLUS one OF grid NOT EQUALS fifteen OR sum of elements at positions i MINUS one i AND then j PLUS one AND positions i AND j AND positions i PLUS one AND j MINUS one OF grid NOT EQUALS fifteen  
                RETURN false  
            END IF  
            RETURN true  
        END FUNCTION  
        SET count TO zero  
        SET rows TO the LENGTH OF grid  
        SET cols TO the LENGTH OF element at position zero OF grid  
        FOR i FROM one TO rows MINUS two  
            FOR j FROM one TO cols MINUS two  
                IF is_magic(i, j)  
                    INCREMENT count BY one  
                END IF  
            END FOR  
        END FOR  
        RETURN count  
    END FUNCTION  
END CLASS