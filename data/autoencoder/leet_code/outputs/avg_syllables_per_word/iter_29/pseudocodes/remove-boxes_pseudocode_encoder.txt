CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            IF the tuple of l r and k IS A KEY IN memo  
                RETURN the value at key l r k in memo  
            END IF  
            
            WHILE r GREATER THAN l AND the element at position r of boxes EQUALS the element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            
            SET res TO the result of dp with parameters l r MINUS one zero memo PLUS the quantity of k PLUS one MULTIPLIED BY k PLUS one  
            
            FOR i FROM l TO r MINUS one  
                IF the element at position i of boxes EQUALS the element at position r of boxes  
                    SET res TO the maximum of res AND the sum of dp with parameters l i k PLUS one memo AND dp with parameters i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            
            SET the value at key l r k in memo TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN the result of dp with parameters zero the length of boxes MINUS one zero an empty memo structure  
    END FUNCTION  
END CLASS