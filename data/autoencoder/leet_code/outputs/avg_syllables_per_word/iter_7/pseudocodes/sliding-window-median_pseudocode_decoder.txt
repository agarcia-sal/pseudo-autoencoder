CLASS Solution  
    FUNCTION medianSlidingWindow(nums, k)  
        SET lo TO empty list  
        SET hi TO empty list  

        FUNCTION balance_heaps()  
            IF LENGTH OF lo IS GREATER THAN LENGTH OF hi PLUS 1  
                MOVE top element FROM lo TO hi (INVERTING value)  
            ELSE IF LENGTH OF hi IS GREATER THAN LENGTH OF lo  
                MOVE top element FROM hi TO lo (INVERTING value)  
            END IF  
        END FUNCTION  

        FUNCTION add_num(num)  
            IF lo IS empty OR num IS LESS THAN OR EQUAL TO inverted top element OF lo  
                ADD inverted num TO lo  
            ELSE  
                ADD num TO hi  
            END IF  
            CALL balance_heaps()  
        END FUNCTION  

        FUNCTION remove_num(num)  
            IF num IS LESS THAN OR EQUAL TO inverted top element OF lo  
                REMOVE inverted num FROM lo  
                IF lo IS NOT empty  
                    REBUILD heap structure of lo  
                END IF  
            ELSE  
                REMOVE num FROM hi  
                IF hi IS NOT empty  
                    REBUILD heap structure of hi  
                END IF  
            END IF  
            CALL balance_heaps()  
        END FUNCTION  

        FUNCTION get_median()  
            IF LENGTH OF lo IS GREATER THAN LENGTH OF hi  
                RETURN inverted top element OF lo  
            ELSE  
                RETURN average OF inverted top element OF lo AND top element OF hi  
            END IF  
        END FUNCTION  

        FOR index FROM 0 TO k MINUS 1  
            CALL add_num WITH nums[index]  
        END FOR  

        SET medians TO list CONTAINING get_median()  

        FOR index FROM k TO LENGTH OF nums MINUS 1  
            CALL add_num WITH nums[index]  
            CALL remove_num WITH nums[index MINUS k]  
            APPEND get_median() TO medians  
        END FOR  

        RETURN medians  
    END FUNCTION  
END CLASS