CLASS Solution  
    FUNCTION containVirus(isInfected)  
        FUNCTION neighbors(r, c)  
            RETURN list containing (r INCREMENTED BY 1, c), (r DECREMENTED BY 1, c), (r, c INCREMENTED BY 1), (r, c DECREMENTED BY 1)  
        END FUNCTION  

        FUNCTION bfs(r, c)  
            SET infected TO empty set  
            SET threatened TO empty set  
            INITIALIZE queue WITH (r, c)  
            SET visited TO set containing (r, c)  
            WHILE queue is not empty  
                REMOVE first element FROM queue AND SET TO x, y  
                ADD (x, y) TO infected  
                FOR each nx, ny IN neighbors(x, y)  
                    IF nx IS GREATER THAN OR EQUAL TO 0 AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO 0 AND ny IS LESS THAN n AND (nx, ny) NOT IN visited  
                        ADD (nx, ny) TO visited  
                        IF isInfected AT position nx, ny EQUALS 1  
                            APPEND (nx, ny) TO queue  
                        ELSE IF isInfected AT position nx, ny EQUALS 0  
                            ADD (nx, ny) TO threatened  
            RETURN infected, threatened  
        END FUNCTION  

        FUNCTION build_walls(infected)  
            SET walls TO 0  
            FOR each x, y IN infected  
                FOR each nx, ny IN neighbors(x, y)  
                    IF nx IS GREATER THAN OR EQUAL TO 0 AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO 0 AND ny IS LESS THAN n AND isInfected AT position nx, ny EQUALS 0  
                        INCREMENT walls BY 1  
            RETURN walls  
        END FUNCTION  

        FUNCTION spread_virus(threatened)  
            FOR each x, y IN threatened  
                SET isInfected AT position x, y TO 1  
        END FUNCTION  

        SET m TO LENGTH OF isInfected  
        SET n TO LENGTH OF isInfected AT INDEX 0  
        SET total_walls TO 0  

        WHILE TRUE  
            SET regions TO empty list  
            SET visited TO empty set  
            FOR r FROM 0 TO m MINUS 1  
                FOR c FROM 0 TO n MINUS 1  
                    IF isInfected AT position r, c EQUALS 1 AND (r, c) NOT IN visited  
                        SET infected, threatened TO bfs(r, c)  
                        APPEND tuple (infected, threatened) TO regions  
                        UNION visited WITH infected  
            IF regions IS empty  
                BREAK  
            SORT regions BY length OF threatened cells IN DESCENDING ORDER  
            INCREMENT total_walls BY build_walls(regions AT INDEX 0 FIRST ELEMENT)  
            FOR each x, y IN infected cells OF regions AT INDEX 0  
                SET isInfected AT position x, y TO -1  
            FOR i FROM 1 TO LENGTH OF regions MINUS 1  
                CALL spread_virus WITH threatened cells OF regions AT INDEX i  
        RETURN total_walls  
    END FUNCTION  
END CLASS