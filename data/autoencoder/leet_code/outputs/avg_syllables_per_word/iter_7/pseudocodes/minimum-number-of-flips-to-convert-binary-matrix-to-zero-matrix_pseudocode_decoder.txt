CLASS Solution  
    FUNCTION minFlips(mat)  
        FUNCTION flip(matrix, x, y)  
            SET directions TO list of coordinate pairs: up, down, left, right, and self  
            FOR each dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx GREATER THAN OR EQUAL TO 0 AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO 0 AND ny LESS THAN n  
                    SET matrix at position nx, ny TO inverse of matrix at position nx, ny  
        END FUNCTION  

        FUNCTION matrix_to_tuple(matrix)  
            RETURN tuple of tuples representing each row in matrix  
        END FUNCTION  

        SET m TO length of mat  
        SET n TO length of first row in mat  
        SET target TO tuple of tuples of zeros with dimensions m by n  
        SET initial_state TO result of matrix_to_tuple applied to mat  
        SET queue TO list containing tuple of initial_state and 0  
        SET visited TO set containing initial_state  

        WHILE queue is not empty  
            REMOVE first element from queue and assign to current_state and steps  
            IF current_state EQUALS target  
                RETURN steps  
            CONVERT current_state to list of lists and assign to current_matrix  
            FOR i FROM 0 TO m MINUS 1  
                FOR j FROM 0 TO n MINUS 1  
                    CREATE deep copy of current_matrix and assign to next_matrix  
                    CALL flip with next_matrix, i, j  
                    SET next_state TO result of matrix_to_tuple applied to next_matrix  
                    IF next_state NOT IN visited  
                        ADD next_state TO visited  
                        APPEND tuple of next_state and steps PLUS 1 TO queue  
        RETURN -1  
    END FUNCTION  
END CLASS