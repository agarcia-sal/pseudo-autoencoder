CLASS Solution  
    FUNCTION isValid(code)  
        IMPORT regular_expression_module AS re  
        
        SET cdata_pattern TO pattern matching '<![CDATA[ any_characters ]]>'  
        
        SET code TO result of replacing all occurrences matching cdata_pattern in code with empty string using re  
        
        SET stack TO empty list  
        
        SET i TO 0  
        WHILE i LESS THAN length of code  
            IF character at code position i EQUALS '<'  
                SET j TO position of next '>' character in code after position i  
                IF j EQUALS -1  
                    RETURN False  
                
                SET tag_content TO substring of code from position i+1 TO j (excluding j)  
                
                IF tag_content IS empty  
                    RETURN False  
                
                IF first character of tag_content EQUALS '/'  
                    SET tag_name TO substring of tag_content from second character TO end  
                    IF stack IS empty OR last element in stack NOT EQUAL TO tag_name  
                        RETURN False  
                    REMOVE last element from stack  
                ELSE IF first character of tag_content EQUALS '!'  
                    RETURN False  
                ELSE  
                    IF length of tag_content LESS THAN 1 OR GREATER THAN 9 OR tag_content IS NOT all uppercase letters  
                        RETURN False  
                    APPEND tag_content TO stack  
                
                SET i TO j PLUS 1  
            ELSE  
                INCREMENT i BY 1  
        
        RETURN stack IS empty AND number of matches of pattern '<[A-Z]+> any_characters </[A-Z]+>' in code IS GREATER THAN 0  
    END FUNCTION  
END CLASS