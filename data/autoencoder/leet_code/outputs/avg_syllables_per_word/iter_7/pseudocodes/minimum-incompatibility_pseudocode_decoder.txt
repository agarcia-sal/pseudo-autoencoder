CLASS Solution  
    FUNCTION minimumIncompatibility(nums, k)  
        SET n TO LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        IF any count IN counts of nums IS GREATER THAN k THEN  
            RETURN -1  
        
        SET subset_incompatibility TO EMPTY MAP  
        
        FOR mask FROM 0 TO (2 RAISED TO n) MINUS 1  
            IF number of set bits in mask IS EQUAL TO subset_size THEN  
                SET elements TO LIST OF nums at positions where mask has bits set  
                IF number of unique elements IN elements IS EQUAL TO subset_size THEN  
                    SET incompatibility TO maximum element IN elements MINUS minimum element IN elements  
                    SET subset_incompatibility at key mask TO incompatibility  
        
        SET dp TO LIST OF size (2 RAISED TO n) FILLED WITH infinity  
        SET dp at position 0 TO 0  
        
        FOR mask FROM 0 TO (2 RAISED TO n) MINUS 1  
            IF number of set bits in mask MODULO subset_size IS NOT 0 THEN  
                CONTINUE TO NEXT ITERATION  
            FOR each subset_mask IN keys of subset_incompatibility  
                IF subset_mask IS A SUBSET OF mask THEN  
                    SET dp at mask TO MINIMUM OF dp at mask AND (dp at mask WITHOUT subset_mask PLUS subset_incompatibility at subset_mask)  
        
        IF dp at position (2 RAISED TO n) MINUS 1 IS infinity THEN  
            RETURN -1  
        ELSE  
            RETURN dp at position (2 RAISED TO n) MINUS 1  
    END FUNCTION  
END CLASS