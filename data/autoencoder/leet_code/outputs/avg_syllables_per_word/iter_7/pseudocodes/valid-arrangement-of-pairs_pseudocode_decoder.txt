CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO a default dictionary mapping to empty lists  
        SET out_degree TO a counter  
        SET in_degree TO a counter  
  
        FOR each pair (u, v) IN pairs  
            APPEND v TO graph at key u  
            INCREMENT out_degree at key u BY 1  
            INCREMENT in_degree at key v BY 1  
  
        SET start_node TO None  
        FOR each node IN graph keys  
            IF out_degree at node EQUALS in_degree at node PLUS 1  
                SET start_node TO node  
                BREAK loop  
        IF start_node IS None  
            SET start_node TO any node from graph keys  
  
        SET path TO empty list  
        SET stack TO list containing start_node  
  
        WHILE stack IS NOT empty  
            SET u TO last element of stack  
            IF graph at u IS NOT empty  
                SET v TO last element removed from graph at u  
                APPEND v TO stack  
            ELSE  
                APPEND last element removed from stack TO path  
  
        REVERSE path  
  
        SET result TO empty list  
        FOR i FROM 0 TO LENGTH OF path MINUS 2  
            APPEND list containing path at i AND path at i PLUS 1 TO result  
  
        RETURN result  
    END FUNCTION  
END CLASS