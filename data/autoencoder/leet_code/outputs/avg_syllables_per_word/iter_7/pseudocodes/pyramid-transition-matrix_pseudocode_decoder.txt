CLASS Solution  
    FUNCTION pyramidTransition(bottom, allowed)  
        SET allowed_map TO new map with default value as map with default value as empty list  
        FOR each rule IN allowed  
            SET left TO first character of rule  
            SET right TO second character of rule  
            SET top TO third character of rule  
            APPEND top TO allowed_map at key left and key right  
        END FOR  
        
        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF LENGTH OF current_bottom EQUALS 1  
                RETURN True  
            END IF  
            IF LENGTH OF current_top EQUALS LENGTH OF current_bottom MINUS 1  
                RETURN can_build_pyramid(current_top, empty list)  
            END IF  
            
            SET left TO character at position LENGTH OF current_top IN current_bottom  
            SET right TO character at position LENGTH OF current_top PLUS 1 IN current_bottom  
            IF left IS IN allowed_map AND right IS IN allowed_map[left]  
                FOR each top IN allowed_map[left][right]  
                    IF can_build_pyramid(current_bottom, current_top APPENDED WITH top)  
                        RETURN True  
                    END IF  
                END FOR  
            END IF  
            RETURN False  
        END FUNCTION  
        
        RETURN can_build_pyramid(bottom, empty list)  
    END FUNCTION  
END CLASS