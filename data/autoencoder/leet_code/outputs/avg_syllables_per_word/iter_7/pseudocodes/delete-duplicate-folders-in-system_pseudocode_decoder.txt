CLASS TrieNode  
    FUNCTION __init__()  
        SET children TO a default mapping creating new TrieNode on missing keys  
        SET deleted TO False  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION deleteDuplicateFolder(paths)  
        SET ans TO empty list  
        SET root TO new TrieNode  
        SET subtreeToNodes TO a default mapping from string to list of TrieNodes  

        FOR each path IN paths sorted in ascending order  
            SET node TO root  
            FOR each s IN path  
                SET node TO node.children[s]  
        
        FUNCTION buildSubtreeToRoots(node)  
            SET subtree TO open parenthesis concatenated with  
                concatenation of for each s in node.children: s concatenated with buildSubtreeToRoots(node.children[s])  
                concatenated with close parenthesis  
            IF subtree is not equal to empty parentheses  
                APPEND node TO subtreeToNodes[subtree]  
            RETURN subtree  
        END FUNCTION  

        CALL buildSubtreeToRoots(root)  

        FOR each nodes IN subtreeToNodes values  
            IF length of nodes is greater than one  
                FOR each node IN nodes  
                    SET node.deleted TO True  

        FUNCTION constructPath(node, path)  
            FOR each s, child IN node.children items  
                IF child.deleted is False  
                    CALL constructPath(child, path concatenated with s)  
            IF path is not empty  
                APPEND path TO ans  
        END FUNCTION  

        CALL constructPath(root, empty list)  
        RETURN ans  
    END FUNCTION  
END CLASS