CLASS Solution
    FUNCTION braceExpansionII(expression)
        FUNCTION parse_expression(index)
            SET current_set TO empty set
            SET current_product TO list containing empty string
            
            WHILE index LESS THAN length of expression
                SET char TO character at position index in expression
                
                IF char EQUALS '{'
                    SET inner_set, index TO parse_expression(index PLUS 1)
                    SET new_product TO empty list
                    FOR each a IN current_product
                        FOR each b IN inner_set
                            APPEND concatenation of a and b TO new_product
                    SET current_product TO new_product
                
                ELSE IF char EQUALS '}'
                    ADD all concatenations of strings in current_product TO current_set
                    RETURN current_set, index
                
                ELSE IF char EQUALS ','
                    ADD all concatenations of strings in current_product TO current_set
                    SET current_product TO list containing empty string
                
                ELSE 
                    SET updated_product TO empty list
                    FOR each a IN current_product
                        APPEND concatenation of a and char TO updated_product
                    SET current_product TO updated_product
                
                INCREMENT index BY 1
            
            ADD all concatenations of strings in current_product TO current_set
            RETURN current_set, index
        END FUNCTION
        
        SET result_set, _ TO parse_expression(0)
        RETURN sorted list of elements in result_set
    END FUNCTION
END CLASS