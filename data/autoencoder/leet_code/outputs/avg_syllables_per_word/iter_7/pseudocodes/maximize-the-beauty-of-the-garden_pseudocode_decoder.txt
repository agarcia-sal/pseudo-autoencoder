CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        SET indices TO new mapping with default empty list  
        SET prefix_sum TO list of zeros with length LENGTH OF flowers PLUS 1  
        
        FOR i FROM 0 TO LENGTH OF flowers MINUS 1  
            SET prefix_sum AT i PLUS 1 TO prefix_sum AT i PLUS the greater value BETWEEN flowers AT i AND 0  
            APPEND i TO indices AT key flowers AT i  
        
        SET max_beauty TO negative infinity  
        
        FOR each beauty IN keys of indices  
            IF LENGTH OF indices AT beauty IS GREATER THAN OR EQUAL TO 2 THEN  
                SET first TO the first element IN indices AT beauty  
                SET last TO the last element IN indices AT beauty  
                
                SET current_beauty TO 2 TIMES beauty PLUS (prefix_sum AT last MINUS prefix_sum AT first PLUS 1)  
                SET max_beauty TO the greater value BETWEEN max_beauty AND current_beauty  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS