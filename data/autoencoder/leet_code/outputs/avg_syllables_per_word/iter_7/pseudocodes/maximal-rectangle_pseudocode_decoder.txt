CLASS Solution  
    FUNCTION maximalRectangle(matrix)  
        IF matrix IS EMPTY OR first element of matrix IS EMPTY  
            RETURN 0  
        END IF  

        SET rows TO LENGTH OF matrix  
        SET cols TO LENGTH OF first element of matrix  
        SET heights TO list of zeros with length cols  
        SET max_area TO 0  

        FOR i FROM 0 TO rows MINUS 1  
            FOR j FROM 0 TO cols MINUS 1  
                IF matrix at i and j IS '1'  
                    INCREMENT heights at j BY 1  
                ELSE  
                    SET heights at j TO 0  
                END IF  
            END FOR  

            SET max_area TO maximum of max_area AND RESULT OF largestRectangleArea(heights)  
        END FOR  

        RETURN max_area  
    END FUNCTION  

    FUNCTION largestRectangleArea(heights)  
        SET stack TO empty list  
        SET max_area TO 0  
        SET index TO 0  

        WHILE index IS LESS THAN LENGTH OF heights  
            IF stack IS empty OR heights at index IS GREATER THAN OR EQUAL TO heights at top element of stack  
                APPEND index TO stack  
                INCREMENT index BY 1  
            ELSE  
                SET top_of_stack TO element popped from stack  
                IF stack IS NOT empty  
                    SET width TO index MINUS top element of stack MINUS 1  
                ELSE  
                    SET width TO index  
                END IF  
                SET area TO heights at top_of_stack MULTIPLIED BY width  
                SET max_area TO maximum of max_area AND area  
            END IF  
        END WHILE  

        WHILE stack IS NOT empty  
            SET top_of_stack TO element popped from stack  
            IF stack IS NOT empty  
                SET width TO index MINUS top element of stack MINUS 1  
            ELSE  
                SET width TO index  
            END IF  
            SET area TO heights at top_of_stack MULTIPLIED BY width  
            SET max_area TO maximum of max_area AND area  
        END WHILE  

        RETURN max_area  
    END FUNCTION  
END CLASS