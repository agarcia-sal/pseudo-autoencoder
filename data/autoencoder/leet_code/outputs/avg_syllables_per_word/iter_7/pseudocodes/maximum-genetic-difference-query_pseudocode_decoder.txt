CLASS TrieNode  
    FUNCTION __init__()  
        SET children TO mapping with default value of new TrieNode  
        SET count TO 0  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION maxGeneticDifference(parents, queries)  
        SET tree TO mapping with default value of empty list  
        FOR each index i AND parent IN parents  
            IF parent IS NOT equal to -1  
                APPEND i TO tree[parent]  
        
        SET node_queries TO mapping with default value of empty list  
        FOR each node, val IN queries  
            APPEND val TO node_queries[node]  
        
        SET root TO new TrieNode  
        SET result TO list of zeros with length equal to length of queries  
        
        FUNCTION dfs(node)  
            CALL insert(trie_root root, value node)  
            
            FOR each val IN node_queries[node]  
                SET result[query_idx[(node, val)]] TO CALL max_xor(trie_root root, value val)  
            
            FOR each child IN tree[node]  
                CALL dfs(child)  
            
            CALL erase(trie_root root, value node)  
        END FUNCTION  
        
        FUNCTION insert(trie_root, value)  
            SET node TO trie_root  
            FOR i FROM 17 DOWN TO 0  
                SET bit TO bit at position i in value  
                SET node TO node.children[bit]  
                INCREMENT node.count BY 1  
        END FUNCTION  
        
        FUNCTION erase(trie_root, value)  
            SET node TO trie_root  
            FOR i FROM 17 DOWN TO 0  
                SET bit TO bit at position i in value  
                SET node TO node.children[bit]  
                DECREMENT node.count BY 1  
        END FUNCTION  
        
        FUNCTION max_xor(trie_root, value)  
            SET node TO trie_root  
            SET max_xor_val TO 0  
            FOR i FROM 17 DOWN TO 0  
                SET bit TO bit at position i in value  
                SET toggled_bit TO 1 MINUS bit  
                IF toggled_bit EXISTS IN node.children AND node.children[toggled_bit].count IS GREATER THAN 0  
                    SET max_xor_val TO max_xor_val OR bit value with 1 at position i  
                    SET node TO node.children[toggled_bit]  
                ELSE  
                    SET node TO node.children[bit]  
            RETURN max_xor_val  
        END FUNCTION  
        
        SET query_idx TO mapping from (node, val) TO index for each index and (node, val) IN queries  
        
        FOR each index i AND parent IN parents  
            IF parent IS equal to -1  
                CALL dfs(i)  
                EXIT LOOP  
        
        RETURN result  
    END FUNCTION  
END CLASS