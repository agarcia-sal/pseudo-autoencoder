CLASS Solution  
    FUNCTION pacificAtlantic(heights)  
        FUNCTION bfs(q, vis)  
            WHILE q IS NOT EMPTY  
                SET length TO LENGTH OF q  
                FOR index FROM 0 TO length MINUS 1  
                    SET i, j TO REMOVE FIRST ELEMENT FROM q  
                    FOR each pair a, b IN LIST OF DIRECTIONS [(0, -1), (0, 1), (1, 0), (-1, 0)]  
                        SET x TO i PLUS a  
                        SET y TO j PLUS b  
                        IF x IS GREATER THAN OR EQUAL TO 0 AND x IS LESS THAN m  
                            AND y IS GREATER THAN OR EQUAL TO 0 AND y IS LESS THAN n  
                            AND (x, y) IS NOT IN vis  
                            AND heights[x][y] IS GREATER THAN OR EQUAL TO heights[i][j]  
                        THEN  
                            ADD (x, y) TO vis  
                            ADD (x, y) TO q  
        SET m TO LENGTH OF heights  
        SET n TO LENGTH OF heights AT INDEX 0  
        SET vis1 TO EMPTY SET  
        SET vis2 TO EMPTY SET  
        SET q1 TO EMPTY QUEUE  
        SET q2 TO EMPTY QUEUE  
        FOR i FROM 0 TO m MINUS 1  
            FOR j FROM 0 TO n MINUS 1  
                IF i EQUALS 0 OR j EQUALS 0  
                    ADD (i, j) TO vis1  
                    ADD (i, j) TO q1  
                IF i EQUALS m MINUS 1 OR j EQUALS n MINUS 1  
                    ADD (i, j) TO vis2  
                    ADD (i, j) TO q2  
        CALL bfs WITH q1 AND vis1  
        CALL bfs WITH q2 AND vis2  
        SET result TO EMPTY LIST  
        FOR i FROM 0 TO m MINUS 1  
            FOR j FROM 0 TO n MINUS 1  
                IF (i, j) IS IN vis1 AND (i, j) IS IN vis2  
                    ADD (i, j) TO result  
        RETURN result  
    END FUNCTION  
END CLASS