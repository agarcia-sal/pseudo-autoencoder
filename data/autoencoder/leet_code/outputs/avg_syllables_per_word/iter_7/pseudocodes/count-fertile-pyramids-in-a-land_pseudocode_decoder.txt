CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid IS EMPTY OR grid FIRST ROW IS EMPTY THEN  
                RETURN 0  
            END IF  
            SET m TO number of rows in grid  
            SET n TO number of columns in grid  
            INITIALIZE dp AS m rows AND n columns grid filled with 0  
            SET count TO 0  
            FOR i FROM 0 TO m MINUS 1 DO  
                FOR j FROM 0 TO n MINUS 1 DO  
                    IF grid AT position i,j EQUALS 1 THEN  
                        IF i EQUALS 0 OR j EQUALS 0 OR j EQUALS n MINUS 1 THEN  
                            SET dp AT position i,j TO 1  
                        ELSE  
                            SET dp AT position i,j TO minimum of dp AT positions (i MINUS 1, j MINUS 1), (i MINUS 1, j), (i MINUS 1, j PLUS 1) PLUS 1  
                        END IF  
                        IF dp AT position i,j GREATER THAN 1 THEN  
                            INCREMENT count BY dp AT position i,j MINUS 1  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid IS EMPTY OR grid FIRST ROW IS EMPTY THEN  
                RETURN 0  
            END IF  
            SET m TO number of rows in grid  
            SET n TO number of columns in grid  
            INITIALIZE dp AS m rows AND n columns grid filled with 0  
            SET count TO 0  
            FOR i FROM m MINUS 1 DOWN TO 0 DO  
                FOR j FROM 0 TO n MINUS 1 DO  
                    IF grid AT position i,j EQUALS 1 THEN  
                        IF i EQUALS m MINUS 1 OR j EQUALS 0 OR j EQUALS n MINUS 1 THEN  
                            SET dp AT position i,j TO 1  
                        ELSE  
                            SET dp AT position i,j TO minimum of dp AT positions (i PLUS 1, j MINUS 1), (i PLUS 1, j), (i PLUS 1, j PLUS 1) PLUS 1  
                        END IF  
                        IF dp AT position i,j GREATER THAN 1 THEN  
                            INCREMENT count BY dp AT position i,j MINUS 1  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        
        RETURN result of count_pyramids_from_top(grid) PLUS result of count_pyramids_from_bottom(grid)  
    END FUNCTION  
END CLASS