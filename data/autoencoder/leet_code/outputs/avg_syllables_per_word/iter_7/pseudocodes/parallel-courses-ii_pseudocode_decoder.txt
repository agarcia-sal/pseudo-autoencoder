CLASS Solution  
    FUNCTION minNumberOfSemesters(n, relations, k)  
        SET graph TO a mapping from integer to list initialized empty  
        SET in_degree TO list of zeros with length n plus one  
        
        FOR each pair prevCourse, nextCourse IN relations  
            APPEND nextCourse TO graph AT key prevCourse  
            INCREMENT in_degree AT index nextCourse BY 1  
        
        SET queue TO empty double-ended queue  
        FOR course FROM 1 TO n  
            IF in_degree AT index course EQUALS 0  
                APPEND course TO queue  
        
        SET semesters TO 0  
        
        WHILE queue IS NOT empty  
            SET limit TO minimum of k and LENGTH OF queue  
            FOR index FROM 1 TO limit  
                REMOVE leftmost element FROM queue AND SET TO current_course  
                FOR each next_course IN graph AT key current_course  
                    DECREMENT in_degree AT index next_course BY 1  
                    IF in_degree AT index next_course EQUALS 0  
                        APPEND next_course TO queue  
            INCREMENT semesters BY 1  
        
        RETURN semesters  
    END FUNCTION  
END CLASS