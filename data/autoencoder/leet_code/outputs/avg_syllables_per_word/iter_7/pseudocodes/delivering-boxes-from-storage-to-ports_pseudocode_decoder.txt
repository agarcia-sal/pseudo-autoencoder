CLASS Solution  
    FUNCTION boxDelivering(boxes, portsCount, maxBoxes, maxWeight)  
        SET n TO LENGTH OF boxes  
        INITIALIZE dp AS LIST OF SIZE n PLUS 1 FILLED WITH INFINITY  
        SET dp AT INDEX 0 TO 0  
        
        SET left TO 0  
        SET current_weight TO 0  
        SET extra_trips TO 0  
        
        FOR right FROM 0 TO n MINUS 1  
            INCREMENT current_weight BY boxes AT INDEX right AT INDEX 1  
            IF right GREATER THAN 0 AND boxes AT INDEX right AT INDEX 0 NOT EQUAL TO boxes AT INDEX right MINUS 1 AT INDEX 0 THEN  
                INCREMENT extra_trips BY 1  
            END IF  
            
            WHILE left LESS THAN OR EQUAL TO right AND (right MINUS left PLUS 1 GREATER THAN maxBoxes OR current_weight GREATER THAN maxWeight)  
                DECREMENT current_weight BY boxes AT INDEX left AT INDEX 1  
                IF left GREATER THAN 0 AND boxes AT INDEX left AT INDEX 0 NOT EQUAL TO boxes AT INDEX left MINUS 1 AT INDEX 0 THEN  
                    DECREMENT extra_trips BY 1  
                END IF  
                INCREMENT left BY 1  
            END WHILE  
            
            SET dp AT INDEX right PLUS 1 TO dp AT INDEX left PLUS 2 PLUS extra_trips  
        END FOR  
        
        RETURN dp AT INDEX n  
    END FUNCTION  
END CLASS