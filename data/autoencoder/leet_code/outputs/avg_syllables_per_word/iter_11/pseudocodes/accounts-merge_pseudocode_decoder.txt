CLASS UnionFind
    FUNCTION __init__(size)
        SET self.root TO empty list
        SET self.rank TO empty list
        FOR index FROM zero TO size MINUS one
            APPEND index TO self.root
            APPEND one TO self.rank
        END FOR
    END FUNCTION

    FUNCTION find(x)
        IF element at position x of self.root EQUALS x THEN
            RETURN x
        END IF
        SET element at position x of self.root TO self.find(element at position x of self.root)
        RETURN element at position x of self.root
    END FUNCTION

    FUNCTION union(x, y)
        SET rootX TO self.find(x)
        SET rootY TO self.find(y)
        IF rootX NOT EQUALS rootY THEN
            IF element at position rootX of self.rank GREATER THAN element at position rootY of self.rank THEN
                SET element at position rootY of self.root TO rootX
            ELSE IF element at position rootX of self.rank LESS THAN element at position rootY of self.rank THEN
                SET element at position rootX of self.root TO rootY
            ELSE
                SET element at position rootY of self.root TO rootX
                INCREMENT element at position rootX of self.rank BY one
            END IF
        END IF
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION accountsMerge(accounts)
        SET email_to_id TO empty dictionary
        SET uf TO new UnionFind with size EQUALS the LENGTH OF accounts

        FOR i FROM zero TO the LENGTH OF accounts MINUS one
            SET current_account TO element at position i of accounts
            SET name TO element at position zero of current_account
            SET emails TO elements from position one TO the END of current_account
            FOR each email IN emails
                IF email NOT IN email_to_id THEN
                    SET email_to_id at email TO i
                ELSE
                    CALL uf.union with arguments i AND email_to_id at email
                END IF
            END FOR
        END FOR

        SET merged_emails TO empty dictionary with default values as empty list
        FOR each email, account_id IN email_to_id items
            SET root_id TO uf.find(account_id)
            APPEND email TO merged_emails at root_id
        END FOR

        SET result TO empty list
        FOR each account_id, emails IN merged_emails items
            SET name TO element at position zero of element at position account_id of accounts
            SET sorted_emails TO emails sorted in ascending order
            APPEND list containing name FOLLOWED BY sorted_emails TO result
        END FOR

        RETURN result
    END FUNCTION
END CLASS