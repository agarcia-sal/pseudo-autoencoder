CLASS Solution
    FUNCTION removeBoxes(boxes)
        FUNCTION dp(l, r, k, memo)
            IF l GREATER THAN r
                RETURN zero
            END IF

            IF tuple of l, r, k IS IN memo
                RETURN value at key tuple of l, r, k in memo
            END IF

            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes
                DECREMENT r BY one
                INCREMENT k BY one
            END WHILE

            SET res TO dp called with l, r MINUS one, zero, and memo PLUS (k PLUS one) MULTIPLIED BY (k PLUS one)

            FOR i FROM l TO r MINUS one
                IF element at position i of boxes EQUALS element at position r of boxes
                    SET res TO maximum of res AND dp called with l, i, k PLUS one, and memo PLUS dp called with i PLUS one, r MINUS one, zero, and memo
                END IF
            END FOR

            SET value at key tuple of l, r, k in memo TO res
            RETURN res
        END FUNCTION

        RETURN dp called with zero, length of boxes MINUS one, zero, and empty dictionary
    END FUNCTION
END CLASS