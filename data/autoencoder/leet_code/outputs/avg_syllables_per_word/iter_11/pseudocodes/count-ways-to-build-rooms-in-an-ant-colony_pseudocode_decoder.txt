CLASS Solution  
    FUNCTION waysToBuildRooms(prevRoom)  
        IMPORT defaultdict FROM collections  
        
        SET n TO the LENGTH OF prevRoom  
        SET graph TO a new defaultdict of list  
        
        FOR room FROM one TO n MINUS one  
            APPEND room TO the list at key prevRoom at position room in graph  
        END FOR  
        
        FUNCTION dp(node)  
            IF the list at key node in graph IS empty  
                RETURN one AND one  
            END IF  
            
            SET total_ways TO one  
            SET total_size TO one  
            
            SET child_results TO a new empty list  
            FOR each child IN the list at key node in graph  
                SET ways AND size TO dp(child)  
                APPEND the pair (ways, size) TO child_results  
                INCREMENT total_size BY size  
            END FOR  
            
            SET current_size TO one  
            FOR each pair (ways, size) IN child_results  
                SET total_ways TO total_ways MULTIPLIED BY the combination OF current_size PLUS size MINUS one AND size  
                SET total_ways TO total_ways MULTIPLIED BY ways  
                SET total_ways TO total_ways MODULO MOD  
                INCREMENT current_size BY size  
            END FOR  
            
            RETURN total_ways AND total_size  
        END FUNCTION  
        
        RETURN the first element OF dp(zero)  
    END FUNCTION  
END CLASS