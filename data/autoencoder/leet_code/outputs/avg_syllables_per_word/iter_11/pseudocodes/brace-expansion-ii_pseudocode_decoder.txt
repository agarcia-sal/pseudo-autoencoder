CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index LESS THAN the LENGTH OF expression  
                SET char TO element at position index of expression  
                
                IF char EQUALS open curly brace  
                    SET inner_set, index TO parse_expression(index PLUS one)  
                    SET temp_list TO empty list  
                    FOR each a IN current_product  
                        FOR each b IN inner_set  
                            APPEND concatenation of a PLUS b TO temp_list  
                        END FOR  
                    END FOR  
                    SET current_product TO temp_list  
                
                ELSE IF char EQUALS close curly brace  
                    FOR each p IN current_product  
                        ADD concatenation of p TO current_set  
                    END FOR  
                    RETURN current_set, index  
                
                ELSE IF char EQUALS comma  
                    FOR each p IN current_product  
                        ADD concatenation of p TO current_set  
                    END FOR  
                    SET current_product TO list containing empty string  
                
                ELSE  
                    SET temp_list TO empty list  
                    FOR each a IN current_product  
                        APPEND concatenation of a PLUS char TO temp_list  
                    END FOR  
                    SET current_product TO temp_list  
                
                END IF  
                
                INCREMENT index BY one  
            END WHILE  
            
            FOR each p IN current_product  
                ADD concatenation of p TO current_set  
            END FOR  
            RETURN current_set, index  
        END FUNCTION  
        
        SET result_set, unused_variable TO parse_expression(zero)  
        RETURN sorted list of elements in result_set  
    END FUNCTION  
END CLASS