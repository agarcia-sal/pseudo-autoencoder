CLASS Solution  
    FUNCTION wordSquares(words)  
        IMPORT from collections the data structure named defaultdict  
        SET prefix_to_words TO a new defaultdict with list as default value  
        FOR each word IN words  
            FOR i FROM zero TO the LENGTH OF word MINUS one  
                SET prefix TO the substring of word from start TO position i NOT INCLUDING i  
                APPEND word TO the list at key prefix in prefix_to_words  
            END FOR  
        END FOR  
        SET results TO an empty list  

        FUNCTION backtrack(square)  
            IF the LENGTH OF square EQUALS the LENGTH OF the first word in words  
                APPEND square TO results  
                RETURN  
            END IF  
            SET prefix TO the concatenation of the character at position LENGTH OF square in each word of square  
            FOR each candidate IN the list at key prefix in prefix_to_words  
                CALL backtrack with the argument square PLUS a list containing candidate  
            END FOR  
        END FUNCTION  

        FOR each word IN words  
            CALL backtrack with a list containing word  
        END FOR  
        RETURN results  
    END FUNCTION  
END CLASS