CLASS Solution
    FUNCTION removeBoxes(boxes)
        FUNCTION dp(l, r, k, memo)
            IF l GREATER THAN r
                RETURN zero
            END IF

            IF tuple l r k IS IN memo
                RETURN value AT tuple l r k IN memo
            END IF

            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes
                DECREMENT r BY one
                INCREMENT k BY one
            END WHILE

            SET res TO dp(l, r MINUS one, zero, memo) PLUS (k PLUS one) MULTIPLIED BY (k PLUS one)

            FOR i FROM l TO r MINUS one
                IF element at position i of boxes EQUALS element at position r of boxes
                    SET res TO maximum OF res AND dp(l, i, k PLUS one, memo) PLUS dp(i PLUS one, r MINUS one, zero, memo)
                END IF
            END FOR

            SET memo AT tuple l r k TO res
            RETURN res
        END FUNCTION

        RETURN dp(zero, length OF boxes MINUS one, zero, empty dictionary)
    END FUNCTION
END CLASS