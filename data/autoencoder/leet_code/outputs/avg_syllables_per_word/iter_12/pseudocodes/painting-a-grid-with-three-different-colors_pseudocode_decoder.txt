CLASS Solution
    FUNCTION colorTheGrid(m, n)
        SET MOD TO one billion PLUS seven

        FUNCTION generate_valid_columns(prev_col)
            SET colors TO list containing one, two, three
            SET valid_cols TO empty list

            FUNCTION backtrack(col, row)
                IF row EQUALS m
                    APPEND tuple of col TO valid_cols
                    RETURN
                END IF

                FOR each color IN colors
                    IF col IS empty OR last element of col NOT EQUALS color
                        IF prev_col IS NOT NONE AND element at position row of prev_col EQUALS color
                            CONTINUE to next iteration
                        END IF
                        APPEND color TO col
                        CALL backtrack(col, row PLUS one)
                        REMOVE last element FROM col
                    END IF
                END FOR
            END FUNCTION

            CALL backtrack(empty list, zero)
            RETURN valid_cols
        END FUNCTION

        SET all_valid_cols TO CALL generate_valid_columns(NONE)
        SET num_valid_cols TO LENGTH OF all_valid_cols

        SET compatible_cols TO dictionary mapping each integer i from zero TO num_valid_cols MINUS one TO empty list

        FOR i FROM zero TO num_valid_cols MINUS one
            FOR j FROM zero TO num_valid_cols MINUS one
                SET all_positions_different TO TRUE
                FOR k FROM zero TO m MINUS one
                    IF element at position k of element at position i of all_valid_cols EQUALS element at position k of element at position j of all_valid_cols
                        SET all_positions_different TO FALSE
                        BREAK out of this inner FOR loop
                    END IF
                END FOR
                IF all_positions_different IS TRUE
                    APPEND j TO list at key i of compatible_cols
                END IF
            END FOR
        END FOR

        SET dp TO list of length num_valid_cols filled with one

        FOR each index FROM one TO n MINUS one
            SET next_dp TO list of length num_valid_cols filled with zero
            FOR i FROM zero TO num_valid_cols MINUS one
                FOR each j IN list at key i of compatible_cols
                    SET element at position j of next_dp TO element at position j of next_dp PLUS element at position i of dp
                    SET element at position j of next_dp TO element at position j of next_dp MODULO MOD
                END FOR
            END FOR
            SET dp TO next_dp
        END FOR

        SET total_ways TO zero
        FOR each count IN dp
            INCREMENT total_ways BY count
        END FOR

        RETURN total_ways MODULO MOD
    END FUNCTION
END CLASS