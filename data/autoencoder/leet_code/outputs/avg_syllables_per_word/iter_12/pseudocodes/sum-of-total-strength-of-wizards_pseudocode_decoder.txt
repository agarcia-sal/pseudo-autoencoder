CLASS Solution  
    FUNCTION totalStrength(strength)  
        SET MOD TO one billion PLUS seven  
        SET n TO the LENGTH OF strength  
        
        SET prefix TO a list of zeroes of LENGTH n PLUS one  
        FOR i FROM zero TO n MINUS one  
            SET element at position i PLUS one OF prefix TO the REMAINDER OF the SUM OF element at position i OF prefix AND element at position i OF strength DIVIDED BY MOD  
        END FOR  
        
        SET prefix_prefix TO a list of zeroes of LENGTH n PLUS two  
        FOR i FROM zero TO n  
            SET element at position i PLUS one OF prefix_prefix TO the REMAINDER OF the SUM OF element at position i OF prefix_prefix AND element at position i OF prefix DIVIDED BY MOD  
        END FOR  
        
        SET prev_smaller TO a list filled with minus one of LENGTH n  
        SET next_smaller_or_equal TO a list filled with n of LENGTH n  
        
        SET stack TO an empty list  
        FOR i FROM zero TO n MINUS one  
            WHILE the LENGTH OF stack IS greater than zero AND element at position stack at LAST position OF strength IS GREATER THAN OR EQUAL TO element at position i OF strength  
                REMOVE last element FROM stack  
            END WHILE  
            IF the LENGTH OF stack IS greater than zero  
                SET element at position i OF prev_smaller TO element at LAST position OF stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        CLEAR stack  
        FOR i FROM n MINUS one DOWN TO zero  
            WHILE the LENGTH OF stack IS greater than zero AND element at position stack at LAST position OF strength IS GREATER THAN element at position i OF strength  
                REMOVE last element FROM stack  
            END WHILE  
            IF the LENGTH OF stack IS greater than zero  
                SET element at position i OF next_smaller_or_equal TO element at LAST position OF stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        SET total_strength TO zero  
        FOR i FROM zero TO n MINUS one  
            SET left TO element at position i OF prev_smaller PLUS one  
            SET right TO element at position i OF next_smaller_or_equal  
            
            SET sum_left TO the REMAINDER OF the PRODUCT OF (i MINUS left PLUS one) AND (element at position right PLUS one OF prefix_prefix MINUS element at position i PLUS one OF prefix_prefix) DIVIDED BY MOD  
            SET sum_right TO the REMAINDER OF the PRODUCT OF (right MINUS i) AND (element at position i PLUS one OF prefix_prefix MINUS element at position left OF prefix_prefix) DIVIDED BY MOD  
            
            SET contribution TO the REMAINDER OF PRODUCT OF element at position i OF strength AND (sum_left MINUS sum_right) DIVIDED BY MOD  
            SET total_strength TO the REMAINDER OF the SUM OF total_strength AND contribution DIVIDED BY MOD  
        END FOR  
        
        RETURN total_strength  
    END FUNCTION  
END CLASS