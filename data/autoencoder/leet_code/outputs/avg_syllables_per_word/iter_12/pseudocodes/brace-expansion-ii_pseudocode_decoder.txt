CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index LESS THAN the LENGTH OF expression  
                SET char TO element at position index of expression  
                
                IF char EQUALS open brace  
                    SET inner_set AND index TO parse_expression index PLUS one  
                    SET current_product TO list of concatenation of each element a in current_product with each element b in inner_set  
                
                ELSE IF char EQUALS closing brace  
                    ADD each concatenated string from the elements of current_product TO current_set  
                    RETURN current_set AND index  
                
                ELSE IF char EQUALS comma  
                    ADD each concatenated string from the elements of current_product TO current_set  
                    SET current_product TO list containing empty string  
                
                ELSE  
                    SET current_product TO list of concatenation of each element a in current_product with char  
                
                INCREMENT index BY one  
            END WHILE  
            
            ADD each concatenated string from the elements of current_product TO current_set  
            RETURN current_set AND index  
        END FUNCTION  
        
        SET result_set AND discard to parse_expression zero  
        RETURN sorted list of elements in result_set  
    END FUNCTION  
END CLASS