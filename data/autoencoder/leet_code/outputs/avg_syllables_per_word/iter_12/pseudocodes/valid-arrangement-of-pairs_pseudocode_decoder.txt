CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO a mapping with default empty list for each key  
        SET out_degree TO a counting structure mapping elements to counts  
        SET in_degree TO a counting structure mapping elements to counts  
        FOR each pair consisting of u and v IN pairs  
            APPEND v TO the list mapped by u in graph  
            INCREMENT the count of u in out_degree BY one  
            INCREMENT the count of v in in_degree BY one  
        END FOR  
        SET start_node TO nothing  
        FOR each node IN graph  
            IF the count of node in out_degree EQUALS the count of node in in_degree PLUS one  
                SET start_node TO node  
                BREAK  
            END IF  
        END FOR  
        IF start_node IS nothing  
            SET start_node TO the first element in the iteration of graph keys  
        END IF  
        SET path TO an empty list  
        SET stack TO a list containing start_node  
        WHILE the stack IS NOT empty  
            SET u TO the last element of stack  
            IF the list of u in graph IS NOT empty  
                REMOVE the last element FROM the list of u in graph AND SET it TO v  
                APPEND v TO stack  
            ELSE  
                APPEND the last element FROM stack TO path  
            END IF  
        END WHILE  
        REVERSE path  
        SET result TO an empty list  
        FOR i FROM zero TO the LENGTH OF path MINUS one  
            APPEND a list consisting of the element at position i of path AND the element at position i PLUS one of path TO result  
        END FOR  
        RETURN result  
    END FUNCTION  
END CLASS