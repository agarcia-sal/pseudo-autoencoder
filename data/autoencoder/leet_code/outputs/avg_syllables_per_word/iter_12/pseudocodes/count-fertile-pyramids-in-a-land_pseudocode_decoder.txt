CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid EQUALS empty OR first element of grid EQUALS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF first element of grid  
            CALL create_two_dimensional_list with parameters m and n and SET result TO dp  
            SET count TO zero  
            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    IF element at position i of grid AT position j EQUALS one  
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET element at position i of dp AT position j TO one  
                        ELSE  
                            SET element at position i of dp AT position j TO the MINIMUM OF element at position i MINUS one of dp AT position j MINUS one, element at position i MINUS one of dp AT position j, and element at position i MINUS one of dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i of dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i of dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid EQUALS empty OR first element of grid EQUALS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF first element of grid  
            CALL create_two_dimensional_list with parameters m and n and SET result TO dp  
            SET count TO zero  
            FOR i FROM m MINUS one DOWN TO zero  
                FOR j FROM zero TO n MINUS one  
                    IF element at position i of grid AT position j EQUALS one  
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET element at position i of dp AT position j TO one  
                        ELSE  
                            SET element at position i of dp AT position j TO the MINIMUM OF element at position i PLUS one of dp AT position j MINUS one, element at position i PLUS one of dp AT position j, and element at position i PLUS one of dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i of dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i of dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        SET top_count TO the CALL of count_pyramids_from_top with grid  
        SET bottom_count TO the CALL of count_pyramids_from_bottom with grid  
        RETURN top_count PLUS bottom_count  
    END FUNCTION  

    FUNCTION create_two_dimensional_list(m, n)  
        SET list_result TO empty list  
        FOR index FROM zero TO m MINUS one  
            APPEND a list OF zero repeated n TIMES TO list_result  
        END FOR  
        RETURN list_result  
    END FUNCTION  
END CLASS