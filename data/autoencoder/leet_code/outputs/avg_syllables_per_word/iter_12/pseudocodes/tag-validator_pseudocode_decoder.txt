CLASS Solution  
    FUNCTION isValid(code)  
        IMPORT regular expression module as re  
        SET cdata_pattern TO a string representing the regular expression for CDATA sections starting with less than exclamation left square bracket CDATA left square bracket followed by any characters non-greedily followed by right square bracket right square bracket greater than sign  
        SET code TO the result of substituting all occurrences matching cdata_pattern in code with an empty string using regular expression substitution  
        SET stack TO an empty list  
        SET i TO zero  
        WHILE i LESS THAN the length of code  
            IF the element at position i of code EQUALS the less than character  
                SET j TO the position of the first occurrence of the greater than character in code starting from position i plus one  
                IF j EQUALS negative one  
                    RETURN false  
                END IF  
                SET tag_content TO the substring of code starting at position i plus one up to position j minus one inclusive  
                IF tag_content IS empty  
                    RETURN false  
                END IF  
                IF the first character of tag_content EQUALS the forward slash character  
                    SET tag_name TO the substring of tag_content starting from position one to the end  
                    IF stack IS empty OR the last element of stack DOES NOT EQUAL tag_name  
                        RETURN false  
                    END IF  
                    REMOVE the last element FROM stack  
                ELSE IF the first character of tag_content EQUALS the exclamation mark character  
                    RETURN false  
                ELSE  
                    IF NOT (the length of tag_content IS GREATER THAN OR EQUAL TO one AND the length of tag_content IS LESS THAN OR EQUAL TO nine AND tag_content CONSISTS ONLY OF uppercase letters)  
                        RETURN false  
                    END IF  
                    APPEND tag_content TO stack  
                END IF  
                SET i TO j PLUS one  
            ELSE  
                INCREMENT i BY one  
            END IF  
        END WHILE  
        RETURN the logical negation of stack AND the length of the list of all matches of the regular expression less than uppercase letters greater than followed by any characters followed by less than forward slash uppercase letters greater than in code IS GREATER THAN zero  
    END FUNCTION  
END CLASS