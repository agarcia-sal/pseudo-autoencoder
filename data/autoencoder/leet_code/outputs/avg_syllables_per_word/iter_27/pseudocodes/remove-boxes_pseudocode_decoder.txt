CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN zero  
            END IF  
            IF the TUPLE l r k IS IN memo THEN  
                RETURN the VALUE ASSOCIATED WITH the TUPLE l r k IN memo  
            END IF  
            WHILE r GREATER THAN l AND the ELEMENT AT POSITION r OF boxes EQUALS the ELEMENT AT POSITION r MINUS one OF boxes DO  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO the RESULT OF CALLING dp WITH PARAMETERS l r MINUS one zero memo PLUS the RESULT OF (k PLUS one) MULTIPLIED BY (k PLUS one)  
            FOR i FROM l TO r MINUS one DO  
                IF the ELEMENT AT POSITION i OF boxes EQUALS the ELEMENT AT POSITION r OF boxes THEN  
                    SET temp TO the RESULT OF CALLING dp WITH PARAMETERS l i k PLUS one memo PLUS the RESULT OF CALLING dp WITH PARAMETERS i PLUS one r MINUS one zero memo  
                    SET res TO the MAXIMUM OF res AND temp  
                END IF  
            END FOR  
            ASSIGN the VALUE res TO memo AT the KEY THE TUPLE l r k  
            RETURN res  
        END FUNCTION  
        RETURN the RESULT OF CALLING dp WITH PARAMETERS zero the LENGTH OF boxes MINUS one zero AN EMPTY OBJECT  
    END FUNCTION  
END CLASS