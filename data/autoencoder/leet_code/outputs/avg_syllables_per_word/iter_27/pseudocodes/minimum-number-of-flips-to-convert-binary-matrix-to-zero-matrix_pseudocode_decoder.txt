CLASS Solution  
    FUNCTION minFlips(mat)  
        FUNCTION flip(matrix x y)  
            SET directions TO list containing pairs minus one zero one zero zero zero minus one zero one  
            FOR each pair dx dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx GREATER THAN OR EQUAL TO zero AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO zero AND ny LESS THAN n  
                    SET element at position nx position ny of matrix TO one MINUS element at position nx position ny of matrix  
                END IF  
            END FOR  
        END FUNCTION  

        FUNCTION matrix_to_tuple(matrix)  
            RETURN tuple of tuples each constructed by FOR each row IN matrix CONVERT row TO tuple  
        END FUNCTION  

        SET m TO LENGTH OF mat  
        SET n TO LENGTH OF element at position zero of mat  
        SET target TO tuple consisting FOR each number FROM zero TO m MINUS one OF tuple consisting FOR each number FROM zero TO n MINUS one OF zero  
        SET initial_state TO matrix_to_tuple(mat)  
        SET queue TO list containing pair initial_state zero  
        SET visited TO empty set  
        ADD initial_state TO visited  

        WHILE queue IS NOT empty  
            REMOVE first pair FROM queue AND ASSIGN TO current_state steps  
            IF current_state EQUALS target  
                RETURN steps  
            END IF  

            SET current_matrix TO list constructed FOR each row IN current_state CONVERT row TO list  

            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    SET next_matrix TO deep copy OF current_matrix  
                    CALL flip(next_matrix i j)  
                    SET next_state TO matrix_to_tuple(next_matrix)  
                    IF next_state NOT IN visited  
                        ADD next_state TO visited  
                        APPEND pair next_state steps PLUS one TO queue  
                    END IF  
                END FOR  
            END FOR  
        END WHILE  

        RETURN minus one  
    END FUNCTION  
END CLASS