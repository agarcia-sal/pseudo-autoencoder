CLASS Solution
    FUNCTION confusingNumberII(n)
        SET rotate_map TO {0 maps to 0, 1 maps to 1, 6 maps to 9, 8 maps to 8, 9 maps to 6}
        SET valid_digits TO [0, 1, 6, 8, 9]

        FUNCTION is_confusing(num)
            SET original_num TO num
            SET rotated_num TO 0
            WHILE num GREATER THAN 0
                SET digit TO num MODULO 10
                SET rotated_num TO rotated_num MULTIPLIED BY 10 PLUS rotate_map[digit]
                SET num TO num DIVIDED BY 10 (integer division)
            IF rotated_num NOT EQUAL TO original_num
                RETURN True
            ELSE
                RETURN False
        END FUNCTION

        FUNCTION count_confusing_numbers(limit, current = 0)
            IF current GREATER THAN limit
                RETURN 0
            SET count TO 0
            IF current NOT EQUAL TO 0 AND is_confusing(current) IS True
                SET count TO 1
            FOR EACH digit IN valid_digits
                SET new_number TO current MULTIPLIED BY 10 PLUS digit
                IF new_number EQUAL TO 0
                    CONTINUE to next iteration
                INCREMENT count BY count_confusing_numbers(limit, new_number)
            RETURN count
        END FUNCTION

        RETURN count_confusing_numbers(n)
    END FUNCTION
END CLASS