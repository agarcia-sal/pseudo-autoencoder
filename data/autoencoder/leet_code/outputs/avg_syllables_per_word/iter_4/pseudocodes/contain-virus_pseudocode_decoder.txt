CLASS Solution
    FUNCTION containVirus(isInfected: List of List of Integer) RETURNS Integer
        FUNCTION neighbors(r: Integer, c: Integer) RETURNS List of Tuple of Integer, Integer
            RETURN list containing (r + 1, c), (r - 1, c), (r, c + 1), (r, c - 1)
        END FUNCTION

        FUNCTION bfs(r: Integer, c: Integer) RETURNS Tuple of Set of Tuple of Integer, Integer, Set of Tuple of Integer, Integer
            SET infected TO empty set
            SET threatened TO empty set
            SET queue TO deque containing (r, c)
            SET visited TO set containing (r, c)
            WHILE queue is not empty
                SET x, y TO queue.pop left
                ADD (x, y) TO infected
                FOR each nx, ny IN neighbors(x, y)
                    IF nx is greater or equal to 0 AND nx less than m AND ny greater or equal to 0 AND ny less than n AND (nx, ny) not in visited THEN
                        ADD (nx, ny) TO visited
                        IF isInfected[nx][ny] equals 1 THEN
                            APPEND (nx, ny) TO queue
                        ELSE IF isInfected[nx][ny] equals 0 THEN
                            ADD (nx, ny) TO threatened
                        END IF
                    END IF
                END FOR
            END WHILE
            RETURN infected, threatened
        END FUNCTION

        FUNCTION build_walls(infected: Set of Tuple of Integer, Integer) RETURNS Integer
            SET walls TO 0
            FOR each x, y IN infected
                FOR each nx, ny IN neighbors(x, y)
                    IF nx is greater or equal to 0 AND nx less than m AND ny greater or equal to 0 AND ny less than n AND isInfected[nx][ny] equals 0 THEN
                        INCREMENT walls BY 1
                    END IF
                END FOR
            END FOR
            RETURN walls
        END FUNCTION

        FUNCTION spread_virus(threatened: Set of Tuple of Integer, Integer)
            FOR each x, y IN threatened
                SET isInfected[x][y] TO 1
            END FOR
        END FUNCTION

        SET m TO LENGTH OF isInfected
        SET n TO LENGTH OF isInfected[0]
        SET total_walls TO 0

        WHILE TRUE
            SET regions TO empty list
            SET visited TO empty set
            FOR r FROM 0 TO m MINUS 1
                FOR c FROM 0 TO n MINUS 1
                    IF isInfected[r][c] equals 1 AND (r, c) not in visited THEN
                        SET infected, threatened TO bfs(r, c)
                        APPEND (infected, threatened) TO regions
                        SET visited TO UNION of visited AND infected
                    END IF
                END FOR
            END FOR

            IF regions is empty THEN
                BREAK
            END IF

            SORT regions BY descending size of threatened set

            SET total_walls TO total_walls PLUS build_walls(regions[0][0])
            FOR each x, y IN regions[0][0]
                SET isInfected[x][y] TO -1
            END FOR

            FOR i FROM 1 TO LENGTH OF regions MINUS 1
                CALL spread_virus(regions[i][1])
            END FOR
        END WHILE

        RETURN total_walls
    END FUNCTION
END CLASS