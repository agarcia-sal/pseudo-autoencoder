CLASS Solution
    FUNCTION validArrangement(pairs)
        SET graph TO empty map with list as default value
        SET out_degree TO empty map with integer default
        SET in_degree TO empty map with integer default
        
        FOR each (u, v) IN pairs
            APPEND v TO graph[u]
            INCREMENT out_degree[u] BY 1
            INCREMENT in_degree[v] BY 1
        
        SET start_node TO null
        FOR each node IN keys of graph
            IF out_degree[node] EQUALS in_degree[node] PLUS 1
                SET start_node TO node
                BREAK LOOP
        IF start_node IS null
            SET start_node TO any key from graph
        
        SET path TO empty list
        SET stack TO list containing start_node
        
        WHILE stack IS NOT empty
            SET u TO last element in stack
            IF graph[u] IS NOT empty
                SET v TO last element popped from graph[u]
                APPEND v TO stack
            ELSE
                APPEND last element popped from stack TO path
        
        REVERSE path
        
        SET result TO empty list
        FOR i FROM 0 TO LENGTH OF path MINUS 2
            APPEND [path[i], path[i + 1]] TO result
        
        RETURN result
    END FUNCTION
END CLASS