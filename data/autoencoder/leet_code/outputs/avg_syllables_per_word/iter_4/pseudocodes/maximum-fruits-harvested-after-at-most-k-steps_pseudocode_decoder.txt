CLASS Solution
    FUNCTION maxTotalFruits(fruits, startPos, k)
        SET max_fruits TO 0
        SET total_fruits TO 0
        SET left TO 0
        
        FOR right FROM 0 TO LENGTH OF fruits MINUS 1
            SET position TO fruits[right][0]
            SET amount TO fruits[right][1]
            INCREMENT total_fruits BY amount
            
            WHILE left <= right AND NOT (
                fruits[left][0] BETWEEN startPos - k AND startPos + k AND
                fruits[right][0] BETWEEN startPos - k AND startPos + k AND
                MIN(ABS(fruits[right][0] - startPos), ABS(fruits[left][0] - startPos)) +
                fruits[right][0] - fruits[left][0] <= k
            )
                DECREMENT total_fruits BY fruits[left][1]
                INCREMENT left BY 1
            
            SET max_fruits TO MAXIMUM OF max_fruits AND total_fruits
        
        RETURN max_fruits
    END FUNCTION
END CLASS