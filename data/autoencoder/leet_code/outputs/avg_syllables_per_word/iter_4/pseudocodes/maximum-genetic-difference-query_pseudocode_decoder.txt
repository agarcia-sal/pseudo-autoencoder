CLASS TrieNode
    FUNCTION __init__()
        SET children TO new default dictionary with default value TrieNode
        SET count TO 0
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION maxGeneticDifference(parents: List[int], queries: List[List[int]]) -> List[int]
        SET tree TO new default dictionary of lists
        FOR i, parent IN enumerate(parents)
            IF parent NOT EQUAL TO -1 THEN
                APPEND i TO tree[parent]
        
        SET node_queries TO new default dictionary of lists
        FOR node, val IN queries
            APPEND val TO node_queries[node]
        
        SET root TO new TrieNode()
        SET result TO list of zeros with length equal to length of queries
        
        SET query_idx TO dictionary mapping (node, val) TO index for each index, (node, val) IN enumerate(queries)
        
        FUNCTION insert(trie_root: TrieNode, value: int)
            SET node TO trie_root
            FOR i FROM 17 DOWNTO 0
                SET bit TO value SHIFTED RIGHT BY i AND 1
                SET node TO node.children[bit]
                INCREMENT node.count BY 1
            END FOR
        END FUNCTION
        
        FUNCTION erase(trie_root: TrieNode, value: int)
            SET node TO trie_root
            FOR i FROM 17 DOWNTO 0
                SET bit TO value SHIFTED RIGHT BY i AND 1
                SET node TO node.children[bit]
                DECREMENT node.count BY 1
            END FOR
        END FUNCTION
        
        FUNCTION max_xor(trie_root: TrieNode, value: int) RETURNS int
            SET node TO trie_root
            SET max_xor_val TO 0
            FOR i FROM 17 DOWNTO 0
                SET bit TO value SHIFTED RIGHT BY i AND 1
                SET toggled_bit TO 1 MINUS bit
                IF toggled_bit IN node.children AND node.children[toggled_bit].count > 0 THEN
                    SET max_xor_val TO max_xor_val OR (1 SHIFTED LEFT BY i)
                    SET node TO node.children[toggled_bit]
                ELSE
                    SET node TO node.children[bit]
            RETURN max_xor_val
        END FUNCTION
        
        FUNCTION dfs(node: int)
            CALL insert(root, node)
            FOR val IN node_queries[node]
                SET index TO query_idx[(node, val)]
                SET result[index] TO max_xor(root, val)
            FOR child IN tree[node]
                CALL dfs(child)
            CALL erase(root, node)
        END FUNCTION
        
        FOR i, parent IN enumerate(parents)
            IF parent EQUALS -1 THEN
                CALL dfs(i)
                BREAK
        
        RETURN result
    END FUNCTION
END CLASS