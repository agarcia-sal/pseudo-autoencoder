CLASS UnionFind
    FUNCTION __init__()
        SET self.parent TO empty dictionary
        SET self.count TO 0
    END FUNCTION

    FUNCTION make_set(x)
        IF x NOT IN self.parent THEN
            SET self.parent[x] TO x
            INCREMENT self.count BY 1
        END IF
    END FUNCTION

    FUNCTION find(x)
        IF self.parent[x] IS NOT x THEN
            SET self.parent[x] TO self.find(self.parent[x])
        END IF
        RETURN self.parent[x]
    END FUNCTION

    FUNCTION union(x, y)
        SET rootX TO self.find(x)
        SET rootY TO self.find(y)
        IF rootX IS NOT rootY THEN
            SET self.parent[rootX] TO rootY
            DECREMENT self.count BY 1
        END IF
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION numIslands2(m, n, positions)
        FUNCTION is_valid(x, y)
            RETURN x IS GREATER OR EQUAL TO 0 AND x IS LESS THAN m AND y IS GREATER OR EQUAL TO 0 AND y IS LESS THAN n
        END FUNCTION

        SET directions TO LIST OF (1,0), (-1,0), (0,1), (0,-1)
        SET uf TO NEW UnionFind
        SET grid TO 2D LIST WITH m ROWS AND n COLUMNS FILLED WITH 0
        SET result TO empty LIST

        FOR EACH r, c IN positions DO
            IF grid[r][c] IS 1 THEN
                APPEND uf.count TO result
                CONTINUE TO NEXT ITERATION
            END IF

            SET grid[r][c] TO 1
            CALL uf.make_set WITH (r, c)

            FOR EACH dr, dc IN directions DO
                SET nr TO r PLUS dr
                SET nc TO c PLUS dc
                IF is_valid(nr, nc) AND grid[nr][nc] IS 1 THEN
                    CALL uf.union WITH (r, c) AND (nr, nc)
                END IF
            END FOR

            APPEND uf.count TO result
        END FOR

        RETURN result
    END FUNCTION
END CLASS