CLASS Solution
    FUNCTION countSmaller(nums: List of Integer) RETURNS List of Integer
        SET sorted_nums TO sorted unique elements of nums
        SET rank TO map each value in sorted_nums TO its index plus one
        
        SET bit TO list of zeros with length of sorted_nums plus one
        
        FUNCTION get_sum(idx)
            SET res TO 0
            WHILE idx greater than 0
                INCREMENT res BY bit at idx
                DECREMENT idx BY lowest set bit of idx
            RETURN res
        END FUNCTION
        
        FUNCTION update(idx, delta)
            WHILE idx less than length of bit
                INCREMENT bit at idx BY delta
                INCREMENT idx BY lowest set bit of idx
        END FUNCTION
        
        SET counts TO empty list
        FOR each num IN nums in reversed order
            SET r TO rank at num
            APPEND get_sum(r minus 1) TO counts
            CALL update with r and 1
        RETURN reversed counts
    END FUNCTION
END CLASS