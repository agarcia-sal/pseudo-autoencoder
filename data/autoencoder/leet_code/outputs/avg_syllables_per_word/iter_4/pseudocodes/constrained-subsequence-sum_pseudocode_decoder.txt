CLASS Solution
    FUNCTION constrainedSubsetSum(nums: List[int], k: int) RETURNS int
        SET n TO LENGTH OF nums
        SET dp TO LIST OF SIZE n WITH ALL VALUES 0
        SET dp[0] TO nums[0]
        SET max_sum TO nums[0]
        SET q TO DEQUE CONTAINING 0
        
        FOR i FROM 1 TO n MINUS 1
            IF dp[q[0]] > 0 THEN
                SET dp[i] TO nums[i] PLUS dp[q[0]]
            ELSE
                SET dp[i] TO nums[i]
            END IF
            
            IF dp[i] > max_sum THEN
                SET max_sum TO dp[i]
            END IF
            
            WHILE q IS NOT EMPTY AND dp[i] >= dp[q[-1]] DO
                REMOVE LAST ELEMENT FROM q
            END WHILE
            
            APPEND i TO q
            
            IF q[0] EQUALS i MINUS k THEN
                REMOVE FIRST ELEMENT FROM q
            END IF
        END FOR
        
        RETURN max_sum
    END FUNCTION
END CLASS