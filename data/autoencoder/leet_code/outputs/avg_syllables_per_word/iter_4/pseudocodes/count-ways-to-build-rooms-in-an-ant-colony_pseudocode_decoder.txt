CLASS Solution
    FUNCTION waysToBuildRooms(prevRoom: List[int]) RETURNS int
        SET n TO LENGTH OF prevRoom
        INITIALIZE graph AS a map with default empty list
        
        FOR room FROM 1 TO n - 1
            APPEND room TO graph[prevRoom[room]]
        
        FUNCTION dp(node) RETURNS (int, int)
            IF graph[node] IS EMPTY
                RETURN 1, 1
            
            SET total_ways TO 1
            SET total_size TO 1
            INITIALIZE child_results AS empty list
            
            FOR each child IN graph[node]
                SET ways, size TO dp(child)
                APPEND (ways, size) TO child_results
                INCREMENT total_size BY size
            
            SET current_size TO 1
            FOR each (ways, size) IN child_results
                SET total_ways TO (total_ways * COMBINATION(current_size + size - 1, size) * ways) MODULO 1000000007
                INCREMENT current_size BY size
            
            RETURN total_ways, total_size
        
        RETURN dp(0)[0]
END CLASS