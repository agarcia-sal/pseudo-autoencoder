CLASS Solution
    FUNCTION numSquarefulPerms(nums)
        FUNCTION is_square(n)
            SET root TO SQUARE_ROOT OF n CONVERTED TO INTEGER
            RETURN root MULTIPLIED BY root EQUALS n
        END FUNCTION

        FUNCTION backtrack(path, count)
            IF LENGTH OF path EQUALS LENGTH OF nums THEN
                RETURN 1
            END IF

            SET ans TO 0
            FOR each x IN count KEYS DO
                IF count[x] GREATER THAN 0 AND (path IS EMPTY OR is_square(path LAST ELEMENT PLUS x)) THEN
                    DECREMENT count[x] BY 1
                    SET ans TO ans PLUS backtrack(path APPENDED WITH x, count)
                    INCREMENT count[x] BY 1
                END IF
            END FOR
            RETURN ans
        END FUNCTION

        SET count TO COUNTER OF nums
        RETURN backtrack(EMPTY LIST, count)
    END FUNCTION
END CLASS