CLASS Solution
    FUNCTION minNumberOfSemesters(n, relations, k)
        SET graph TO a mapping from integer to list
        SET in_degree TO a list of zeros with length n + 1
        
        FOR each pair prevCourse, nextCourse IN relations
            APPEND nextCourse TO graph[prevCourse]
            INCREMENT in_degree[nextCourse] BY 1
        
        SET queue TO an empty double-ended queue
        FOR course FROM 1 TO n
            IF in_degree[course] EQUALS 0
                APPEND course TO queue
        
        SET semesters TO 0
        
        WHILE queue is not empty
            SET courses_this_semester TO minimum of k and LENGTH OF queue
            FOR i FROM 1 TO courses_this_semester
                SET current_course TO POP leftmost element FROM queue
                FOR each next_course IN graph[current_course]
                    DECREMENT in_degree[next_course] BY 1
                    IF in_degree[next_course] EQUALS 0
                        APPEND next_course TO queue
            INCREMENT semesters BY 1
        
        RETURN semesters
    END FUNCTION
END CLASS