```
n = len(nums)
dp = array of size n with dp[0] = nums[0]
max_sum = nums[0]
q = deque with [0]

for i in 1 to n-1:
    dp[i] = nums[i] + (dp[q[0]] if dp[q[0]] > 0 else 0)
    max_sum = max(max_sum, dp[i])
    while q not empty and dp[i] >= dp[q[-1]]: q.pop()
    q.append(i)
    if q[0] == i - k: q.popleft()

return max_sum
```