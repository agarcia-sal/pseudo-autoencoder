```
n ← length of piles
dp ← 2D array of size (n+1)×(k+1), initialized with 0

for i in 1 to n:
  for j in 1 to k:
    current_value ← 0
    for l in 0 to min(j, length(piles[i-1])):
      if l > 0:
        current_value += piles[i-1][l-1]
      dp[i][j] ← max(dp[i][j], dp[i-1][j-l] + current_value)

return dp[n][k]
```