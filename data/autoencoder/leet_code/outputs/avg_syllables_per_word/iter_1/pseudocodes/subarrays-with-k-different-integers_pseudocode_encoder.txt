```
function subarraysWithKDistinct(nums, k):
    function atMostKDistinct(t):
        count = empty map, left = 0, res = 0
        for right in 0..len(nums)-1:
            increment count[nums[right]]
            while size(count) > t:
                decrement count[nums[left]]
                if count[nums[left]] == 0: remove nums[left] from count
                left += 1
            res += right - left + 1
        return res
    return atMostKDistinct(k) - atMostKDistinct(k - 1)
```