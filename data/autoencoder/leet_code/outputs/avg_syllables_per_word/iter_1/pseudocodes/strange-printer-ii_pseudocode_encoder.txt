```
for each color: bounds[color] = [∞, ∞, -∞, -∞]
for r in rows, c in cols:
    color = grid[r][c]
    update bounds[color] = [min(r), min(c), max(r), max(c)]

graph, indeg = {}, {}
for color, (minr, minc, maxr, maxc) in bounds:
    for r in range minr to maxr:
        for c in range minc to maxc:
            if grid[r][c] ≠ color:
                graph[grid[r][c]] += color
                indeg[color] += 1

queue = colors with indeg=0
visited = 0
while queue not empty:
    color = pop from queue
    visited +=1
    for nxt in graph[color]:
        indeg[nxt] -=1
        if indeg[nxt]==0: push nxt to queue

return visited == number of colors
```