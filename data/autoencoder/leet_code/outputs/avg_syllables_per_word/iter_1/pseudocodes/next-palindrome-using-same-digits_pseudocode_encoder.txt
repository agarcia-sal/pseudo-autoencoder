```
n = length(num)
half = first n//2 chars of num
half_list = list(half)

k = max i in [0..len(half_list)-2] where half_list[i]<half_list[i+1], else -1
if k == -1: return ""

l = max i in [k+1..len(half_list)-1] where half_list[i]>half_list[k]

swap half_list[k], half_list[l]
half_list = half_list[:k+1] + sorted(half_list[k+1:])

new_half = join(half_list)
if n even: return new_half + reverse(new_half)
else: return new_half + num[n//2] + reverse(new_half)
```