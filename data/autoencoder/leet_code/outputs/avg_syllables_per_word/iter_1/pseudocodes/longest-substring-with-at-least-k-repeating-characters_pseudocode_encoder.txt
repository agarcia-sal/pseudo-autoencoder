```
func longestSubstring(s, k):
    if len(s) < k: return 0
    count = freq_map(s)
    for c in count:
        if count[c] < k:
            return max(longestSubstring(sub, k) for sub in split(s, c))
    return len(s)
```