```
define isValid(code):
    remove all '<![CDATA[...]]>' from code
    stack ← empty list
    i ← 0
    while i < length(code):
        if code[i] = '<':
            j ← index of '>' after i
            if j = -1: return False
            tag ← substring(code, i+1, j)
            if tag empty: return False
            if tag starts with '/':
                if stack empty or stack top ≠ tag[1:]: return False
                pop stack
            else if tag starts with '!': return False
            else:
                if length(tag) not in [1..9] or not all uppercase(tag): return False
                push tag to stack
            i ← j + 1
        else:
            i ← i + 1
    return stack empty and code contains at least one '<TAG>...</TAG>' pattern with uppercase TAG
```