```
init graph, in_degree array[1..n] = 0
for prev, nxt in relations:
    graph[prev].append(nxt)
    in_degree[nxt] += 1

queue = all courses with in_degree == 0
semesters = 0

while queue not empty:
    take up to k courses from queue:
        for each course:
            for nxt in graph[course]:
                in_degree[nxt] -= 1
                if in_degree[nxt] == 0:
                    queue.append(nxt)
    semesters += 1

return semesters
```