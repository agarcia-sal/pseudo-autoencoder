```
deg = array of size n+1 zeroed
for (u,v) in edges: deg[u]+=1; deg[v]+=1

shared = map default int
for (u,v) in edges: if u>v swap(u,v); shared[(u,v)]+=1

sd = sorted(deg)

res = []
for q in queries:
    cnt=0
    l=1; r=n
    while l<r:
        if sd[l]+sd[r]>q: cnt+=(r-l); r-=1
        else: l+=1
    for (u,v), c in shared.items():
        s=deg[u]+deg[v]
        if s>q and s-c<=q: cnt-=1
    res.append(cnt)

return res
```