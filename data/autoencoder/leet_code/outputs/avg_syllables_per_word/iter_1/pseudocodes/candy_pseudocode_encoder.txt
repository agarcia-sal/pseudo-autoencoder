```
set n = length(ratings)
set candies = array of size n filled with 1

for i in 1 to n-1:
    if ratings[i] > ratings[i-1]:
        candies[i] = candies[i-1] + 1

for i in n-2 down to 0:
    if ratings[i] > ratings[i+1]:
        candies[i] = max(candies[i], candies[i+1] + 1)

return sum(candies)
```