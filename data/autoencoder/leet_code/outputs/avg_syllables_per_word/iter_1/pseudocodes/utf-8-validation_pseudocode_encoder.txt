```
func validUtf8(data):
  get_byte_count(b) =
    if b >> 7 == 0b0: 1
    else if b >> 5 == 0b110: 2
    else if b >> 4 == 0b1110: 3
    else if b >> 3 == 0b11110: 4
    else: -1

  i = 0
  while i < len(data):
    n = get_byte_count(data[i])
    if n == -1 or i + n > len(data):
      return False
    for j in range(i+1, i+n):
      if data[j] >> 6 != 0b10:
        return False
    i += n
  return True
```