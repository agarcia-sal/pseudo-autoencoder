```
if batchSize = 1: return len(groups)
cnt = array of size batchSize with zeroes
for g in groups: cnt[g % batchSize] += 1

define dp(rem, cnt...):
    max_h = 0
    for i in 0 to batchSize-1:
        if cnt[i] = 0: continue
        cnt[i] -= 1
        new_rem = (rem - i) mod batchSize
        happy = 1 + dp(new_rem, cnt...) if rem = 0 else dp(new_rem, cnt...)
        max_h = max(max_h, happy)
        cnt[i] += 1
    return max_h

return dp(0, cnt...)
```