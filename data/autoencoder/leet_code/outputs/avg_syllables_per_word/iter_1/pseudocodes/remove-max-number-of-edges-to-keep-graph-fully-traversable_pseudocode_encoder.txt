```
init uf_common, uf_alice, uf_bob with n
used = 0

for t,u,v in edges:
  if t=3 and uf_common.union(u,v):
    uf_alice.union(u,v)
    uf_bob.union(u,v)
    used += 1

for t,u,v in edges:
  if t=1 and uf_alice.union(u,v): used += 1
  else if t=2 and uf_bob.union(u,v): used += 1

if uf_alice.count=1 and uf_bob.count=1: return len(edges)-used
else: return -1
```