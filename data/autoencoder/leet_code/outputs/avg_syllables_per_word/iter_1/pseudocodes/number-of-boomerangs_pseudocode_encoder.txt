```
set ans = 0
for each p1 in points:
    create empty map cnt
    for each p2 in points:
        d = (p1.x - p2.x)^2 + (p1.y - p2.y)^2
        ans += cnt[d]
        cnt[d] += 1
return ans * 2
```