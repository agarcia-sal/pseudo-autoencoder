```
init cols[n], hills[2n-1], dales[2n-1] = 0

fn is_safe(r,c) = (cols[c] + hills[r-c] + dales[r+c]) == 0
fn place(r,c): cols[c]=1; hills[r-c]=1; dales[r+c]=1
fn remove(r,c): cols[c]=0; hills[r-c]=0; dales[r+c]=0

fn backtrack(r=0, cnt=0):
  for c in 0..n-1:
    if is_safe(r,c):
      place(r,c)
      cnt += (r+1 == n) ? 1 : backtrack(r+1, cnt)
      remove(r,c)
  return cnt

ret = backtrack()
```