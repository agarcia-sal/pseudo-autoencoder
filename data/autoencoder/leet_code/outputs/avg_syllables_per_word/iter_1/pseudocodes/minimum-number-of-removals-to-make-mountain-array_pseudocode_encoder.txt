```
n = length(nums)
lis = array of size n, filled with 1
for i in 0 to n-1:
  for j in 0 to i-1:
    if nums[i] > nums[j]:
      lis[i] = max(lis[i], lis[j] + 1)

lds = array of size n, filled with 1
for i in n-1 down to 0:
  for j in i+1 to n-1:
    if nums[i] > nums[j]:
      lds[i] = max(lds[i], lds[j] + 1)

max_mountain = 0
for i in 1 to n-2:
  if lis[i] > 1 and lds[i] > 1:
    max_mountain = max(max_mountain, lis[i] + lds[i] - 1)

return n - max_mountain
```