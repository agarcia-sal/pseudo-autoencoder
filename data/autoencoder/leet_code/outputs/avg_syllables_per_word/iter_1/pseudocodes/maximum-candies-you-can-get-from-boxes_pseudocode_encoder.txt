```
init boxes = set(initialBoxes), keys = empty set, total = 0
repeat until no progress:
  progress = false
  for box in copy of boxes:
    if status[box] open or box in keys:
      total += candies[box]
      keys += keys[box]
      boxes += containedBoxes[box]
      boxes -= box
      progress = true
return total
```