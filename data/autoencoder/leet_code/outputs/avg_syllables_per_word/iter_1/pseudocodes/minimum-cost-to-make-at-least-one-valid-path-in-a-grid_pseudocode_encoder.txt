```
m,n = size(grid)
dirs = [(0,1),(0,-1),(1,0),(-1,0)]
costs = matrix(m,n,inf)
costs[0][0] = 0
pq = [(0,0,0)]  # cost,i,j
visited = set()

while pq:
    c,i,j = pop_min(pq)
    if (i,j) in visited: continue
    visited.add((i,j))
    if i==m-1 and j==n-1: return c
    for k,(di,dj) in enumerate(dirs):
        ni,nj = i+di,j+dj
        if in_bounds(ni,nj,m,n):
            nc = c + (1 if k+1 != grid[i][j] else 0)
            if nc < costs[ni][nj]:
                costs[ni][nj] = nc
                push(pq,(nc,ni,nj))
return -1
```