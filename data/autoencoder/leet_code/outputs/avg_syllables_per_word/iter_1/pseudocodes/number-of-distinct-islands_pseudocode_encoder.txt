```
for i in range(rows): for j in range(cols):
  if grid[i][j] == 1:
    path = []
    dfs(i, j, 'o')
    unique.add(tuple(path))

def dfs(i, j, d):
  if i in [0..rows) and j in [0..cols) and grid[i][j]==1:
    grid[i][j] = 0
    path.append(d)
    dfs(i+1, j, 'd'); dfs(i-1, j, 'u')
    dfs(i, j+1, 'r'); dfs(i, j-1, 'l')
    path.append('b')
  return path

return len(unique)
```