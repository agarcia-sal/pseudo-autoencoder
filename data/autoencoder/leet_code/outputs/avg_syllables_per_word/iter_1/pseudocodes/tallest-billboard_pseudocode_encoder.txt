```
dp = {0: 0}
for rod in rods:
    new_dp = dp.copy()
    for d, y in dp.items():
        new_dp[d + rod] = max(new_dp.get(d + rod, 0), y)
        new_dp[abs(d - rod)] = max(new_dp.get(abs(d - rod), 0), y + min(d, rod))
    dp = new_dp
return dp[0]
```