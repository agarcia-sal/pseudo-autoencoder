```
define is_square(n): return (int(sqrt(n)))Â² = n

define backtrack(path, count):
    if length(path) = length(nums): return 1
    ans = 0
    for x in keys(count):
        if count[x] > 0 and (empty(path) or is_square(last(path) + x)):
            count[x] -= 1
            ans += backtrack(path + [x], count)
            count[x] += 1
    return ans

count = frequency_map(nums)
return backtrack([], count)
```