```
if not grid or not grid[0]: return 0
n = len(grid)
if n == 1: return min(grid[0])
dp = grid[0][:]
for i in 1 to n-1:
    min1 = min2 = inf; min1_idx = -1
    for j in 0 to n-1:
        if dp[j] < min1: min2 = min1; min1 = dp[j]; min1_idx = j
        else if dp[j] < min2: min2 = dp[j]
    new_dp = [0]*n
    for j in 0 to n-1:
        if j == min1_idx: new_dp[j] = grid[i][j] + min2
        else: new_dp[j] = grid[i][j] + min1
    dp = new_dp
return min(dp)
```