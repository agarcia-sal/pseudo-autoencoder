```
sort envelopes by (width asc, height desc)
dp = []
for each (_, h) in envelopes:
    i = binary_search_left(dp, h)
    if i == length(dp):
        append h to dp
    else:
        dp[i] = h
return length(dp)
```