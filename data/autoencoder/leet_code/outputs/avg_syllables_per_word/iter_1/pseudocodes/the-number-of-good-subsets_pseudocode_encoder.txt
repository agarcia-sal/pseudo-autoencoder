```
prime_factors = {...}  # as given
MOD = 10**9+7
map prime p to bit (p-1)

count = Counter(nums)
dp = array[0..(1<<10)-1] of int; dp[0] = 1

for num in count:
  if num == 1:
    dp[0] = dp[0] * (2^(count[1])) mod MOD
  else if num in prime_factors:
    mask = 0
    for p in prime_factors[num]:
      mask |= 1 << (p-1)
    for m in ( (1<<10)-1 .. 0 ):
      if m & mask == 0:
        dp[m|mask] = (dp[m|mask] + dp[m] * count[num]) mod MOD

return sum(dp[1..]) mod MOD
```