```
convert n to binary string b
let L = length of b
dp[0] = 1; dp[1] = 2
for i in 2 to L: dp[i] = dp[i-1] + dp[i-2]

res = 0; prev = 0
for i in 0 to L-1:
    if b[i] == '1':
        res += dp[L - i - 1]
        if prev == 1:
            res -= 1; break
    prev = 1 if b[i] == '1' else 0

return res + 1
```