```
build graph from pairs: node -> set(neighbors)
root = node with max degree
if degree(root) != n-1: return 0

define can_be_parent(u,v): all neighbors of v in neighbors[u] + u itself

ways = 1
for u in graph except root:
    parent = min {v in neighbors[u] | degree(v) >= degree(u) and can_be_parent(v,u)} by degree
    if no parent: return 0
    if degree(parent) == degree(u): ways = 2

return ways
```