```
function sequenceReconstruction(nums, sequences):
    n = length(nums)
    graph = map from int to list
    indegree = array of zeros size n+1

    for seq in sequences:
        for i in 0 to length(seq)-2:
            u = seq[i]; v = seq[i+1]
            append v to graph[u]
            indegree[v] += 1

    queue = deque of nodes i in [1..n] with indegree[i] == 0
    if length(queue) != 1: return False

    index = 0
    while queue not empty:
        if length(queue) != 1: return False
        node = pop left(queue)
        if node != nums[index]: return False
        index += 1
        for neigh in graph[node]:
            indegree[neigh] -= 1
            if indegree[neigh] == 0: append neigh to queue

    return index == n
```