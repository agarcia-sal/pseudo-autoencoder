CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root TO the square root of n converted to an integer  
            RETURN whether square_root MULTIPLIED BY square_root EQUALS n  
        END FUNCTION  
  
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums THEN  
                RETURN one  
            END IF  
  
            SET ans TO zero  
            FOR each element x IN the keys of count  
                IF the value of count associated with x GREATER THAN zero AND (path is empty OR is_square(the element at position the last of path PLUS x)) THEN  
                    DECREMENT the value of count associated with x BY one  
                    INCREMENT ans BY the result of backtrack(the concatenation of path with a list containing x, count)  
                    INCREMENT the value of count associated with x BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
  
        SET count TO the frequency counts of elements in nums  
        RETURN backtrack(an empty list, count)  
    END FUNCTION  
END CLASS