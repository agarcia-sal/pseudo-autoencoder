CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l r k memo)  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            IF tuple consisting of l r and k EXISTS IN memo  
                RETURN the element at key tuple consisting of l r and k IN memo  
            END IF  
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO result of dp with parameters l r MINUS one zero memo PLUS the product of sum of k PLUS one AND sum of k PLUS one  
            FOR i FROM l TO r MINUS one  
                IF element at position i of boxes EQUALS element at position r of boxes  
                    SET res TO the maximum OF res AND result of dp with parameters l i sum of k PLUS one memo PLUS result of dp with parameters i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            ASSIGN in memo at key tuple consisting of l r and k the value res  
            RETURN res  
        END FUNCTION  
        RETURN result of dp with parameters zero the length of boxes MINUS one zero empty dictionary  
    END FUNCTION  
END CLASS