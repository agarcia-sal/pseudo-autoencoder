CLASS UnionFind  
    FUNCTION __init__(self size)  
        SET self root TO an empty list  
        FOR index FROM zero TO size MINUS one  
            APPEND index TO self root  
        END FOR  
        SET self rank TO an empty list  
        FOR count FROM zero TO size MINUS one  
            APPEND one TO self rank  
        END FOR  
    END FUNCTION  

    FUNCTION find(self x)  
        IF element at position x of self root EQUALS x  
            RETURN x  
        END IF  
        SET element at position x of self root TO the result of calling find on the element at position x of self root  
        RETURN the element at position x of self root  
    END FUNCTION  

    FUNCTION union(self x y)  
        SET rootX TO the result of calling find on x  
        SET rootY TO the result of calling find on y  
        IF rootX NOT EQUALS rootY  
            IF element at position rootX of self rank GREATER THAN element at position rootY of self rank  
                SET element at position rootY of self root TO rootX  
            ELSE IF element at position rootX of self rank LESS THAN element at position rootY of self rank  
                SET element at position rootX of self root TO rootY  
            ELSE  
                SET element at position rootY of self root TO rootX  
                INCREMENT element at position rootX of self rank BY one  
            END IF  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION accountsMerge(self accounts)  
        SET email_to_id TO an empty mapping  
        SET uf TO a new UnionFind object initialized with the length of accounts  

        FOR variable i FROM zero TO the length of accounts MINUS one  
            SET the variable emails TO all elements of element at position i of accounts EXCEPT the first element  
            FOR each email IN emails  
                IF email NOT IN the keys of email_to_id  
                    SET email_to_id at key email TO i  
                ELSE  
                    CALL the union function of uf with parameters i and email_to_id at key email  
                END IF  
            END FOR  
        END FOR  

        SET merged_emails TO an empty mapping with default empty list  
        FOR each email and account_id IN the items of email_to_id  
            SET root_id TO the result of calling find on account_id using uf  
            APPEND email TO the list at key root_id of merged_emails  
        END FOR  

        SET result TO an empty list  
        FOR each account_id and emails IN the items of merged_emails  
            SET name TO the first element of element at position account_id of accounts  
            SET sorted_emails TO the list emails sorted in ascending order  
            APPEND a new list containing name FOLLOWED BY all elements of sorted_emails TO result  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS