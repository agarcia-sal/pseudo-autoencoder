CLASS UnionFind  
    FUNCTION __init__(self size)  
        SET self.parent TO list consisting of all integers from zero TO size MINUS one  
    END FUNCTION  
    
    FUNCTION find(self u)  
        IF element at position u of self.parent NOT EQUALS u THEN  
            SET element at position u of self.parent TO the result of calling find with argument element at position u of self.parent  
        END IF  
        RETURN element at position u of self.parent  
    END FUNCTION  
    
    FUNCTION union(self u v)  
        SET root_u TO the result of calling find with argument u  
        SET root_v TO the result of calling find with argument v  
        IF root_u NOT EQUALS root_v THEN  
            SET element at position root_u of self.parent TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform(self matrix)  
        SET m TO the length of matrix  
        SET n TO the length of element at position zero of matrix  
        SET value_to_indices TO a new empty default dictionary with list as the default type  
        
        FOR r FROM zero TO m MINUS one  
            FOR c FROM zero TO n MINUS one  
                APPEND the pair consisting of r and c TO the list at key equal to element at position r of matrix AND position c of matrix in value_to_indices  
            END FOR  
        END FOR  
        
        SET row_rank TO a list of zeros of length m  
        SET col_rank TO a list of zeros of length n  
        SET result TO a list of lists each consisting of zeros of length n FOR each row FROM zero TO m MINUS one  
        
        FOR each value IN the sorted list of keys of value_to_indices  
            SET uf TO a new instance of UnionFind with argument m PLUS n  
            SET rank TO a new empty default dictionary with integer zero as default value  
            
            FOR each pair r c IN the list at key value in value_to_indices  
                CALL union of uf with arguments r AND c PLUS m  
            END FOR  
            
            FOR each pair r c IN the list at key value in value_to_indices  
                SET root TO the result of calling find of uf with argument r  
                SET element at key root of rank TO the maximum of element at key root of rank AND the maximum of element at position r of row_rank AND element at position c of col_rank PLUS one  
            END FOR  
            
            FOR each pair r c IN the list at key value in value_to_indices  
                SET element at position r AND position c of result TO element at key root of rank where root is the result of calling find of uf with argument r  
                SET element at position r of row_rank TO element at key root of rank  
                SET element at position c of col_rank TO element at key root of rank  
            END FOR  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS  