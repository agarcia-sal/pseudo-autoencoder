CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO an empty set  
            SET current_product TO a list containing an empty string  
            
            WHILE index LESS THAN the length of expression  
                SET char TO element at position index of expression  
                
                IF char EQUALS the opening brace  
                    SET inner_set and index TO the result of calling parse_expression with index PLUS one  
                    SET new_product TO an empty list  
                    FOR each a IN current_product  
                        FOR each b IN inner_set  
                            APPEND the concatenation of a AND b TO new_product  
                        END FOR  
                    END FOR  
                    SET current_product TO new_product  
                
                ELSE IF char EQUALS the closing brace  
                    FOR each p IN current_product  
                        JOIN the elements of p into a string  
                        ADD that string TO current_set  
                    END FOR  
                    RETURN current_set and index  
                
                ELSE IF char EQUALS the comma  
                    FOR each p IN current_product  
                        JOIN the elements of p into a string  
                        ADD that string TO current_set  
                    END FOR  
                    SET current_product TO a list containing an empty string  
                
                ELSE  # char is a lowercase letter  
                    SET new_product TO an empty list  
                    FOR each a IN current_product  
                        APPEND the concatenation of a AND char TO new_product  
                    END FOR  
                    SET current_product TO new_product  
                
                END IF  
                INCREMENT index BY one  
            END WHILE  
            
            FOR each p IN current_product  
                JOIN the elements of p into a string  
                ADD that string TO current_set  
            END FOR  
            RETURN current_set and index  
        END FUNCTION  
        
        SET result_set and discard_value TO the result of calling parse_expression with zero  
        RETURN the sorted list formed from result_set  
    END FUNCTION  
END CLASS