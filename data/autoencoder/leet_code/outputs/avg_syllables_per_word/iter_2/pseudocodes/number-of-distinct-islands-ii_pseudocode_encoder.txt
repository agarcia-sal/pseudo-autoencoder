CLASS Solution
    FUNCTION numDistinctIslands2(grid)
        FUNCTION dfs(x, y, island)
            IF x < 0 OR x >= LENGTH OF grid OR y < 0 OR y >= LENGTH OF grid[0] OR grid[x][y] == 0 THEN
                RETURN
            SET grid[x][y] TO 0
            APPEND (x, y) TO island
            CALL dfs(x + 1, y, island)
            CALL dfs(x - 1, y, island)
            CALL dfs(x, y + 1, island)
            CALL dfs(x, y - 1, island)
        END FUNCTION

        FUNCTION normalize(island)
            SET shapes TO empty list
            FOR EACH (dx, dy) IN [(1, 1), (1, -1), (-1, 1), (-1, -1)]
                SET new_island TO list of points (x * dx, y * dy) FOR EACH (x, y) IN island
                SORT new_island
                SET min_x TO minimum x VALUE IN new_island
                SET min_y TO minimum y VALUE IN new_island
                APPEND tuple of points (x - min_x, y - min_y) FOR EACH (x, y) IN new_island TO shapes
            FOR i FROM 0 TO LENGTH OF shapes MINUS 1
                APPEND tuple of points (y, -x) FOR EACH (x, y) IN shapes[i] TO shapes
            RETURN minimum tuple FROM shapes
        END FUNCTION

        SET islands TO empty set
        FOR i FROM 0 TO LENGTH OF grid MINUS 1
            FOR j FROM 0 TO LENGTH OF grid[0] MINUS 1
                IF grid[i][j] == 1 THEN
                    SET island TO empty list
                    CALL dfs(i, j, island)
                    ADD normalize(island) TO islands
        RETURN SIZE OF islands
    END FUNCTION
END CLASS