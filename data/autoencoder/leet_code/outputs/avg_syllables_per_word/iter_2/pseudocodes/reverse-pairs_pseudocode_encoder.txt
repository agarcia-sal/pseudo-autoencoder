CLASS Solution
    FUNCTION reversePairs(nums)
        FUNCTION merge_and_count(nums, start, end)
            IF start >= end THEN
                RETURN 0
            SET mid TO (start + end) DIVIDED BY 2
            SET count TO merge_and_count(nums, start, mid) + merge_and_count(nums, mid + 1, end)

            SET j TO mid + 1
            FOR i FROM start TO mid
                WHILE j <= end AND nums[i] > 2 * nums[j]
                    INCREMENT j BY 1
                INCREMENT count BY j - (mid + 1)

            SET merged TO empty list
            SET left TO start
            SET right TO mid + 1
            WHILE left <= mid AND right <= end
                IF nums[left] <= nums[right] THEN
                    APPEND nums[left] TO merged
                    INCREMENT left BY 1
                ELSE
                    APPEND nums[right] TO merged
                    INCREMENT right BY 1

            APPEND elements from nums[left TO mid] TO merged
            APPEND elements from nums[right TO end] TO merged

            REPLACE elements in nums FROM start TO end WITH merged

            RETURN count
        END FUNCTION

        RETURN merge_and_count(nums, 0, LENGTH OF nums MINUS 1)
    END FUNCTION
END CLASS