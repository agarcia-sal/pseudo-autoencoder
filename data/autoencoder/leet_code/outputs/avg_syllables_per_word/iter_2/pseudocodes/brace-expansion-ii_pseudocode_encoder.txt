CLASS Solution
    FUNCTION braceExpansionII(expression)
        FUNCTION parse_expression(index)
            SET current_set TO empty set
            SET current_product TO list containing empty string
            
            WHILE index LESS THAN length of expression
                SET char TO expression[index]
                
                IF char EQUALS '{'
                    SET inner_set, index TO parse_expression(index + 1)
                    SET current_product TO list of concatenation of each string in current_product with each string in inner_set
                
                ELSE IF char EQUALS '}'
                    ADD all concatenations of strings in current_product TO current_set
                    RETURN current_set, index
                
                ELSE IF char EQUALS ','
                    ADD all concatenations of strings in current_product TO current_set
                    SET current_product TO list containing empty string
                
                ELSE
                    SET current_product TO list of concatenation of each string in current_product with char
                
                INCREMENT index BY 1
            
            ADD all concatenations of strings in current_product TO current_set
            RETURN current_set, index
        END FUNCTION
        
        SET result_set, unused TO parse_expression(0)
        RETURN sorted list of elements in result_set
    END FUNCTION
END CLASS