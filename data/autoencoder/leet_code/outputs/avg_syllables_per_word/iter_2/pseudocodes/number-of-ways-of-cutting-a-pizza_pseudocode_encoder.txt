CLASS Solution
    FUNCTION ways(pizza, k)
        SET mod TO 1000000007
        SET m TO LENGTH OF pizza
        SET n TO LENGTH OF pizza[0]
        SET s TO MATRIX OF SIZE (m + 1) BY (n + 1) FILLED WITH 0

        FOR i FROM 1 TO m
            FOR j FROM 1 TO n
                SET s[i][j] TO s[i - 1][j] PLUS s[i][j - 1] MINUS s[i - 1][j - 1]
                IF pizza[i - 1][j - 1] EQUALS 'A' THEN
                    INCREMENT s[i][j] BY 1

        DEFINE FUNCTION dfs(i, j, k)
            IF k EQUALS 0 THEN
                RETURN 1 IF s[m][n] MINUS s[i][n] MINUS s[m][j] PLUS s[i][j] GREATER THAN 0 ELSE 0
            SET ans TO 0
            FOR x FROM i + 1 TO m - 1
                IF s[x][n] MINUS s[i][n] MINUS s[x][j] PLUS s[i][j] GREATER THAN 0 THEN
                    INCREMENT ans BY dfs(x, j, k - 1)
            FOR y FROM j + 1 TO n - 1
                IF s[m][y] MINUS s[i][y] MINUS s[m][j] PLUS s[i][j] GREATER THAN 0 THEN
                    INCREMENT ans BY dfs(i, y, k - 1)
            RETURN ans MODULO mod

        RETURN dfs(0, 0, k - 1)
END CLASS