CLASS Solution
    FUNCTION countPyramids(grid)
        FUNCTION count_pyramids_from_top(grid)
            IF grid IS EMPTY OR grid[0] IS EMPTY
                RETURN 0
            SET m TO LENGTH OF grid
            SET n TO LENGTH OF grid[0]
            INITIALIZE dp AS A 2D LIST OF SIZE m BY n WITH ALL ZEROS
            SET count TO 0

            FOR i FROM 0 TO m - 1
                FOR j FROM 0 TO n - 1
                    IF grid[i][j] EQUALS 1
                        IF i EQUALS 0 OR j EQUALS 0 OR j EQUALS n - 1
                            SET dp[i][j] TO 1
                        ELSE
                            SET dp[i][j] TO MINIMUM OF dp[i-1][j-1], dp[i-1][j], dp[i-1][j+1] PLUS 1
                        IF dp[i][j] GREATER THAN 1
                            INCREMENT count BY dp[i][j] MINUS 1
            RETURN count
        END FUNCTION

        FUNCTION count_pyramids_from_bottom(grid)
            IF grid IS EMPTY OR grid[0] IS EMPTY
                RETURN 0
            SET m TO LENGTH OF grid
            SET n TO LENGTH OF grid[0]
            INITIALIZE dp AS A 2D LIST OF SIZE m BY n WITH ALL ZEROS
            SET count TO 0

            FOR i FROM m - 1 DOWNTO 0
                FOR j FROM 0 TO n - 1
                    IF grid[i][j] EQUALS 1
                        IF i EQUALS m - 1 OR j EQUALS 0 OR j EQUALS n - 1
                            SET dp[i][j] TO 1
                        ELSE
                            SET dp[i][j] TO MINIMUM OF dp[i+1][j-1], dp[i+1][j], dp[i+1][j+1] PLUS 1
                        IF dp[i][j] GREATER THAN 1
                            INCREMENT count BY dp[i][j] MINUS 1
            RETURN count
        END FUNCTION

        RETURN count_pyramids_from_top(grid) PLUS count_pyramids_from_bottom(grid)
    END FUNCTION
END CLASS