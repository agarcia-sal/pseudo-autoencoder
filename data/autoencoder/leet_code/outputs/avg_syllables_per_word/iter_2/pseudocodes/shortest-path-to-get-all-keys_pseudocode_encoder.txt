CLASS Solution
    FUNCTION shortestPathAllKeys(grid: List of strings) RETURNS integer
        SET directions TO list of coordinate pairs [(0, 1), (0, -1), (1, 0), (-1, 0)]
        
        SET m TO LENGTH OF grid
        SET n TO LENGTH OF grid[0]
        SET start TO None
        SET num_keys TO 0
        
        FOR i FROM 0 TO m - 1
            FOR j FROM 0 TO n - 1
                IF grid[i][j] EQUALS '@' THEN
                    SET start TO (i, j)
                ELSE IF grid[i][j] IS lowercase letter THEN
                    INCREMENT num_keys BY 1
        
        INITIALIZE queue AS deque CONTAINING (start_x, start_y, 0, 0)
        INITIALIZE visited AS set CONTAINING (start_x, start_y, 0)
        
        WHILE queue IS NOT empty DO
            REMOVE FIRST ELEMENT FROM queue INTO (x, y, keys, steps)
            
            FOR EACH (dx, dy) IN directions DO
                SET nx TO x PLUS dx
                SET ny TO y PLUS dy
                
                IF nx IS BETWEEN 0 AND m MINUS 1 AND ny IS BETWEEN 0 AND n MINUS 1 THEN
                    SET cell TO grid[nx][ny]
                    
                    IF cell EQUALS '#' THEN
                        CONTINUE TO NEXT direction
                    
                    IF cell IS uppercase letter THEN
                        SET key_needed TO 1 LEFT SHIFT BY (ASCII value of lowercase cell MINUS ASCII value of 'a')
                        IF keys BITWISE AND key_needed EQUALS 0 THEN
                            CONTINUE TO NEXT direction
                    
                    IF cell IS lowercase letter THEN
                        SET new_keys TO keys BITWISE OR 1 LEFT SHIFT BY (ASCII value of cell MINUS ASCII value of 'a')
                        IF new_keys EQUALS (1 LEFT SHIFT BY num_keys) MINUS 1 THEN
                            RETURN steps PLUS 1
                    ELSE
                        SET new_keys TO keys
                    
                    IF (nx, ny, new_keys) IS NOT IN visited THEN
                        ADD (nx, ny, new_keys) TO visited
                        APPEND (nx, ny, new_keys, steps PLUS 1) TO queue
        
        RETURN -1
    END FUNCTION
END CLASS