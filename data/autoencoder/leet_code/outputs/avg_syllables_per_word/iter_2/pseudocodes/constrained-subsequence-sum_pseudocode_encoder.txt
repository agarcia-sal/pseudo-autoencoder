CLASS Solution
    FUNCTION constrainedSubsetSum(nums: List of Integer, k: Integer) RETURNS Integer
        SET n TO LENGTH OF nums
        SET dp TO list of size n filled with 0
        SET dp[0] TO nums[0]
        SET max_sum TO nums[0]
        
        INITIALIZE q TO deque containing 0
        
        FOR i FROM 1 TO n MINUS 1 DO
            IF dp[q[0]] > 0 THEN
                SET dp[i] TO nums[i] PLUS dp[q[0]]
            ELSE
                SET dp[i] TO nums[i]
            END IF
            
            SET max_sum TO MAXIMUM OF max_sum AND dp[i]
            
            WHILE q IS NOT EMPTY AND dp[i] IS GREATER THAN OR EQUAL TO dp[q[-1]] DO
                REMOVE last element FROM q
            END WHILE
            
            APPEND i TO q
            
            IF q[0] EQUALS i MINUS k THEN
                REMOVE first element FROM q
            END IF
        END FOR
        
        RETURN max_sum
    END FUNCTION
END CLASS