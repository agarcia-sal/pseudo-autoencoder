CLASS TrieNode
    FUNCTION __init__()
        SET children TO new defaultdict mapping to TrieNode
        SET deleted TO False
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION deleteDuplicateFolder(paths: List of List of strings) RETURNS List of List of strings
        SET ans TO empty list
        SET root TO new TrieNode
        SET subtreeToNodes TO new defaultdict mapping to empty list

        FOR each path IN paths sorted in ascending order
            SET node TO root
            FOR each s IN path
                SET node TO node.children[s]

        FUNCTION buildSubtreeToRoots(node: TrieNode) RETURNS string
            SET subtree TO '('
            FOR each s IN node.children keys in iteration order
                SET subtree TO subtree CONCATENATED WITH s CONCATENATED WITH buildSubtreeToRoots(node.children[s])
            SET subtree TO subtree CONCATENATED WITH ')'
            IF subtree IS NOT '()'
                APPEND node TO subtreeToNodes[subtree]
            RETURN subtree
        END FUNCTION

        CALL buildSubtreeToRoots(root)

        FOR each nodes IN subtreeToNodes values
            IF LENGTH OF nodes > 1
                FOR each node IN nodes
                    SET node.deleted TO True

        FUNCTION constructPath(node: TrieNode, path: List of strings) RETURNS None
            FOR each (s, child) IN node.children items
                IF child.deleted IS False
                    CALL constructPath(child, path CONCATENATED WITH [s])
            IF LENGTH OF path > 0
                APPEND path TO ans
        END FUNCTION

        CALL constructPath(root, empty list)
        RETURN ans
    END FUNCTION
END CLASS