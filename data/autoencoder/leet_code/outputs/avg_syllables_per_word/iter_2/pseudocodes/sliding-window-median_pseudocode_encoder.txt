```
CLASS Solution
    FUNCTION medianSlidingWindow(nums, k)
        SET lo TO empty list
        SET hi TO empty list

        FUNCTION balance_heaps()
            IF LENGTH OF lo > LENGTH OF hi + 1 THEN
                MOVE top element FROM lo TO hi WITH inversion
            ELSE IF LENGTH OF hi > LENGTH OF lo THEN
                MOVE top element FROM hi TO lo WITH inversion
            END IF
        END FUNCTION

        FUNCTION add_num(num)
            IF lo IS empty OR num <= inverted top of lo THEN
                ADD inverted num TO lo
            ELSE
                ADD num TO hi
            END IF
            CALL balance_heaps()
        END FUNCTION

        FUNCTION remove_num(num)
            IF num <= inverted top of lo THEN
                REMOVE inverted num FROM lo
                IF lo IS NOT empty THEN
                    REBUILD lo AS heap
                END IF
            ELSE
                REMOVE num FROM hi
                IF hi IS NOT empty THEN
                    REBUILD hi AS heap
                END IF
            END IF
            CALL balance_heaps()
        END FUNCTION

        FUNCTION get_median()
            IF LENGTH OF lo > LENGTH OF hi THEN
                RETURN inverted top element of lo
            ELSE
                RETURN average of inverted top of lo AND top of hi
            END IF
        END FUNCTION

        FOR i FROM 0 TO k - 1 DO
            CALL add_num(nums[i])
        END FOR

        SET medians TO list containing get_median()

        FOR i FROM k TO LENGTH OF nums - 1 DO
            CALL add_num(nums[i])
            CALL remove_num(nums[i - k])
            APPEND get_median() TO medians
        END FOR

        RETURN medians
    END FUNCTION
END CLASS
