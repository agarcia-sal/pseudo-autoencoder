CLASS Solution
    FUNCTION totalStrength(strength: List of Integer) RETURNS Integer
        SET MOD TO 10^9 + 7
        SET n TO LENGTH OF strength
        
        SET prefix TO list of zeros WITH SIZE (n + 1)
        FOR i FROM 0 TO n - 1
            SET prefix[i + 1] TO (prefix[i] + strength[i]) MODULO MOD
        
        SET prefix_prefix TO list of zeros WITH SIZE (n + 2)
        FOR i FROM 0 TO n
            SET prefix_prefix[i + 1] TO (prefix_prefix[i] + prefix[i]) MODULO MOD
        
        SET prev_smaller TO list of -1 WITH SIZE n
        SET next_smaller_or_equal TO list of n WITH SIZE n
        
        SET stack TO empty list
        FOR i FROM 0 TO n - 1
            WHILE stack IS NOT EMPTY AND strength[stack LAST ELEMENT] >= strength[i]
                REMOVE LAST ELEMENT FROM stack
            IF stack IS NOT EMPTY
                SET prev_smaller[i] TO stack LAST ELEMENT
            APPEND i TO stack
        
        CLEAR stack
        FOR i FROM n - 1 DOWNTO 0
            WHILE stack IS NOT EMPTY AND strength[stack LAST ELEMENT] > strength[i]
                REMOVE LAST ELEMENT FROM stack
            IF stack IS NOT EMPTY
                SET next_smaller_or_equal[i] TO stack LAST ELEMENT
            APPEND i TO stack
        
        SET total_strength TO 0
        FOR i FROM 0 TO n - 1
            SET left TO prev_smaller[i] + 1
            SET right TO next_smaller_or_equal[i]
            
            SET sum_left TO (i - left + 1) * (prefix_prefix[right + 1] - prefix_prefix[i + 1]) MODULO MOD
            SET sum_right TO (right - i) * (prefix_prefix[i + 1] - prefix_prefix[left]) MODULO MOD
            
            SET contribution TO strength[i] * (sum_left - sum_right) MODULO MOD
            SET total_strength TO (total_strength + contribution) MODULO MOD
        
        RETURN total_strength
    END FUNCTION
END CLASS