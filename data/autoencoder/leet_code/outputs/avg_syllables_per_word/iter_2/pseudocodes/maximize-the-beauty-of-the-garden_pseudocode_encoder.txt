CLASS Solution
    FUNCTION maximumBeauty(flowers: List of Integer) RETURNS Integer
        SET indices TO dictionary with default list
        
        SET prefix_sum TO list of zeros with length LENGTH OF flowers PLUS 1
        FOR i FROM 0 TO LENGTH OF flowers MINUS 1
            SET prefix_sum at i plus 1 TO prefix_sum at i PLUS MAXIMUM of flowers at i AND 0
            APPEND i TO indices at flowers at i
        
        SET max_beauty TO negative infinity
        
        FOR each beauty IN keys of indices
            IF LENGTH OF indices at beauty IS GREATER THAN OR EQUAL TO 2
                SET first TO first element in indices at beauty
                SET last TO last element in indices at beauty
                SET current_beauty TO (2 TIMES beauty) PLUS (prefix_sum at last MINUS prefix_sum at first plus 1)
                SET max_beauty TO MAXIMUM of max_beauty AND current_beauty
        
        RETURN max_beauty
    END FUNCTION
END CLASS