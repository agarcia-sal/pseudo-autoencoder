CLASS Solution
    FUNCTION confusingNumberII(n)
        SET rotate_map TO {0: 0, 1: 1, 6: 9, 8: 8, 9: 6}
        SET valid_digits TO [0, 1, 6, 8, 9]
        
        FUNCTION is_confusing(num)
            SET original_num TO num
            SET rotated_num TO 0
            WHILE num > 0
                SET digit TO num MODULO 10
                SET rotated_num TO rotated_num MULTIPLIED BY 10 PLUS rotate_map[digit]
                SET num TO num DIVIDED BY 10 (integer division)
            END WHILE
            RETURN rotated_num IS NOT EQUAL TO original_num
        END FUNCTION
        
        FUNCTION count_confusing_numbers(limit, current)
            IF current IS UNDEFINED
                SET current TO 0
            END IF
            IF current > limit
                RETURN 0
            END IF
            IF current IS NOT 0 AND is_confusing(current) IS TRUE
                SET count TO 1
            ELSE
                SET count TO 0
            END IF
            FOR EACH digit IN valid_digits
                SET new_number TO current MULTIPLIED BY 10 PLUS digit
                IF new_number IS 0
                    CONTINUE TO NEXT digit
                END IF
                SET count TO count PLUS count_confusing_numbers(limit, new_number)
            END FOR
            RETURN count
        END FUNCTION
        
        RETURN count_confusing_numbers(n)
    END FUNCTION
END CLASS