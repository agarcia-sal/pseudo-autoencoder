CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root TO the integer part of the square root of n  
            RETURN square_root MULTIPLIED BY square_root EQUALS n  
        END FUNCTION  
      
        FUNCTION backtrack(path, count)  
            IF the length of path EQUALS the length of nums THEN  
                RETURN one  
            END IF  
          
            SET ans TO zero  
            FOR each element x IN the keys of count  
                IF the value at count for x GREATER THAN zero AND (the length of path EQUALS zero OR is_square(the last element at position the length of path MINUS one of path PLUS x)) THEN  
                    DECREMENT the value at count for x BY one  
                    INCREMENT ans BY backtrack(the list formed by appending x to path, count)  
                    INCREMENT the value at count for x BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
      
        SET count TO the frequency counter of nums  
        RETURN backtrack(the empty list, count)  
    END FUNCTION  
END CLASS