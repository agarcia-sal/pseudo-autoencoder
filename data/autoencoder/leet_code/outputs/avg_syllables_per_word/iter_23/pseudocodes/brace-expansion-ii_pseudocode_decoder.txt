CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
              
            WHILE index LESS THAN LENGTH OF expression  
                SET char TO element at position index of expression  
                  
                IF char EQUALS left curly brace  
                    SET inner_set AND index TO RESULT OF parse_expression WITH argument the position after index  
                    SET new_product TO empty list  
                    FOR each element a IN current_product  
                        FOR each element b IN inner_set  
                            APPEND concatenation of a AND b TO new_product  
                        END FOR  
                    END FOR  
                    SET current_product TO new_product  
                      
                ELSE IF char EQUALS right curly brace  
                    FOR each element p IN current_product  
                        JOIN elements of p INTO a string  
                        ADD the string TO current_set  
                    END FOR  
                    RETURN current_set AND index  
                      
                ELSE IF char EQUALS comma  
                    FOR each element p IN current_product  
                        JOIN elements of p INTO a string  
                        ADD the string TO current_set  
                    END FOR  
                    SET current_product TO list containing empty string  
                      
                ELSE  
                    SET new_product TO empty list  
                    FOR each element a IN current_product  
                        APPEND concatenation of a AND char TO new_product  
                    END FOR  
                    SET current_product TO new_product  
                      
                END IF  
                INCREMENT index BY one  
            END WHILE  
              
            FOR each element p IN current_product  
                JOIN elements of p INTO a string  
                ADD the string TO current_set  
            END FOR  
            RETURN current_set AND index  
        END FUNCTION  
          
        SET result_set AND discard TO RESULT OF parse_expression WITH zero AS argument  
        SET sorted_result TO sorted list of elements in result_set  
        RETURN sorted_result  
    END FUNCTION  
END CLASS