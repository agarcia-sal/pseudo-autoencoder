CLASS UnionFind  
    FUNCTION __init__(self, size)  
        SET self.parent TO list of integers starting from zero TO size MINUS one  
    END FUNCTION  

    FUNCTION find(self, u)  
        IF element at position u of self.parent NOT EQUALS u THEN  
            SET element at position u of self.parent TO the result of calling find on element at position u of self.parent  
        END IF  
        RETURN element at position u of self.parent  
    END FUNCTION  

    FUNCTION union(self, u, v)  
        SET root_u TO result of calling find on u  
        SET root_v TO result of calling find on v  
        IF root_u NOT EQUALS root_v THEN  
            SET element at position root_u of self.parent TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform(self, matrix)  
        SET m TO the LENGTH OF matrix  
        SET n TO the LENGTH OF element at position zero of matrix  
        SET value_to_indices TO empty dictionary that returns an empty list for missing keys  

        FOR r FROM zero TO m MINUS one  
            FOR c FROM zero TO n MINUS one  
                APPEND tuple consisting of r and c TO the list at key equal to element at position r of matrix at position c in value_to_indices  
            END FOR  
        END FOR  

        SET row_rank TO list of zeros with length m  
        SET col_rank TO list of zeros with length n  
        SET result TO list of m elements each being a list of n zeros  

        FOR each value IN the keys of value_to_indices sorted in ascending order  
            INITIALIZE uf AS a new instance of UnionFind with parameter m PLUS n  
            SET rank TO empty dictionary that returns zero for missing keys  

            FOR each tuple of r and c IN the list at key value in value_to_indices  
                CALL union on uf with parameters r and c PLUS m  
            END FOR  

            FOR each tuple of r and c IN the list at key value in value_to_indices  
                SET root TO result of calling find on uf with parameter r  
                SET element at key root in rank TO the maximum of element at key root in rank AND the maximum of element at position r in row_rank AND element at position c in col_rank PLUS one  
            END FOR  

            FOR each tuple of r and c IN the list at key value in value_to_indices  
                SET root TO result of calling find on uf with parameter r  
                SET element at position r in result at position c TO element at key root in rank  
                SET element at position r in row_rank TO element at key root in rank  
                SET element at position c in col_rank TO element at key root in rank  
            END FOR  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS