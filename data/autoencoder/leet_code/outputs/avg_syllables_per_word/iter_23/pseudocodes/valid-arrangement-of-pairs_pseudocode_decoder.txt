CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO empty mapping with default empty list  
        SET out_degree TO empty counting mapping  
        SET in_degree TO empty counting mapping  
        
        FOR each pair composed of u and v IN pairs  
            APPEND element v TO the list associated with key u in graph  
            INCREMENT the count associated with key u in out_degree BY one  
            INCREMENT the count associated with key v in in_degree BY one  
        END FOR  
        
        SET start_node TO nothing  
        FOR each node IN the keys of graph  
            IF the count associated with node in out_degree EQUALS the count associated with node in in_degree PLUS one  
                SET start_node TO node  
                BREAK the loop  
            END IF  
        END FOR  
        IF start_node EQUALS nothing  
            SET start_node TO any one element FROM the keys of graph  
        END IF  
        
        SET path TO empty list  
        SET stack TO list containing start_node  
        
        WHILE stack holds one or more elements  
            SET u TO the last element in stack  
            IF the list associated with key u in graph contains one or more elements  
                SET v TO the last element in the list associated with key u in graph  
                REMOVE the last element FROM the list associated with key u in graph  
                APPEND element v TO stack  
            ELSE  
                APPEND the last element of stack TO path  
                REMOVE the last element FROM stack  
            END IF  
        END WHILE  
        
        REVERSE the order of elements in path  
        
        SET result TO empty list  
        FOR index FROM zero TO the length of path MINUS one MINUS one  
            APPEND list containing element at position index of path AND element at position index PLUS one of path TO result  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS