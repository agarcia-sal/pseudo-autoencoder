CLASS Solution  
    FUNCTION longestObstacleCourseAtEachPosition(obstacles)  
        SET n TO the LENGTH OF obstacles  
        SET ans TO an empty list  
        SET increasing_subseq TO an empty list  
        
        FOR each obstacle IN obstacles  
            SET idx TO the POSITION where obstacle can be inserted in increasing_subseq to maintain the order such that all elements at positions before idx are LESS THAN OR EQUAL TO obstacle and all elements at positions at or after idx are GREATER THAN obstacle  
            
            IF idx EQUALS the LENGTH OF increasing_subseq  
                APPEND obstacle TO increasing_subseq  
            ELSE  
                SET element at position idx of increasing_subseq TO obstacle  
            END IF  
            
            APPEND the VALUE of idx PLUS one TO ans  
        END FOR  
        
        RETURN ans  
    END FUNCTION  
END CLASS