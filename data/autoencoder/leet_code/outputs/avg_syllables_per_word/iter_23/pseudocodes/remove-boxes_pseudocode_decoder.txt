CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN zero  
            END IF  
            
            IF memo CONTAINS the KEY composed of l AND r AND k THEN  
                RETURN the VALUE ASSOCIATED WITH the KEY composed of l AND r AND k FROM memo  
            END IF  
            
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes DO  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            
            SET res TO the RESULT OF dp WITH PARAMETERS l AND r MINUS one AND zero AND memo PLUS the PRODUCT OF the SUM OF k AND one MULTIPLIED BY the SUM OF k AND one  
            
            FOR i FROM l TO r MINUS one DO  
                IF element at position i of boxes EQUALS element at position r of boxes THEN  
                    SET res TO the GREATER BETWEEN res AND the SUM OF dp WITH PARAMETERS l AND i AND k PLUS one AND memo AND dp WITH PARAMETERS i PLUS one AND r MINUS one AND zero AND memo  
                END IF  
            END FOR  
            
            SET the VALUE ASSOCIATED WITH the KEY composed of l AND r AND k IN memo TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN dp WITH PARAMETERS zero AND the LENGTH OF boxes MINUS one AND zero AND an EMPTY STRUCTURE  
    END FUNCTION  
END CLASS