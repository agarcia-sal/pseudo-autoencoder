CLASS Solution  
    FUNCTION minimumIncompatibility(nums AS List OF Integer, k AS Integer) RETURNS Integer  
        IMPORT Counter FROM collections  
        
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        IF any count IN the VALUES OF Counter APPLIED TO nums IS GREATER THAN k  
            RETURN negative one  
        END IF  
        
        SET subset_incompatibility TO an empty MAPPING  
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            IF the COUNT OF ONES IN THE BINARY REPRESENTATION OF mask EQUALS subset_size  
                SET elements TO a LIST OF nums AT POSITION i FOR each i FROM zero TO n MINUS one WHERE the BITWISE AND OF mask AND two RAISED TO THE POWER OF i IS NOT ZERO  
                IF the COUNT OF UNIQUE elements EQUALS subset_size  
                    SET incompatibility TO the MAXIMUM OF elements MINUS the MINIMUM OF elements  
                    SET the VALUE AT key mask IN subset_incompatibility TO incompatibility  
                END IF  
            END IF  
        END FOR  
        
        SET dp TO a LIST OF LENGTH two RAISED TO THE POWER OF n FILLED WITH INFINITY VALUE  
        SET the VALUE AT position zero IN dp TO zero  
        
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            IF the COUNT OF ONES IN THE BINARY REPRESENTATION OF mask MODULO subset_size IS NOT ZERO  
                CONTINUE TO the NEXT iteration  
            END IF  
            FOR each subset_mask IN the KEYS OF subset_incompatibility  
                IF the BITWISE AND OF mask AND subset_mask EQUALS subset_mask  
                    SET dp AT position mask TO the MINIMUM OF dp AT position mask AND dp AT position of the BITWISE XOR OF mask AND subset_mask PLUS subset_incompatibility AT position subset_mask  
                END IF  
            END FOR  
        END FOR  
        
        IF dp AT position two RAISED TO THE POWER OF n MINUS one IS NOT EQUAL TO INFINITY VALUE  
            RETURN dp AT position two RAISED TO THE POWER OF n MINUS one  
        ELSE  
            RETURN negative one  
        END IF  
    END FUNCTION  
END CLASS