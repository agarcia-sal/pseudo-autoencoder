CLASS Solution  
    FUNCTION wordSquares(words)  
        DEFINE prefix_to_words AS auxiliary FUNCTION initialize_prefix_to_words WITH words  
        SET results TO empty list  
        
        FUNCTION backtrack(square)  
            IF LENGTH OF square EQUALS LENGTH OF element at position zero of words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO concatenation of element at position length of square in each word IN square  
            FOR each candidate IN element at position prefix IN prefix_to_words  
                CALL backtrack WITH square PLUS list containing candidate  
            END FOR  
        END FUNCTION  
        
        FOR each word IN words  
            CALL backtrack WITH list containing word  
        END FOR  
        
        RETURN results  
    END FUNCTION  
    
    FUNCTION initialize_prefix_to_words WITH words  
        SET prefix_mapping TO a new mapping of prefixes to lists of words initialized empty  
        FOR each word IN words  
            FOR index FROM zero TO LENGTH OF word MINUS one  
                SET prefix TO substring from position zero TO index MINUS one of word  
                APPEND word TO element at position prefix IN prefix_mapping  
            END FOR  
        END FOR  
        RETURN prefix_mapping  
    END FUNCTION  
END CLASS