CLASS Solution  
    FUNCTION isValid(code)  
        IMPORT regular_expression_module  
        
        SET cdata_pattern TO string representing left angle bracket followed by exclamation mark followed by left square bracket followed by CDATA followed by left square bracket followed by any character zero or more times non greedy followed by right square bracket followed by right square bracket followed by right angle bracket  
        
        SET code TO result of replacing all occurrences matching cdata_pattern in code with empty string using regular_expression_module  
        
        SET stack TO empty list  
        
        SET i TO zero  
        WHILE i LESS THAN the LENGTH OF code  
            IF character at position i of code EQUALS left angle bracket  
                SET j TO the result of finding right angle bracket starting from position i plus one in code  
                IF j EQUALS negative one  
                    RETURN false  
                END IF  
                
                SET tag_content TO substring from position i plus one TO position j minus one of code  
                
                IF tag_content IS EMPTY  
                    RETURN false  
                END IF  
                
                IF first character of tag_content EQUALS forward slash  
                    SET tag_name TO substring from position one TO the END of tag_content  
                    IF stack IS EMPTY OR last element of stack DOES NOT EQUAL tag_name  
                        RETURN false  
                    END IF  
                    REMOVE the last element FROM stack  
                ELSE IF first character of tag_content EQUALS exclamation mark  
                    RETURN false  
                ELSE  
                    IF LENGTH OF tag_content LESS THAN one OR LENGTH OF tag_content GREATER THAN nine OR tag_content IS NOT ALL uppercase letters  
                        RETURN false  
                    END IF  
                    APPEND tag_content TO stack  
                END IF  
                
                SET i TO j PLUS one  
            ELSE  
                INCREMENT i BY one  
            END IF  
        END WHILE  
        
        RETURN stack IS EMPTY AND number of matches of pattern left angle bracket followed by one or more uppercase letters followed by right angle bracket followed by any character zero or more times followed by left angle bracket followed by forward slash followed by one or more uppercase letters followed by right angle bracket in code IS GREATER THAN zero  
    END FUNCTION  
END CLASS