CLASS Solution  
    FUNCTION minNumberOfSemesters WITH PARAMETERS n INTEGER relations LIST OF LIST OF INTEGER k INTEGER  
        SET graph TO new mapping from integers TO lists  
        SET in_degree TO list of zeros OF LENGTH n PLUS one  
        
        FOR each pair prevCourse AND nextCourse IN relations  
            APPEND nextCourse TO list at key prevCourse IN graph  
            INCREMENT element at position nextCourse OF in_degree BY one  
        END FOR  
        
        SET queue TO new double ended queue  
        FOR course FROM one TO n  
            IF element at position course OF in_degree EQUALS zero  
                APPEND course TO queue  
            END IF  
        END FOR  
        
        SET semesters TO zero  
        
        WHILE queue is not empty  
            SET number_of_courses TO the smaller value BETWEEN k AND the LENGTH OF queue  
            FOR counter FROM one TO number_of_courses  
                REMOVE element from the front OF queue AND ASSIGN TO current_course  
                FOR each next_course IN list at key current_course IN graph  
                    DECREMENT element at position next_course OF in_degree BY one  
                    IF element at position next_course OF in_degree EQUALS zero  
                        APPEND next_course TO queue  
                    END IF  
                END FOR  
            END FOR  
            INCREMENT semesters BY one  
        END WHILE  
        
        RETURN semesters  
    END FUNCTION  
END CLASS