CLASS Solution  
    FUNCTION pyramidTransition(bottom, allowed)  
        SET allowed_map TO a default dictionary that maps each item TO a default dictionary that maps each item TO a list  
        FOR each rule IN allowed  
            SET left TO the first character of rule  
            SET right TO the second character of rule  
            SET top TO the third character of rule  
            APPEND top TO the list at position right of the dictionary at position left of allowed_map  
        END FOR  

        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF the LENGTH OF current_bottom EQUALS one  
                RETURN true  
            END IF  
            IF the LENGTH OF current_top EQUALS the LENGTH OF current_bottom MINUS one  
                RETURN the result of can_build_pyramid with current_top and an empty list as arguments  
            END IF  
            SET left TO the character at position the LENGTH OF current_top PLUS one of current_bottom  
            SET right TO the character at position the LENGTH OF current_top PLUS two of current_bottom  
            IF left EXISTS AS a key in allowed_map AND right EXISTS AS a key in the dictionary at position left of allowed_map  
                FOR each top IN the list at position right of the dictionary at position left of allowed_map  
                    IF can_build_pyramid called with current_bottom and current_top concatenated with top returns true  
                        RETURN true  
                    END IF  
                END FOR  
            END IF  
            RETURN false  
        END FUNCTION  

        RETURN the result of can_build_pyramid called with bottom and an empty list  
    END FUNCTION  
END CLASS