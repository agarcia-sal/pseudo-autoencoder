CLASS Solution  
    FUNCTION uniquePathsIII(grid)  
        FUNCTION dfs(x, y, steps)  
            IF the element at position x of grid at position y EQUALS two  
                RETURN steps EQUALS zero  
            END IF  
            SET original TO the element at position x of grid at position y  
            SET the element at position x of grid at position y TO negative two  
            SET count TO zero  
            FOR each pair of values dx and dy IN the list of pairs consisting of negative one and zero, one and zero, zero and negative one, zero and one  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n AND the element at position nx of grid at position ny IS GREATER THAN OR EQUAL TO zero  
                    INCREMENT count BY the result of the invocation of dfs with nx, ny, steps MINUS one  
                END IF  
            END FOR  
            SET the element at position x of grid at position y TO original  
            RETURN count  
        END FUNCTION  
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF the element at position zero of grid  
        SET start_x TO zero  
        SET start_y TO zero  
        SET empty_squares TO one  
        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF the element at position i of grid at position j EQUALS one  
                    SET start_x TO i  
                    SET start_y TO j  
                ELSE IF the element at position i of grid at position j EQUALS zero  
                    INCREMENT empty_squares BY one  
                END IF  
            END FOR  
        END FOR  
        RETURN the result of the invocation of dfs with start_x, start_y, empty_squares  
    END FUNCTION  
END CLASS