CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index IS LESS THAN the LENGTH OF expression  
                SET char TO element at position index of expression  
                
                IF char EQUALS opening curly bracket  
                    SET inner_set AND index TO RESULT OF parse_expression with index PLUS one  
                    SET new_product TO empty list  
                    FOR each element a IN current_product  
                        FOR each element b IN inner_set  
                            APPEND concatenation of a AND b TO new_product  
                        END FOR  
                    END FOR  
                    SET current_product TO new_product  
                
                ELSE IF char EQUALS closing curly bracket  
                    FOR each element p IN current_product  
                        JOIN p INTO string  
                        ADD string TO current_set  
                    END FOR  
                    RETURN current_set AND index  
                
                ELSE IF char EQUALS comma  
                    FOR each element p IN current_product  
                        JOIN p INTO string  
                        ADD string TO current_set  
                    END FOR  
                    SET current_product TO list containing empty string  
                
                ELSE  # char is a lowercase letter  
                    SET new_product TO empty list  
                    FOR each element a IN current_product  
                        CONCATENATE a AND char AND APPEND the result TO new_product  
                    END FOR  
                    SET current_product TO new_product  
                
                END IF  
                INCREMENT index BY one  
            END WHILE  
            
            FOR each element p IN current_product  
                JOIN p INTO string  
                ADD string TO current_set  
            END FOR  
            RETURN current_set AND index  
        END FUNCTION  
        
        SET result_set AND discard_second TO RESULT OF parse_expression with zero  
        RETURN sorted list of elements of result_set  
    END FUNCTION  
END CLASS