CLASS Solution  
    FUNCTION removeBoxes WITH PARAMETERS boxes AS List OF INTEGER  
        FUNCTION dp WITH PARAMETERS l AS INTEGER r AS INTEGER k AS INTEGER memo AS DICTIONARY  
            IF l IS GREATER THAN r  
                RETURN zero  
            END IF  
            
            IF the TUPLE consisting of l r k IS IN memo  
                RETURN the VALUE ASSOCIATED WITH the TUPLE consisting of l r k IN memo  
            END IF  
            
            WHILE r IS GREATER THAN l AND the ELEMENT at position r of boxes EQUALS the ELEMENT at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            
            SET res TO dp WITH ARGUMENTS l r MINUS one zero memo PLUS THE PRODUCT OF THE SUM of k PLUS one AND THE SUM of k PLUS one  
            
            FOR i FROM l TO r MINUS one  
                IF the ELEMENT at position i of boxes EQUALS the ELEMENT at position r of boxes  
                    SET res TO the MAXIMUM OF res AND THE SUM OF dp WITH ARGUMENTS l i k PLUS one memo AND dp WITH ARGUMENTS i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            
            SET the VALUE ASSOCIATED WITH the TUPLE consisting of l r k IN memo TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN dp WITH ARGUMENTS zero THE LENGTH OF boxes MINUS one zero EMPTY DICTIONARY  
    END FUNCTION  
END CLASS