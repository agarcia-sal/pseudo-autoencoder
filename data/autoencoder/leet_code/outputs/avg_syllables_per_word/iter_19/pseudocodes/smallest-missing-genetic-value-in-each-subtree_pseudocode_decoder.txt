CLASS Solution  
    FUNCTION smallestMissingValueSubtree(parents AS List OF Integer, nums AS List OF Integer) RETURNS List OF Integer  
        IMPORT default dictionary FROM collections  
        
        SET n TO the LENGTH OF parents  
        SET tree TO a default dictionary with lists as default values  
        
        FOR index FROM one TO n MINUS one  
            APPEND index TO the list AT key parents at position index OF tree  
        END FOR  
        
        SET node_with_one TO minus one  
        FOR index FROM zero TO n MINUS one  
            IF the element at position index of nums EQUALS one  
                SET node_with_one TO index  
                BREAK the loop  
            END IF  
        END FOR  
        
        IF node_with_one EQUALS minus one  
            RETURN a list of integer one REPEATED n times  
        END IF  
        
        SET result TO a list of integer one REPEATED n times  
        
        FUNCTION dfs(node) RETURNS set of Integer  
            ADD node TO visited  
            SET genetic_values TO a set containing the element at position node of nums  
            FOR each child IN the list at key node OF tree  
                IF child NOT IN visited  
                    SET genetic_values TO the UNION OF genetic_values AND the result OF dfs with child  
                END IF  
            END FOR  
            SET smallest_missing TO one  
            WHILE smallest_missing IS IN genetic_values  
                INCREMENT smallest_missing BY one  
            END WHILE  
            SET the element at position node of result TO smallest_missing  
            RETURN genetic_values  
        END FUNCTION  
        
        SET visited TO an empty set  
        
        SET path TO an empty list  
        SET current TO node_with_one  
        WHILE current NOT EQUAL TO minus one  
            APPEND current TO path  
            SET current TO the element at position current of parents  
        END WHILE  
        
        SET path_set TO the set created from path  
        FOR each node IN the reverse ORDER OF path  
            IF node IS IN visited  
                CONTINUE to next iteration  
            END IF  
            CALL dfs with node  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS