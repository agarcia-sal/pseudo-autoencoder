CLASS Solution  
    FUNCTION longestObstacleCourseAtEachPosition(obstacles)  
        SET n TO the LENGTH OF obstacles  
        SET ans TO an empty list  
        SET increasing_subseq TO an empty list representing the smallest tail of all increasing subsequences of different lengths found so far  
        
        FOR each obstacle IN obstacles  
            SET idx TO the position returned by BISPECT_RIGHT METHOD applied to increasing_subseq and obstacle where idx is the first position in increasing_subseq at which obstacle can be inserted while maintaining non-decreasing order  
            
            IF idx EQUALS the LENGTH OF increasing_subseq  
                APPEND obstacle TO increasing_subseq  
            ELSE  
                SET element at position idx of increasing_subseq TO obstacle  
            END IF  
            
            APPEND idx PLUS one TO ans  
        END FOR  
        
        RETURN ans  
    END FUNCTION  
END CLASS