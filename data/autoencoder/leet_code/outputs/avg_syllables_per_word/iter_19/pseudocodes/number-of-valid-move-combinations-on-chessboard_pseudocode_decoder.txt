CLASS Solution  
    FUNCTION countCombinations(pieces AS list of strings, positions AS list of list of integers) RETURNS integer  
        SET directions TO a mapping from piece type name TO list of pairs of integers representing movement directions  
        SET the element mapped by rook TO list of pairs of one and zero, negative one and zero, zero and one, zero and negative one  
        SET the element mapped by queen TO list of pairs of one and zero, negative one and zero, zero and one, zero and negative one, one and one, negative one and one, one and negative one, negative one and negative one  
        SET the element mapped by bishop TO list of pairs of one and one, negative one and one, one and negative one, negative one and negative one  
        
        FUNCTION get_destinations(start AS pair of integers, piece_type AS string) RETURNS list of pairs of integers  
            SET r TO the first element of start  
            SET c TO the second element of start  
            SET dests TO list containing start  
            FOR each pair dr and dc IN the element mapped by piece_type in directions  
                SET nr TO r PLUS dr  
                SET nc TO c PLUS dc  
                WHILE the value of nr is greater than or equal to zero AND the value of nr is less than eight AND the value of nc is greater than or equal to zero AND the value of nc is less than eight  
                    APPEND the pair nr and nc TO dests  
                    INCREMENT nr BY dr  
                    INCREMENT nc BY dc  
                END WHILE  
            END FOR  
            RETURN dests  
        END FUNCTION  
        
        SET positions TO a new list by transforming each pair r and c in input positions TO pair r MINUS one and c MINUS one  
        
        SET all_destinations TO list constructed by applying get_destinations TO each pair position and corresponding piece from positions and pieces zipped  
        
        FUNCTION is_valid_combination(combination AS list of pairs of integers) RETURNS boolean  
            SET pos TO a shallow copy of positions  
            SET n TO the length of pos  
            LOOP indefinitely  
                IF the number of unique elements in pos is less than n  
                    RETURN false  
                END IF  
                SET all_reached TO true  
                FOR index i FROM zero TO n MINUS one  
                    IF the element at position i of pos EQUALS the element at position i of combination  
                        CONTINUE to the next iteration  
                    END IF  
                    SET all_reached TO false  
                    SET r TO the first element of the element at position i of pos  
                    SET c TO the second element of the element at position i of pos  
                    IF the first element of the element at position i of combination GREATER THAN r  
                        SET dr TO one  
                    ELSE IF the first element of the element at position i of combination LESS THAN r  
                        SET dr TO negative one  
                    ELSE  
                        SET dr TO zero  
                    END IF  
                    IF the second element of the element at position i of combination GREATER THAN c  
                        SET dc TO one  
                    ELSE IF the second element of the element at position i of combination LESS THAN c  
                        SET dc TO negative one  
                    ELSE  
                        SET dc TO zero  
                    END IF  
                    SET the element at position i of pos TO pair r PLUS dr and c PLUS dc  
                END FOR  
                IF all_reached IS true  
                    RETURN true  
                END IF  
            END LOOP  
        END FUNCTION  
        
        SET valid_count TO zero  
        FOR each combination in the cartesian product of all_destinations' elements  
            IF is_valid_combination WITH combination RETURNS true  
                INCREMENT valid_count BY one  
            END IF  
        END FOR  
        
        RETURN valid_count  
    END FUNCTION  
END CLASS