CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            IF the TUPLE CONSISTING OF l r k IS IN memo  
                RETURN the ELEMENT AT the TUPLE CONSISTING OF l r k OF memo  
            END IF  
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO dp WITH l AND r MINUS one AND zero AND memo PLUS open PARENTHESIS k PLUS one CLOSE PARENTHESIS MULTIPLIED BY open PARENTHESIS k PLUS one CLOSE PARENTHESIS  
            FOR each i FROM l TO r MINUS one  
                IF element at position i of boxes EQUALS element at position r of boxes  
                    SET res TO the GREATER OF res AND dp WITH l AND i AND k PLUS one AND memo PLUS dp WITH i PLUS one AND r MINUS one AND zero AND memo  
                END IF  
            END FOR  
            SET the ELEMENT AT the TUPLE CONSISTING OF l r k OF memo TO res  
            RETURN res  
        END FUNCTION  
        RETURN dp WITH zero AND the LENGTH OF boxes MINUS one AND zero AND an EMPTY DICTIONARY  
    END FUNCTION  
END CLASS