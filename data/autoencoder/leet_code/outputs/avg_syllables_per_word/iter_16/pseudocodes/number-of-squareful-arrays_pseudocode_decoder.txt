CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET root TO the square root of n converted TO integer  
            IF root MULTIPLIED BY root EQUALS n  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums  
                RETURN one  
            END IF  
            
            SET ans TO zero  
            FOR each element x IN count  
                IF the VALUE at key x IN count IS GREATER THAN zero AND path IS empty OR is_square of the SUM of the last element in path AND x RETURNS true  
                    DECREMENT the VALUE at key x IN count BY one  
                    INCREMENT ans BY backtrack with the CONCATENATION of path AND x AND count  
                    INCREMENT the VALUE at key x IN count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO a mapping from elements of nums TO their counts using Counter  
        RETURN backtrack with an empty list AND count  
    END FUNCTION  
END CLASS