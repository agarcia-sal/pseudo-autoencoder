CLASS Solution  
    FUNCTION numDistinctIslands2(grid)  
        FUNCTION dfs(x, y, island)  
            IF x LESS THAN zero OR x GREATER THAN OR EQUAL TO the LENGTH OF grid OR y LESS THAN zero OR y GREATER THAN OR EQUAL TO the LENGTH OF element at position zero of grid OR element at position x of element at position y of grid EQUALS zero  
                RETURN  
            END IF  
            SET element at position x of element at position y of grid TO zero  
            APPEND tuple of x and y TO island  
            CALL dfs WITH parameters x PLUS one, y, island  
            CALL dfs WITH parameters x MINUS one, y, island  
            CALL dfs WITH parameters x, y PLUS one, island  
            CALL dfs WITH parameters x, y MINUS one, island  
        END FUNCTION

        FUNCTION normalize(island)  
            SET shapes TO empty list  
            FOR each pair dx and dy IN list of tuples of one and one AND one and MINUS one AND MINUS one and one AND MINUS one and MINUS one  
                SET new_island TO empty list  
                FOR each pair x and y IN island  
                    APPEND tuple of x MULTIPLIED BY dx and y MULTIPLIED BY dy TO new_island  
                END FOR  
                SORT new_island BY default order  
                SET min_x TO minimum value of x for each pair x and y IN new_island  
                SET min_y TO minimum value of y for each pair x and y IN new_island  
                APPEND tuple of tuple of x MINUS min_x and y MINUS min_y FOR each pair x and y IN new_island TO shapes  
            END FOR  
            FOR index FROM zero TO one LESS THAN the LENGTH OF shapes  
                APPEND tuple of tuple of y and MINUS x FOR each pair x and y IN element at position index of shapes TO shapes  
            END FOR  
            SET result TO minimum element of shapes  
            RETURN result  
        END FUNCTION

        SET islands TO empty set  
        FOR i FROM zero TO one LESS THAN the LENGTH OF grid  
            FOR j FROM zero TO one LESS THAN the LENGTH OF element at position zero of grid  
                IF element at position i of element at position j of grid EQUALS one  
                    SET island TO empty list  
                    CALL dfs WITH parameters i, j, island  
                    ADD the result of calling normalize WITH parameter island TO islands  
                END IF  
            END FOR  
        END FOR  
        SET count_of_islands TO the LENGTH OF islands  
        RETURN count_of_islands  
    END FUNCTION  
END CLASS