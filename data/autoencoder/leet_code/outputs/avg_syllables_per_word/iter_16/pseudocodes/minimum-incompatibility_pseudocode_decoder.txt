CLASS Solution  
    FUNCTION minimumIncompatibility(nums LIST OF INTEGER, k INTEGER) RETURNS INTEGER  
        IMPORT from collections the Counter FUNCTION  
        
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        IF there EXISTS any count IN the VALUES OF Counter applied to nums SUCH THAT count IS GREATER THAN k  
            RETURN negative one  
        END IF  
        
        SET subset_incompatibility TO an EMPTY DICTIONARY  
        
        FOR each mask FROM zero TO two RAISED TO the POWER OF n MINUS one  
            SET bit_count TO the NUMBER OF set bits IN mask  
            IF bit_count EQUALS subset_size  
                SET elements TO an EMPTY LIST  
                FOR each index FROM zero TO n MINUS one  
                    IF the bit at position index IN mask IS SET  
                        APPEND the element at position index OF nums TO elements  
                    END IF  
                END FOR  
                IF the NUMBER OF UNIQUE elements IN elements EQUALS subset_size  
                    SET max_element TO the MAXIMUM VALUE IN elements  
                    SET min_element TO the MINIMUM VALUE IN elements  
                    SET incompatibility TO max_element MINUS min_element  
                    ASSIGN subset_incompatibility AT key mask TO incompatibility  
                END IF  
            END IF  
        END FOR  
        
        SET dp TO a LIST OF LENGTH two RAISED TO the POWER OF n FILLED WITH positive infinity  
        SET the ELEMENT at position zero OF dp TO zero  
        
        FOR each mask FROM zero TO two RAISED TO the POWER OF n MINUS one  
            SET bit_count TO the NUMBER OF set bits IN mask  
            IF bit_count MODULO subset_size IS NOT EQUAL TO zero  
                CONTINUE to next iteration of the loop  
            END IF  
            FOR each subset_mask IN subset_incompatibility KEYS  
                IF the BITWISE AND OF mask AND subset_mask EQUALS subset_mask  
                    SET current_value TO dp AT position mask  
                    SET candidate_value TO dp AT position the BITWISE XOR OF mask AND subset_mask PLUS subset_incompatibility AT key subset_mask  
                    SET dp AT position mask TO the MINIMUM OF current_value AND candidate_value  
                END IF  
            END FOR  
        END FOR  
        
        IF dp AT position two RAISED TO the POWER OF n MINUS one IS NOT positive infinity  
            RETURN dp AT position two RAISED TO the POWER OF n MINUS one  
        ELSE  
            RETURN negative one  
        END IF  
    END FUNCTION  
END CLASS