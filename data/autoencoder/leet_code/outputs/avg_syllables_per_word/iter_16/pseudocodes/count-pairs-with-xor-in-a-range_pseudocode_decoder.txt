CLASS TrieNode  
    FUNCTION __init__  
        SET children TO empty mapping  
        SET count TO zero  
    END FUNCTION  
END CLASS  

CLASS Trie  
    FUNCTION __init__ WITH PARAMETER bit_length EQUAL TO fifteen  
        ASSIGN pointer TO object TrieNode TO root  
        SET bit_length TO bit_length  
    END FUNCTION  

    FUNCTION insert WITH PARAMETER num  
        ASSIGN pointer TO root TO node  
        FOR index FROM bit_length DOWN TO zero  
            SET bit TO the result of the bitwise right shift of num BY index AND the value one  
            IF bit IS NOT a key in the mapping children of node THEN  
                ASSIGN pointer TO object TrieNode TO the value associated with bit key in children of node  
            END IF  
            ASSIGN pointer TO the value associated with bit key in children of node TO node  
            INCREMENT count attribute of node BY one  
        END FOR  
    END FUNCTION  

    FUNCTION count_less_than WITH PARAMETERS num AND threshold  
        SET count TO zero  
        ASSIGN pointer TO root TO node  
        FOR index FROM bit_length DOWN TO zero  
            IF node DOES NOT exist THEN  
                BREAK the loop  
            END IF  
            SET bit TO the result of the bitwise right shift of num BY index AND the value one  
            SET threshold_bit TO the result of the bitwise right shift of threshold BY index AND the value one  
            IF threshold_bit EQUALS one THEN  
                INCREMENT count BY the count attribute of the value associated with bit key in children of node OR zero if key missing  
                ASSIGN pointer TO the value associated with the result of bit XOR one key in children of node TO node  
            ELSE  
                ASSIGN pointer TO the value associated with bit key in children of node TO node  
            END IF  
        END FOR  
        RETURN count  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION countPairs WITH PARAMETERS nums AND low AND high  
        CREATE new instance of Trie ASSIGN TO trie  
        SET nice_pairs TO zero  

        FOR each num IN nums  
            INCREMENT nice_pairs BY the result of calling count_less_than on trie with parameters num AND high PLUS one MINUS the result of calling count_less_than on trie with parameters num AND low  
            CALL insert method of trie with parameter num  
        END FOR  

        RETURN nice_pairs  
    END FUNCTION  
END CLASS