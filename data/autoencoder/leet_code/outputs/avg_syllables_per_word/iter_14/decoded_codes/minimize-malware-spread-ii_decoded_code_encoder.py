from collections import defaultdict

class Solution:
    def minMalwareSpread(self, graph, initial):
        n = len(graph)
        adj_list = defaultdict(list)
        for i in range(n):
            for j in range(i + 1, n):
                if graph[i][j] == 1:
                    adj_list[i].append(j)
                    adj_list[j].append(i)

        def dfs(node, visited):
            if node in visited:
                return 0
            visited.add(node)
            size = 1
            for neighbor in adj_list[node]:
                size += dfs(neighbor, visited)
            return size

        infected = set(initial)

        component_sizes = []
        visited = set()
        component_index = {}

        for node in range(n):
            if node not in visited and node not in infected:
                size = dfs(node, visited)
                component_sizes.append(size)
                i = len(component_sizes) - 1
                # Assign component index to all nodes in this component.
                # We need to find all nodes connected with 'node' to assign indices.
                # Since visited is shared, but we only added the nodes during dfs,
                # we can recover the nodes of this component by running a BFS or DFS again.
                # To avoid inefficiency, we do a BFS here.

                component_nodes = []
                stack = [node]
                visited_nodes = set()
                while stack:
                    curr = stack.pop()
                    if curr in visited_nodes or curr in infected:
                        continue
                    visited_nodes.add(curr)
                    component_nodes.append(curr)
                    for neighbor in adj_list[curr]:
                        if neighbor not in visited_nodes and neighbor not in infected:
                            stack.append(neighbor)

                for neighbor in component_nodes:
                    component_index[neighbor] = i

        infected_in_component = defaultdict(int)

        for node in infected:
            if node in component_index:
                infected_in_component[component_index[node]] += 1

        max_size = 0
        node_to_remove = min(initial)

        for node in infected:
            if node in component_index:
                comp_idx = component_index[node]
                if infected_in_component[comp_idx] == 1:
                    comp_size = component_sizes[comp_idx]
                    if comp_size > max_size:
                        max_size = comp_size
                        node_to_remove = node
                    elif comp_size == max_size and node < node_to_remove:
                        node_to_remove = node

        return node_to_remove