CLASS Solution  
    FUNCTION countPairs(nums, k)  
        SET gcd_count TO an empty mapping with default zero values for counting elements  
        
        FOR each num IN nums  
            SET the gcd_result TO the greatest common divisor OF num AND k  
            INCREMENT the count AT key gcd_result IN gcd_count BY one  
        END FOR  
        
        SET total_pairs TO zero  
        
        SET gcd_values TO the list of keys IN gcd_count  
        SET n TO the LENGTH OF gcd_values  
        
        FOR index i FROM zero TO n MINUS one  
            FOR index j FROM i TO n MINUS one  
                SET gcd1 TO the element AT position i OF gcd_values  
                SET gcd2 TO the element AT position j OF gcd_values  
                
                IF gcd1 MULTIPLIED BY gcd2 MODULO k IS EQUAL TO zero  
                    IF i IS EQUAL TO j  
                        INCREMENT total_pairs BY the count AT key gcd1 IN gcd_count MULTIPLIED BY the difference BETWEEN the count AT key gcd1 IN gcd_count AND one DIVIDED BY two  
                    ELSE  
                        INCREMENT total_pairs BY the count AT key gcd1 IN gcd_count MULTIPLIED BY the count AT key gcd2 IN gcd_count  
                    END IF  
                END IF  
            END FOR  
        END FOR  
        
        RETURN total_pairs  
    END FUNCTION  
END CLASS