CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO a mapping with default empty list for missing keys  
        SET out_degree TO a counting mapping with default zero for missing keys  
        SET in_degree TO a counting mapping with default zero for missing keys  
        
        FOR each element consisting of u and v IN pairs  
            APPEND v TO the list at graph indexed by u  
            INCREMENT out_degree at u BY one  
            INCREMENT in_degree at v BY one  
        END FOR  
        
        SET start_node TO nothing  
        FOR each node IN keys of graph  
            IF out_degree at node IS EQUAL TO in_degree at node PLUS one  
                SET start_node TO node  
                BREAK the loop  
            END IF  
        END FOR  
        
        IF start_node IS nothing  
            SET start_node TO the first element of keys of graph  
        END IF  
        
        SET path TO an empty list  
        SET stack TO a list containing start_node  
        
        WHILE the LENGTH OF stack IS GREATER THAN zero  
            SET u TO the last element of stack  
            IF the list at graph indexed by u IS NOT empty  
                SET v TO the last element of the list at graph indexed by u  
                REMOVE the last element FROM the list at graph indexed by u  
                APPEND v TO stack  
            ELSE  
                APPEND the last element of stack TO path  
                REMOVE the last element FROM stack  
            END IF  
        END WHILE  
        
        REVERSE the order of elements IN path  
        
        SET result TO an empty list  
        FOR index FROM zero TO LENGTH OF path MINUS two  
            APPEND a list consisting of element at position index OF path and element at position index PLUS one OF path TO result  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS