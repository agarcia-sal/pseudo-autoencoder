CLASS Solution  
    FUNCTION maximumBeauty WITH PARAMETER flowers  
        CREATE auxiliary FUNCTION initialize_default_dictionary TO produce a mapping from keys to empty lists  
  
        SET indices TO initialize_default_dictionary RESULT  
        
        SET prefix_sum TO list OF zero VALUES with LENGTH THE LENGTH OF flowers PLUS one  
        
        FOR index FROM zero TO THE LENGTH OF flowers MINUS one  
            SET element_at_index_of_prefix_sum FROM position index PLUS one TO element_at_index_of_prefix_sum FROM position index PLUS maximum BETWEEN element_at_index_of_flowers FROM position index AND zero  
            APPEND index TO list AT indices WITH KEY element_at_index_of_flowers FROM position index  
        END FOR  
        
        SET max_beauty TO negative infinity CONSTANT  
        
        FOR each beauty_key IN keys OF indices  
            IF LENGTH OF list AT indices WITH KEY beauty_key IS GREATER THAN OR EQUAL TO two THEN  
                SET first TO element_at_position zero OF list AT indices WITH KEY beauty_key  
                SET last TO element_at_position negative one OF list AT indices WITH KEY beauty_key  
                
                SET current_beauty TO two MULTIPLIED BY beauty_key PLUS element_at_position last OF prefix_sum MINUS element_at_position first PLUS one OF prefix_sum  
                
                IF current_beauty IS GREATER THAN max_beauty THEN  
                    SET max_beauty TO current_beauty  
                END IF  
            END IF  
        END FOR  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS