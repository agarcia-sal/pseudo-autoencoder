CLASS Solution
    FUNCTION numSquarefulPerms WITH PARAMETER nums AS List of integers
        FUNCTION is_square WITH PARAMETER n AS integer
            SET square_root TO the INTEGER part of the SQUARE ROOT of n
            IF square_root MULTIPLIED BY square_root EQUAL TO n THEN
                RETURN true
            ELSE
                RETURN false
            END IF
        END FUNCTION

        FUNCTION backtrack WITH PARAMETERS path AS list, count AS mapping FROM integer TO integer
            IF the LENGTH OF path EQUAL TO the LENGTH OF nums THEN
                RETURN one
            END IF

            SET ans TO zero
            FOR each x IN the KEYS OF count
                IF the VALUE ASSOCIATED WITH x IN count GREATER THAN zero AND (path IS EMPTY OR is_square WITH PARAMETER the LAST ELEMENT OF path PLUS x RETURNS true) THEN
                    DECREMENT the VALUE ASSOCIATED WITH x IN count BY one
                    SET ans TO ans PLUS backtrack WITH PARAMETERS path APPENDED WITH x AND count
                    INCREMENT the VALUE ASSOCIATED WITH x IN count BY one
                END IF
            END FOR
            RETURN ans
        END FUNCTION

        SET count TO the Counter MAPPING OF nums
        RETURN backtrack WITH PARAMETERS an EMPTY list AND count
    END FUNCTION
END CLASS