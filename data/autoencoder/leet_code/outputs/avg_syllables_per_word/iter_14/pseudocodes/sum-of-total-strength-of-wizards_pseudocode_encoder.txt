CLASS Solution  
    FUNCTION totalStrength(strength)  
        SET MOD TO ten RAISED TO THE POWER OF nine PLUS one  
        SET n TO the LENGTH OF strength  
        
        # Initialize prefix sums and prefix sums of prefix sums  
        SET prefix TO a list of ZEROS of LENGTH n PLUS one  
        FOR i FROM zero TO n MINUS one  
            SET prefix ELEMENT at position i PLUS one TO (prefix ELEMENT at position i PLUS strength ELEMENT at position i) MODULO MOD  
        END FOR  
        
        SET prefix_prefix TO a list of ZEROS of LENGTH n PLUS two  
        FOR i FROM zero TO n  
            SET prefix_prefix ELEMENT at position i PLUS one TO (prefix_prefix ELEMENT at position i PLUS prefix ELEMENT at position i) MODULO MOD  
        END FOR  
        
        # Initialize arrays to store previous and next smaller elements  
        SET prev_smaller TO a list FILLED WITH minus one OF LENGTH n  
        SET next_smaller_or_equal TO a list FILLED WITH n OF LENGTH n  
        
        # Monotonic stack to find previous smaller elements  
        SET stack TO an empty list  
        FOR i FROM zero TO n MINUS one  
            WHILE the LENGTH OF stack IS GREATER THAN zero AND strength ELEMENT at position element at the LAST POSITION OF stack IS GREATER THAN OR EQUAL TO strength ELEMENT at position i  
                REMOVE the element at the LAST POSITION FROM stack  
            END WHILE  
            IF the LENGTH OF stack IS GREATER THAN zero  
                SET prev_smaller ELEMENT at position i TO element at the LAST POSITION OF stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        # Monotonic stack to find next smaller or equal elements  
        CLEAR stack TO be an empty list  
        FOR i FROM n MINUS one DOWN TO zero  
            WHILE the LENGTH OF stack IS GREATER THAN zero AND strength ELEMENT at position element at the LAST POSITION OF stack IS GREATER THAN strength ELEMENT at position i  
                REMOVE the element at the LAST POSITION FROM stack  
            END WHILE  
            IF the LENGTH OF stack IS GREATER THAN zero  
                SET next_smaller_or_equal ELEMENT at position i TO element at the LAST POSITION OF stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        # Calculate the total strength  
        SET total_strength TO zero  
        FOR i FROM zero TO n MINUS one  
            SET left TO prev_smaller ELEMENT at position i PLUS one  
            SET right TO next_smaller_or_equal ELEMENT at position i  
            
            SET sum_left TO (i MINUS left PLUS one) MULTIPLIED BY (prefix_prefix ELEMENT at position right PLUS one MINUS prefix_prefix ELEMENT at position i PLUS one) MODULO MOD  
            SET sum_right TO (right MINUS i) MULTIPLIED BY (prefix_prefix ELEMENT at position i PLUS one MINUS prefix_prefix ELEMENT at position left) MODULO MOD  
            
            SET contribution TO strength ELEMENT at position i MULTIPLIED BY (sum_left MINUS sum_right) MODULO MOD  
            SET total_strength TO (total_strength PLUS contribution) MODULO MOD  
        END FOR  
        
        RETURN total_strength  
    END FUNCTION  
END CLASS