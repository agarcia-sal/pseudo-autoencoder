CLASS Solution  
    FUNCTION wordSquares WITH parameter words  
        DEFINE prefix_to_words AS A MAPPING FROM PREFIX STRINGS TO LISTS OF WORD STRINGS  
        FOR each word IN words  
            FOR index FROM zero TO LENGTH OF word MINUS one  
                SET prefix TO SUBSTRING FROM START TO index OF word  
                APPEND word TO THE LIST ASSOCIATED WITH prefix IN prefix_to_words  
            END FOR  
        END FOR  
        
        DEFINE results AS AN EMPTY LIST OF LISTS OF WORD STRINGS  
        
        FUNCTION backtrack WITH parameter square  
            IF LENGTH OF square EQUAL TO LENGTH OF THE FIRST ELEMENT IN words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO AN EMPTY STRING  
            FOR each word_element IN square  
                APPEND CHARACTER AT POSITION LENGTH OF square IN word_element TO prefix  
            END FOR  
            
            FOR each candidate IN THE LIST ASSOCIATED WITH prefix IN prefix_to_words  
                CALL backtrack WITH THE LIST OBTAINED BY APPENDING candidate TO square  
            END FOR  
        END FUNCTION  
        
        FOR each word_element IN words  
            CALL backtrack WITH A LIST CONTAINING word_element  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS