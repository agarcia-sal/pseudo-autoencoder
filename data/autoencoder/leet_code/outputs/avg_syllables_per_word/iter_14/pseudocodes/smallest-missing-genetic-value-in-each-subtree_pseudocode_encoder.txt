CLASS Solution  
    FUNCTION smallestMissingValueSubtree WITH PARAMETERS parents OF TYPE List of Integer AND nums OF TYPE List of Integer  
        SET n TO the LENGTH OF parents  
        SET tree TO a new default dictionary that produces an empty list for missing keys  

        FOR i FROM one TO n MINUS one  
            APPEND i TO the list AT key parents AT position i OF tree  
        END FOR  

        SET node_with_one TO negative one  
        FOR i FROM zero TO n MINUS one  
            IF the element at position i OF nums IS EQUAL TO one  
                SET node_with_one TO i  
                BREAK the loop  
            END IF  
        END FOR  

        IF node_with_one IS EQUAL TO negative one  
            RETURN a list containing the value one REPEATED n times  
        END IF  

        SET result TO a list containing the value one REPEATED n times  
        SET visited TO an empty set  

        FUNCTION dfs WITH PARAMETER node  
            ADD node TO visited  
            SET genetic_values TO a new set containing the element at position node OF nums  
            FOR each child IN the list at key node OF tree  
                IF child IS NOT IN visited  
                    CALL dfs WITH child AND UNION the returned set WITH genetic_values  
                END IF  
            END FOR  
            SET smallest_missing TO one  
            WHILE smallest_missing IS IN genetic_values  
                INCREMENT smallest_missing BY one  
            END WHILE  
            SET the element at position node OF result TO smallest_missing  
            RETURN genetic_values  
        END FUNCTION  

        SET path TO an empty list  
        SET current TO node_with_one  
        WHILE current IS NOT EQUAL TO negative one  
            APPEND current TO path  
            SET current TO the element at position current OF parents  
        END WHILE  

        SET path_set TO a new set containing all elements of path  
        FOR each node IN path TRAVERSED from last TO first  
            IF node IS IN visited  
                CONTINUE to the next iteration  
            END IF  
            CALL dfs WITH node  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS