CLASS Solution  
    FUNCTION maskPII WITH PARAMETER s  
        IF the character AT any position IN s IS EQUAL TO the symbol AT sign at sign  
            SET local TO the substring BEFORE the symbol AT sign at sign IN s  
            SET domain TO the substring AFTER the symbol AT sign at sign IN s  
            SET masked_local TO the first character OF local CONCATENATED WITH five times the character ASTERISK CONCATENATED WITH the last character OF local  
            RETURN the lowercase OF masked_local CONCATENATED WITH the symbol AT sign at sign CONCATENATED WITH the lowercase OF domain  
        ELSE  
            SET digits TO an empty string  
            FOR each character IN s  
                IF character IS a digit  
                    APPEND character TO digits  
                END IF  
            END FOR  
            SET local_number TO the three characters ASTERISK ASTERISK ASTERISK DASH ASTERISK ASTERISK ASTERISK DASH CONCATENATED WITH the last four characters OF digits  
            IF the length OF digits IS EQUAL TO ten  
                RETURN local_number  
            ELSE  
                SET country_code_length TO the length OF digits MINUS ten  
                SET country_code TO the character PLUS SIGN CONCATENATED WITH the character ASTERISK REPEATED country_code_length times CONCATENATED WITH the character DASH  
                RETURN country_code CONCATENATED WITH local_number  
            END IF  
        END IF  
    END FUNCTION  
END CLASS