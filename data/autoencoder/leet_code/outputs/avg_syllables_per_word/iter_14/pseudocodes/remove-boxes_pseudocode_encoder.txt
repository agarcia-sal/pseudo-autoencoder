CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l IS GREATER THAN r  
                RETURN zero  
            END IF  
            IF memo CONTAINS the KEY consisting OF l AND r AND k  
                RETURN the VALUE FROM memo ASSOCIATED WITH the KEY consisting OF l AND r AND k  
            END IF  
            WHILE r IS GREATER THAN l AND element at position r OF boxes IS EQUAL TO element at position r MINUS one OF boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO RESULT OF dp WITH PARAMETERS l, r MINUS one, zero, AND memo PLUS THE PRODUCT OF (k PLUS one) AND (k PLUS one)  
            FOR i FROM l TO r MINUS one  
                IF element at position i OF boxes IS EQUAL TO element at position r OF boxes  
                    SET res TO THE GREATER OF res AND THE RESULT OF dp WITH PARAMETERS l, i, k PLUS one, AND memo PLUS THE RESULT OF dp WITH PARAMETERS i PLUS one, r MINUS one, zero, AND memo  
                END IF  
            END FOR  
            ASSIGN res TO memo AT THE KEY CONSISTING OF l, r, AND k  
            RETURN res  
        END FUNCTION  
        RETURN RESULT OF dp WITH PARAMETERS zero, LENGTH OF boxes MINUS one, zero, AND AN EMPTY memo  
    END FUNCTION  
END CLASS