CLASS Solution  
    FUNCTION countPyramids WITH PARAMETER grid  
        FUNCTION count_pyramids_from_top WITH PARAMETER grid  
            IF grid IS EMPTY OR the LENGTH OF grid EQUAL TO zero OR the LENGTH OF element at position zero OF grid EQUAL TO zero  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF element at position zero OF grid  
            SET dp TO a two-dimensional list of zeros WITH m ROWS AND n COLUMNS  
            SET count TO zero  
            
            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    IF element at position i OF grid AT position j EQUAL TO one  
                        IF i EQUAL TO zero OR j EQUAL TO zero OR j EQUAL TO n MINUS one  
                            SET element at position i OF dp AT position j TO one  
                        ELSE  
                            SET element at position i OF dp AT position j TO the MINIMUM OF element at position i MINUS one OF dp AT position j MINUS one AND element at position i MINUS one OF dp AT position j AND element at position i MINUS one OF dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i OF dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i OF dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        FUNCTION count_pyramids_from_bottom WITH PARAMETER grid  
            IF grid IS EMPTY OR the LENGTH OF grid EQUAL TO zero OR the LENGTH OF element at position zero OF grid EQUAL TO zero  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF element at position zero OF grid  
            SET dp TO a two-dimensional list of zeros WITH m ROWS AND n COLUMNS  
            SET count TO zero  
            
            FOR i FROM m MINUS one DOWN TO zero  
                FOR j FROM zero TO n MINUS one  
                    IF element at position i OF grid AT position j EQUAL TO one  
                        IF i EQUAL TO m MINUS one OR j EQUAL TO zero OR j EQUAL TO n MINUS one  
                            SET element at position i OF dp AT position j TO one  
                        ELSE  
                            SET element at position i OF dp AT position j TO the MINIMUM OF element at position i PLUS one OF dp AT position j MINUS one AND element at position i PLUS one OF dp AT position j AND element at position i PLUS one OF dp AT position j PLUS one PLUS one  
                        END IF  
                        IF element at position i OF dp AT position j GREATER THAN one  
                            INCREMENT count BY element at position i OF dp AT position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        RETURN the RESULT OF count_pyramids_from_top WITH grid PLUS the RESULT OF count_pyramids_from_bottom WITH grid  
    END FUNCTION  
END CLASS