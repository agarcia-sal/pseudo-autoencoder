CLASS Solution  
    FUNCTION confusingNumberII(n)  
        SET rotate_map TO auxiliary FUNCTION mapping_digit_to_rotated_digit  
        SET valid_digits TO list containing zero one six eight nine  
        
        FUNCTION is_confusing(num)  
            SET original_num TO num  
            SET rotated_num TO zero  
            WHILE num GREATER THAN zero IS TRUE  
                SET digit TO remainder of num DIVIDED BY ten  
                SET rotated_num TO rotated_num MULTIPLIED BY ten PLUS rotate_map AT digit  
                SET num TO num DIVIDED BY ten discarding remainder  
            END WHILE  
            IF rotated_num NOT EQUAL TO original_num THEN  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
        
        FUNCTION count_confusing_numbers(limit current)  
            IF current GREATER THAN limit THEN  
                RETURN zero  
            END IF  
            IF current NOT EQUAL TO zero AND is_confusing(current) IS true THEN  
                SET count TO one  
            ELSE  
                SET count TO zero  
            END IF  
            FOR each digit IN valid_digits  
                SET new_number TO current MULTIPLIED BY ten PLUS digit  
                IF new_number EQUAL TO zero THEN  
                    CONTINUE TO next iteration  
                END IF  
                INCREMENT count BY count_confusing_numbers(limit new_number)  
            END FOR  
            RETURN count  
        END FUNCTION  
        
        RETURN count_confusing_numbers(n zero)  
    END FUNCTION  
END CLASS