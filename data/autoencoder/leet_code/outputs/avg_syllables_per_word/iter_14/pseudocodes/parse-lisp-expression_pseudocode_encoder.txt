CLASS Solution  
    FUNCTION evaluate(expression)  
        FUNCTION get_tokens(expression)  
            SET tokens TO empty list  
            SET buf TO empty string  
            SET depth TO zero  
            FOR each character IN expression  
                IF character IS equal to a space AND depth IS equal to zero  
                    APPEND buf TO tokens  
                    SET buf TO empty string  
                ELSE  
                    IF character IS equal to an opening parenthesis  
                        INCREMENT depth BY one  
                    ELSE IF character IS equal to a closing parenthesis  
                        DECREMENT depth BY one  
                    END IF  
                    CONCATENATE character TO buf  
                END IF  
            END FOR  
            IF buf IS NOT empty  
                APPEND buf TO tokens  
            END IF  
            RETURN tokens  
        END FUNCTION  

        FUNCTION evaluate_expression(tokens, context)  
            IF element at position zero OF tokens IS equal to the word add  
                SET value_one TO evaluate_expression(element at position one OF tokens, context)  
                SET value_two TO evaluate_expression(element at position two OF tokens, context)  
                RETURN value_one PLUS value_two  
            ELSE IF element at position zero OF tokens IS equal to the word mult  
                SET value_one TO evaluate_expression(element at position one OF tokens, context)  
                SET value_two TO evaluate_expression(element at position two OF tokens, context)  
                RETURN value_one MULTIPLIED BY value_two  
            ELSE IF element at position zero OF tokens IS equal to the word let  
                SET new_context TO a copy OF context  
                SET index TO one  
                WHILE index IS LESS THAN the length OF tokens MINUS one  
                    SET var TO element at position index OF tokens  
                    SET expr TO element at position index PLUS one OF tokens  
                    SET new_context at key var TO evaluate_expression(expr, new_context)  
                    INCREMENT index BY two  
                END WHILE  
                RETURN evaluate_expression(element at the last position OF tokens, new_context)  
            ELSE  
                ATTEMPT  
                    RETURN the integer conversion OF element at position zero OF tokens  
                EXCEPT conversion failure  
                    RETURN context at key element at position zero OF tokens  
                END ATTEMPT  
            END IF  
        END FUNCTION  

        FUNCTION parse_expression(expression)  
            IF element at position zero OF expression IS NOT equal to an opening parenthesis  
                RETURN expression  
            END IF  
            SET tokens TO get_tokens(expression WITHOUT the first character AND WITHOUT the last character)  
            RETURN a list COMPRISING parse_expression(token) FOR each token IN tokens  
        END FUNCTION  

        SET parsed_expression TO parse_expression(expression)  
        RETURN evaluate_expression(parsed_expression, an empty dictionary)  
    END FUNCTION  
END CLASS