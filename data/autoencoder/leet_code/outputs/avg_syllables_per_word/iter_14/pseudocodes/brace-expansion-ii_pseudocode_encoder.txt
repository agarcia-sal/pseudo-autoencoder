CLASS Solution  
    FUNCTION braceExpansionII WITH PARAMETER expression  
        FUNCTION parse_expression WITH PARAMETER index  
            SET current_set TO an empty collection of unique elements  
            SET current_product TO a collection containing an empty string  
            
            WHILE index IS LESS THAN the LENGTH OF expression  
                SET char TO the element at position index OF expression  
                
                IF char IS EQUAL TO the character indicating opening brace  
                    SET inner_set AND index TO the RESULT of calling parse_expression WITH PARAMETER index PLUS one  
                    SET current_product TO a NEW collection containing each element from current_product concatenated with each element from inner_set FOR all combinations  
                ELSE IF char IS EQUAL TO the character indicating closing brace  
                    ADD to current_set all strings formed by concatenating elements of current_product  
                    RETURN current_set AND index  
                ELSE IF char IS EQUAL TO the character indicating comma  
                    ADD to current_set all strings formed by concatenating elements of current_product  
                    SET current_product TO a collection containing an empty string  
                ELSE  
                    SET current_product TO a NEW collection containing each element from current_product concatenated with char  
                END IF  
                
                INCREMENT index BY one  
            END WHILE  
            
            ADD to current_set all strings formed by concatenating elements of current_product  
            RETURN current_set AND index  
        END FUNCTION  
        
        SET result_set AND an unused variable TO the RESULT of calling parse_expression WITH PARAMETER zero  
        RETURN result_set sorted in ascending lexicographical order  
    END FUNCTION  
END CLASS