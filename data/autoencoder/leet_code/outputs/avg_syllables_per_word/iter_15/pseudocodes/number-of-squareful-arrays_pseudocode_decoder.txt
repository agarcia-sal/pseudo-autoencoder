CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root_value TO THE INTEGER PART OF THE SQUARE ROOT OF n  
            IF square_root_value MULTIPLIED BY square_root_value EQUALS n THEN  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
      
        FUNCTION backtrack(path, count)  
            IF LENGTH OF path EQUALS LENGTH OF nums THEN  
                RETURN one  
            END IF  
          
            SET ans TO zero  
            FOR each x IN count  
                IF value at key x in count GREATER THAN zero AND (path IS EMPTY OR is_square(SUM OF element at LAST POSITION OF path PLUS x)) THEN  
                    DECREMENT value at key x in count BY one  
                    INCREMENT ans BY backtrack(path WITH element x APPENDED, count)  
                    INCREMENT value at key x in count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
      
        SET count TO Counter REPRESENTING THE FREQUENCIES OF ELEMENTS IN nums  
        RETURN backtrack(EMPTY LIST, count)  
    END FUNCTION  
END CLASS