CLASS Solution  
    FUNCTION removeBoxes WITH PARAMETER boxes  
        FUNCTION dp WITH PARAMETERS l r k memo  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            IF the TRIPLE l r k EXISTS AS key IN memo  
                RETURN the VALUE ASSOCIATED WITH key of l r k IN memo  
            END IF  
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO THE RESULT OF CALLING dp WITH PARAMETERS l r MINUS one zero memo PLUS THE PRODUCT OF THE SUM OF k PLUS one AND ITSELF  
            FOR index i FROM l TO r MINUS one  
                IF element at position i of boxes EQUALS element at position r of boxes  
                    SET res TO THE MAXIMUM OF res AND THE SUM OF THE RESULT OF CALLING dp WITH PARAMETERS l i k PLUS one memo AND THE RESULT OF CALLING dp WITH PARAMETERS i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            SET the VALUE ASSOCIATED WITH key of l r k IN memo TO res  
            RETURN res  
        END FUNCTION  
        RETURN THE RESULT OF CALLING dp WITH PARAMETERS zero THE LENGTH OF boxes MINUS one ZERO AN EMPTY COLLECTION  
    END FUNCTION  
END CLASS