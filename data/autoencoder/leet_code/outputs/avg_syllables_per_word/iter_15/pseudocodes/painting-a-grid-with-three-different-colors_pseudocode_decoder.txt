CLASS Solution  
    FUNCTION colorTheGrid WITH PARAMETERS m n  
        SET MOD TO one billion PLUS seven  
              
        FUNCTION generate_valid_columns WITH PARAMETER prev_col  
            SET colors TO list containing one two three  
            SET valid_cols TO empty list  
                  
            FUNCTION backtrack WITH PARAMETERS col row  
                IF row EQUALS m THEN  
                    APPEND the tuple version of col TO valid_cols  
                    RETURN  
                END IF  
                FOR each color IN colors  
                    IF col IS empty OR element at position negative one of col NOT EQUALS color THEN  
                        IF prev_col IS NOT None AND element at position row of prev_col EQUALS color THEN  
                            CONTINUE to next iteration  
                        END IF  
                        APPEND color TO col  
                        CALL backtrack WITH col AND row PLUS one  
                        REMOVE the last element FROM col  
                    END IF  
                END FOR  
            END FUNCTION  
              
            CALL backtrack WITH empty list AND zero  
            RETURN valid_cols  
        END FUNCTION  
              
        SET all_valid_cols TO result of calling generate_valid_columns WITH None  
        SET num_valid_cols TO the LENGTH OF all_valid_cols  
              
        SET compatible_cols TO a dictionary with keys from zero TO num_valid_cols MINUS one each mapped TO empty list  
        FOR i FROM zero TO num_valid_cols MINUS one  
            FOR j FROM zero TO num_valid_cols MINUS one  
                IF for all k FROM zero TO m MINUS one the element at position k of all_valid_cols at position i NOT EQUALS element at position k of all_valid_cols at position j THEN  
                    APPEND j TO the list at key i OF compatible_cols  
                END IF  
            END FOR  
        END FOR  
              
        SET dp TO a list of size num_valid_cols each element set TO one  
              
        FOR _ FROM one TO n MINUS one  
            SET next_dp TO a list of size num_valid_cols each element set TO zero  
            FOR i FROM zero TO num_valid_cols MINUS one  
                FOR each j IN the list at key i OF compatible_cols  
                    SET next_dp at position j TO the sum of element at position j of next_dp PLUS element at position i of dp MODULO MOD  
                END FOR  
            END FOR  
            SET dp TO next_dp  
        END FOR  
              
        RETURN the sum of all elements in dp MODULO MOD  
    END FUNCTION  
END CLASS