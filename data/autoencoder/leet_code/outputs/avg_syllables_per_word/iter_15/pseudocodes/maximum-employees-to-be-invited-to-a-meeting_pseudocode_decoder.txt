CLASS Solution  
    FUNCTION maximumInvitations(favorite)  
        SET n TO the LENGTH OF favorite  
        SET graph TO a DEFAULT DICTIONARY WHERE each key MAPS TO an EMPTY LIST  
        SET in_degree TO a LIST OF zero WITH LENGTH n  
        FOR i FROM zero TO n MINUS one  
            APPEND element i TO the LIST at key element at position i of favorite in graph  
            INCREMENT element at position element at position i of favorite in in_degree BY one  
        END FOR  
        SET mutual_chains TO zero  
        SET visited TO a LIST OF False WITH LENGTH n  
        FOR i FROM zero TO n MINUS one  
            IF element at position element at position i of favorite EQUALS i AND i LESS THAN element at position i of favorite THEN  
                SET a TO i  
                SET b TO element at position i of favorite  
                SET chain_a TO RESULT OF FUNCTION find_chain_length WITH PARAMETERS a graph visited  
                SET chain_b TO RESULT OF FUNCTION find_chain_length WITH PARAMETERS b graph visited  
                INCREMENT mutual_chains BY chain_a PLUS chain_b  
            END IF  
        END FOR  
        SET longest_cycle TO zero  
        SET visited TO a LIST OF False WITH LENGTH n  
        FOR i FROM zero TO n MINUS one  
            IF element at position i of visited EQUALS False THEN  
                SET cycle_length TO RESULT OF FUNCTION find_cycle_length WITH PARAMETERS i graph visited favorite  
                IF cycle_length GREATER THAN longest_cycle THEN  
                    SET longest_cycle TO cycle_length  
                END IF  
            END IF  
        END FOR  
        IF mutual_chains GREATER THAN longest_cycle THEN  
            RETURN mutual_chains  
        ELSE  
            RETURN longest_cycle  
        END IF  
    END FUNCTION  
  
    FUNCTION find_chain_length(start graph visited)  
        SET length TO zero  
        SET queue TO a DOUBLE ENDED QUEUE INITIALIZED WITH start  
        SET element at position start of visited TO True  
        WHILE queue IS NOT EMPTY  
            REMOVE the FIRST element FROM queue AND ASSIGN TO current  
            FOR each neighbor IN element at position current of graph  
                IF element at position neighbor of visited EQUALS False THEN  
                    SET element at position neighbor of visited TO True  
                    APPEND neighbor TO queue  
                    INCREMENT length BY one  
                END IF  
            END FOR  
        END WHILE  
        RETURN length  
    END FUNCTION  
  
    FUNCTION find_cycle_length(start graph visited favorite)  
        IF element at position start of visited EQUALS True THEN  
            RETURN zero  
        END IF  
        SET stack TO an EMPTY LIST  
        SET current TO start  
        WHILE element at position current of visited EQUALS False  
            SET element at position current of visited TO True  
            APPEND current TO stack  
            SET current TO element at position current of favorite  
        END WHILE  
        IF current NOT IN stack THEN  
            RETURN zero  
        END IF  
        SET cycle_start_index TO the POSITION OF current IN stack  
        SET cycle_length TO the LENGTH OF stack MINUS cycle_start_index  
        RETURN cycle_length  
    END FUNCTION  
END CLASS