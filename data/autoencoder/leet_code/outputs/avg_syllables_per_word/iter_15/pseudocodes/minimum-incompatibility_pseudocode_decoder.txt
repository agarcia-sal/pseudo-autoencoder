CLASS Solution  
    FUNCTION minimumIncompatibility(nums AS List OF integer, k AS integer) RETURNS integer  
        IMPORT collections.Counter AS Counter  
        
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        SET counts TO the values of COUNT OF each element IN nums USING Counter  
        IF there EXISTS a count IN counts THAT IS GREATER THAN k THEN  
            RETURN minus one  
        END IF  
        
        SET subset_incompatibility TO an empty dictionary  
        
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            SET bit_count TO the COUNT OF ones IN the binary representation of mask  
            IF bit_count EQUALS subset_size THEN  
                SET elements TO an empty list  
                FOR index FROM zero TO n MINUS one  
                    IF the bitwise AND OF mask AND two RAISED TO THE index IS NOT EQUAL TO zero THEN  
                        APPEND element at position index of nums TO elements  
                    END IF  
                END FOR  
                IF the LENGTH OF THE SET OF elements EQUALS subset_size THEN  
                    SET incompatibility TO the MAXIMUM element in elements MINUS the MINIMUM element in elements  
                    SET subset_incompatibility AT key mask TO incompatibility  
                END IF  
            END IF  
        END FOR  
        
        SET dp TO a list of length two RAISED TO THE POWER OF n FILLED with positive infinity  
        SET dp AT position zero TO zero  
        
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            SET bit_count TO the COUNT OF ones IN the binary representation of mask  
            IF the remainder of bit_count DIVIDED BY subset_size IS NOT EQUAL TO zero THEN  
                CONTINUE the next iteration of the loop  
            END IF  
            FOR each subset_mask IN THE KEYS OF subset_incompatibility  
                IF the bitwise AND OF mask AND subset_mask EQUALS subset_mask THEN  
                    SET dp AT position mask TO the MINIMUM OF dp AT position mask AND the SUM OF dp AT position bitwise XOR OF mask AND subset_mask AND subset_incompatibility AT key subset_mask  
                END IF  
            END FOR  
        END FOR  
        
        IF dp AT position two RAISED TO THE POWER OF n MINUS one IS NOT EQUAL TO positive infinity THEN  
            RETURN dp AT position two RAISED TO THE POWER OF n MINUS one  
        ELSE  
            RETURN minus one  
        END IF  
    END FUNCTION  
END CLASS