CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        SET directions TO the list of pairs zero and one zero and negative one one and zero negative one and zero  
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF element at position zero of grid  
        SET start TO None  
        SET num_keys TO zero  

        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF element at position i of grid at position j EQUALS the symbol at sign of at sign  
                    SET start TO the pair of i and j  
                ELSE IF element at position i of grid at position j is a lowercase letter  
                    INCREMENT num_keys BY one  
                END IF  
            END FOR  
        END FOR  

        SET queue TO a double ended queue initialized with the tuple of element at position zero of start element at position one of start zero zero  
        SET visited TO a set initialized with the tuple of element at position zero of start element at position one of start zero  

        WHILE queue is not empty  
            REMOVE and RETURN from the left of queue TO the tuple of variables x y keys steps  

            FOR each pair dx dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  

                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n  
                    SET cell TO element at position nx of grid at position ny  

                    IF cell EQUALS the symbol number sign  
                        CONTINUE to next iteration  
                    END IF  

                    IF cell is an uppercase letter  
                        SET key_needed TO one SHIFTED LEFT BY the numerical position of character cell converted to lowercase MINUS the numerical position of character a  
                        IF keys AND key_needed EQUALS zero  
                            CONTINUE to next iteration  
                        END IF  
                    END IF  

                    IF cell is a lowercase letter  
                        SET new_keys TO keys OR one SHIFTED LEFT BY the numerical position of character cell MINUS the numerical position of character a  
                        IF new_keys EQUALS one SHIFTED LEFT BY num_keys MINUS one  
                            RETURN steps PLUS one  
                        END IF  
                    ELSE  
                        SET new_keys TO keys  
                    END IF  

                    IF the tuple of nx ny new_keys is not in visited  
                        ADD the tuple of nx ny new_keys TO visited  
                        APPEND the tuple of nx ny new_keys steps PLUS one TO queue  
                    END IF  
                END IF  
            END FOR  
        END WHILE  

        RETURN negative one  
    END FUNCTION  
END CLASS