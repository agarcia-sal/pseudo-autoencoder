CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO an empty set  
            SET current_product TO a list containing the empty string  
            
            WHILE the value of index is less than the LENGTH OF expression  
                SET char TO the element at position index of expression  
                
                IF char EQUALS the character representing an opening brace  
                    SET inner_set AND updated_index TO the result of calling parse_expression with argument index PLUS one  
                    SET temp_product TO an empty list  
                    FOR each string a IN current_product  
                        FOR each string b IN inner_set  
                            APPEND the concatenation of string a and string b TO temp_product  
                        END FOR  
                    END FOR  
                    SET current_product TO temp_product  
                    SET index TO updated_index  
                
                ELSE IF char EQUALS the character representing a closing brace  
                    FOR each string p IN current_product  
                        ADD the string obtained by joining the characters of p TO current_set  
                    END FOR  
                    RETURN current_set AND index  
                
                ELSE IF char EQUALS the character representing a comma  
                    FOR each string p IN current_product  
                        ADD the string obtained by joining the characters of p TO current_set  
                    END FOR  
                    SET current_product TO a list containing the empty string  
                
                ELSE  
                    SET temp_product TO an empty list  
                    FOR each string a IN current_product  
                        APPEND the concatenation of string a and char TO temp_product  
                    END FOR  
                    SET current_product TO temp_product  
                
                END IF  
                INCREMENT index BY one  
            END WHILE  
            
            FOR each string p IN current_product  
                ADD the string obtained by joining the characters of p TO current_set  
            END FOR  
            RETURN current_set AND index  
        END FUNCTION  
        
        SET result_set AND _ TO the result of calling parse_expression with argument zero  
        RETURN the sorted list obtained from result_set  
    END FUNCTION  
END CLASS