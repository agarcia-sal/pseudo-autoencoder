CLASS Solution  
    FUNCTION numBusesToDestination(routes AS List OF List OF Integer, source AS Integer, target AS Integer) RETURNS Integer  
        IF source EQUALS target THEN  
            RETURN zero  
        END IF  

        SET stop_to_buses TO a new defaultdict mapping each stop TO a list of buses  
        FOR each bus WITH index bus_index IN routes  
            FOR each stop IN route corresponding to bus_index  
                APPEND bus_index TO list of buses at stop in stop_to_buses  
            END FOR  
        END FOR  

        SET bus_queue TO a new deque  
        SET visited_buses TO a new empty set  
        SET visited_stops TO a new empty set  

        FOR each bus IN list of buses at key source in stop_to_buses  
            APPEND to bus_queue the pair of the bus and the integer one representing number of buses taken  
            ADD bus TO visited_buses  
            ADD source TO visited_stops  
        END FOR  

        WHILE bus_queue is not empty  
            REMOVE the first element from bus_queue and ASSIGN to current_bus and bus_count  

            FOR each stop IN route of current_bus in routes  
                IF stop EQUALS target THEN  
                    RETURN bus_count  
                END IF  

                IF stop is not IN visited_stops THEN  
                    ADD stop TO visited_stops  
                    FOR each next_bus IN list of buses at key stop in stop_to_buses  
                        IF next_bus is not IN visited_buses THEN  
                            ADD next_bus TO visited_buses  
                            APPEND to bus_queue the pair of next_bus and the sum of bus_count and one  
                        END IF  
                    END FOR  
                END IF  
            END FOR  
        END WHILE  

        RETURN negative one  
    END FUNCTION  
END CLASS