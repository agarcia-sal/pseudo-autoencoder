CLASS Solution  
    FUNCTION minFlips(mat)  
        FUNCTION flip(matrix, x, y)  
            SET directions TO list of coordinate pairs for neighbors and self  
            FOR each dx, dy IN directions  
                SET nx TO x plus dx  
                SET ny TO y plus dy  
                IF nx greater than or equal to zero AND nx less than m AND ny greater than or equal to zero AND ny less than n THEN  
                    SET matrix at position nx, ny TO one minus current value at matrix nx, ny  
        END FUNCTION  
        
        FUNCTION matrix_to_tuple(matrix)  
            RETURN immutable sequence of immutable sequences representing matrix rows  
        END FUNCTION  
        
        SET m TO number of rows in mat  
        SET n TO number of columns in mat  
        SET target TO immutable sequence of zero rows of length n for m times  
        SET initial_state TO matrix_to_tuple applied to mat  
        SET queue TO list containing tuple of initial_state and zero  
        SET visited TO empty set  
        ADD initial_state TO visited  
        
        WHILE queue is not empty DO  
            REMOVE first element from queue INTO current_state and steps  
            IF current_state equals target THEN  
                RETURN steps  
            SET current_matrix TO mutable list of lists copied from current_state  
            FOR i FROM zero TO m minus one DO  
                FOR j FROM zero TO n minus one DO  
                    SET next_matrix TO deep copy of current_matrix  
                    CALL flip with next_matrix, i, j  
                    SET next_state TO matrix_to_tuple applied to next_matrix  
                    IF next_state not in visited THEN  
                        ADD next_state TO visited  
                        APPEND tuple of next_state and steps plus one TO queue  
        RETURN minus one  
    END FUNCTION  
END CLASS