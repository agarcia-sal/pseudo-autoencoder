CLASS Solution  
    FUNCTION pyramidTransition(bottom, allowed)  
        SET allowed_map TO map with default as map with default as list  
        FOR each rule IN allowed  
            SET left TO first element of rule  
            SET right TO second element of rule  
            SET top TO third element of rule  
            APPEND top TO allowed_map[left][right]  
        
        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF length of current_bottom EQUALS 1  
                RETURN True  
            IF length of current_top EQUALS length of current_bottom MINUS 1  
                RETURN can_build_pyramid(current_top, empty list)  
            
            SET left TO element of current_bottom AT position length of current_top  
            SET right TO element of current_bottom AT position length of current_top PLUS 1  
            IF allowed_map HAS key left AND allowed_map[left] HAS key right  
                FOR each top IN allowed_map[left][right]  
                    IF can_build_pyramid(current_bottom, current_top CONCATENATED WITH top)  
                        RETURN True  
            RETURN False  
        END FUNCTION  
        
        RETURN can_build_pyramid(bottom, empty list)  
    END FUNCTION  
END CLASS