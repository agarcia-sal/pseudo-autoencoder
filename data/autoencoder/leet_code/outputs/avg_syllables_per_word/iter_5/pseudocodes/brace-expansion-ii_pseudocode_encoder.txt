CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index LESS THAN length of expression  
                SET char TO expression AT index  
                
                IF char EQUALS '{'  
                    SET inner_set, index TO parse_expression(index PLUS 1)  
                    SET current_product TO all combinations of strings from current_product concatenated with strings from inner_set  
                
                ELSE IF char EQUALS '}'  
                    ADD all joined strings from current_product TO current_set  
                    RETURN current_set, index  
                
                ELSE IF char EQUALS ','  
                    ADD all joined strings from current_product TO current_set  
                    SET current_product TO list containing empty string  
                
                ELSE  
                    SET current_product TO all strings from current_product each concatenated with char  
                
                INCREMENT index BY 1  
            
            ADD all joined strings from current_product TO current_set  
            RETURN current_set, index  
        END FUNCTION  
        
        SET result_set, _ TO parse_expression(0)  
        RETURN sorted list of result_set  
    END FUNCTION  
END CLASS