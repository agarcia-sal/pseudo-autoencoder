CLASS Solution  
    FUNCTION trapRainWater(heightMap)  
        IF heightMap IS EMPTY OR heightMap FIRST ELEMENT IS EMPTY  
            RETURN 0  
        
        SET m TO LENGTH OF heightMap  
        SET n TO LENGTH OF heightMap FIRST ELEMENT  
        SET visited TO 2D LIST OF False WITH DIMENSIONS m BY n  
        SET min_heap TO EMPTY LIST  
        
        FOR i FROM 0 TO m MINUS 1  
            PUSH (heightMap AT i AT 0, i, 0) INTO min_heap  
            PUSH (heightMap AT i AT n MINUS 1, i, n MINUS 1) INTO min_heap  
            SET visited AT i AT 0 TO True  
            SET visited AT i AT n MINUS 1 TO True  
        
        FOR j FROM 0 TO n MINUS 1  
            PUSH (heightMap AT 0 AT j, 0, j) INTO min_heap  
            PUSH (heightMap AT m MINUS 1 AT j, m MINUS 1, j) INTO min_heap  
            SET visited AT 0 AT j TO True  
            SET visited AT m MINUS 1 AT j TO True  
        
        SET directions TO LIST OF (-1, 0), (1, 0), (0, -1), (0, 1)  
        SET water_trapped TO 0  
        
        WHILE min_heap IS NOT EMPTY  
            POP smallest HEIGHT, x, y FROM min_heap  
            
            FOR EACH dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx GREATER THAN OR EQUAL TO 0 AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO 0 AND ny LESS THAN n AND visited AT nx AT ny IS False  
                    SET visited AT nx AT ny TO True  
                    SET water_trapped TO water_trapped PLUS MAXIMUM OF 0 AND height MINUS heightMap AT nx AT ny  
                    PUSH (MAXIMUM OF height AND heightMap AT nx AT ny, nx, ny) INTO min_heap  
        
        RETURN water_trapped  
    END FUNCTION  
END CLASS