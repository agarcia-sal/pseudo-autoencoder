CLASS TrieNode  
    FUNCTION __init__()  
        SET children TO a mapping with default value TrieNode  
        SET count TO 0  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION maxGeneticDifference(parents, queries)  
        SET tree TO a mapping with default value empty list  
        FOR each index i and value parent IN parents  
            IF parent IS NOT EQUAL TO -1  
                APPEND i TO tree[parent]  
            END IF  
        END FOR  
          
        SET node_queries TO a mapping with default value empty list  
        FOR each node and val IN queries  
            APPEND val TO node_queries[node]  
        END FOR  
          
        SET root TO a new TrieNode  
          
        SET result TO a list of zeros WITH LENGTH OF queries  
          
        DEFINE FUNCTION dfs(node)  
            CALL insert(trie_root = root, value = node)  
              
            FOR each val IN node_queries[node]  
                SET result AT query_idx[(node, val)] TO max_xor(trie_root = root, value = val)  
            END FOR  
              
            FOR each child IN tree[node]  
                CALL dfs(child)  
            END FOR  
              
            CALL erase(trie_root = root, value = node)  
        END FUNCTION  
          
        DEFINE FUNCTION insert(trie_root, value)  
            SET node TO trie_root  
            FOR i FROM 17 DOWNTO 0  
                SET bit TO the i-th bit of value  
                SET node TO node.children[bit]  
                INCREMENT node.count BY 1  
            END FOR  
        END FUNCTION  
          
        DEFINE FUNCTION erase(trie_root, value)  
            SET node TO trie_root  
            FOR i FROM 17 DOWNTO 0  
                SET bit TO the i-th bit of value  
                SET node TO node.children[bit]  
                DECREMENT node.count BY 1  
            END FOR  
        END FUNCTION  
          
        DEFINE FUNCTION max_xor(trie_root, value)  
            SET node TO trie_root  
            SET max_xor_val TO 0  
            FOR i FROM 17 DOWNTO 0  
                SET bit TO the i-th bit of value  
                SET toggled_bit TO 1 MINUS bit  
                IF toggled_bit EXISTS IN node.children AND node.children[toggled_bit].count IS GREATER THAN 0  
                    SET max_xor_val TO max_xor_val OR (1 LEFT SHIFTED BY i)  
                    SET node TO node.children[toggled_bit]  
                ELSE  
                    SET node TO node.children[bit]  
                END IF  
            END FOR  
            RETURN max_xor_val  
        END FUNCTION  
          
        SET query_idx TO a mapping FROM (node, val) TO index IN queries  
          
        FOR each index i and value parent IN parents  
            IF parent IS EQUAL TO -1  
                CALL dfs(i)  
                BREAK  
            END IF  
        END FOR  
          
        RETURN result  
    END FUNCTION  
END CLASS