CLASS Solution  
    FUNCTION shortestPath(grid, k)  
        IF grid IS EMPTY OR grid FIRST ELEMENT IS EMPTY  
            RETURN -1  
        
        SET m TO LENGTH OF grid  
        SET n TO LENGTH OF grid FIRST ELEMENT  
        
        IF k IS GREATER THAN OR EQUAL TO m PLUS n MINUS 2  
            RETURN m PLUS n MINUS 2  
        
        SET directions TO LIST OF (0, 1), (1, 0), (0, -1), (-1, 0)  
        
        SET queue TO NEW DEQUE INITIALIZED WITH (0, 0, k, 0)  
        
        SET visited TO NEW SET INITIALIZED WITH (0, 0, k)  
        
        WHILE queue IS NOT EMPTY  
            SET x, y, remaining_k, steps TO REMOVE FIRST ELEMENT FROM queue  
            
            IF x IS EQUAL TO m MINUS 1 AND y IS EQUAL TO n MINUS 1  
                RETURN steps  
            
            FOR EACH dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx IS GREATER THAN OR EQUAL TO 0 AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO 0 AND ny IS LESS THAN n  
                    SET new_k TO remaining_k MINUS grid AT nx AT ny  
                    IF new_k IS GREATER THAN OR EQUAL TO 0 AND (nx, ny, new_k) IS NOT IN visited  
                        ADD (nx, ny, new_k) TO visited  
                        APPEND (nx, ny, new_k, steps PLUS 1) TO queue  
        
        RETURN -1  
    END FUNCTION  
END CLASS