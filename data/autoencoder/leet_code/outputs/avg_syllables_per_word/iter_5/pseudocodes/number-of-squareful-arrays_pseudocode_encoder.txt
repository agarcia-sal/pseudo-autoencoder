CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            RETURN square of integer square root of n EQUALS n  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF length of path EQUALS length of nums THEN  
                RETURN 1  
            END IF  
            
            SET ans TO 0  
            FOR each x IN count  
                IF count of x GREATER THAN 0 AND (path IS empty OR is_square(last element of path PLUS x)) THEN  
                    DECREMENT count of x BY 1  
                    INCREMENT ans BY backtrack(path APPENDED WITH x, count)  
                    INCREMENT count of x BY 1  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO frequency count of elements in nums  
        RETURN backtrack(empty list, count)  
    END FUNCTION  
END CLASS