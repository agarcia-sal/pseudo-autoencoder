CLASS Solution  
    FUNCTION countSmaller(nums)  
        SET sorted_nums TO sorted unique elements in nums  
        SET rank TO dictionary mapping each value in sorted_nums to its position starting from 1  
        SET bit TO list of zeros with size LENGTH OF sorted_nums PLUS 1  
        
        FUNCTION get_sum(idx)  
            SET res TO 0  
            WHILE idx GREATER THAN 0  
                INCREMENT res BY bit at position idx  
                DECREMENT idx BY idx AND negative idx  
            RETURN res  
        END FUNCTION  
        
        FUNCTION update(idx, delta)  
            WHILE idx LESS THAN LENGTH OF bit  
                INCREMENT bit at position idx BY delta  
                INCREMENT idx BY idx AND negative idx  
        END FUNCTION  
        
        SET counts TO empty list  
        FOR each num IN nums iterated from last to first  
            SET r TO rank at num  
            APPEND get_sum(r MINUS 1) TO counts  
            CALL update with r and 1  
        
        RETURN counts reversed  
    END FUNCTION  
END CLASS