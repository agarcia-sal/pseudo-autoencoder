CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid IS EMPTY OR grid AT 0 IS EMPTY THEN  
                RETURN 0  
            SET m TO LENGTH OF grid  
            SET n TO LENGTH OF grid AT 0  
            SET dp TO NEW TWO-DIMENSIONAL LIST OF SIZE m BY n FILLED WITH 0  
            SET count TO 0  
            
            FOR i FROM 0 TO m MINUS 1  
                FOR j FROM 0 TO n MINUS 1  
                    IF grid AT i AT j EQUALS 1 THEN  
                        IF i EQUALS 0 OR j EQUALS 0 OR j EQUALS n MINUS 1 THEN  
                            SET dp AT i AT j TO 1  
                        ELSE  
                            SET dp AT i AT j TO MINIMUM OF dp AT i MINUS 1 AT j MINUS 1, dp AT i MINUS 1 AT j, dp AT i MINUS 1 AT j PLUS 1 PLUS 1  
                        END IF  
                        IF dp AT i AT j GREATER THAN 1 THEN  
                            INCREMENT count BY dp AT i AT j MINUS 1  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid IS EMPTY OR grid AT 0 IS EMPTY THEN  
                RETURN 0  
            SET m TO LENGTH OF grid  
            SET n TO LENGTH OF grid AT 0  
            SET dp TO NEW TWO-DIMENSIONAL LIST OF SIZE m BY n FILLED WITH 0  
            SET count TO 0  
            
            FOR i FROM m MINUS 1 DOWNTO 0  
                FOR j FROM 0 TO n MINUS 1  
                    IF grid AT i AT j EQUALS 1 THEN  
                        IF i EQUALS m MINUS 1 OR j EQUALS 0 OR j EQUALS n MINUS 1 THEN  
                            SET dp AT i AT j TO 1  
                        ELSE  
                            SET dp AT i AT j TO MINIMUM OF dp AT i PLUS 1 AT j MINUS 1, dp AT i PLUS 1 AT j, dp AT i PLUS 1 AT j PLUS 1 PLUS 1  
                        END IF  
                        IF dp AT i AT j GREATER THAN 1 THEN  
                            INCREMENT count BY dp AT i AT j MINUS 1  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        RETURN count_pyramids_from_top(grid) PLUS count_pyramids_from_bottom(grid)  
    END FUNCTION  
END CLASS