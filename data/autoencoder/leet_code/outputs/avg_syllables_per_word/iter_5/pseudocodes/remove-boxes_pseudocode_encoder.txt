CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r  
                RETURN 0  
            IF (l, r, k) IS IN memo  
                RETURN memo WITH KEY (l, r, k)  
            
            WHILE r GREATER THAN l AND boxes AT r EQUALS boxes AT r MINUS 1  
                DECREMENT r BY 1  
                INCREMENT k BY 1  
            
            SET res TO dp(l, r MINUS 1, 0, memo) PLUS (k PLUS 1) MULTIPLIED BY (k PLUS 1)  
            
            FOR i FROM l TO r MINUS 1  
                IF boxes AT i EQUALS boxes AT r  
                    SET res TO MAXIMUM OF res AND dp(l, i, k PLUS 1, memo) PLUS dp(i PLUS 1, r MINUS 1, 0, memo)  
            
            SET memo WITH KEY (l, r, k) TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN dp(0, LENGTH OF boxes MINUS 1, 0, EMPTY DICTIONARY)  
    END FUNCTION  
END CLASS