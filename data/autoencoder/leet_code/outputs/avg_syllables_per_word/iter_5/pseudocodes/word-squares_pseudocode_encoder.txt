CLASS Solution  
    FUNCTION wordSquares(words)  
        INITIALIZE prefix_to_words AS a mapping from prefix TO list of words  
        FOR each word IN words  
            FOR each index FROM 0 TO length of word MINUS 1  
                SET prefix TO substring of word FROM start TO index  
                APPEND word TO prefix_to_words AT prefix  
          
        INITIALIZE results AS empty list  
          
        FUNCTION backtrack(square)  
            IF length of square EQUALS length of words at first element THEN  
                APPEND square TO results  
                RETURN  
            SET prefix TO concatenation of characters AT position length of square FROM each word IN square  
            FOR each candidate IN prefix_to_words AT prefix  
                CALL backtrack WITH square APPENDED WITH candidate  
        END FUNCTION  
          
        FOR each word IN words  
            CALL backtrack WITH list containing word  
          
        RETURN results  
    END FUNCTION  
END CLASS