CLASS Solution  
    FUNCTION numSubarrayBoundedMax(nums, left, right)  
        FUNCTION count(max_value)  
            SET count TO 0  
            SET current_length TO 0  
            FOR each num IN nums  
                IF num LESS THAN OR EQUAL TO max_value  
                    INCREMENT current_length BY 1  
                    INCREMENT count BY current_length  
                ELSE  
                    SET current_length TO 0  
            RETURN count  
        END FUNCTION  
        RETURN count(right) MINUS count(left MINUS 1)  
    END FUNCTION  
END CLASS