CLASS Solution  
    FUNCTION constrainedSubsetSum(nums, k)  
        SET n TO LENGTH OF nums  
        SET dp TO LIST OF SIZE n FILLED WITH 0  
        SET dp AT 0 TO nums AT 0  
        SET max_sum TO nums AT 0  

        SET q TO DEQUE CONTAINING 0  

        FOR i FROM 1 TO n MINUS 1  
            IF dp AT q AT 0 IS GREATER THAN 0  
                SET dp AT i TO nums AT i PLUS dp AT q AT 0  
            ELSE  
                SET dp AT i TO nums AT i  
            END IF  

            IF dp AT i IS GREATER THAN max_sum  
                SET max_sum TO dp AT i  
            END IF  

            WHILE q IS NOT EMPTY AND dp AT i IS GREATER THAN OR EQUAL TO dp AT q AT LAST ELEMENT  
                REMOVE LAST ELEMENT FROM q  
            END WHILE  

            APPEND i TO q  

            IF q AT 0 IS EQUAL TO i MINUS k  
                REMOVE FIRST ELEMENT FROM q  
            END IF  
        END FOR  

        RETURN max_sum  
    END FUNCTION  
END CLASS