CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        CREATE indices AS mapping FROM integer TO list  
        SET prefix_sum TO list OF size LENGTH OF flowers PLUS 1 FILLED WITH 0  
        
        FOR i FROM 0 TO LENGTH OF flowers MINUS 1  
            SET prefix_sum AT i PLUS 1 TO prefix_sum AT i PLUS MAXIMUM BETWEEN flowers AT i AND 0  
            APPEND i TO indices AT flowers AT i  
        
        SET max_beauty TO negative infinity  
        
        FOR each beauty IN keys OF indices  
            IF LENGTH OF indices AT beauty GREATER THAN OR EQUAL TO 2 THEN  
                SET first TO first element IN indices AT beauty  
                SET last TO last element IN indices AT beauty  
                
                SET current_beauty TO 2 TIMES beauty PLUS (prefix_sum AT last MINUS prefix_sum AT first PLUS 1)  
                SET max_beauty TO MAXIMUM BETWEEN max_beauty AND current_beauty  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS