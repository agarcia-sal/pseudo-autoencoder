CLASS Solution
    FUNCTION countPalindromicSubsequences(s)
        SET MOD TO 10 TO THE POWER OF 9 PLUS 7
        SET n TO LENGTH OF s

        SET next_occurrence TO 2D LIST OF SIZE 4 BY n FILLED WITH -1
        SET prev_occurrence TO 2D LIST OF SIZE 4 BY n FILLED WITH -1

        FOR c FROM 0 TO 3
            SET char TO CHARACTER 'a' PLUS c
            SET last TO -1
            FOR i FROM 0 TO n - 1
                IF s[i] EQUALS char THEN
                    SET last TO i
                SET prev_occurrence[c][i] TO last
            END FOR

            SET last TO -1
            FOR i FROM n - 1 DOWNTO 0
                IF s[i] EQUALS char THEN
                    SET last TO i
                SET next_occurrence[c][i] TO last
            END FOR
        END FOR

        SET dp TO 2D LIST OF SIZE n BY n FILLED WITH 0

        FOR i FROM 0 TO n - 1
            SET dp[i][i] TO 1
        END FOR

        FOR length FROM 2 TO n
            FOR i FROM 0 TO n - length
                SET j TO i PLUS length MINUS 1
                FOR c FROM 0 TO 3
                    SET char TO CHARACTER 'a' PLUS c
                    SET left TO next_occurrence[c][i]
                    SET right TO prev_occurrence[c][j]

                    IF left GREATER THAN j OR right LESS THAN i THEN
                        CONTINUE TO NEXT c
                    ELSE IF left EQUALS right THEN
                        SET dp[i][j] TO (dp[i][j] PLUS 1) MODULO MOD
                    ELSE
                        SET dp[i][j] TO (dp[i][j] PLUS dp[left PLUS 1][right MINUS 1] PLUS 2) MODULO MOD
                    END IF
                END FOR
            END FOR
        END FOR

        RETURN dp[0][n MINUS 1]
    END FUNCTION
END CLASS