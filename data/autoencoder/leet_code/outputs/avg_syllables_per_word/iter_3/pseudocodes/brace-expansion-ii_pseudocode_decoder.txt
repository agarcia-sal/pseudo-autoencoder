CLASS Solution
    FUNCTION braceExpansionII(expression)
        FUNCTION parse_expression(index)
            SET current_set TO empty set
            SET current_product TO list containing empty string
            
            WHILE index less than LENGTH OF expression
                SET char TO expression at position index
                
                IF char equals '{'
                    SET inner_set, index TO parse_expression(index + 1)
                    SET current_product TO list of concatenations of each a in current_product with each b in inner_set
                
                ELSE IF char equals '}'
                    ADD all concatenations of strings in current_product to current_set
                    RETURN current_set, index
                
                ELSE IF char equals ','
                    ADD all concatenations of strings in current_product to current_set
                    SET current_product TO list containing empty string
                
                ELSE  # char is a lowercase letter
                    SET current_product TO list of concatenations of each a in current_product with char
                
                INCREMENT index BY 1
            
            ADD all concatenations of strings in current_product to current_set
            RETURN current_set, index
        END FUNCTION
        
        SET result_set, _ TO parse_expression(0)
        RETURN sorted list of result_set
    END FUNCTION
END CLASS