CLASS Solution
    FUNCTION maximumBeauty(flowers: List OF Integer) RETURNS Integer
        SET indices TO a new dictionary with default value as empty list
        SET prefix_sum TO a list of zeros with length LENGTH OF flowers PLUS 1
        
        FOR i FROM 0 TO LENGTH OF flowers MINUS 1
            SET prefix_sum[i PLUS 1] TO prefix_sum[i] PLUS MAXIMUM OF flowers[i] AND 0
            APPEND i TO indices[flowers[i]]
        
        SET max_beauty TO negative infinity
        
        FOR each beauty IN indices KEYS
            IF LENGTH OF indices[beauty] IS GREATER THAN OR EQUAL TO 2
                SET first TO indices[beauty][0]
                SET last TO indices[beauty][-1]
                
                SET current_beauty TO 2 TIMES beauty PLUS (prefix_sum[last] MINUS prefix_sum[first PLUS 1])
                SET max_beauty TO MAXIMUM OF max_beauty AND current_beauty
        
        RETURN max_beauty
    END FUNCTION
END CLASS