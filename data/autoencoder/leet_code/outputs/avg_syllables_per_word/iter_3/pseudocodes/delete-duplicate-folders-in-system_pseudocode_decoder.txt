CLASS TrieNode
    FUNCTION __init__()
        SET children TO a default dictionary of TrieNode
        SET deleted TO False
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION deleteDuplicateFolder(paths)
        SET ans TO empty list
        SET root TO new TrieNode
        SET subtreeToNodes TO default dictionary of list

        FOR each path IN paths sorted lexicographically
            SET node TO root
            FOR each s IN path
                SET node TO node.children[s]

        FUNCTION buildSubtreeToRoots(node)
            SET subtree TO '('
            FOR each s IN node.children keys sorted lexicographically
                SET subtree TO subtree CONCATENATED WITH s CONCATENATED WITH buildSubtreeToRoots(node.children[s])
            SET subtree TO subtree CONCATENATED WITH ')'
            IF subtree IS NOT '()'
                APPEND node TO subtreeToNodes[subtree]
            RETURN subtree
        END FUNCTION

        CALL buildSubtreeToRoots(root)

        FOR each nodes IN subtreeToNodes values
            IF LENGTH OF nodes IS GREATER THAN 1
                FOR each node IN nodes
                    SET node.deleted TO True

        FUNCTION constructPath(node, path)
            FOR each (s, child) IN node.children items
                IF child.deleted IS False
                    CALL constructPath(child, path APPENDED WITH s)
            IF path IS NOT empty
                APPEND path TO ans
        END FUNCTION

        CALL constructPath(root, empty list)
        RETURN ans
    END FUNCTION
END CLASS