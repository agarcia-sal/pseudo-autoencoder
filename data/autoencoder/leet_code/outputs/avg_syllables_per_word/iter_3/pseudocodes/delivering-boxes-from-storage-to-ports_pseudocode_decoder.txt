CLASS Solution
    FUNCTION boxDelivering(boxes, portsCount, maxBoxes, maxWeight)
        SET n TO LENGTH OF boxes
        SET dp TO LIST OF SIZE n+1 WITH ALL VALUES AS infinity
        SET dp[0] TO 0
        
        SET left TO 0
        SET current_weight TO 0
        SET extra_trips TO 0
        
        FOR right FROM 0 TO n-1
            INCREMENT current_weight BY boxes[right][1]
            IF right > 0 AND boxes[right][0] IS NOT EQUAL TO boxes[right - 1][0]
                INCREMENT extra_trips BY 1
            END IF
            
            WHILE left <= right AND ((right - left + 1) > maxBoxes OR current_weight > maxWeight)
                DECREMENT current_weight BY boxes[left][1]
                IF left > 0 AND boxes[left][0] IS NOT EQUAL TO boxes[left - 1][0]
                    DECREMENT extra_trips BY 1
                END IF
                INCREMENT left BY 1
            END WHILE
            
            SET dp[right + 1] TO dp[left] + 2 + extra_trips
        END FOR
        
        RETURN dp[n]
    END FUNCTION
END CLASS