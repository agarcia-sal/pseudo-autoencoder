CLASS Solution
    FUNCTION shortestPath(grid, k)
        IF grid IS EMPTY OR grid[0] IS EMPTY
            RETURN -1
        SET m TO LENGTH OF grid
        SET n TO LENGTH OF grid[0]
        IF k >= m + n - 2
            RETURN m + n - 2
        SET directions TO [(0, 1), (1, 0), (0, -1), (-1, 0)]
        SET queue TO DEQUE CONTAINING (0, 0, k, 0)
        SET visited TO SET CONTAINING (0, 0, k)
        WHILE queue IS NOT EMPTY
            SET x, y, remaining_k, steps TO REMOVE FIRST ELEMENT FROM queue
            IF x EQUALS m - 1 AND y EQUALS n - 1
                RETURN steps
            FOR EACH (dx, dy) IN directions
                SET nx TO x + dx
                SET ny TO y + dy
                IF nx >= 0 AND nx < m AND ny >= 0 AND ny < n
                    SET new_k TO remaining_k - grid[nx][ny]
                    IF new_k >= 0 AND (nx, ny, new_k) NOT IN visited
                        ADD (nx, ny, new_k) TO visited
                        ADD (nx, ny, new_k, steps + 1) TO queue
        RETURN -1
END CLASS