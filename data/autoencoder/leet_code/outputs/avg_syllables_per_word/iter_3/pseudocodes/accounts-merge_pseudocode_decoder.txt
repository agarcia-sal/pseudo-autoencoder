CLASS UnionFind
    FUNCTION __init__(self, size)
        SET self.root TO list of integers from 0 to size minus 1
        SET self.rank TO list of size elements, each initialized to 1
    END FUNCTION

    FUNCTION find(self, x)
        IF self.root[x] EQUALS x THEN
            RETURN x
        SET self.root[x] TO self.find(self.root[x])
        RETURN self.root[x]
    END FUNCTION

    FUNCTION union(self, x, y)
        SET rootX TO self.find(x)
        SET rootY TO self.find(y)
        IF rootX NOT EQUALS rootY THEN
            IF self.rank[rootX] GREATER THAN self.rank[rootY] THEN
                SET self.root[rootY] TO rootX
            ELSE IF self.rank[rootX] LESS THAN self.rank[rootY] THEN
                SET self.root[rootX] TO rootY
            ELSE
                SET self.root[rootY] TO rootX
                INCREMENT self.rank[rootX] BY 1
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION accountsMerge(self, accounts)
        SET email_to_id TO empty map
        SET uf TO new UnionFind with size LENGTH OF accounts

        FOR i, (_, followed by emails) IN enumeration of accounts
            FOR each email IN emails
                IF email NOT IN email_to_id THEN
                    SET email_to_id[email] TO i
                ELSE
                    CALL uf.union(i, email_to_id[email])

        SET merged_emails TO map with default empty list
        FOR each email, account_id IN email_to_id
            SET root_id TO uf.find(account_id)
            APPEND email TO merged_emails[root_id]

        SET result TO empty list
        FOR each account_id, emails IN merged_emails
            SET name TO accounts[account_id][0]
            APPEND list consisting of name followed by sorted emails TO result

        RETURN result
    END FUNCTION
END CLASS