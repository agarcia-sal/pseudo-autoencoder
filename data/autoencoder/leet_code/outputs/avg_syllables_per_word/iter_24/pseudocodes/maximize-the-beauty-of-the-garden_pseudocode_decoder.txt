CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        SET indices TO a new default dictionary with list as default value  
        SET prefix_sum TO a list of zero values with the length equal to the length of flowers PLUS one  
        FOR i FROM zero TO the length of flowers MINUS one  
            SET element_at_position i PLUS one of prefix_sum TO element_at_position i of prefix_sum PLUS the maximum value BETWEEN element_at_position i of flowers AND zero  
            APPEND i TO the list at key element_at_position i of flowers in indices  
        END FOR  
        SET max_beauty TO the smallest possible number  
        FOR each beauty IN the keys of indices  
            IF the length of the list at key beauty in indices IS GREATER THAN OR EQUAL TO two  
                SET first TO the element at position zero of the list at key beauty in indices  
                SET last TO the element at the last position of the list at key beauty in indices  
                SET current_beauty TO two MULTIPLIED BY beauty PLUS the difference BETWEEN element_at_position last of prefix_sum AND element_at_position first PLUS one of prefix_sum  
                IF current_beauty IS GREATER THAN max_beauty  
                    SET max_beauty TO current_beauty  
                END IF  
            END IF  
        END FOR  
        RETURN max_beauty  
    END FUNCTION  
END CLASS