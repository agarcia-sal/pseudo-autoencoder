CLASS UnionFind  
    FUNCTION __init__(self)  
        SET self.parent TO empty dictionary  
        SET self.count TO zero  
    END FUNCTION  

    FUNCTION make_set(self, x)  
        IF x NOT IN self.parent THEN  
            SET element x IN self.parent TO x itself  
            INCREMENT self.count BY one  
        END IF  
    END FUNCTION  

    FUNCTION find(self, x)  
        IF element at position x of self.parent NOT EQUALS x THEN  
            SET element at position x of self.parent TO call find function with argument element at position x of self.parent  
        END IF  
        RETURN element at position x of self.parent  
    END FUNCTION  

    FUNCTION union(self, x, y)  
        SET rootX TO call find function with argument x  
        SET rootY TO call find function with argument y  
        IF rootX NOT EQUALS rootY THEN  
            SET element at position rootX of self.parent TO rootY  
            DECREMENT self.count BY one  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION numIslands2(self, m, n, positions)  
        FUNCTION is_valid(x, y)  
            RETURN x GREATER THAN OR EQUAL TO zero AND x LESS THAN m AND y GREATER THAN OR EQUAL TO zero AND y LESS THAN n  
        END FUNCTION  

        SET directions TO list of pairs each consisting of one and zero MINUS one and zero zero and one zero and MINUS one  
        SET uf TO new instance of UnionFind  
        SET grid TO list consisting of m elements each being a list consisting of n elements each being zero  
        SET result TO empty list  

        FOR each pair r COMMA c IN positions  
            IF element at position r of element at position c of grid EQUALS one THEN  
                APPEND uf.count TO result  
                CONTINUE to next iteration  
            END IF  

            SET element at position r of element at position c of grid TO one  
            CALL make_set function of uf with argument pair r COMMA c  

            FOR each pair dr COMMA dc IN directions  
                SET nr TO r PLUS dr  
                SET nc TO c PLUS dc  
                IF call is_valid function with arguments nr COMMA nc AND element at position nr of element at position nc of grid EQUALS one THEN  
                    CALL union function of uf with arguments pair r COMMA c AND pair nr COMMA nc  
                END IF  
            END FOR  

            APPEND uf.count TO result  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS