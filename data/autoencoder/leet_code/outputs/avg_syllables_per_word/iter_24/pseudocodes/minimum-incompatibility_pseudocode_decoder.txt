CLASS Solution  
    FUNCTION minimumIncompatibility(nums PARAMETER, k PARAMETER)  
        IMPORT the structure that counts occurrences of elements

        SET n TO the LENGTH OF nums
        SET subset_size TO n DIVIDED BY k

        IF there EXISTS a count IN the counts of elements obtained by counting nums SUCH THAT the count IS GREATER THAN k  
            RETURN negative one  
        END IF

        DEFINE an empty map named subset_incompatibility

        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            IF the NUMBER OF ONES in the binary representation of mask EQUALS subset_size  
                SET elements TO an empty list  
                FOR i FROM zero TO n MINUS one  
                    IF the bitwise AND of mask AND two RAISED TO THE POWER OF i IS NOT EQUAL TO zero  
                        APPEND element at position i of nums TO elements  
                    END IF  
                END FOR  
                IF the NUMBER OF UNIQUE elements IN elements EQUALS subset_size  
                    SET incompatibility TO the MAXIMUM element IN elements MINUS the MINIMUM element IN elements  
                    ASSIGN incompatibility TO subset_incompatibility AT key mask  
                END IF  
            END IF  
        END FOR  

        SET dp TO a list with two RAISED TO THE POWER OF n ELEMENTS EACH SET TO positive infinity  
        SET element at position zero of dp TO zero

        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            IF the NUMBER OF ONES in the binary representation of mask MODULO subset_size IS NOT EQUAL TO zero  
                CONTINUE to next iteration  
            END IF  
            FOR each subset_mask IN the keys of subset_incompatibility  
                IF the bitwise AND of mask AND subset_mask EQUALS subset_mask  
                    SET dp at position mask TO the MINIMUM BETWEEN dp at position mask AND dp at position bitwise XOR of mask AND subset_mask PLUS the value at key subset_mask in subset_incompatibility  
                END IF  
            END FOR  
        END FOR

        IF dp at position two RAISED TO THE POWER OF n MINUS one IS EQUAL TO positive infinity  
            RETURN negative one  
        ELSE  
            RETURN dp at position two RAISED TO THE POWER OF n MINUS one  
        END IF  
    END FUNCTION  
END CLASS