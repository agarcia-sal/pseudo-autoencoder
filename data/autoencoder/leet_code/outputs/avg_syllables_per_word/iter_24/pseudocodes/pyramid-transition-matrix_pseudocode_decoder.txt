CLASS Solution  
    FUNCTION pyramidTransition(bottom, allowed)  
        SET allowed_map TO a dictionary that returns a dictionary that returns a list  
        FOR each rule IN allowed  
            SET left TO element at position zero of rule  
            SET right TO element at position one of rule  
            SET top TO element at position two of rule  
            APPEND top TO allowed_map at left at right  
        END FOR  

        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF the LENGTH OF current_bottom EQUALS one  
                RETURN True  
            END IF  
            IF the LENGTH OF current_top EQUALS the LENGTH OF current_bottom MINUS one  
                RETURN can_build_pyramid WITH current_top AS first argument AND an empty list AS second argument  
            END IF  
            SET left TO element at position the LENGTH OF current_top of current_bottom  
            SET right TO element at position the LENGTH OF current_top PLUS one of current_bottom  
            IF allowed_map CONTAINS left AS key AND allowed_map at left CONTAINS right AS key  
                FOR each top IN allowed_map at left at right  
                    IF can_build_pyramid WITH current_bottom AS first argument AND current_top PLUS top AS second argument RETURNS True  
                        RETURN True  
                    END IF  
                END FOR  
            END IF  
            RETURN False  
        END FUNCTION  

        RETURN can_build_pyramid WITH bottom AS first argument AND an empty list AS second argument  
    END FUNCTION  
END CLASS