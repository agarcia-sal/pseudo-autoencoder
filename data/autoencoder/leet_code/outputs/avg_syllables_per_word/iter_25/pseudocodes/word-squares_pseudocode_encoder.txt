CLASS Solution  
    FUNCTION wordSquares(words)  
        SET prefix_to_words TO an empty dictionary that maps each prefix to a list of words  
        FOR each word IN words  
            FOR each index i FROM zero TO the length of word MINUS one  
                SET prefix TO the substring of word from the start up to position i exclusive  
                APPEND word TO the list in prefix_to_words at key prefix  
            END FOR  
        END FOR  
        
        SET results TO an empty list  
        
        FUNCTION backtrack(square)  
            IF the length of square EQUALS the length of the first word in words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO the concatenation of the character at the position equal to the length of square in each word in square  
            FOR each candidate IN the list found in prefix_to_words at key prefix  
                CALL backtrack with the list formed by appending candidate to square  
            END FOR  
        END FUNCTION  
        
        FOR each word IN words  
            CALL backtrack with the list containing only word  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS