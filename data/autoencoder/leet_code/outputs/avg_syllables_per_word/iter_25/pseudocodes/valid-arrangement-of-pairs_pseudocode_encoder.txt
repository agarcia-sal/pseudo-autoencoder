CLASS Solution  
    FUNCTION validArrangement WITH pairs AS parameter  
        SET graph TO an empty default dictionary where each key maps to an empty list  
        SET out_degree TO an empty counter  
        SET in_degree TO an empty counter  
        
        FOR each element u and v in pairs  
            APPEND v TO the list mapped by u in graph  
            INCREMENT out_degree for u BY one  
            INCREMENT in_degree for v BY one  
        END FOR  
        
        SET start_node TO none  
        FOR each node IN graph  
            IF out_degree for node EQUALS in_degree for node PLUS one THEN  
                SET start_node TO node  
                BREAK the loop  
            END IF  
        END FOR  
        IF start_node IS none THEN  
            SET start_node TO the next element of the iterator over graph keys  
        END IF  
        
        SET path TO an empty list  
        SET stack TO a list containing start_node  
        
        WHILE the length of stack IS greater than zero  
            SET u TO the last element in stack  
            IF the list mapped by u in graph IS NOT empty THEN  
                REMOVE the last element v FROM the list mapped by u in graph  
                APPEND v TO stack  
            ELSE  
                REMOVE the last element FROM stack and APPEND it TO path  
            END IF  
        END WHILE  
        
        REVERSE the elements of path  
        
        SET result TO an empty list  
        FOR i FROM zero TO the LENGTH OF path MINUS one MINUS one  
            APPEND a list containing element at position i of path and element at position i PLUS one of path TO result  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS