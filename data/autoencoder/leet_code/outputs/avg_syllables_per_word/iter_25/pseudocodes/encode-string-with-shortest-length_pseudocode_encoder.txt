CLASS Solution  
    FUNCTION encode WITH PARAMETER s  
        FUNCTION get_encoded_length WITH PARAMETERS count AND substring  
            SET length_of_count_string TO the LENGTH OF the STRING REPRESENTATION OF count  
            SET length_of_substring TO the LENGTH OF substring  
            RETURN the SUM OF length_of_count_string PLUS length_of_substring PLUS two  
        END FUNCTION  

        FUNCTION dp WITH PARAMETERS i AND j  
            SET substring TO the ELEMENTS FROM position i TO position j IN s  
            SET n TO j MINUS i PLUS one  
            IF n LESS THAN five THEN  
                RETURN substring  
            END IF  
            SET shortest TO substring  
            FOR each k FROM one TO the INTEGER DIVISION OF n BY two PLUS one  
                IF n MODULO k EQUALS zero THEN  
                    SET repeat_count TO the INTEGER DIVISION OF n BY k  
                    SET repeated_substring TO the ELEMENTS FROM position zero TO position k MINUS one IN substring REPEATED repeat_count TIMES  
                    IF substring EQUALS repeated_substring THEN  
                        SET encoded_candidate TO the CONCATENATION OF the STRING REPRESENTATION OF repeat_count PLUS the WORD REPRESENTATION OF the LEFT SQUARE BRACKET PLUS dp CALLED WITH PARAMETERS i AND i PLUS k MINUS one PLUS the WORD REPRESENTATION OF the RIGHT SQUARE BRACKET  
                        IF the LENGTH OF encoded_candidate LESS THAN the LENGTH OF shortest THEN  
                            SET shortest TO encoded_candidate  
                        END IF  
                    END IF  
                END IF  
            END FOR  
            FOR each k FROM i TO j MINUS one  
                SET left_encoded TO dp CALLED WITH PARAMETERS i AND k  
                SET right_encoded TO dp CALLED WITH PARAMETERS k PLUS one AND j  
                SET combined TO the CONCATENATION OF left_encoded PLUS right_encoded  
                IF the LENGTH OF combined LESS THAN the LENGTH OF shortest THEN  
                    SET shortest TO combined  
                END IF  
            END FOR  
            RETURN shortest  
        END FUNCTION  

        RETURN dp CALLED WITH PARAMETERS zero AND the LENGTH OF s MINUS one  
    END FUNCTION  
END CLASS