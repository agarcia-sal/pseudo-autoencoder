CLASS Solution  
    FUNCTION confusingNumberII(n)  
        SET rotate_map TO a mapping from zero to zero one to one six to nine eight to eight nine to six  
        SET valid_digits TO a list containing zero one six eight nine  

        FUNCTION is_confusing(num)  
            SET original_num TO num  
            SET rotated_num TO zero  
            WHILE num is greater than zero  
                SET digit TO the remainder of num divided by ten  
                SET rotated_num TO rotated_num multiplied by ten plus the value from rotate_map for digit  
                SET num TO the result of integer division of num by ten  
            END WHILE  
            RETURN whether rotated_num is not equal to original_num  
        END FUNCTION  

        FUNCTION count_confusing_numbers(limit current)  
            IF current is greater than limit  
                RETURN zero  
            END IF  
            SET count TO one if current is not equal to zero and is_confusing(current) is true otherwise zero  
            FOR each digit IN valid_digits  
                SET new_number TO current multiplied by ten plus digit  
                IF new_number is equal to zero  
                    CONTINUE  
                END IF  
                INCREMENT count BY the result of count_confusing_numbers(limit new_number)  
            END FOR  
            RETURN count  
        END FUNCTION  

        RETURN the result of count_confusing_numbers(n zero)  
    END FUNCTION  
END CLASS