CLASS Solution  
    FUNCTION smallestMissingValueSubtree WITH PARAMETERS parents AND nums  
        SET n TO the LENGTH OF parents  
        CREATE tree AS a default dictionary of lists  
        FOR i FROM one TO n MINUS one  
            APPEND i TO the element at position parents AT i OF tree  
        END FOR  
        SET node_with_one TO minus one  
        FOR i FROM zero TO n MINUS one  
            IF the element at position i of nums EQUALS one THEN  
                SET node_with_one TO i  
                BREAK  
            END IF  
        END FOR  
        IF node_with_one EQUALS minus one THEN  
            CREATE a list of LENGTH n WITH all elements equal to one  
            RETURN that list  
        END IF  
        CREATE result AS a list of LENGTH n WITH all elements equal to one  
        CREATE visited AS an empty set  
        FUNCTION dfs WITH PARAMETER node  
            ADD node TO visited  
            CREATE genetic_values AS a set CONTAINING the element at position node of nums  
            FOR each child IN the list at position node of tree  
                IF child NOT IN visited THEN  
                    UPDATE genetic_values WITH the result of dfs applied to child  
                END IF  
            END FOR  
            SET smallest_missing TO one  
            WHILE smallest_missing IS IN genetic_values  
                INCREMENT smallest_missing BY one  
            END WHILE  
            SET the element at position node of result TO smallest_missing  
            RETURN genetic_values  
        END FUNCTION  
        CREATE path AS an empty list  
        SET current TO node_with_one  
        WHILE current NOT EQUALS minus one  
            APPEND current TO path  
            SET current TO the element at position current of parents  
        END WHILE  
        CREATE path_set AS a set CONTAINING all elements of path  
        FOR each node IN path IN REVERSED ORDER  
            IF node IS IN visited THEN  
                CONTINUE  
            END IF  
            CALL dfs WITH node  
        END FOR  
        RETURN result  
    END FUNCTION  
END CLASS