CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            RETURN the INTEGER part of the SQUARE ROOT of n MULTIPLIED BY the INTEGER part of the SQUARE ROOT of n EQUALS n  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF the LENGTH of path EQUALS the LENGTH of nums THEN  
                RETURN one  
            END IF  
            
            SET ans TO zero  
            FOR each x IN the KEYS of count  
                IF the VALUE of count at x GREATER THAN zero AND (the LENGTH of path EQUALS zero OR is_square(the LAST ELEMENT of path PLUS x)) THEN  
                    DECREMENT the VALUE of count at x BY one  
                    INCREMENT ans BY the RESULT of backtrack(the path with x APPENDED, count)  
                    INCREMENT the VALUE of count at x BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO the FREQUENCY COUNTER of nums  
        RETURN backtrack(empty list, count)  
    END FUNCTION  
END CLASS