CLASS Solution  
    FUNCTION maxEnvelopes WITH envelopes  
        PERFORM sorting of envelopes by width in ascending order and by height in descending order when widths are equal  
        SET dp TO an empty list  
        FOR each pair of underscore and height IN envelopes  
            SET idx TO position found by performing binary search to find leftmost insertion index of height in dp  
            IF idx EQUALS length of dp THEN  
                APPEND height TO dp  
            ELSE  
                SET the element at position idx of dp TO height  
            END IF  
        END FOR  
        RETURN the length of dp  
    END FUNCTION  
END CLASS