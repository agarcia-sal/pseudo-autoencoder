from collections import defaultdict

class Solution:
    def minMalwareSpread(self, graph, initial):
        total_nodes = len(graph)
        adjacency_list = defaultdict(list)

        for i in range(total_nodes):
            for j in range(i + 1, total_nodes):
                if graph[i][j] == 1:
                    adjacency_list[i].append(j)
                    adjacency_list[j].append(i)

        def dfs(node, visited):
            if node in visited:
                return 0
            visited.add(node)
            size = 1
            for neighbor in adjacency_list[node]:
                size += dfs(neighbor, visited)
            return size

        infected_set = set(initial)

        component_sizes = []
        visited_nodes = set()
        component_index_map = dict()

        for node in range(total_nodes):
            if node not in visited_nodes and node not in infected_set:
                current_size = dfs(node, visited_nodes)
                component_sizes.append(current_size)
                # Index of the newly added component
                index_i = len(component_sizes) - 1
                # Assign component index to neighbors of node
                for neighbor_node in adjacency_list[node]:
                    component_index_map[neighbor_node] = index_i

        infected_count_per_component = defaultdict(int)
        for infected_node in infected_set:
            if infected_node in component_index_map:
                infected_count_per_component[component_index_map[infected_node]] += 1

        max_component_size = 0
        node_to_remove = min(initial)

        for infected_node in infected_set:
            if infected_node in component_index_map:
                component_id = component_index_map[infected_node]
                if infected_count_per_component[component_id] == 1:
                    size = component_sizes[component_id]
                    if size > max_component_size:
                        max_component_size = size
                        node_to_remove = infected_node
                    elif size == max_component_size and infected_node < node_to_remove:
                        node_to_remove = infected_node

        return node_to_remove