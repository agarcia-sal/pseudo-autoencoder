CLASS Solution
    FUNCTION encode(string s)
        FUNCTION get_encoded_length(count, substring)
            RETURN the LENGTH OF the STRING REPRESENTATION OF count PLUS the LENGTH OF substring PLUS the quantity two
        END FUNCTION
        
        FUNCTION dp(index i, index j)
            SET substring TO the ELEMENTS FROM position i TO position j INCLUSIVE OF string s
            SET n TO j MINUS i PLUS one
            IF n LESS THAN five THEN
                RETURN substring
            END IF
            
            SET shortest TO substring
            FOR variable k FROM one TO n DIVIDED BY two INCLUSIVE
                IF n MODULO k EQUALS zero THEN
                    SET repeat_count TO n DIVIDED BY k
                    IF substring EQUALS the FIRST k ELEMENTS OF substring REPEATED repeat_count TIMES THEN
                        SET encoded_candidate TO the CONCATENATION OF the STRING REPRESENTATION OF repeat_count PLUS the LEFT SQUARE BRACKET PLUS dp(i, i PLUS k MINUS one) PLUS the RIGHT SQUARE BRACKET
                        IF the LENGTH OF encoded_candidate LESS THAN the LENGTH OF shortest THEN
                            SET shortest TO encoded_candidate
                        END IF
                    END IF
                END IF
            END FOR
            
            FOR variable k FROM i TO j MINUS one INCLUSIVE
                SET left_encoded TO dp(i, k)
                SET right_encoded TO dp(k PLUS one, j)
                SET combined TO the CONCATENATION OF left_encoded PLUS right_encoded
                IF the LENGTH OF combined LESS THAN the LENGTH OF shortest THEN
                    SET shortest TO combined
                END IF
            END FOR
            
            RETURN shortest
        END FUNCTION
        
        RETURN dp(zero, the LENGTH OF string s MINUS one)
    END FUNCTION
END CLASS