CLASS Solution
    FUNCTION maximumBeauty(flowers, newFlowers, target, full, partial)
        CALL flowers SORT
        SET n TO the LENGTH OF flowers
        SET max_beauty TO zero
        
        SET prefix_sum TO a list of zero REPEATED n PLUS one times
        FOR i FROM zero TO n MINUS one INCLUSIVE
            SET element at position i PLUS one OF prefix_sum TO element at position i OF prefix_sum PLUS element at position i OF flowers
        END FOR
        
        SET complete_gardens TO zero
        FOR i FROM n MINUS one DOWN TO zero INCLUSIVE
            IF element at position i OF flowers GREATER THAN OR EQUAL TO target HOLDS
                INCREMENT complete_gardens BY one
            ELSE
                BREAK
            END IF
        END FOR
        
        SET remaining_flowers TO newFlowers
        SET max_incomplete_flowers TO zero
        
        FOR i FROM complete_gardens TO n INCLUSIVE
            IF i GREATER THAN zero HOLDS
                DECREMENT remaining_flowers BY target MINUS element at position n MINUS i OF flowers
                IF remaining_flowers LESS THAN zero HOLDS
                    BREAK
                END IF
            END IF
            
            SET left TO zero
            SET right TO n MINUS i MINUS one
            
            WHILE left LESS THAN OR EQUAL TO right HOLDS
                SET mid TO left PLUS right DIVIDED BY two USING integer division
                SET cost TO element at position mid OF flowers MULTIPLIED BY mid PLUS one MINUS element at position mid PLUS one OF prefix_sum
                IF cost GREATER THAN remaining_flowers HOLDS
                    DECREMENT right BY one
                ELSE
                    INCREMENT left BY one
                END IF
            END WHILE
            
            IF right GREATER THAN OR EQUAL TO zero HOLDS
                SET max_incomplete_flowers TO element at position right OF flowers PLUS remaining_flowers MINUS element at position right OF flowers MULTIPLIED BY right PLUS one MINUS element at position right PLUS one OF prefix_sum DIVIDED BY right PLUS one USING integer division
            ELSE
                SET max_incomplete_flowers TO zero
            END IF
            
            SET total_beauty TO i MULTIPLIED BY full PLUS the MINIMUM OF max_incomplete_flowers AND target MINUS one MULTIPLIED BY partial
            IF total_beauty GREATER THAN max_beauty HOLDS
                SET max_beauty TO total_beauty
            END IF
        END FOR
        
        RETURN max_beauty
    END FUNCTION
END CLASS