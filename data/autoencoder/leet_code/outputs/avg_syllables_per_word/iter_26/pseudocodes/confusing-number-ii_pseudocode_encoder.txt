CLASS Solution
    FUNCTION confusingNumberII(n)
        SET rotate_map TO a MAPPING of digit zero TO zero AND digit one TO one AND digit six TO nine AND digit eight TO eight AND digit nine TO six
        SET valid_digits TO a LIST OF digit zero AND digit one AND digit six AND digit eight AND digit nine

        FUNCTION is_confusing(num)
            SET original_num TO num
            SET rotated_num TO zero
            WHILE num GREATER THAN zero HOLDS
                SET digit TO the REMAINDER OF num DIVIDED BY ten
                SET rotated_num TO rotated_num MULTIPLIED BY ten PLUS the VALUE MAPPED FROM digit IN rotate_map
                SET num TO the INTEGER PART OF num DIVIDED BY ten
            END WHILE
            RETURN rotated_num NOT EQUALS original_num
        END FUNCTION

        FUNCTION count_confusing_numbers(limit, current)
            IF current GREATER THAN limit THEN
                RETURN zero
            END IF
            SET count TO one IF current NOT EQUALS zero AND is_confusing(current) HOLDS OTHERWISE zero
            FOR each digit IN valid_digits
                SET new_number TO current MULTIPLIED BY ten PLUS digit
                IF new_number EQUALS zero THEN
                    CONTINUE TO next iteration
                END IF
                INCREMENT count BY the RESULT OF count_confusing_numbers WITH PARAMETERS limit AND new_number
            END FOR
            RETURN count
        END FUNCTION

        RETURN count_confusing_numbers WITH PARAMETERS n AND zero
    END FUNCTION
END CLASS