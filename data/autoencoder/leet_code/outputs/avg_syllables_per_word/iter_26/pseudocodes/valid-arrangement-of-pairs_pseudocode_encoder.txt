CLASS Solution
    FUNCTION validArrangement(pairs)
        SET graph TO a mapping from keys to empty lists
        SET out_degree TO a counting map
        SET in_degree TO a counting map

        FOR each element consisting of two items named u and v IN pairs
            APPEND v TO the list at key u IN graph
            INCREMENT the count of u IN out_degree BY one
            INCREMENT the count of v IN in_degree BY one
        END FOR

        SET start_node TO none
        FOR each node IN the keys of graph
            IF the count of node IN out_degree EQUALS the count of node IN in_degree PLUS one
                SET start_node TO node
                STOP the loop
            END IF
        END FOR
        IF start_node IS none
            SET start_node TO the first element obtained from the iteration over the keys of graph
        END IF

        SET path TO an empty list
        SET stack TO a list containing start_node

        WHILE stack IS NOT empty
            SET u TO the last element OF stack
            IF the list at key u IN graph IS NOT empty
                SET v TO the last element removed FROM the list at key u IN graph
                APPEND v TO stack
            ELSE
                REMOVE the last element FROM stack AND APPEND it TO path
            END IF
        END WHILE

        REVERSE the order of elements IN path

        SET result TO an empty list
        FOR index FROM zero TO the length of path MINUS one EXCLUSIVE
            APPEND a list consisting of the element at position index OF path AND the element at position index PLUS one OF path TO result
        END FOR

        RETURN result
    END FUNCTION
END CLASS