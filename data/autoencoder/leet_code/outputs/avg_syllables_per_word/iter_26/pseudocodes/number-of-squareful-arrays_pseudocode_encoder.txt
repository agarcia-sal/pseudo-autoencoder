CLASS Solution
    FUNCTION numSquarefulPerms(list_of_numbers)
        FUNCTION is_square(number)
            SET square_root TO the INTEGER PART OF the SQUARE ROOT OF number
            IF square_root MULTIPLIED BY square_root EQUALS number THEN
                RETURN true
            ELSE
                RETURN false
            END IF
        END FUNCTION

        FUNCTION backtrack(current_path, frequency_count)
            IF the LENGTH OF current_path EQUALS the LENGTH OF list_of_numbers THEN
                RETURN one
            END IF

            SET answer TO zero
            FOR each element IN frequency_count
                IF the VALUE ASSOCIATED TO element IN frequency_count IS GREATER THAN zero AND 
                   (the LENGTH OF current_path EQUALS zero OR is_square(the LAST ELEMENT OF current_path PLUS element)) THEN
                    DECREMENT the VALUE ASSOCIATED TO element IN frequency_count BY one
                    INCREMENT answer BY backtrack(current_path APPENDED WITH element, frequency_count)
                    INCREMENT the VALUE ASSOCIATED TO element IN frequency_count BY one
                END IF
            END FOR
            RETURN answer
        END FUNCTION

        ASSIGN frequency_count TO the COUNTER OF list_of_numbers
        RETURN backtrack(an EMPTY LIST, frequency_count)
    END FUNCTION
END CLASS