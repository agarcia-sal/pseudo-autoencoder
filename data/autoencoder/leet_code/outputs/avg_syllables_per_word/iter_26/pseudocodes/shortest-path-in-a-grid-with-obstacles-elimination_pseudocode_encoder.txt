CLASS Solution
    FUNCTION shortestPath(grid AS list of list of integer, k AS integer) RETURNS integer
        IF grid IS empty OR element at position zero OF grid IS empty
            RETURN negative one
        END IF

        SET m TO the LENGTH OF grid
        SET n TO the LENGTH OF element at position zero OF grid

        IF k IS GREATER THAN OR EQUAL TO m PLUS n MINUS two
            RETURN m PLUS n MINUS two
        END IF

        SET directions TO list OF tuples representing zero and one, one and zero, zero and negative one, negative one and zero

        SET queue TO a new deque initialized with a tuple of zero, zero, k, zero

        SET visited TO a new set initialized with a tuple of zero, zero, k

        WHILE queue IS NOT empty
            SET x, y, remaining_k, steps TO the result of removing the leftmost element FROM queue

            IF x EQUALS m MINUS one AND y EQUALS n MINUS one
                RETURN steps
            END IF

            FOR each dx, dy IN directions
                SET nx TO x PLUS dx
                SET ny TO y PLUS dy

                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n
                    SET new_k TO remaining_k MINUS element at position nx OF grid AT position ny
                    IF new_k IS GREATER THAN OR EQUAL TO zero AND the tuple of nx, ny, new_k IS NOT IN visited
                        ADD the tuple of nx, ny, new_k TO visited
                        APPEND the tuple of nx, ny, new_k, steps PLUS one TO queue
                    END IF
                END IF
            END FOR
        END WHILE

        RETURN negative one
    END FUNCTION
END CLASS