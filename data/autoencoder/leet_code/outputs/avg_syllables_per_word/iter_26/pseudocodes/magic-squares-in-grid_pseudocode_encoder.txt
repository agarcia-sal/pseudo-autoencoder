CLASS Solution
    FUNCTION numMagicSquaresInside(grid)
        FUNCTION is_magic(i, j)
            IF element at position i OF grid AT position j NOT EQUALS five THEN
                RETURN False
            END IF

            SET numbers TO empty set
            FOR x FROM i MINUS one TO i PLUS one INCLUSIVE
                FOR y FROM j MINUS one TO j PLUS one INCLUSIVE
                    IF element at position x OF grid AT position y LESS THAN one OR element at position x OF grid AT position y GREATER THAN nine OR element at position x OF grid AT position y IN numbers THEN
                        RETURN False
                    END IF
                    ADD element at position x OF grid AT position y TO numbers
                END FOR
            END FOR

            FOR start FROM i MINUS one TO i PLUS one INCLUSIVE
                IF sum of element at position start OF grid AT position j MINUS one PLUS element at position start OF grid AT position j PLUS element at position start OF grid AT position j PLUS one NOT EQUALS fifteen OR sum of element at position i MINUS one OF grid AT position start PLUS element at position i OF grid AT position start PLUS element at position i PLUS one OF grid AT position start NOT EQUALS fifteen THEN
                    RETURN False
                END IF
            END FOR

            IF sum of element at position i MINUS one OF grid AT position j MINUS one PLUS element at position i OF grid AT position j PLUS element at position i PLUS one OF grid AT position j PLUS one NOT EQUALS fifteen OR sum of element at position i MINUS one OF grid AT position j PLUS one PLUS element at position i OF grid AT position j PLUS element at position i PLUS one OF grid AT position j MINUS one NOT EQUALS fifteen THEN
                RETURN False
            END IF

            RETURN True
        END FUNCTION

        SET count TO zero
        SET rows TO the LENGTH OF grid
        SET cols TO the LENGTH OF element at position zero OF grid

        FOR i FROM one TO rows MINUS one EXCLUSIVE
            FOR j FROM one TO cols MINUS one EXCLUSIVE
                IF is_magic(i, j) THEN
                    INCREMENT count BY one
                END IF
            END FOR
        END FOR

        RETURN count
    END FUNCTION
END CLASS