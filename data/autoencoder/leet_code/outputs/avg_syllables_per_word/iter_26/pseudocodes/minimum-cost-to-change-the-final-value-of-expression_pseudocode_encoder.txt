CLASS Solution
    FUNCTION minOperationsToFlip(expression)
        SET stack TO empty list
        FOR each element e IN expression
            IF element e EQUALS an opening parenthesis OR element e EQUALS ampersand OR element e EQUALS vertical bar
                APPEND tuple of element e AND zero TO stack
                CONTINUE to next iteration
            ELSE IF element e EQUALS closing parenthesis
                SET lastPair TO the result of removing the last element FROM stack
                REMOVE the last element FROM stack
            ELSE
                SET lastPair TO tuple of element e AND one
            END IF
            IF stack is NOT empty AND the first component of the last element in stack EQUALS ampersand OR vertical bar
                SET op TO the first component of the result of removing the last element FROM stack
                SET a and costA TO the result of removing the last element FROM stack
                SET b and costB TO lastPair
                IF op EQUALS ampersand
                    IF a EQUALS zero AND b EQUALS zero
                        SET lastPair TO tuple of zero AND one PLUS the smaller of costA AND costB
                    ELSE IF a EQUALS zero AND b EQUALS one
                        SET lastPair TO tuple of zero AND one
                    ELSE IF a EQUALS one AND b EQUALS zero
                        SET lastPair TO tuple of zero AND one
                    ELSE
                        SET lastPair TO tuple of one AND the smaller of costA AND costB
                    END IF
                ELSE
                    IF a EQUALS zero AND b EQUALS zero
                        SET lastPair TO tuple of zero AND the smaller of costA AND costB
                    ELSE IF a EQUALS zero AND b EQUALS one
                        SET lastPair TO tuple of one AND one
                    ELSE IF a EQUALS one AND b EQUALS zero
                        SET lastPair TO tuple of one AND one
                    ELSE
                        SET lastPair TO tuple of one AND one PLUS the smaller of costA AND costB
                    END IF
                END IF
            END IF
            APPEND lastPair TO stack
        END FOR
        RETURN the second component of the last element in stack
    END FUNCTION
END CLASS