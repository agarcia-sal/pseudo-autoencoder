CLASS Solution
    FUNCTION wordSquares(words)
        IMPORT the collection type DEFAULTDICT from the collection module

        SET prefix_to_words TO a new DEFAULTDICT mapping TO empty list

        FOR each word IN words
            FOR index FROM zero TO the LENGTH OF word MINUS one INCLUSIVE
                SET prefix TO the substring FROM position zero TO position index EXCLUSIVE OF word
                APPEND word TO the list AT prefix IN prefix_to_words
            END FOR
        END FOR

        SET results TO an empty list

        FUNCTION backtrack(square)
            IF the LENGTH OF square EQUALS the LENGTH OF the first element OF words THEN
                APPEND square TO results
                RETURN
            END IF

            SET prefix TO the concatenation OF for each word_element IN square the character AT position LENGTH OF square OF word_element

            FOR each candidate IN the list AT prefix IN prefix_to_words
                CALL backtrack WITH square APPENDED WITH candidate AS argument
            END FOR
        END FUNCTION

        FOR each word IN words
            CALL backtrack WITH a list containing word AS argument
        END FOR

        RETURN results
    END FUNCTION
END CLASS