CLASS Solution
    FUNCTION removeBoxes(boxes)
        FUNCTION dp(left_index, right_index, carry_count, memoization_map)
            IF left_index GREATER THAN right_index
                RETURN zero
            END IF
            
            IF the TRIPLE consisting of left_index, right_index, AND carry_count IS A KEY IN memoization_map
                RETURN the VALUE ASSOCIATED WITH the TRIPLE consisting of left_index, right_index, AND carry_count IN memoization_map
            END IF
            
            WHILE right_index GREATER THAN left_index AND the ELEMENT at position right_index OF boxes EQUALS the ELEMENT at position right_index MINUS one OF boxes
                DECREMENT right_index BY one
                INCREMENT carry_count BY one
            END WHILE
            
            SET result TO the VALUE RETURNED BY dp WITH ARGUMENTS left_index, right_index MINUS one, zero, AND memoization_map PLUS the RESULT OF MULTIPLYING THE SUM OF carry_count PLUS one BY ITSELF
            
            FOR each index FROM left_index TO right_index MINUS one INCLUSIVE
                IF the ELEMENT at position index OF boxes EQUALS the ELEMENT at position right_index OF boxes
                    SET candidate TO the SUM OF the VALUE RETURNED BY dp WITH ARGUMENTS left_index, index, carry_count PLUS one, AND memoization_map AND the VALUE RETURNED BY dp WITH ARGUMENTS index PLUS one, right_index MINUS one, zero, AND memoization_map
                    SET result TO the GREATER OF result AND candidate
                END IF
            END FOR
            
            SET the VALUE ASSOCIATED WITH the TRIPLE consisting of left_index, right_index, AND carry_count IN memoization_map TO result
            RETURN result
        END FUNCTION
        
        RETURN the VALUE RETURNED BY dp WITH ARGUMENTS zero, the LENGTH OF boxes MINUS one, zero, AND an EMPTY MAP
    END FUNCTION
END CLASS