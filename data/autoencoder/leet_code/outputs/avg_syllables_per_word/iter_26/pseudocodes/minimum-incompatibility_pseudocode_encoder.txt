CLASS Solution

    FUNCTION minimumIncompatibility(nums, k)
        IMPORT Counter FROM collections
        
        SET n TO the LENGTH OF nums
        SET subset_size TO n DIVIDED BY k
        
        IF THERE EXISTS a count IN the VALUES OF Counter APPLIED TO nums SUCH THAT count GREATER THAN k
            RETURN negative one
        END IF
        
        SET subset_incompatibility TO an EMPTY DICTIONARY
        
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one INCLUSIVE
            IF the COUNT OF ONES IN the BINARY REPRESENTATION OF mask EQUALS subset_size
                SET elements TO an EMPTY LIST
                FOR i FROM zero TO n MINUS one INCLUSIVE
                    IF the BITWISE AND OF mask AND two RAISED TO THE POWER OF i NOT EQUAL TO zero
                        APPEND the ELEMENT AT POSITION i OF nums TO elements
                    END IF
                END FOR
                IF the LENGTH OF the SET OF elements EQUALS subset_size
                    SET incompatibility TO the MAXIMUM VALUE OF elements MINUS the MINIMUM VALUE OF elements
                    ASSIGN incompatibility TO subset_incompatibility WITH KEY mask
                END IF
            END IF
        END FOR
        
        SET dp TO a LIST OF LENGTH two RAISED TO THE POWER OF n WITH EACH ELEMENT SET TO positive infinity
        SET the ELEMENT AT POSITION zero OF dp TO zero
        
        FOR mask FROM zero TO two RAISED TO THE POWER OF n MINUS one INCLUSIVE
            IF the COUNT OF ONES IN the BINARY REPRESENTATION OF mask MODULO subset_size NOT EQUALS zero
                CONTINUE TO the NEXT ITERATION
            END IF
            
            FOR each subset_mask IN the KEYS OF subset_incompatibility
                IF the BITWISE AND OF mask AND subset_mask EQUALS subset_mask
                    SET dp AT POSITION mask TO the MINIMUM OF dp AT POSITION mask AND the SUM OF dp AT POSITION the BITWISE XOR OF mask AND subset_mask AND subset_incompatibility AT POSITION subset_mask
                END IF
            END FOR
        END FOR
        
        IF dp AT POSITION the TWO RAISED TO THE POWER OF n MINUS one NOT EQUALS positive infinity
            RETURN dp AT POSITION the TWO RAISED TO THE POWER OF n MINUS one
        ELSE
            RETURN negative one
        END IF
    END FUNCTION

END CLASS