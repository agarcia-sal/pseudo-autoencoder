CLASS Solution
    FUNCTION maximumBeauty(flowers)
        FROM collections IMPORT defaultdict

        SET indices TO a new defaultdict that returns an empty list by default

        SET prefix_sum TO a list of zeros with the length of the LENGTH OF flowers PLUS one

        FOR index FROM zero TO the LENGTH OF flowers MINUS one INCLUSIVE
            SET element_value TO element at position index OF flowers
            SET element_at position index PLUS one OF prefix_sum TO element at position index OF prefix_sum PLUS the GREATER OF element_value AND zero
            APPEND index TO the list at key element_value IN indices
        END FOR

        SET max_beauty TO negative infinity

        FOR each beauty_value IN the keys of indices
            IF the LENGTH OF the list at key beauty_value IN indices IS GREATER THAN OR EQUAL TO two
                SET first TO element at position zero OF the list at key beauty_value IN indices
                SET last TO element at the last position OF the list at key beauty_value IN indices

                SET current_beauty TO two MULTIPLIED BY beauty_value PLUS element at position last OF prefix_sum MINUS element at position first PLUS one OF prefix_sum

                IF current_beauty IS GREATER THAN max_beauty
                    SET max_beauty TO current_beauty
                END IF
            END IF
        END FOR

        RETURN max_beauty
    END FUNCTION
END CLASS