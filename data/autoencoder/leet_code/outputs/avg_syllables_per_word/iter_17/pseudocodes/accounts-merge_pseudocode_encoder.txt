CLASS UnionFind
    FUNCTION __init__(size)
        SET self.root TO A LIST OF each integer FROM zero TO size MINUS one
        SET self.rank TO A LIST WITH size TIMES one
    END FUNCTION

    FUNCTION find(x)
        IF element at position x of self.root EQUALS x
            RETURN x
        END IF
        SET element at position x of self.root TO CALL find WITH element at position x of self.root
        RETURN element at position x of self.root
    END FUNCTION

    FUNCTION union(x, y)
        SET rootX TO CALL find WITH x
        SET rootY TO CALL find WITH y
        IF rootX IS NOT EQUAL TO rootY
            IF element at position rootX of self.rank GREATER THAN element at position rootY of self.rank
                SET element at position rootY of self.root TO rootX
            ELSE IF element at position rootX of self.rank LESS THAN element at position rootY of self.rank
                SET element at position rootX of self.root TO rootY
            ELSE
                SET element at position rootY of self.root TO rootX
                INCREMENT element at position rootX of self.rank BY one
            END IF
        END IF
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION accountsMerge(accounts)
        SET email_to_id TO an empty dictionary
        SET uf TO A NEW UnionFind WITH the LENGTH OF accounts

        FOR each index i AND tuple consisting of one element ignored AND list of emails IN enumeration of accounts
            FOR each email IN emails
                IF email IS NOT IN email_to_id
                    SET element at position email of email_to_id TO i
                ELSE
                    CALL union OF uf WITH parameters i AND element at position email of email_to_id
                END IF
            END FOR
        END FOR

        SET merged_emails TO A NEW defaultdict WITH list as default

        FOR each email AND account_id IN email_to_id items
            SET root_id TO CALL find OF uf WITH account_id
            APPEND email TO element at position root_id of merged_emails
        END FOR

        SET result TO an empty list

        FOR each account_id AND emails IN merged_emails items
            SET name TO element at position zero of element at position account_id of accounts
            SET sorted_emails TO CALL auxiliary FUNCTION accountsMerge TO sort emails
            APPEND A LIST CONSISTING OF name FOLLOWED BY sorted_emails TO result
        END FOR

        RETURN result
    END FUNCTION
END CLASS