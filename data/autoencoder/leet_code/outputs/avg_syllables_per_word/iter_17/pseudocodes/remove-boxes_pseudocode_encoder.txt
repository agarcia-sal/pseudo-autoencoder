CLASS Solution
    FUNCTION removeBoxes(list_of_boxes)
        FUNCTION dp(left_index, right_index, count_k, memo_dictionary)
            IF left_index GREATER THAN right_index
                RETURN zero
            END IF

            IF tuple CONSISTING OF left_index right_index count_k IS IN memo_dictionary
                RETURN element at key tuple CONSISTING OF left_index right_index count_k OF memo_dictionary
            END IF

            WHILE right_index GREATER THAN left_index AND element at position right_index of list_of_boxes EQUALS element at position right_index MINUS one of list_of_boxes
                DECREMENT right_index BY one
                INCREMENT count_k BY one
            END WHILE

            SET result_value TO CALL dp WITH parameters left_index right_index MINUS one zero memo_dictionary PLUS (count_k PLUS one) MULTIPLIED BY (count_k PLUS one)

            FOR each index i FROM left_index TO right_index MINUS one
                IF element at position i of list_of_boxes EQUALS element at position right_index of list_of_boxes
                    SET result_value TO MAXIMUM OF result_value AND CALL dp WITH parameters left_index i count_k PLUS one memo_dictionary PLUS CALL dp WITH parameters i PLUS one right_index MINUS one zero memo_dictionary
                END IF
            END FOR

            SET element at key tuple CONSISTING OF left_index right_index count_k OF memo_dictionary TO result_value
            RETURN result_value
        END FUNCTION

        RETURN CALL dp WITH parameters zero the LENGTH OF list_of_boxes MINUS one zero an empty dictionary
    END FUNCTION
END CLASS