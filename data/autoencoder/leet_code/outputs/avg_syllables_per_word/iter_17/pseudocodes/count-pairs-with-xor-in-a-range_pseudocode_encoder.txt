CLASS TrieNode
    FUNCTION __init__
        SET children TO an empty dictionary
        SET count TO zero
    END FUNCTION
END CLASS

CLASS Trie
    FUNCTION __init__(bit_length)
        SET root TO a new TrieNode
        SET bit_length TO bit_length
    END FUNCTION

    FUNCTION insert(num)
        SET node TO root
        FOR i FROM bit_length TO zero BY minus one
            SET bit TO element at position i of num shifted right by i AND one
            IF bit IS NOT IN keys of node.children
                SET element at key bit of node.children TO a new TrieNode
            END IF
            SET node TO element at key bit of node.children
            INCREMENT node.count BY one
        END FOR
    END FUNCTION

    FUNCTION count_less_than(num, threshold)
        SET count TO zero
        SET node TO root
        FOR i FROM bit_length TO zero BY minus one
            IF node IS null
                BREAK
            END IF
            SET bit TO element at position i of num shifted right by i AND one
            SET threshold_bit TO element at position i of threshold shifted right by i AND one
            IF threshold_bit EQUALS one
                INCREMENT count BY count of element at key bit of node.children OR zero IF key bit NOT IN node.children
                SET node TO element at key bit XOR one of node.children OR null IF key bit XOR one NOT IN node.children
            ELSE
                SET node TO element at key bit of node.children OR null IF key bit NOT IN node.children
            END IF
        END FOR
        RETURN count
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION countPairs(nums, low, high)
        SET trie TO a new Trie
        SET nice_pairs TO zero
        FOR each num IN nums
            INCREMENT nice_pairs BY CALL count_less_than ON trie WITH num AND high PLUS one MINUS CALL count_less_than ON trie WITH num AND low
            CALL insert ON trie WITH num
        END FOR
        RETURN nice_pairs
    END FUNCTION
END CLASS