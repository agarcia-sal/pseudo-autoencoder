CLASS Solution
    FUNCTION shortestPath(grid, k)
        IF grid IS empty OR element at position zero of grid IS empty
            RETURN negative one
        END IF

        SET m TO the LENGTH OF grid
        SET n TO the LENGTH OF element at position zero of grid

        IF k IS GREATER THAN OR EQUAL TO m PLUS n MINUS two
            RETURN m PLUS n MINUS two
        END IF

        SET directions TO the LIST OF TUPLES zero ONE, one zero, zero MINUS one, MINUS one zero

        SET queue TO a double-ended QUEUE with the single ELEMENT of the TUPLE zero, zero, k, zero

        SET visited TO a SET containing the TUPLE zero, zero, k

        WHILE queue IS NOT empty
            REMOVE AND RETURN the LEFTMOST ELEMENT of queue INTO x, y, remaining_k, steps

            IF x EQUALS m MINUS one AND y EQUALS n MINUS one
                RETURN steps
            END IF

            FOR each dx, dy IN directions
                SET nx TO x PLUS dx
                SET ny TO y PLUS dy

                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n
                    SET new_k TO remaining_k MINUS element at position nx of grid THEN element at position ny of that element

                    IF new_k IS GREATER THAN OR EQUAL TO zero AND the TUPLE nx, ny, new_k IS NOT IN visited
                        ADD the TUPLE nx, ny, new_k TO visited
                        APPEND the TUPLE nx, ny, new_k, steps PLUS one TO queue
                    END IF
                END IF
            END FOR
        END WHILE

        RETURN negative one
    END FUNCTION
END CLASS