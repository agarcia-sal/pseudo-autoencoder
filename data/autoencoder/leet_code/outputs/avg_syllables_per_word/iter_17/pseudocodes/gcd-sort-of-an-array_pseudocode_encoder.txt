CLASS UnionFind
    FUNCTION __init__(size)
        SET parent TO list OF numbers from zero TO size MINUS one
        SET rank TO list OF one repeated size times
    END FUNCTION

    FUNCTION find(p)
        IF element at position p of parent DOES NOT EQUAL p
            SET element at position p of parent TO CALL find WITH element at position p of parent
        END IF
        RETURN element at position p of parent
    END FUNCTION

    FUNCTION union(p, q)
        SET rootP TO CALL find WITH p
        SET rootQ TO CALL find WITH q
        IF rootP EQUALS rootQ
            RETURN False
        END IF
        IF element at position rootP of rank GREATER THAN element at position rootQ of rank
            SET element at position rootQ of parent TO rootP
        ELSE IF element at position rootP of rank LESS THAN element at position rootQ of rank
            SET element at position rootP of parent TO rootQ
        ELSE
            SET element at position rootQ of parent TO rootP
            INCREMENT element at position rootP of rank BY one
        END IF
        RETURN True
    END FUNCTION
END CLASS

CLASS Solution
    FUNCTION gcdSort(nums)
        SET sorted_nums TO CALL sorted WITH nums
        SET max_val TO CALL max WITH nums
        SET uf TO CALL UnionFind WITH max_val PLUS one

        FOR each num IN nums
            FOR factor FROM two TO the INTEGER PART OF the SQUARE ROOT OF num PLUS one
                IF num MODULO factor EQUALS zero
                    CALL uf.union WITH num AND factor
                    CALL uf.union WITH num AND the INTEGER DIVISION OF num BY factor
                END IF
            END FOR
        END FOR

        FOR i FROM zero TO the LENGTH OF nums MINUS one
            IF CALL uf.find WITH element at position i of nums DOES NOT EQUAL CALL uf.find WITH element at position i of sorted_nums
                RETURN False
            END IF
        END FOR

        RETURN True
    END FUNCTION
END CLASS