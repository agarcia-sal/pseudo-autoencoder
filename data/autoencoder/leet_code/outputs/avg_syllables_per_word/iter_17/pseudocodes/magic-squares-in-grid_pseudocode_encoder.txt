CLASS Solution
    FUNCTION numMagicSquaresInside(grid)
        FUNCTION is_magic(i, j)
            IF element at position i of grid element at position j NOT EQUALS five
                RETURN false
            END IF

            SET numbers TO auxiliary FUNCTION initialize_number_set()

            FOR x FROM i MINUS one TO i PLUS one
                FOR y FROM j MINUS one TO j PLUS one
                    IF element at position x of grid element at position y LESS THAN one OR element at position x of grid element at position y GREATER THAN nine OR element at position x of grid element at position y IS IN numbers
                        RETURN false
                    END IF
                    CALL auxiliary FUNCTION add_number TO numbers WITH parameter element at position x of grid element at position y
                END FOR
            END FOR

            FOR start FROM i MINUS one TO i PLUS one
                IF element at position start of grid element at position j MINUS one PLUS element at position start of grid element at position j PLUS element at position start of grid element at position j PLUS one NOT EQUALS fifteen OR element at position i MINUS one of grid element at position start PLUS element at position i of grid element at position start PLUS element at position i PLUS one of grid element at position start NOT EQUALS fifteen
                    RETURN false
                END IF
            END FOR

            IF element at position i MINUS one of grid element at position j MINUS one PLUS element at position i of grid element at position j PLUS element at position i PLUS one of grid element at position j PLUS one NOT EQUALS fifteen OR element at position i MINUS one of grid element at position j PLUS one PLUS element at position i of grid element at position j PLUS element at position i PLUS one of grid element at position j MINUS one NOT EQUALS fifteen
                RETURN false
            END IF

            RETURN true
        END FUNCTION

        SET count TO zero
        SET rows TO the LENGTH OF grid
        SET cols TO the LENGTH OF element at position zero of grid

        FOR i FROM one TO rows MINUS two
            FOR j FROM one TO cols MINUS two
                IF CALL is_magic WITH parameters i and j HOLDS true
                    INCREMENT count BY one
                END IF
            END FOR
        END FOR

        RETURN count
    END FUNCTION
END CLASS