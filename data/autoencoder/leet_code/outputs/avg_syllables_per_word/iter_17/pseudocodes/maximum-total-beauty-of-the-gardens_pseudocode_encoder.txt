CLASS Solution
    FUNCTION maximumBeauty(flowers, newFlowers, target, full, partial)
        CALL flowers SORT
        SET n TO the LENGTH OF flowers
        SET max_beauty TO zero

        SET prefix_sum TO a LIST OF zero REPEATED n PLUS one TIMES
        FOR index FROM zero TO n MINUS one
            SET element at position index PLUS one OF prefix_sum TO element at position index OF prefix_sum PLUS element at position index OF flowers
        END FOR

        SET complete_gardens TO zero
        FOR index FROM n MINUS one DOWN TO zero
            IF element at position index OF flowers IS GREATER THAN OR EQUAL TO target
                INCREMENT complete_gardens BY one
            ELSE
                BREAK
            END IF
        END FOR

        SET remaining_flowers TO newFlowers
        SET max_incomplete_flowers TO zero

        FOR i FROM complete_gardens TO n
            IF i IS GREATER THAN zero
                DECREMENT remaining_flowers BY target MINUS element at position n MINUS i OF flowers
                IF remaining_flowers IS LESS THAN zero
                    BREAK
                END IF
            END IF

            SET left TO zero
            SET right TO n MINUS i MINUS one
            WHILE left IS LESS THAN OR EQUAL TO right
                SET mid TO left PLUS right DIVIDED BY two
                SET cost TO element at position mid OF flowers MULTIPLIED BY mid PLUS one MINUS element at position mid PLUS one OF prefix_sum
                IF cost IS GREATER THAN remaining_flowers
                    SET right TO mid MINUS one
                ELSE
                    SET left TO mid PLUS one
                END IF
            END WHILE

            IF right IS GREATER THAN OR EQUAL TO zero
                SET max_incomplete_flowers TO element at position right OF flowers PLUS (remaining_flowers MINUS (element at position right OF flowers MULTIPLIED BY right PLUS one MINUS element at position right PLUS one OF prefix_sum)) DIVIDED BY right PLUS one
            ELSE
                SET max_incomplete_flowers TO zero
            END IF

            SET total_beauty TO i MULTIPLIED BY full PLUS the MINIMUM OF max_incomplete_flowers AND target MINUS one MULTIPLIED BY partial
            SET max_beauty TO the MAXIMUM OF max_beauty AND total_beauty
        END FOR

        RETURN max_beauty
    END FUNCTION
END CLASS