CLASS Solution
    FUNCTION maskPII(s)
        IF the character AT position at symbol IS IN s
            CALL split_email WITH s RETURNING local AND domain
            SET masked_local TO the first character of local CONCATENATED WITH five times the asterisk character CONCATENATED WITH the last character of local
            RETURN the lowercase version of masked_local CONCATENATED WITH the at symbol CONCATENATED WITH the lowercase version of domain
        ELSE
            SET digits TO the result of CALL filter_digits WITH s
            SET local_number TO three asterisks CONCATENATED WITH a dash CONCATENATED WITH three asterisks CONCATENATED WITH a dash CONCATENATED WITH the last four characters of digits
            IF the length of digits EQUALS ten
                RETURN local_number
            ELSE
                SET country_code_length TO the length of digits MINUS ten
                SET country_code TO the plus symbol CONCATENATED WITH country_code_length times the asterisk character CONCATENATED WITH a dash
                RETURN country_code CONCATENATED WITH local_number
            END IF
        END IF
    END FUNCTION

    FUNCTION split_email(email)
        CALL split string AT the character at symbol WITH email RETURNING two parts local AND domain
        RETURN local AND domain
    END FUNCTION

    FUNCTION filter_digits(text)
        CREATE an empty string digits_only
        FOR each character IN text
            IF character IS a digit
                APPEND character TO digits_only
            END IF
        END FOR
        RETURN digits_only
    END FUNCTION
END CLASS