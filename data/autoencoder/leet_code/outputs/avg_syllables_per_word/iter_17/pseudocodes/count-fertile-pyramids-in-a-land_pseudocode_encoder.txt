CLASS Solution
    FUNCTION countPyramids(grid)
        FUNCTION count_pyramids_from_top(two_dimensional_list grid)
            IF grid IS empty OR element at position zero of grid IS empty
                RETURN zero
            END IF
            SET m TO the LENGTH OF grid
            SET n TO the LENGTH OF element at position zero of grid
            SET dp TO a two_dimensional list of zeros with m rows and n columns
            SET count TO zero

            FOR i FROM zero TO m MINUS one
                FOR j FROM zero TO n MINUS one
                    IF element at position i of grid AT position j EQUALS one
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one
                            SET element at position i of dp AT position j TO one
                        ELSE
                            SET element at position i of dp AT position j TO the MINIMUM OF element at position i MINUS one of dp AT position j MINUS one, element at position i MINUS one of dp AT position j, element at position i MINUS one of dp AT position j PLUS one PLUS one
                        END IF
                        IF element at position i of dp AT position j GREATER THAN one
                            INCREMENT count BY element at position i of dp AT position j MINUS one
                        END IF
                    END IF
                END FOR
            END FOR

            RETURN count
        END FUNCTION

        FUNCTION count_pyramids_from_bottom(two_dimensional_list grid)
            IF grid IS empty OR element at position zero of grid IS empty
                RETURN zero
            END IF
            SET m TO the LENGTH OF grid
            SET n TO the LENGTH OF element at position zero of grid
            SET dp TO a two_dimensional list of zeros with m rows and n columns
            SET count TO zero

            FOR i FROM m MINUS one TO zero STEP negative one
                FOR j FROM zero TO n MINUS one
                    IF element at position i of grid AT position j EQUALS one
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one
                            SET element at position i of dp AT position j TO one
                        ELSE
                            SET element at position i of dp AT position j TO the MINIMUM OF element at position i PLUS one of dp AT position j MINUS one, element at position i PLUS one of dp AT position j, element at position i PLUS one of dp AT position j PLUS one PLUS one
                        END IF
                        IF element at position i of dp AT position j GREATER THAN one
                            INCREMENT count BY element at position i of dp AT position j MINUS one
                        END IF
                    END IF
                END FOR
            END FOR

            RETURN count
        END FUNCTION

        RETURN CALL count_pyramids_from_top WITH grid PLUS CALL count_pyramids_from_bottom WITH grid
    END FUNCTION
END CLASS