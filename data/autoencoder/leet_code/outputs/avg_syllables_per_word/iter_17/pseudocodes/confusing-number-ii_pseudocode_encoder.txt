CLASS Solution
    FUNCTION confusingNumberII(n)
        SET rotate_map TO auxiliary FUNCTION InitializeRotationMapping
        SET valid_digits TO auxiliary FUNCTION InitializeValidDigits

        FUNCTION is_confusing(num)
            SET original_num TO num
            SET rotated_num TO zero
            WHILE num GREATER THAN zero holds
                SET digit TO num MODULO ten
                SET rotated_num TO rotated_num MULTIPLIED BY ten PLUS the element AT position digit OF rotate_map
                SET num TO num DIVIDED BY ten
            END WHILE
            RETURN rotated_num NOT EQUALS original_num
        END FUNCTION

        FUNCTION count_confusing_numbers(limit, current SET TO zero)
            IF current GREATER THAN limit THEN
                RETURN zero
            END IF
            IF current NOT EQUALS zero AND CALL is_confusing WITH current THEN
                SET count TO one
            ELSE
                SET count TO zero
            END IF
            FOR each digit IN valid_digits
                SET new_number TO current MULTIPLIED BY ten PLUS digit
                IF new_number EQUALS zero THEN
                    CONTINUE to next iteration
                END IF
                INCREMENT count BY CALL count_confusing_numbers WITH limit AND new_number
            END FOR
            RETURN count
        END FUNCTION

        RETURN CALL count_confusing_numbers WITH n
    END FUNCTION
END CLASS