CLASS Solution
    FUNCTION maximumInvitations(favorite_list_of_integers)
        SET n TO the LENGTH OF favorite_list_of_integers
        SET graph TO a NEW defaultdict OF list
        SET in_degree TO a NEW list OF zero REPEATED n TIMES

        FOR index FROM zero TO n MINUS one
            APPEND index TO the list AT element at position index of favorite_list_of_integers IN graph
            INCREMENT element at position index of favorite_list_of_integers IN in_degree BY one
        END FOR

        SET mutual_chains TO zero
        SET visited TO a NEW list OF False REPEATED n TIMES

        FOR i FROM zero TO n MINUS one
            IF the element at position element at position i of favorite_list_of_integers of favorite_list_of_integers EQUALS i AND i LESS THAN element at position i of favorite_list_of_integers
                SET a TO i
                SET b TO element at position i of favorite_list_of_integers
                SET chain_a TO CALL find_chain_length WITH a graph visited
                SET chain_b TO CALL find_chain_length WITH b graph visited
                INCREMENT mutual_chains BY chain_a PLUS chain_b
            END IF
        END FOR

        SET longest_cycle TO zero
        SET visited TO a NEW list OF False REPEATED n TIMES

        FOR i FROM zero TO n MINUS one
            IF element at position i of visited EQUALS False
                SET cycle_length TO CALL find_cycle_length WITH i graph visited favorite_list_of_integers
                SET longest_cycle TO THE MAXIMUM OF longest_cycle AND cycle_length
            END IF
        END FOR

        RETURN THE MAXIMUM OF mutual_chains AND longest_cycle
    END FUNCTION

    FUNCTION find_chain_length(start_integer graph defaultdict visited_list_of_boolean)
        SET length TO zero
        SET queue TO a NEW deque INITIALIZED WITH start_integer
        SET element at position start_integer of visited_list_of_boolean TO True

        WHILE queue IS NOT empty
            SET current TO POP LEFT element FROM queue
            FOR each neighbor IN element at position current of graph
                IF element at position neighbor of visited_list_of_boolean EQUALS False
                    SET element at position neighbor of visited_list_of_boolean TO True
                    APPEND neighbor TO queue
                    INCREMENT length BY one
                END IF
            END FOR
        END WHILE

        RETURN length
    END FUNCTION

    FUNCTION find_cycle_length(start_integer graph defaultdict visited_list_of_boolean favorite_list_of_integers)
        IF element at position start_integer of visited_list_of_boolean EQUALS True
            RETURN zero
        END IF

        SET stack TO an EMPTY list
        SET current TO start_integer

        WHILE element at position current of visited_list_of_boolean EQUALS False
            SET element at position current of visited_list_of_boolean TO True
            APPEND current TO stack
            SET current TO element at position current of favorite_list_of_integers
        END WHILE

        IF current IS NOT IN stack
            RETURN zero
        END IF

        SET cycle_start_index TO THE POSITION OF current IN stack
        SET cycle_length TO THE LENGTH OF stack MINUS cycle_start_index

        RETURN cycle_length
    END FUNCTION
END CLASS