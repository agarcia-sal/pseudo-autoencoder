CLASS Solution
    FUNCTION maximumBeauty(flowers)
        ASSIGN pointer TO create_defaultdict_of_lists
        
        ASSIGN indices TO pointer
        
        SET prefix_sum TO auxiliary FUNCTION initialize_prefix_sum WITH parameters length OF flowers PLUS one
        
        FOR index FROM zero TO length OF flowers MINUS one
            SET element_at_position index_plus_one OF prefix_sum TO element_at_position index OF prefix_sum PLUS maximum OF element_at_position index OF flowers AND zero
            CALL append index TO list AT key element_at_position index OF flowers IN indices
        END FOR
        
        SET max_beauty TO negative_infinity
        
        FOR each beauty_value IN keys OF indices
            IF length OF list AT key beauty_value OF indices IS GREATER THAN OR EQUAL TO two
                SET first_occurrence TO element_at_position zero OF list AT key beauty_value OF indices
                SET last_occurrence TO element_at_position negative one OF list AT key beauty_value OF indices
                
                SET current_beauty TO two MULTIPLIED BY beauty_value PLUS element_at_position last_occurrence OF prefix_sum MINUS element_at_position first_occurrence PLUS one OF prefix_sum
                SET max_beauty TO maximum OF max_beauty AND current_beauty
            END IF
        END FOR
        
        RETURN max_beauty
    END FUNCTION
END CLASS