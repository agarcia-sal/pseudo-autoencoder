CLASS Solution
    FUNCTION minimumIncompatibility(nums, k)
        SET n TO the LENGTH OF nums
        SET subset_size TO n DIVIDED BY k

        CALL function Counter WITH nums ASSIGN TO counts
        IF ANY count IS GREATER THAN k FOR each count IN the VALUES OF counts
            RETURN negative one
        END IF

        INITIALIZE empty collection subset_incompatibility

        FOR mask FROM zero TO (one LEFT SHIFTED BY n) MINUS one
            IF the COUNT OF ones IN the BINARY REPRESENTATION OF mask EQUALS subset_size
                SET elements TO empty list
                FOR index FROM zero TO n MINUS one
                    IF the BITWISE AND OF mask AND one LEFT SHIFTED BY index IS NOT zero
                        APPEND element at position index OF nums TO elements
                    END IF
                END FOR
                IF the COUNT OF UNIQUE elements IN elements EQUALS subset_size
                    SET incompatibility TO the MAXIMUM OF elements MINUS the MINIMUM OF elements
                    ASSIGN incompatibility TO subset_incompatibility AT KEY mask
                END IF
            END IF
        END FOR

        INITIALIZE list dp WITH SIZE one LEFT SHIFTED BY n FILLED WITH infinity
        SET element at position zero OF dp TO zero

        FOR mask FROM zero TO (one LEFT SHIFTED BY n) MINUS one
            IF the REMAINDER OF the COUNT OF ones IN the BINARY REPRESENTATION OF mask DIVIDED BY subset_size IS NOT zero
                CONTINUE TO next iteration
            END IF
            FOR each subset_mask IN subset_incompatibility
                IF the BITWISE AND OF mask AND subset_mask EQUALS subset_mask
                    SET dp AT position mask TO the MINIMUM OF dp AT position mask AND dp AT position mask BITWISE XOR subset_mask PLUS subset_incompatibility AT KEY subset_mask
                END IF
            END FOR
        END FOR

        IF dp AT position (one LEFT SHIFTED BY n) MINUS one IS EQUAL TO infinity
            RETURN negative one
        ELSE
            RETURN dp AT position (one LEFT SHIFTED BY n) MINUS one
        END IF
    END FUNCTION
END CLASS