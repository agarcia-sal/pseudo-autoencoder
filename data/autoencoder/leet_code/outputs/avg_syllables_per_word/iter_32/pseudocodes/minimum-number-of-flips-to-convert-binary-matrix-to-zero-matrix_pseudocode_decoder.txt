CLASS Solution  
    FUNCTION minFlips(mat)  
        FUNCTION flip(matrix x y)  
            SET directions TO list of pairs indicating one above one below one to the left one to the right and the cell itself  
            FOR each direction dx dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN n  
                    IF element at position nx position ny of matrix EQUALS one  
                        SET element at position nx position ny of matrix TO zero  
                    ELSE  
                        SET element at position nx position ny of matrix TO one  
                    END IF  
                END IF  
            END FOR  
        END FUNCTION  

        FUNCTION matrix_to_tuple(matrix)  
            CREATE result AS empty list  
            FOR each row IN matrix  
                CREATE tuple_row AS an immutable sequence containing each element of row  
                APPEND tuple_row TO result  
            END FOR  
            RETURN an immutable sequence containing each element of result  
        END FUNCTION  

        SET m TO the LENGTH OF mat  
        SET n TO the LENGTH OF the element at position zero of mat  
        SET target TO an immutable sequence containing m elements each of which is an immutable sequence containing n elements each of which is zero  
        SET initial_state TO matrix_to_tuple called with mat  
        SET queue TO a list containing a pair of initial_state and zero  
        CREATE visited AS an empty set  
        ADD initial_state TO visited  

        WHILE queue is not empty  
            REMOVE the first pair from queue and ASSIGN to current_state and steps  
            IF current_state IS EQUAL TO target  
                RETURN steps  
            END IF  

            CREATE current_matrix AS a list  
            FOR each row IN current_state  
                CREATE row_list AS a list containing each element of row  
                APPEND row_list TO current_matrix  
            END FOR  

            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    CREATE next_matrix AS a deep copy of current_matrix  
                    CALL flip with next_matrix i j  
                    SET next_state TO matrix_to_tuple called with next_matrix  
                    IF next_state IS NOT IN visited  
                        ADD next_state TO visited  
                        APPEND the pair of next_state and steps PLUS one TO queue  
                    END IF  
                END FOR  
            END FOR  
        END WHILE  

        RETURN a value indicating negative one  
    END FUNCTION  
END CLASS