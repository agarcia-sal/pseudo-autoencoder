CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid EQUALS nothing OR element at position zero of grid EQUALS nothing  
                RETURN zero  
            END IF  
            SET number_of_rows TO the LENGTH OF grid  
            SET number_of_columns TO the LENGTH OF element at position zero of grid  
            INITIALIZE dp AS a list OF lists WITH number_of_rows lists EACH CONTAINING number_of_columns zeros  
            SET count TO zero  
            FOR each row_index FROM zero TO number_of_rows MINUS one  
                FOR each column_index FROM zero TO number_of_columns MINUS one  
                    IF element at position row_index of grid at position column_index EQUALS one  
                        IF row_index EQUALS zero OR column_index EQUALS zero OR column_index EQUALS number_of_columns MINUS one  
                            SET element at position row_index of dp at position column_index TO one  
                        ELSE  
                            SET element_at_top_left TO element at position row_index MINUS one of dp at position column_index MINUS one  
                            SET element_at_top TO element at position row_index MINUS one of dp at position column_index  
                            SET element_at_top_right TO element at position row_index MINUS one of dp at position column_index PLUS one  
                            SET minimum_value TO the smallest of element_at_top_left AND element_at_top AND element_at_top_right  
                            SET element at position row_index of dp at position column_index TO minimum_value PLUS one  
                        END IF  
                        IF element at position row_index of dp at position column_index GREATER THAN one  
                            INCREMENT count BY element at position row_index of dp at position column_index MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid EQUALS nothing OR element at position zero of grid EQUALS nothing  
                RETURN zero  
            END IF  
            SET number_of_rows TO the LENGTH OF grid  
            SET number_of_columns TO the LENGTH OF element at position zero of grid  
            INITIALIZE dp AS a list OF lists WITH number_of_rows lists EACH CONTAINING number_of_columns zeros  
            SET count TO zero  
            FOR each row_index FROM number_of_rows MINUS one DOWN TO zero  
                FOR each column_index FROM zero TO number_of_columns MINUS one  
                    IF element at position row_index of grid at position column_index EQUALS one  
                        IF row_index EQUALS number_of_rows MINUS one OR column_index EQUALS zero OR column_index EQUALS number_of_columns MINUS one  
                            SET element at position row_index of dp at position column_index TO one  
                        ELSE  
                            SET element_at_bottom_left TO element at position row_index PLUS one of dp at position column_index MINUS one  
                            SET element_at_bottom TO element at position row_index PLUS one of dp at position column_index  
                            SET element_at_bottom_right TO element at position row_index PLUS one of dp at position column_index PLUS one  
                            SET minimum_value TO the smallest of element_at_bottom_left AND element_at_bottom AND element_at_bottom_right  
                            SET element at position row_index of dp at position column_index TO minimum_value PLUS one  
                        END IF  
                        IF element at position row_index of dp at position column_index GREATER THAN one  
                            INCREMENT count BY element at position row_index of dp at position column_index MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        SET total_from_top TO the result of calling count_pyramids_from_top WITH grid  
        SET total_from_bottom TO the result of calling count_pyramids_from_bottom WITH grid  
        RETURN total_from_top PLUS total_from_bottom  
    END FUNCTION  
END CLASS