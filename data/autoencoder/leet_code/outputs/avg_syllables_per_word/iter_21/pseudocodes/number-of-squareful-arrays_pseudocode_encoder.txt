CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            CALL square_root_of_n WITH PARAMETERS n  
            CALL convert_to_integer WITH PARAMETERS result_of_previous_call  
            CALL raise_to_power_of_integer WITH PARAMETERS two  
            IF result_of_previous_call EQUALS n  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
          
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums  
                RETURN one  
            END IF  
              
            SET ans TO zero  
            FOR each element x IN the KEYS OF count  
                IF the VALUE ASSOCIATED WITH x IN count IS GREATER THAN zero AND (the LENGTH OF path EQUALS zero OR CALL is_square WITH PARAMETERS the ELEMENT AT the LAST POSITION OF path PLUS x)  
                    DECREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                    SET ans TO ans PLUS CALL backtrack WITH PARAMETERS path APPENDED WITH x AND count  
                    INCREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
          
        CALL initialize_counter_with PARAMETERS nums AND ASSIGN RESULT TO count  
        RETURN CALL backtrack WITH PARAMETERS an EMPTY LIST AND count  
    END FUNCTION  
END CLASS