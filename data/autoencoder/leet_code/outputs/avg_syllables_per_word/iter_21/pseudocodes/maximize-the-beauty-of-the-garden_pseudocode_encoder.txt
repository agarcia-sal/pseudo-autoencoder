CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        SET indices TO CALL defaultdict WITH PARAMETERS list  
        SET prefix_sum TO a list OF zero WITH LENGTH EQUAL TO the LENGTH OF flowers PLUS one  
        FOR index FROM zero TO the LENGTH OF flowers MINUS one  
            SET element_at_position index PLUS one OF prefix_sum TO the element_at_position index OF prefix_sum PLUS the GREATER OF the element_at_position index OF flowers AND zero  
            CALL append WITH PARAMETERS index ON the element_at_position index OF flowers OF indices  
        END FOR  
        SET max_beauty TO negative infinity  
        FOR each beauty IN the KEYS OF indices  
            IF the LENGTH OF the element_at_position beauty OF indices IS GREATER THAN OR EQUAL TO two  
                SET first TO the element_at_position zero OF the element_at_position beauty OF indices  
                SET last TO the element_at_position negative one OF the element_at_position beauty OF indices  
                SET current_beauty TO two MULTIPLIED BY beauty PLUS the element_at_position last OF prefix_sum MINUS the element_at_position first PLUS one OF prefix_sum  
                SET max_beauty TO the GREATER OF max_beauty AND current_beauty  
            END IF  
        END FOR  
        RETURN max_beauty  
    END FUNCTION  
END CLASS