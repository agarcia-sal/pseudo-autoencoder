CLASS Solution  
    FUNCTION minimumIncompatibility(nums, k)  
        IMPORT Counter FROM collections  
        
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        IF there EXISTS any count IN the VALUES OF Counter APPLIED TO nums WHERE count IS GREATER THAN k THEN  
            RETURN minus one  
        END IF  
        
        SET subset_incompatibility TO an EMPTY MAPPING  
        FOR mask FROM zero TO (one LEFT SHIFTED BY n) MINUS one  
            IF the NUMBER OF ONES IN THE BINARY REPRESENTATION OF mask EQUALS subset_size THEN  
                SET elements TO an EMPTY LIST  
                FOR i FROM zero TO n MINUS one  
                    IF the BITWISE AND OF mask AND (one LEFT SHIFTED BY i) IS NOT EQUAL TO zero THEN  
                        APPEND the ELEMENT at POSITION i OF nums TO elements  
                    END IF  
                END FOR  
                IF the NUMBER OF UNIQUE ELEMENTS IN elements EQUALS subset_size THEN  
                    SET incompatibility TO the MAXIMUM ELEMENT IN elements MINUS the MINIMUM ELEMENT IN elements  
                    ASSIGN incompatibility TO subset_incompatibility AT KEY mask  
                END IF  
            END IF  
        END FOR  
        
        SET dp TO a LIST FILLED WITH the VALUE infinity OF LENGTH one LEFT SHIFTED BY n  
        SET the ELEMENT AT POSITION zero OF dp TO zero  
        
        FOR mask FROM zero TO (one LEFT SHIFTED BY n) MINUS one  
            IF the REMAINDER WHEN the NUMBER OF ONES IN THE BINARY REPRESENTATION OF mask IS DIVIDED BY subset_size IS NOT EQUAL TO zero THEN  
                CONTINUE TO the NEXT ITERATION  
            END IF  
            FOR each subset_mask IN the KEYS OF subset_incompatibility  
                IF the BITWISE AND OF mask AND subset_mask EQUALS subset_mask THEN  
                    SET dp AT POSITION mask TO the MINIMUM OF dp AT POSITION mask AND dp AT POSITION (the BITWISE XOR OF mask AND subset_mask) PLUS subset_incompatibility AT KEY subset_mask  
                END IF  
            END FOR  
        END FOR  
        
        IF the ELEMENT AT POSITION (one LEFT SHIFTED BY n MINUS one) OF dp IS NOT EQUAL TO infinity THEN  
            RETURN the ELEMENT AT POSITION (one LEFT SHIFTED BY n MINUS one) OF dp  
        ELSE  
            RETURN minus one  
        END IF  
    END FUNCTION  
END CLASS