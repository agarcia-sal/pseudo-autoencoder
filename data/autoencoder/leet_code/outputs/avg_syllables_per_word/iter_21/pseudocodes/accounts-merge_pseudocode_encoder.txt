CLASS UnionFind  
    FUNCTION __init__(self, size)  
        SET self.root TO an empty list  
        FOR index FROM zero TO size MINUS one  
            APPEND index TO self.root  
        END FOR  
        SET self.rank TO a list containing one REPEATED size TIMES  
    END FUNCTION  
  
    FUNCTION find(self, x)  
        IF the element at position x OF self.root EQUALS x  
            RETURN x  
        END IF  
        SET the element at position x OF self.root TO CALL find WITH PARAMETERS the element at position x OF self.root  
        RETURN the element at position x OF self.root  
    END FUNCTION  
  
    FUNCTION union(self, x, y)  
        SET rootX TO CALL find WITH PARAMETERS x  
        SET rootY TO CALL find WITH PARAMETERS y  
        IF rootX NOT EQUALS rootY  
            IF the element at position rootX OF self.rank GREATER THAN the element at position rootY OF self.rank  
                SET the element at position rootY OF self.root TO rootX  
            ELSE IF the element at position rootX OF self.rank LESS THAN the element at position rootY OF self.rank  
                SET the element at position rootX OF self.root TO rootY  
            ELSE  
                SET the element at position rootY OF self.root TO rootX  
                INCREMENT the element at position rootX OF self.rank BY one  
            END IF  
        END IF  
    END FUNCTION  
END CLASS  
  
CLASS Solution  
    FUNCTION accountsMerge(self, accounts)  
        SET email_to_id TO an empty dictionary  
        SET uf TO CALL UnionFind WITH PARAMETERS the LENGTH OF accounts  
  
        FOR index, value PAIR BY ENUMERATION IN accounts  
            SET name TO the element at position zero OF value  
            SET emails TO the sublist of value FROM position one TO the END  
            FOR each email IN emails  
                IF email NOT IN email_to_id  
                    SET email_to_id[email] TO index  
                ELSE  
                    CALL union ON uf WITH PARAMETERS index AND the value at email IN email_to_id  
                END IF  
            END FOR  
        END FOR  
  
        SET merged_emails TO an empty dictionary with default list values  
        FOR each email, account_id IN email_to_id items  
            SET root_id TO CALL find ON uf WITH PARAMETERS account_id  
            APPEND email TO the list AT position root_id IN merged_emails  
        END FOR  
  
        SET result TO an empty list  
        FOR each account_id, emails IN merged_emails items  
            SET name TO the element at position zero OF the element at position account_id OF accounts  
            SET sorted_emails TO emails SORTED IN ascending order  
            APPEND a list CONSISTING OF name FOLLOWED BY sorted_emails TO result  
        END FOR  
  
        RETURN result  
    END FUNCTION  
END CLASS