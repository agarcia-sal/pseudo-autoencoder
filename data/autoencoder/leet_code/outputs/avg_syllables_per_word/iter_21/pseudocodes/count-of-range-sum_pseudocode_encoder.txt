CLASS Solution  
    FUNCTION countRangeSum(nums AS List OF Integer, lower AS Integer, upper AS Integer) RETURNS Integer  
        SET prefix_sums TO a list containing zero  
        SET current_sum TO zero  
        SET count TO zero  
        
        FOR each num IN nums  
            INCREMENT current_sum BY num  
            SET left TO current_sum MINUS upper  
            SET right TO current_sum MINUS lower  
            
            SET count TO count PLUS (the position RETURNED BY bisect_right IN prefix_sums FOR right MINUS the position RETURNED BY bisect_left IN prefix_sums FOR left)  
            
            CALL bisect_insort WITH PARAMETERS prefix_sums AND current_sum  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS