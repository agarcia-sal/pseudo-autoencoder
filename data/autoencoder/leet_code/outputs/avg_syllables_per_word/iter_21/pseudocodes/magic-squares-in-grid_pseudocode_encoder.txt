CLASS Solution  
    FUNCTION numMagicSquaresInside(grid)  
        FUNCTION is_magic(i, j)  
            IF element at position i OF grid AT position j DOES NOT EQUAL five  
                RETURN false  
            END IF  
            
            SET numbers TO an empty set  
            FOR x FROM i MINUS one TO i PLUS one  
                FOR y FROM j MINUS one TO j PLUS one  
                    IF element at position x OF grid AT position y LESS THAN one OR element at position x OF grid AT position y GREATER THAN nine OR element at position x OF grid AT position y IS IN numbers  
                        RETURN false  
                    END IF  
                    ADD element at position x OF grid AT position y TO numbers  
                END FOR  
            END FOR  
            
            FOR start FROM i MINUS one TO i PLUS one  
                IF the sum of element at position start OF grid AT position j MINUS one PLUS element at position start OF grid AT position j PLUS element at position start OF grid AT position j PLUS one DOES NOT EQUAL fifteen OR the sum of element at position i MINUS one OF grid AT position start PLUS element at position i OF grid AT position start PLUS element at position i PLUS one OF grid AT position start DOES NOT EQUAL fifteen  
                    RETURN false  
                END IF  
            END FOR  
            
            IF the sum of element at position i MINUS one OF grid AT position j MINUS one PLUS element at position i OF grid AT position j PLUS element at position i PLUS one OF grid AT position j PLUS one DOES NOT EQUAL fifteen OR the sum of element at position i MINUS one OF grid AT position j PLUS one PLUS element at position i OF grid AT position j PLUS element at position i PLUS one OF grid AT position j MINUS one DOES NOT EQUAL fifteen  
                RETURN false  
            END IF  
            
            RETURN true  
        END FUNCTION  
        
        SET count TO zero  
        SET rows TO the LENGTH OF grid  
        SET cols TO the LENGTH OF element at position zero OF grid  
        
        FOR i FROM one TO rows MINUS one  
            FOR j FROM one TO cols MINUS one  
                IF CALL is_magic WITH PARAMETERS i AND j RETURNS true  
                    INCREMENT count BY one  
                END IF  
            END FOR  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS