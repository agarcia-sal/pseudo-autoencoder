CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO an empty collection of unique elements  
            SET current_product TO a list containing the empty string  
            
            WHILE index LESS THAN the length of expression  
                SET char TO the element at position index OF expression  
                
                IF char EQUALS the left brace character  
                    CALL parse_expression WITH PARAMETERS index PLUS one AND ASSIGN the first returned value TO inner_set AND the second returned value TO index  
                    SET new_product TO an empty list  
                    FOR each element a IN current_product  
                        FOR each element b IN inner_set  
                            APPEND the concatenation of a PLUS b TO new_product  
                        END FOR  
                    END FOR  
                    SET current_product TO new_product  
                
                ELSE IF char EQUALS the right brace character  
                    FOR each element p IN current_product  
                        JOIN the elements of p into a single string  
                    END FOR  
                    ADD all joined strings from current_product TO current_set  
                    RETURN current_set AND index  
                
                ELSE IF char EQUALS the comma character  
                    FOR each element p IN current_product  
                        JOIN the elements of p into a single string  
                    END FOR  
                    ADD all joined strings from current_product TO current_set  
                    SET current_product TO a list containing the empty string  
                
                ELSE  
                    SET new_product TO an empty list  
                    FOR each element a IN current_product  
                        APPEND the concatenation of a PLUS char TO new_product  
                    END FOR  
                    SET current_product TO new_product  
                
                END IF  
                
                INCREMENT index BY one  
            END WHILE  
            
            FOR each element p IN current_product  
                JOIN the elements of p into a single string  
            END FOR  
            ADD all joined strings from current_product TO current_set  
            RETURN current_set AND index  
        END FUNCTION  
        
        CALL parse_expression WITH PARAMETERS zero AND ASSIGN the first returned value TO result_set AND IGNORE the second returned value  
        RETURN the sorted list of elements in result_set  
    END FUNCTION  
END CLASS