CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            
            IF the TUPLE consisting of l r and k IS IN memo  
                RETURN the VALUE ASSOCIATED WITH the TUPLE consisting of l r and k IN memo  
            END IF  
            
            WHILE r GREATER THAN l AND the ELEMENT at position r OF boxes EQUALS the ELEMENT at position r MINUS one OF boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            
            SET res TO CALL dp WITH PARAMETERS l r MINUS one zero memo PLUS the PRODUCT OF the SUM of k PLUS one AND the SUM of k PLUS one  
            
            FOR i FROM l TO r MINUS one  
                IF the ELEMENT at position i OF boxes EQUALS the ELEMENT at position r OF boxes  
                    SET res TO the GREATER VALUE BETWEEN res AND the SUM OF CALL dp WITH PARAMETERS l i k PLUS one memo AND CALL dp WITH PARAMETERS i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            
            SET the VALUE OF the TUPLE consisting of l r and k IN memo TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN CALL dp WITH PARAMETERS zero the LENGTH OF boxes MINUS one zero an EMPTY DICTIONARY  
    END FUNCTION  
END CLASS