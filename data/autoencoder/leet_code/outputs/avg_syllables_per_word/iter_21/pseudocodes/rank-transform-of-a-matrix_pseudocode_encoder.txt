CLASS UnionFind  
    FUNCTION __init__(self, size)  
        SET self.parent TO a list containing the sequence of integers from zero TO size MINUS one  
    END FUNCTION

    FUNCTION find(self, u)  
        IF element at position u OF self.parent NOT EQUALS u THEN  
            SET element at position u OF self.parent TO CALL self.find WITH PARAMETERS element at position u OF self.parent  
        END IF  
        RETURN element at position u OF self.parent  
    END FUNCTION

    FUNCTION union(self, u, v)  
        SET root_u TO CALL self.find WITH PARAMETERS u  
        SET root_v TO CALL self.find WITH PARAMETERS v  
        IF root_u NOT EQUALS root_v THEN  
            SET element at position root_u OF self.parent TO root_v  
        END IF  
    END FUNCTION  
END CLASS

CLASS Solution  
    FUNCTION matrixRankTransform(self, matrix)  
        SET m TO the LENGTH OF matrix  
        SET n TO the LENGTH OF element at position zero OF matrix  
        SET value_to_indices TO an empty mapping with default value as empty list  

        FOR each r FROM zero TO m MINUS one  
            FOR each c FROM zero TO n MINUS one  
                APPEND the tuple containing r and c TO element at position element at position r THEN c OF matrix IN value_to_indices  
            END FOR  
        END FOR

        SET row_rank TO a list of zeroes repeated m times  
        SET col_rank TO a list of zeroes repeated n times  
        SET result TO a list containing m elements each of which is a list containing n zeroes  

        FOR each value IN the keys of value_to_indices IN ascending order  
            SET uf TO a new instance of UnionFind WITH PARAMETER m PLUS n  
            SET rank TO an empty mapping with default value zero  

            FOR each tuple containing r and c IN element at position value IN value_to_indices  
                CALL uf.union WITH PARAMETERS r AND c PLUS m  
            END FOR

            FOR each tuple containing r and c IN element at position value IN value_to_indices  
                SET root TO CALL uf.find WITH PARAMETER r  
                SET element at position root IN rank TO the maximum BETWEEN element at position root IN rank AND the maximum BETWEEN element at position r IN row_rank AND element at position c IN col_rank PLUS one  
            END FOR

            FOR each tuple containing r and c IN element at position value IN value_to_indices  
                SET root TO CALL uf.find WITH PARAMETER r  
                SET element at position r THEN c OF result TO element at position root IN rank  
                SET element at position r IN row_rank TO element at position root IN rank  
                SET element at position c IN col_rank TO element at position root IN rank  
            END FOR  
        END FOR

        RETURN result  
    END FUNCTION  
END CLASS