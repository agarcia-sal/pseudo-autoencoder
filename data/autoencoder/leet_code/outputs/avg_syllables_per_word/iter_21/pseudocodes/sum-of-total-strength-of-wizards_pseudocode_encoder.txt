CLASS Solution  
    FUNCTION totalStrength(strength)  
        SET MOD TO one billion PLUS seven  
        SET n TO the LENGTH OF strength  
        
        CALL initialize_prefix_sums WITH PARAMETERS strength n MOD  
        RECEIVE prefix  
        
        CALL initialize_prefix_prefix_sums WITH PARAMETERS prefix n MOD  
        RECEIVE prefix_prefix  
        
        CALL initialize_prev_smaller WITH PARAMETERS strength n  
        RECEIVE prev_smaller  
        
        CALL initialize_next_smaller_or_equal WITH PARAMETERS strength n  
        RECEIVE next_smaller_or_equal  
        
        SET total_strength TO zero  
        FOR index FROM zero TO n MINUS one  
            SET left TO element at position index OF prev_smaller PLUS one  
            SET right TO element at position index OF next_smaller_or_equal  
            
            SET sum_left TO (index MINUS left PLUS one) MULTIPLIED BY (element at position right PLUS one OF prefix_prefix MINUS element at position index PLUS one OF prefix_prefix) MODULO MOD  
            SET sum_right TO (right MINUS index) MULTIPLIED BY (element at position index PLUS one OF prefix_prefix MINUS element at position left OF prefix_prefix) MODULO MOD  
            
            SET contribution TO element at position index OF strength MULTIPLIED BY (sum_left MINUS sum_right) MODULO MOD  
            SET total_strength TO (total_strength PLUS contribution) MODULO MOD  
        END FOR  
        
        RETURN total_strength  
    END FUNCTION  
    
    FUNCTION initialize_prefix_sums(strength, n, MOD)  
        CREATE list prefix WITH size n PLUS one FILLED WITH zeros  
        FOR index FROM zero TO n MINUS one  
            SET element at position index PLUS one OF prefix TO (element at position index OF prefix PLUS element at position index OF strength) MODULO MOD  
        END FOR  
        RETURN prefix  
    END FUNCTION  
    
    FUNCTION initialize_prefix_prefix_sums(prefix, n, MOD)  
        CREATE list prefix_prefix WITH size n PLUS two FILLED WITH zeros  
        FOR index FROM zero TO n  
            SET element at position index PLUS one OF prefix_prefix TO (element at position index OF prefix_prefix PLUS element at position index OF prefix) MODULO MOD  
        END FOR  
        RETURN prefix_prefix  
    END FUNCTION  
    
    FUNCTION initialize_prev_smaller(strength, n)  
        CREATE list prev_smaller WITH size n FILLED WITH minus one  
        CREATE empty list stack  
        FOR index FROM zero TO n MINUS one  
            WHILE stack IS NOT empty AND element at position element at last position OF stack OF strength GREATER THAN OR EQUAL TO element at position index OF strength  
                REMOVE last element FROM stack  
            END WHILE  
            IF stack IS NOT empty  
                SET element at position index OF prev_smaller TO last element OF stack  
            END IF  
            APPEND index TO stack  
        END FOR  
        RETURN prev_smaller  
    END FUNCTION  
    
    FUNCTION initialize_next_smaller_or_equal(strength, n)  
        CREATE list next_smaller_or_equal WITH size n FILLED WITH n  
        CREATE empty list stack  
        FOR index FROM n MINUS one DOWN TO zero  
            WHILE stack IS NOT empty AND element at position element at last position OF stack OF strength GREATER THAN element at position index OF strength  
                REMOVE last element FROM stack  
            END WHILE  
            IF stack IS NOT empty  
                SET element at position index OF next_smaller_or_equal TO last element OF stack  
            END IF  
            APPEND index TO stack  
        END FOR  
        RETURN next_smaller_or_equal  
    END FUNCTION  
END CLASS