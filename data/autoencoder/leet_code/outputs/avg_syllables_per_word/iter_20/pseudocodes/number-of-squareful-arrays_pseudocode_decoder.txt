CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root_of_n TO the INTEGER PART OF the SQUARE ROOT OF n  
            RETURN the SQUARE OF square_root_of_n EQUALS n  
        END FUNCTION  
      
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums THEN  
                RETURN one  
            END IF  
          
            SET ans TO zero  
            FOR each x IN the KEYS OF count  
                IF the VALUE ASSOCIATED WITH x IN count IS GREATER THAN zero AND (path is empty OR is_square of the SUM OF the ELEMENT at the LAST POSITION OF path AND x) THEN  
                    DECREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                    INCREMENT ans BY the RESULT OF backtrack with path APPENDED BY x AND count  
                    INCREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
      
        SET count TO the FREQUENCY COUNTER of the elements IN nums  
        RETURN backtrack with an EMPTY path AND count  
    END FUNCTION  
END CLASS