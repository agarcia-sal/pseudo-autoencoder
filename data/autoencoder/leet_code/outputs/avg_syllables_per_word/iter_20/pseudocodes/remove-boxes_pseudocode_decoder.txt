CLASS Solution  
    FUNCTION removeBoxes WITH parameters boxes  
        FUNCTION dp WITH parameters l r k memo  
            IF l IS GREATER THAN r  
                RETURN zero  
            END IF  
            IF the tuple of l r k IS A KEY IN memo  
                RETURN the value AT the tuple of l r k IN memo  
            END IF  
            WHILE r IS GREATER THAN l AND the element at position r of boxes EQUALS the element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO the result of dp WITH parameters l the value of r MINUS one zero memo PLUS the value of k PLUS one MULTIPLIED BY the value of k PLUS one  
            FOR each i FROM l TO r MINUS one  
                IF the element at position i of boxes EQUALS the element at position r of boxes  
                    SET res TO the greater value BETWEEN res AND the result of dp WITH parameters l i k PLUS one memo PLUS the result of dp WITH parameters i PLUS one r MINUS one zero memo  
                END IF  
            END FOR  
            SET the value AT the tuple of l r k IN memo TO res  
            RETURN res  
        END FUNCTION  
        RETURN the result of dp WITH parameters zero the length OF boxes MINUS one zero an empty dictionary  
    END FUNCTION  
END CLASS