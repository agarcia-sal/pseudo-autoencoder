CLASS Solution  
    FUNCTION boxDelivering(boxes AS list of list of integer, portsCount AS integer, maxBoxes AS integer, maxWeight AS integer) RETURNS integer  
        SET n TO the LENGTH OF boxes  
        SET dp TO a list filled WITH infinity repeated n PLUS one times  
        SET the element at position zero of dp TO zero  

        SET left TO zero  
        SET current_weight TO zero  
        SET extra_trips TO zero  

        FOR right FROM zero TO n MINUS one  
            INCREMENT current_weight BY element at position one of element at position right of boxes  
            IF right GREATER THAN zero AND element at position zero of element at position right of boxes NOT EQUALS element at position zero of element at position right MINUS one of boxes  
                INCREMENT extra_trips BY one  
            END IF  

            WHILE left LESS THAN OR EQUAL TO right AND THE COUNT OF boxes from position left TO right inclusive GREATER THAN maxBoxes OR current_weight GREATER THAN maxWeight  
                DECREMENT current_weight BY element at position one of element at position left of boxes  
                IF left GREATER THAN zero AND element at position zero of element at position left of boxes NOT EQUALS element at position zero of element at position left MINUS one of boxes  
                    DECREMENT extra_trips BY one  
                END IF  
                INCREMENT left BY one  
            END WHILE  

            SET element at position right PLUS one of dp TO element at position left of dp PLUS two PLUS extra_trips  
        END FOR  

        RETURN element at position n of dp  
    END FUNCTION  
END CLASS