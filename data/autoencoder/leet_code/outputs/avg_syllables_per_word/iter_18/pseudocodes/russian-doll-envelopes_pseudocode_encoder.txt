CLASS Solution  
    FUNCTION maxEnvelopes WITH PARAMETER envelopes AS list of list of integers  
        EXECUTE sorting OF envelopes BY the width IN ascending order AND BY the height IN descending order WHEN the widths ARE EQUAL  
        
        SET dp TO an empty list  
        
        FOR each pair OF width and height IN envelopes  
            SET idx TO the position determined BY binary search to insert height INTO dp TO maintain sorted order  
            IF idx EQUALS the LENGTH OF dp THEN  
                APPEND height TO dp  
            ELSE  
                SET element at position idx OF dp TO height  
            END IF  
        END FOR  
        
        RETURN the LENGTH OF dp  
    END FUNCTION  
END CLASS