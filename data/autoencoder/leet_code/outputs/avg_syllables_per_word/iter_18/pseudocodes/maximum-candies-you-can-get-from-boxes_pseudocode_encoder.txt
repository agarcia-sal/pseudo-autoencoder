CLASS Solution  
    FUNCTION maxCandies WITH PARAMETERS status AS list of integers keys AS list of integers keys AS list of lists of integers containedBoxes AS list of lists of integers initialBoxes AS list of integers  
        SET boxes_we_have TO the set formed from initialBoxes  
        SET keys_we_have TO an empty set  
        SET total_candies TO zero  
        SET progress_made TO TRUE  
        WHILE progress_made holds  
            SET progress_made TO FALSE  
            FOR each box IN the list formed from boxes_we_have  
                IF the element at position box of status EQUALS one OR the box EXISTS IN keys_we_have  
                    INCREMENT total_candies BY the element at position box of candies  
                    UPDATE keys_we_have WITH the elements from the element at position box of keys  
                    UPDATE boxes_we_have WITH the elements from the element at position box of containedBoxes  
                    REMOVE the box FROM boxes_we_have  
                    SET progress_made TO TRUE  
                END IF  
            END FOR  
        END WHILE  
        RETURN total_candies  
    END FUNCTION  
END CLASS