CLASS UnionFind  
    FUNCTION __init__ WITH PARAMETER size  
        SET parent TO a list of integers from zero TO size MINUS one  
    END FUNCTION  

    FUNCTION find WITH PARAMETER u  
        IF the element of parent at position u DOES NOT EQUAL u THEN  
            SET the element of parent at position u TO the result of calling find with the element of parent at position u  
        END IF  
        RETURN the element of parent at position u  
    END FUNCTION  

    FUNCTION union WITH PARAMETERS u AND v  
        SET root_u TO the result of calling find with u  
        SET root_v TO the result of calling find with v  
        IF root_u DOES NOT EQUAL root_v THEN  
            SET the element of parent at position root_u TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform WITH PARAMETER matrix  
        SET m TO the length of matrix  
        SET n TO the length of the element at position zero of matrix  
        SET value_to_indices TO a mapping from keys to list where each key corresponds to a list of pairs of integers indicating positions  
        
        FOR r FROM zero TO m MINUS one  
            FOR c FROM zero TO n MINUS one  
                APPEND the pair consisting of r and c TO the list corresponding to the element at position r and c of matrix in value_to_indices  
            END FOR  
        END FOR  
        
        SET row_rank TO a list of zero repeated m times  
        SET col_rank TO a list of zero repeated n times  
        SET result TO a two-dimensional list of zero repeated n times each inner list and repeated m times the outer list  
        
        FOR each value IN the keys of value_to_indices IN ascending order  
            SET uf TO a new instance of UnionFind initialized with m PLUS n  
            SET rank TO a mapping from keys to integers initialized to zero  
            
            FOR each pair consisting of r and c IN the list corresponding to value in value_to_indices  
                CALL union method on uf with r and c PLUS m  
            END FOR  
            
            FOR each pair consisting of r and c IN the list corresponding to value in value_to_indices  
                SET root TO the result of calling find on uf with r  
                SET rank at key root TO the maximum of the current value of rank at root AND the maximum of the element of row_rank at position r AND the element of col_rank at position c PLUS one  
            END FOR  
            
            FOR each pair consisting of r and c IN the list corresponding to value in value_to_indices  
                SET root TO the result of calling find on uf with r  
                SET the element at position r and c of result TO the value of rank at root  
                SET the element of row_rank at position r TO the value of rank at root  
                SET the element of col_rank at position c TO the value of rank at root  
            END FOR  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS