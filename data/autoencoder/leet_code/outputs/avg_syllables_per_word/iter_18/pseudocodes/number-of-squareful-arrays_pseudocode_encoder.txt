CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            RETURN the integer square root of n multiplied BY the integer square root of n EQUALS n  
        END FUNCTION  

        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums THEN  
                RETURN one  
            END IF  

            SET ans TO zero  
            FOR each x IN the keys of count  
                IF the value at key x in count is GREATER THAN zero AND (path is empty OR is_square the sum of the element at the last position of path AND x) THEN  
                    DECREMENT the value at key x in count BY one  
                    INCREMENT ans BY the result of backtrack with path followed by x AND count  
                    INCREMENT the value at key x in count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  

        SET count TO the mapping of counts of elements in nums  
        RETURN backtrack with empty list AND count  
    END FUNCTION  
END CLASS