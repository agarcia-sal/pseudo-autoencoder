CLASS Solution  
    FUNCTION countPyramids WITH PARAMETER grid  
        FUNCTION count_pyramids_from_top WITH PARAMETER grid  
            IF grid IS empty OR the element at position zero of grid IS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF the element at position zero of grid  
            SET dp TO a newly created two dimensional collection of zero values with dimensions m BY n  
            SET count TO zero  
              
            FOR index i FROM zero TO m MINUS one  
                FOR index j FROM zero TO n MINUS one  
                    IF the element at position i AND position j of grid EQUALS one  
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET the element at position i AND position j of dp TO one  
                        ELSE  
                            SET the element at position i AND position j of dp TO the MINIMUM VALUE AMONG the element at position i MINUS one AND position j MINUS one of dp AND the element at position i MINUS one AND position j of dp AND the element at position i MINUS one AND position j PLUS one of dp PLUS one  
                        END IF  
                        IF the element at position i AND position j of dp GREATER THAN one  
                            INCREMENT count BY the element at position i AND position j of dp MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
              
            RETURN count  
        END FUNCTION  
          
        FUNCTION count_pyramids_from_bottom WITH PARAMETER grid  
            IF grid IS empty OR the element at position zero of grid IS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF the element at position zero of grid  
            SET dp TO a newly created two dimensional collection of zero values with dimensions m BY n  
            SET count TO zero  
              
            FOR index i FROM m MINUS one DOWN TO zero  
                FOR index j FROM zero TO n MINUS one  
                    IF the element at position i AND position j of grid EQUALS one  
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET the element at position i AND position j of dp TO one  
                        ELSE  
                            SET the element at position i AND position j of dp TO the MINIMUM VALUE AMONG the element at position i PLUS one AND position j MINUS one of dp AND the element at position i PLUS one AND position j of dp AND the element at position i PLUS one AND position j PLUS one of dp PLUS one  
                        END IF  
                        IF the element at position i AND position j of dp GREATER THAN one  
                            INCREMENT count BY the element at position i AND position j of dp MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
              
            RETURN count  
        END FUNCTION  
          
        RETURN the RESULT OF count_pyramids_from_top WITH THE ARGUMENT grid PLUS the RESULT OF count_pyramids_from_bottom WITH THE ARGUMENT grid  
    END FUNCTION  
END CLASS