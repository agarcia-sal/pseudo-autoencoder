CLASS Solution  
    FUNCTION validArrangement WITH PARAMETER pairs AS list of list of integer  
        SET graph TO a new mapping with default value as an empty list  
        SET out_degree TO a new mapping with default value as zero  
        SET in_degree TO a new mapping with default value as zero  
        
        FOR each element pair consisting of u and v IN pairs  
            APPEND v TO the list at key u in graph  
            INCREMENT the value at key u in out_degree BY one  
            INCREMENT the value at key v in in_degree BY one  
        END FOR  
        
        SET start_node TO no value  
        FOR each element node IN the keys of graph  
            IF the value at key node in out_degree EQUALS the value at key node in in_degree PLUS one THEN  
                SET start_node TO node  
                BREAK the loop  
            END IF  
        END FOR  
        
        IF start_node has no value THEN  
            SET start_node TO any element from the keys of graph  
        END IF  
        
        SET path TO an empty list  
        SET stack TO a new list containing start_node  
        
        WHILE the stack is not empty  
            SET u TO the last element of stack  
            IF the list at key u in graph is not empty THEN  
                REMOVE the last element from the list at key u in graph and assign it to v  
                APPEND v TO stack  
            ELSE  
                REMOVE the last element from stack and APPEND it TO path  
            END IF  
        END WHILE  
        
        REVERSE the order of elements in path  
        
        SET result TO an empty list  
        FOR each index i FROM zero TO the length of path MINUS one EXCLUSIVE  
            APPEND a new list containing the element at position i of path and the element at position i PLUS one of path TO result  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS