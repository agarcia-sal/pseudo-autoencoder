CLASS Solution  
    FUNCTION longestPath WITH PARAMETERS parent AS List OF integers AND s AS string  
        FROM collections IMPORT defaultdict  
          
        SET tree TO defaultdict WITH empty list AS default value  
        FOR each index i AND parent_index p IN parent WITH enumeration  
            IF p NOT EQUALS negative one  
                APPEND i TO the list at key p IN tree  
            END IF  
        END FOR  
          
        SET self result TO one  
          
        FUNCTION dfs WITH PARAMETER node  
            SET max1 TO zero  
            SET max2 TO zero  
              
            FOR each child IN the list at key node IN tree  
                SET child_length TO CALL dfs WITH child  
                  
                IF character at position child of s NOT EQUALS character at position node of s  
                    IF child_length GREATER THAN max1  
                        SET max2 TO max1  
                        SET max1 TO child_length  
                    ELSE IF child_length GREATER THAN max2  
                        SET max2 TO child_length  
                    END IF  
                END IF  
            END FOR  
              
            SET self result TO the GREATER OF self result AND max1 PLUS max2 PLUS one  
              
            RETURN max1 PLUS one  
        END FUNCTION  
          
        CALL dfs WITH zero  
          
        RETURN self result  
    END FUNCTION  
END CLASS