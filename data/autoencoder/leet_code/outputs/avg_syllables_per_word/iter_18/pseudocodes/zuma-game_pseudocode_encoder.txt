CLASS Solution  
    FUNCTION findMinStep(board AS string, hand AS string) RETURNS integer  
        FUNCTION clean(board AS string) RETURNS string  
            SET stack TO empty list  
            FOR each ball IN board  
                IF stack is not empty AND the first element of the last item in stack NOT EQUALS ball AND the second element of the last item in stack GREATER THAN OR EQUAL TO three  
                    REMOVE the last item FROM stack  
                END IF  
                IF stack is empty OR the first element of the last item in stack NOT EQUALS ball  
                    APPEND a list of ball AND one TO stack  
                ELSE  
                    INCREMENT the second element of the last item in stack BY one  
                END IF  
            END FOR  
            IF stack is not empty AND the second element of the last item in stack GREATER THAN OR EQUAL TO three  
                REMOVE the last item FROM stack  
            END IF  
            RETURN the concatenation of each ball repeated by the count for each pair of ball and count in stack  
        END FUNCTION  

        FUNCTION dfs(board AS string, hand_counter AS mapping from character to integer) RETURNS integer  
            IF board is empty  
                RETURN zero  
            END IF  
            SET min_steps TO infinity  
            SET i TO zero  
            WHILE i LESS THAN the length of board  
                SET j TO i PLUS one  
                WHILE j LESS THAN the length of board AND the character at position i of board EQUALS the character at position j of board  
                    INCREMENT j BY one  
                END WHILE  
                SET increment TO three MINUS (j MINUS i)  
                IF the value for the character at position i of board in hand_counter GREATER THAN OR EQUAL TO increment  
                    ASSIGN new_hand_counter TO a copy of hand_counter  
                    DECREMENT the value for the character at position i of board in new_hand_counter BY increment  
                    ASSIGN new_board TO the result of calling clean WITH the concatenation of the substring of board from start up to position i AND the substring of board from position j to end  
                    SET steps TO the result of calling dfs WITH new_board AND new_hand_counter  
                    IF steps GREATER THAN OR EQUAL TO zero  
                        SET min_steps TO the minimum of min_steps AND steps PLUS increment  
                    END IF  
                END IF  
                SET i TO j  
            END WHILE  
            IF min_steps EQUALS infinity  
                RETURN negative one  
            ELSE  
                RETURN min_steps  
            END IF  
        END FUNCTION  

        ASSIGN hand_counter TO a new Counter initialized with hand  
        RETURN the result of calling dfs WITH board AND hand_counter  
    END FUNCTION  
END CLASS