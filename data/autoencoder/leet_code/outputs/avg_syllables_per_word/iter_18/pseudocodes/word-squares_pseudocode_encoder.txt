CLASS Solution  
    FUNCTION wordSquares(words AS List of strings) RETURNS List of List of strings  
        INITIALIZE prefix_to_words AS mapping FROM string TO list of strings  
        FOR each word IN words  
            FOR index FROM zero TO the LENGTH OF word MINUS one  
                SET prefix TO the substring of word from the start up to position index exclusive  
                APPEND word TO the list at key prefix in prefix_to_words  
            END FOR  
        END FOR  
        
        INITIALIZE results AS empty list of lists of strings  
        
        FUNCTION backtrack(square AS list of strings)  
            IF the LENGTH OF square EQUALS the LENGTH OF the first element of words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO the concatenation of the character at position the LENGTH OF square in each word of square in order  
            FOR each candidate IN the list at key prefix in prefix_to_words  
                CALL backtrack WITH the argument square APPENDED WITH candidate  
            END FOR  
        END FUNCTION  
        
        FOR each word IN words  
            CALL backtrack WITH a list containing only word  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS