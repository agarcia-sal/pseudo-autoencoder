CLASS Solution  
    FUNCTION pyramidTransition WITH PARAMETERS bottom AS string AND allowed AS list of string  
        SET allowed_map TO a mapping with default values as mappings with default values as lists of elements  
        FOR each rule IN allowed  
            SET left TO the first element IN rule  
            SET right TO the second element IN rule  
            SET top TO the third element IN rule  
            APPEND top TO the list at key right IN the mapping at key left OF allowed_map  
        END FOR  
  
        FUNCTION can_build_pyramid WITH PARAMETERS current_bottom AS string AND current_top AS string  
            IF the LENGTH OF current_bottom EQUALS one  
                RETURN true  
            END IF  
            IF the LENGTH OF current_top EQUALS the LENGTH OF current_bottom MINUS one  
                RETURN the result OF can_build_pyramid WITH current_top AND empty string  
            END IF  
  
            SET left TO the character at position the LENGTH OF current_top IN current_bottom  
            SET right TO the character at position the LENGTH OF current_top PLUS one IN current_bottom  
  
            IF left IS a key IN allowed_map AND right IS a key IN the mapping at key left OF allowed_map  
                FOR each top IN the list at key right IN the mapping at key left OF allowed_map  
                    IF can_build_pyramid WITH current_bottom AND the concatenation OF current_top AND top RETURNS true  
                        RETURN true  
                    END IF  
                END FOR  
            END IF  
  
            RETURN false  
        END FUNCTION  
  
        RETURN the result OF can_build_pyramid WITH bottom AND empty string  
    END FUNCTION  
END CLASS