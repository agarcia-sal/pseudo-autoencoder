CLASS Solution  
    FUNCTION numMagicSquaresInside(grid)  
        FUNCTION is_magic(i, j)  
            IF the element at position i and j of grid NOT EQUALS five  
                RETURN false  
            END IF  
              
            SET numbers TO an empty set  
            FOR x FROM i minus one TO i plus one  
                FOR y FROM j minus one TO j plus one  
                    IF the element at position x and y of grid LESS THAN one OR the element at position x and y of grid GREATER THAN nine OR the element at position x and y of grid IN numbers  
                        RETURN false  
                    END IF  
                    APPEND the element at position x and y of grid TO numbers  
                END FOR  
            END FOR  
              
            FOR start FROM i minus one TO i plus one  
                IF the sum of the elements at positions start and j minus one of grid PLUS the element at position start and j of grid PLUS the element at position start and j plus one of grid NOT EQUALS fifteen OR the sum of the elements at positions i minus one and start of grid PLUS the element at position i and start of grid PLUS the element at position i plus one and start of grid NOT EQUALS fifteen  
                    RETURN false  
                END IF  
            END FOR  
              
            IF the sum of the elements at positions i minus one and j minus one of grid PLUS the element at position i and j of grid PLUS the element at position i plus one and j plus one of grid NOT EQUALS fifteen OR the sum of the elements at positions i minus one and j plus one of grid PLUS the element at position i and j of grid PLUS the element at position i plus one and j minus one of grid NOT EQUALS fifteen  
                RETURN false  
            END IF  
              
            RETURN true  
        END FUNCTION  
          
        SET count TO zero  
        SET rows TO the length of grid  
        SET cols TO the length of the element at position zero of grid  
          
        FOR i FROM one TO rows minus two  
            FOR j FROM one TO cols minus two  
                IF is_magic(i, j)  
                    INCREMENT count BY one  
                END IF  
            END FOR  
        END FOR  
          
        RETURN count  
    END FUNCTION  
END CLASS