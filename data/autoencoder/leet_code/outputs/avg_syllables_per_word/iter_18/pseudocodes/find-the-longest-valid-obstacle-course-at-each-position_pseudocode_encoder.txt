CLASS Solution  
    FUNCTION longestObstacleCourseAtEachPosition WITH PARAMETER obstacles AS List of integer  
        SET n TO the LENGTH OF obstacles  
        SET ans TO an empty list  
        SET increasing_subseq TO an empty list  
        
        FOR each obstacle IN obstacles  
            SET idx TO the POSITION OF the SMALLEST NUMBER IN increasing_subseq WHICH IS GREATER THAN OR EQUAL TO obstacle USING binary search for insertion on the right  
            
            IF idx IS EQUAL TO the LENGTH OF increasing_subseq  
                APPEND obstacle TO increasing_subseq  
            ELSE  
                SET the element at position idx of increasing_subseq TO obstacle  
            END IF  
            
            APPEND idx INCREMENTED BY one TO ans  
        END FOR  
        
        RETURN ans  
    END FUNCTION  
END CLASS