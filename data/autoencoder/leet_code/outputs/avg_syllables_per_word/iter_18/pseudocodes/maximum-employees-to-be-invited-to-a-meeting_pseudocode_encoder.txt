CLASS Solution  
    FUNCTION maximumInvitations WITH PARAMETER favorite AS List of integer  
        SET n TO the LENGTH OF favorite  
        SET graph TO a new mapping with default value as an empty list  
        SET in_degree TO a new list of size n with each element set TO zero  
        
        FOR index FROM zero TO n MINUS one  
            APPEND index TO the element at position element at position index of favorite of graph  
            INCREMENT the element at position element at position index of favorite of in_degree BY one  
        END FOR  
        
        SET mutual_chains TO zero  
        SET visited TO a new list of size n with each element set TO False  
        
        FOR index FROM zero TO n MINUS one  
            IF the element at position element at position index of favorite of favorite EQUALS index AND index LESS THAN element at position index of favorite THEN  
                SET a TO index  
                SET b TO element at position index of favorite  
                SET chain_a TO CALL find_chain_length WITH a graph visited  
                SET chain_b TO CALL find_chain_length WITH b graph visited  
                INCREMENT mutual_chains BY chain_a PLUS chain_b  
            END IF  
        END FOR  
        
        SET longest_cycle TO zero  
        SET visited TO a new list of size n with each element set TO False  
        
        FOR index FROM zero TO n MINUS one  
            IF the element at position index of visited EQUALS False THEN  
                SET cycle_length TO CALL find_cycle_length WITH index graph visited favorite  
                IF cycle_length GREATER THAN longest_cycle THEN  
                    SET longest_cycle TO cycle_length  
                END IF  
            END IF  
        END FOR  
        
        RETURN the GREATER OF mutual_chains AND longest_cycle  
    END FUNCTION  
    
    FUNCTION find_chain_length WITH PARAMETERS start AS integer graph AS mapping visited AS List of boolean  
        SET length TO zero  
        SET queue TO a new double ended queue containing start  
        SET the element at position start of visited TO True  
        
        WHILE the LENGTH OF queue GREATER THAN zero  
            SET current TO the REMOVED first element from queue  
            FOR each neighbor IN the element at position current of graph  
                IF the element at position neighbor of visited EQUALS False THEN  
                    SET the element at position neighbor of visited TO True  
                    APPEND neighbor TO queue  
                    INCREMENT length BY one  
                END IF  
            END FOR  
        END WHILE  
        
        RETURN length  
    END FUNCTION  
    
    FUNCTION find_cycle_length WITH PARAMETERS start AS integer graph AS mapping visited AS List of boolean favorite AS List of integer  
        IF the element at position start of visited EQUALS True THEN  
            RETURN zero  
        END IF  
        
        SET stack TO an empty list  
        SET current TO start  
        
        WHILE the element at position current of visited EQUALS False  
            SET the element at position current of visited TO True  
            APPEND current TO stack  
            SET current TO the element at position current of favorite  
        END WHILE  
        
        IF current NOT IN stack THEN  
            RETURN zero  
        END IF  
        
        SET cycle_start_index TO the POSITION of current IN stack  
        SET cycle_length TO the LENGTH OF stack MINUS cycle_start_index  
        
        RETURN cycle_length  
    END FUNCTION  
END CLASS