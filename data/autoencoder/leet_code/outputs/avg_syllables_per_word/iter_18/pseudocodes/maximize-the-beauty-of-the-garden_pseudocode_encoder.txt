CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        FROM collections IMPORT defaultdict  
        SET indices TO defaultdict of empty list  
        SET prefix_sum TO list of zero repeated the LENGTH OF flowers PLUS one times  
        FOR i FROM zero TO the LENGTH OF flowers MINUS one  
            SET element_at_position_i_of_prefix_sum PLUS one TO element_at_position_i_of_prefix_sum PLUS max of the element at position i of flowers AND zero  
            APPEND i TO the list in mapping indices at key the element at position i of flowers  
        END FOR  
        SET max_beauty TO negative infinity  
        FOR each beauty IN keys of mapping indices  
            IF the LENGTH OF list in mapping indices at key beauty GREATER THAN OR EQUAL TO two THEN  
                SET first TO element at position zero of list in mapping indices at key beauty  
                SET last TO element at position negative one of list in mapping indices at key beauty  
                SET current_beauty TO two MULTIPLIED BY beauty PLUS element at position last of prefix_sum MINUS element at position first PLUS one of prefix_sum  
                SET max_beauty TO max of max_beauty AND current_beauty  
            END IF  
        END FOR  
        RETURN max_beauty  
    END FUNCTION  
END CLASS