CLASS Solution  
    FUNCTION cherryPickup(grid AS List OF List OF integer) RETURNS integer  
        SET n TO the LENGTH OF grid  
        IF the element at position zero of grid at position zero EQUALS negative one OR the element at position n MINUS one of grid at position n MINUS one EQUALS negative one THEN  
            RETURN zero  
        END IF  
        
        SET dp TO a three dimensional list of dimensions n by n by n each initialized TO negative one  
        SET the element at position zero of dp at position zero at position zero TO the element at position zero of grid at position zero  
        
        SET directions TO the list containing the pairs zero and one AND one and zero  
        
        FOR t FROM one TO the value of two MULTIPLIED BY n MINUS one EXCLUSIVE  
            FOR i1 FROM the maximum of zero AND t MINUS n PLUS one TO the minimum of n AND t PLUS one EXCLUSIVE  
                FOR i2 FROM the maximum of zero AND t MINUS n PLUS one TO the minimum of n AND t PLUS one EXCLUSIVE  
                    SET j1 TO t MINUS i1  
                    SET j2 TO t MINUS i2  
                    IF the element at position i1 of grid at position j1 EQUALS negative one OR the element at position i2 of grid at position j2 EQUALS negative one THEN  
                        CONTINUE  
                    END IF  
                    
                    SET prev_max TO negative one  
                    FOR each pair di1 and dj1 IN directions  
                        FOR each pair di2 and dj2 IN directions  
                            SET pi1 TO i1 MINUS di1  
                            SET pj1 TO j1 MINUS dj1  
                            SET pi2 TO i2 MINUS di2  
                            SET pj2 TO j2 MINUS dj2  
                            IF pi1 GREATER THAN OR EQUAL TO zero AND pi1 LESS THAN n AND pj1 GREATER THAN OR EQUAL TO zero AND pj1 LESS THAN n AND pi2 GREATER THAN OR EQUAL TO zero AND pi2 LESS THAN n AND pj2 GREATER THAN OR EQUAL TO zero AND pj2 LESS THAN n THEN  
                                SET prev_max TO the greater of prev_max AND the element at position pi1 of dp at position pi2 at position pj1  
                            END IF  
                        END FOR  
                    END FOR  
                    
                    IF prev_max GREATER THAN OR EQUAL TO zero THEN  
                        IF i1 EQUALS i2 THEN  
                            SET cherries TO the element at position i1 of grid at position j1  
                        ELSE  
                            SET cherries TO the sum of the element at position i1 of grid at position j1 AND the element at position i2 of grid at position j2  
                        END IF  
                        SET the element at position i1 of dp at position i2 at position j1 TO prev_max PLUS cherries  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN the greater of zero AND the element at position n MINUS one of dp at position n MINUS one at position n MINUS one  
    END FUNCTION  
END CLASS