CLASS UnionFind  
    FUNCTION __init__(self, size)  
        SET self.parent TO list of integers from zero TO size MINUS one  
    END FUNCTION  

    FUNCTION find(self, u)  
        IF element at self.parent indexed by u NOT EQUALS u THEN  
            SET element at self.parent indexed by u TO result of self.find called with element at self.parent indexed by u  
        END IF  
        RETURN element at self.parent indexed by u  
    END FUNCTION  

    FUNCTION union(self, u, v)  
        SET root_u TO result of self.find called with u  
        SET root_v TO result of self.find called with v  
        IF root_u NOT EQUALS root_v THEN  
            SET element at self.parent indexed by root_u TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform(self, matrix)  
        SET m TO number of rows in matrix  
        SET n TO number of columns in matrix  
        SET value_to_indices TO a dictionary mapping values TO empty lists  
        
        FOR each integer r FROM zero TO m MINUS one  
            FOR each integer c FROM zero TO n MINUS one  
                APPEND pair consisting of r and c TO list in value_to_indices at key matrix element at row r and column c  
            END FOR  
        END FOR  
        
        SET row_rank TO list of zeros with length m  
        SET col_rank TO list of zeros with length n  
        SET result TO a two dimensional list of zeros with dimensions m by n  
        
        FOR each value IN keys of value_to_indices sorted in ascending order  
            SET uf TO new instance of UnionFind initialized with number m PLUS n  
            SET rank TO a dictionary mapping integers TO zero by default  
            
            FOR each pair r, c IN list at value_to_indices[value]  
                CALL uf.union with arguments r and c PLUS m  
            END FOR  
            
            FOR each pair r, c IN list at value_to_indices[value]  
                SET root TO uf.find called with r  
                SET element in rank at key root TO maximum between current element in rank at key root AND maximum between element in row_rank at index r AND element in col_rank at index c PLUS one  
            END FOR  
            
            FOR each pair r, c IN list at value_to_indices[value]  
                SET root TO uf.find called with r  
                SET element in result at row r and column c TO element in rank at key root  
                SET element in row_rank at index r TO element in rank at key root  
                SET element in col_rank at index c TO element in rank at key root  
            END FOR  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS