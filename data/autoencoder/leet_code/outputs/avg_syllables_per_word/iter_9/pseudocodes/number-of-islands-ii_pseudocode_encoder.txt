CLASS UnionFind  
    FUNCTION __init__(self)  
        SET self.parent TO empty dictionary  
        SET self.count TO zero  
    END FUNCTION  

    FUNCTION make_set(self, x)  
        IF x NOT IN self.parent THEN  
            SET self.parent at x TO x  
            INCREMENT self.count BY one  
        END IF  
    END FUNCTION  

    FUNCTION find(self, x)  
        IF self.parent at x NOT EQUALS x THEN  
            SET self.parent at x TO self.find(self.parent at x)  
        END IF  
        RETURN self.parent at x  
    END FUNCTION  

    FUNCTION union(self, x, y)  
        SET rootX TO self.find(x)  
        SET rootY TO self.find(y)  
        IF rootX NOT EQUALS rootY THEN  
            SET self.parent at rootX TO rootY  
            DECREMENT self.count BY one  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION numIslands2(self, m, n, positions)  
        FUNCTION is_valid(x, y)  
            RETURN x GREATER THAN OR EQUAL TO zero AND x LESS THAN m AND y GREATER THAN OR EQUAL TO zero AND y LESS THAN n  
        END FUNCTION  

        SET directions TO list containing (one, zero), (minus one, zero), (zero, one), (zero, minus one)  
        SET uf TO new UnionFind  
        SET grid TO list of m lists each containing n zeroes  
        SET result TO empty list  

        FOR each element r, c IN positions  
            IF grid at position r, c EQUALS one THEN  
                APPEND uf.count TO result  
                CONTINUE to next iteration  
            END IF  

            SET grid at position r, c TO one  
            CALL uf.make_set WITH argument tuple (r, c)  

            FOR each element dr, dc IN directions  
                SET nr TO r PLUS dr  
                SET nc TO c PLUS dc  
                IF is_valid(nr, nc) AND grid at position nr, nc EQUALS one THEN  
                    CALL uf.union WITH arguments tuple (r, c) AND tuple (nr, nc)  
                END IF  
            END FOR  

            APPEND uf.count TO result  
        END FOR  

        RETURN result  
    END FUNCTION  
END CLASS  