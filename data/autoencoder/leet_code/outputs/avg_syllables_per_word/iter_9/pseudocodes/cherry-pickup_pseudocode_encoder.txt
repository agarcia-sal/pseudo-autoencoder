CLASS Solution  
    FUNCTION cherryPickup(self, grid)  
        SET n TO length of grid  
        IF element at grid zero zero EQUALS negative one OR element at grid n minus one n minus one EQUALS negative one THEN  
            RETURN zero  
        END IF  
        
        CALL auxiliary FUNCTION initialize_dp_table WITH parameter n, RETURN TO dp  
        SET element at dp zero zero zero TO element at grid zero zero  
        
        SET directions TO list of pairs: pair of zero and one, pair of one and zero  
        
        FOR t FROM one TO two MULTIPLIED BY n MINUS one  
            FOR i1 FROM maximum of zero and t MINUS (n MINUS one) TO minimum of n and t PLUS one  
                FOR i2 FROM maximum of zero and t MINUS (n MINUS one) TO minimum of n and t PLUS one  
                    SET j1 TO t MINUS i1  
                    SET j2 TO t MINUS i2  
                    IF element at grid i1 j1 EQUALS negative one OR element at grid i2 j2 EQUALS negative one THEN  
                        CONTINUE to next iteration  
                    END IF  
                    
                    SET prev_max TO negative one  
                    FOR each pair di1 dj1 IN directions  
                        FOR each pair di2 dj2 IN directions  
                            SET pi1 TO i1 MINUS di1  
                            SET pj1 TO j1 MINUS dj1  
                            SET pi2 TO i2 MINUS di2  
                            SET pj2 TO j2 MINUS dj2  
                            IF pi1 GREATER THAN OR EQUAL TO zero AND pi1 LESS THAN n AND pj1 GREATER THAN OR EQUAL TO zero AND pj1 LESS THAN n AND pi2 GREATER THAN OR EQUAL TO zero AND pi2 LESS THAN n AND pj2 GREATER THAN OR EQUAL TO zero AND pj2 LESS THAN n THEN  
                                SET prev_max TO maximum of prev_max and element at dp pi1 pi2 pj1  
                            END IF  
                        END FOR  
                    END FOR  
                    
                    IF prev_max GREATER THAN OR EQUAL TO zero THEN  
                        IF i1 EQUALS i2 THEN  
                            SET cherries TO element at grid i1 j1  
                        ELSE  
                            SET cherries TO element at grid i1 j1 PLUS element at grid i2 j2  
                        END IF  
                        SET element at dp i1 i2 pj1 TO prev_max PLUS cherries  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN maximum of zero and element at dp n minus one n minus one n minus one  
    END FUNCTION  

FUNCTION initialize_dp_table(n)  
    CREATE a three dimensional structure dp of size n by n by n  
    FOR each index from zero to n minus one in first dimension  
        FOR each index from zero to n minus one in second dimension  
            FOR each index from zero to n minus one in third dimension  
                SET element at dp current indices TO negative one  
            END FOR  
        END FOR  
    END FOR  
    RETURN dp  
END FUNCTION