CLASS Solution  
    FUNCTION removeBoxes(self, boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN 0  
            END IF  
            
            IF memo CONTAINS key (l, r, k) THEN  
                RETURN memo VALUE FOR key (l, r, k)  
            END IF  
            
            WHILE r GREATER THAN l AND boxes AT r EQUALS boxes AT (r MINUS 1) DO  
                DECREMENT r BY 1  
                INCREMENT k BY 1  
            END WHILE  
            
            SET res TO dp(l, r MINUS 1, zero, memo) PLUS (k PLUS 1) MULTIPLIED BY (k PLUS 1)  
            
            FOR i FROM l TO r MINUS 1 DO  
                IF boxes AT i EQUALS boxes AT r THEN  
                    SET res TO maximum OF res AND (dp(l, i, k PLUS 1, memo) PLUS dp(i PLUS 1, r MINUS 1, zero, memo))  
                END IF  
            END FOR  
            
            SET memo VALUE FOR key (l, r, k) TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN dp(zero, LENGTH OF boxes MINUS 1, zero, EMPTY DICTIONARY)  
    END FUNCTION  
END CLASS