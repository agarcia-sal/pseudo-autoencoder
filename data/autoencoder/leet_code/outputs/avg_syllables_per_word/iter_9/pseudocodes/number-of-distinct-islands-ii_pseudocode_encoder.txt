CLASS Solution  
    FUNCTION numDistinctIslands2(self, grid)  
        FUNCTION dfs(x, y, island)  
            IF x LESS THAN 0 OR x GREATER THAN OR EQUAL TO length of grid OR y LESS THAN 0 OR y GREATER THAN OR EQUAL TO length of grid at zero index OR grid at x y EQUALS 0 THEN  
                RETURN  
            END IF  
            SET grid at x y TO 0  
            APPEND pair of x and y TO island  
            CALL dfs with x PLUS 1, y, island  
            CALL dfs with x MINUS 1, y, island  
            CALL dfs with x, y PLUS 1, island  
            CALL dfs with x, y MINUS 1, island  
        END FUNCTION  

        FUNCTION normalize(island)  
            SET shapes TO empty list  
            FOR each pair dx, dy IN list of (1 and 1), (1 and negative 1), (negative 1 and 1), (negative 1 and negative 1)  
                SET new_island TO empty list  
                FOR each pair x, y IN island  
                    APPEND pair of x MULTIPLIED BY dx and y MULTIPLIED BY dy TO new_island  
                END FOR  
                SORT new_island in ascending order  
                SET min_x TO minimum x value from new_island  
                SET min_y TO minimum y value from new_island  
                APPEND tuple of pairs with x MINUS min_x and y MINUS min_y FROM new_island TO shapes  
            END FOR  
            FOR index FROM zero TO length of shapes MINUS one  
                SET rotated_shape TO tuple of pairs with y from shapes at index and negative x from shapes at index  
                APPEND rotated_shape TO shapes  
            END FOR  
            RETURN minimum element FROM shapes  
        END FUNCTION  

        SET islands TO empty set  
        FOR i FROM zero TO length of grid MINUS one  
            FOR j FROM zero TO length of grid at zero index MINUS one  
                IF grid at i j EQUALS 1 THEN  
                    SET island TO empty list  
                    CALL dfs with i, j, island  
                    ADD normalize of island TO islands  
                END IF  
            END FOR  
        END FOR  
        RETURN size of islands  
    END FUNCTION  
END CLASS