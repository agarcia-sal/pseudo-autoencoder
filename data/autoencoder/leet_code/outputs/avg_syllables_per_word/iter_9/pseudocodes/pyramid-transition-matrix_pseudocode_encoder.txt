CLASS Solution  
    FUNCTION pyramidTransition(self, bottom, allowed)  
        SET allowed_map TO empty mapping with default of empty mapping with default of empty list  
        FOR each rule IN allowed  
            SET left TO first character of rule  
            SET right TO second character of rule  
            SET top TO third character of rule  
            APPEND top TO allowed_map at key left and key right  
        END FOR  

        FUNCTION can_build_pyramid(current_bottom, current_top)  
            IF length of current_bottom EQUALS one THEN  
                RETURN True  
            END IF  
            IF length of current_top EQUALS length of current_bottom MINUS one THEN  
                RETURN can_build_pyramid(current_top, empty list)  
            END IF  

            SET left TO element of current_bottom at position length of current_top  
            SET right TO element of current_bottom at position length of current_top PLUS one  
            IF allowed_map contains key left AND allowed_map at left contains key right THEN  
                FOR each top IN allowed_map at left and right  
                    IF can_build_pyramid(current_bottom, current_top appended with top) THEN  
                        RETURN True  
                    END IF  
                END FOR  
            END IF  
            RETURN False  
        END FUNCTION  

        RETURN can_build_pyramid(bottom, empty list)  
    END FUNCTION  
END CLASS