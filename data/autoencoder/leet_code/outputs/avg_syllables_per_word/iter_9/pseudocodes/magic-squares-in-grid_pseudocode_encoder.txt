CLASS Solution  
    FUNCTION numMagicSquaresInside(self, grid)  
        FUNCTION is_magic(i, j)  
            IF grid at position i j NOT EQUALS 5 THEN  
                RETURN False  
            END IF  
            
            SET numbers TO an empty collection  
            FOR x FROM i MINUS 1 TO i PLUS 1  
                FOR y FROM j MINUS 1 TO j PLUS 1  
                    IF grid at position x y LESS THAN 1 OR grid at position x y GREATER THAN 9 OR grid at position x y IN numbers THEN  
                        RETURN False  
                    END IF  
                    ADD grid at position x y TO numbers  
                END FOR  
            END FOR  
            
            FOR start FROM i MINUS 1 TO i PLUS 1  
                IF sum of grid at row start and columns j MINUS 1, j, j PLUS 1 NOT EQUALS 15 OR sum of grid at rows i MINUS 1, i, i PLUS 1 and column start NOT EQUALS 15 THEN  
                    RETURN False  
                END IF  
            END FOR  
            
            IF sum of grid at positions i MINUS 1 j MINUS 1, i j, i PLUS 1 j PLUS 1 NOT EQUALS 15 OR sum of grid at positions i MINUS 1 j PLUS 1, i j, i PLUS 1 j MINUS 1 NOT EQUALS 15 THEN  
                RETURN False  
            END IF  
            
            RETURN True  
        END FUNCTION  
        
        SET count TO 0  
        SET rows TO length of grid  
        SET cols TO length of first element in grid  
        
        FOR i FROM 1 TO rows MINUS 2  
            FOR j FROM 1 TO cols MINUS 2  
                IF is_magic(i, j) THEN  
                    INCREMENT count BY 1  
                END IF  
            END FOR  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS