CLASS Solution
    FUNCTION uniquePathsIII(self, grid)
        FUNCTION dfs(x, y, steps)
            IF grid AT position x, y EQUALS 2 THEN
                RETURN steps EQUALS 0
            END IF

            SET original TO grid AT position x, y
            SET grid AT position x, y TO visited marker value

            SET count TO 0

            FOR each pair dx, dy IN list of direction pairs
                SET nx TO x PLUS dx
                SET ny TO y PLUS dy

                IF nx GREATER THAN OR EQUAL TO 0 AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO 0 AND ny LESS THAN n AND grid AT position nx, ny GREATER THAN OR EQUAL TO 0 THEN
                    INCREMENT count BY dfs(nx, ny, steps MINUS 1)
                END IF
            END FOR

            SET grid AT position x, y TO original

            RETURN count
        END FUNCTION

        SET m TO number of rows in grid
        SET n TO number of columns in grid

        SET start_x TO 0
        SET start_y TO 0
        SET empty_squares TO 1

        FOR i FROM 0 TO m MINUS 1
            FOR j FROM 0 TO n MINUS 1
                IF grid AT position i, j EQUALS 1 THEN
                    SET start_x TO i
                    SET start_y TO j
                ELSE IF grid AT position i, j EQUALS 0 THEN
                    INCREMENT empty_squares BY 1
                END IF
            END FOR
        END FOR

        RETURN dfs(start_x, start_y, empty_squares)
    END FUNCTION
END CLASS