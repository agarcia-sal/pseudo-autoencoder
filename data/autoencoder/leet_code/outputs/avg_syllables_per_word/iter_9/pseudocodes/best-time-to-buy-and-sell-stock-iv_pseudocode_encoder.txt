CLASS Solution  
    FUNCTION maxProfit(self, k, prices)  
        IF prices IS EMPTY OR k EQUALS 0 THEN  
            RETURN 0  
        END IF  
        
        SET n TO length of prices  
        
        IF k GREATER THAN OR EQUAL TO n DIVIDED BY 2 THEN  
            SET profit TO 0  
            FOR index FROM 1 TO n MINUS 1  
                IF prices AT index GREATER THAN prices AT index MINUS 1 THEN  
                    SET profit TO profit PLUS (prices AT index MINUS prices AT index MINUS 1)  
                END IF  
            END FOR  
            RETURN profit  
        END IF  
        
        SET hold TO list of k PLUS 1 elements each SET TO negative infinity  
        SET release TO list of k PLUS 1 elements each SET TO 0  
        
        FOR each price IN prices  
            FOR i FROM 1 TO k  
                SET hold AT i TO greater of hold AT i AND (release AT i MINUS 1 MINUS price)  
                SET release AT i TO greater of release AT i AND (hold AT i PLUS price)  
            END FOR  
        END FOR  
        
        RETURN release AT k  
    END FUNCTION  
END CLASS