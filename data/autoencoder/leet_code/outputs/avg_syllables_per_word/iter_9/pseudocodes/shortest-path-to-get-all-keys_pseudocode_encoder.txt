CLASS Solution
    FUNCTION shortestPathAllKeys(self, grid)
        SET directions TO list of pairs: (0, 1), (0, -1), (1, 0), (-1, 0)

        SET m TO length of grid
        SET n TO length of first element in grid
        SET start TO None
        SET num_keys TO 0

        FOR i FROM 0 TO m MINUS 1
            FOR j FROM 0 TO n MINUS 1
                IF element at grid position i, j EQUALS '@' THEN
                    SET start TO pair i, j
                ELSE IF element at grid position i, j IS lowercase letter THEN
                    INCREMENT num_keys BY 1
                END IF
            END FOR
        END FOR

        SET queue TO double-ended queue initialized with tuple: start first element, start second element, zero, zero
        SET visited TO set containing tuple: start first element, start second element, zero

        WHILE queue IS NOT empty
            REMOVE first tuple from queue and assign to x, y, keys, steps

            FOR each pair dx, dy IN directions
                SET nx TO x PLUS dx
                SET ny TO y PLUS dy

                IF nx GREATER THAN OR EQUAL TO zero AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO zero AND ny LESS THAN n THEN
                    SET cell TO element at grid position nx, ny

                    IF cell EQUALS '#' THEN
                        CONTINUE to next iteration of directions loop
                    END IF

                    IF cell IS uppercase letter THEN
                        SET key_needed TO one shifted left by (ordinal of cell converted to lowercase MINUS ordinal of letter 'a')
                        IF keys BITWISE AND key_needed EQUALS zero THEN
                            CONTINUE to next iteration of directions loop
                        END IF
                    END IF

                    IF cell IS lowercase letter THEN
                        SET new_keys TO keys BITWISE OR one shifted left by (ordinal of cell MINUS ordinal of letter 'a')
                        IF new_keys EQUALS (one shifted left by num_keys) MINUS one THEN
                            RETURN steps PLUS one
                        END IF
                    ELSE
                        SET new_keys TO keys
                    END IF

                    IF tuple nx, ny, new_keys NOT IN visited THEN
                        ADD tuple nx, ny, new_keys TO visited
                        APPEND tuple nx, ny, new_keys, steps PLUS one TO queue
                    END IF
                END IF
            END FOR
        END WHILE

        RETURN negative one
    END FUNCTION
END CLASS