CLASS Solution  
    FUNCTION shortestPath(self, grid, k)  
        IF grid IS empty OR first element of grid IS empty THEN  
            RETURN minus one  
        END IF  
        
        SET m TO length of grid  
        SET n TO length of first element of grid  
        
        IF k GREATER THAN OR EQUAL TO m PLUS n MINUS two THEN  
            RETURN m PLUS n MINUS two  
        END IF  
        
        SET directions TO list containing tuples: (zero, one), (one, zero), (zero, minus one), (minus one, zero)  
        
        SET queue TO new deque initialized with tuple (zero, zero, k, zero)  
        
        SET visited TO new set initialized with tuple (zero, zero, k)  
        
        WHILE queue IS NOT empty DO  
            REMOVE first element FROM queue AND UNPACK AS x, y, remaining_k, steps  
            
            IF x EQUALS m MINUS one AND y EQUALS n MINUS one THEN  
                RETURN steps  
            END IF  
            
            FOR each pair dx, dy IN directions DO  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx GREATER THAN OR EQUAL TO zero AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO zero AND ny LESS THAN n THEN  
                    SET new_k TO remaining_k MINUS grid element at position nx, ny  
                    
                    IF new_k GREATER THAN OR EQUAL TO zero AND tuple (nx, ny, new_k) NOT IN visited THEN  
                        ADD tuple (nx, ny, new_k) TO visited  
                        APPEND tuple (nx, ny, new_k, steps PLUS one) TO queue  
                    END IF  
                END IF  
            END FOR  
        END WHILE  
        
        RETURN minus one  
    END FUNCTION  
END CLASS