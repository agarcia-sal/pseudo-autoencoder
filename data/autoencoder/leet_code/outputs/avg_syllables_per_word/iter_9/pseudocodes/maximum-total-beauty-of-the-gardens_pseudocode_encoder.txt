CLASS Solution  
    FUNCTION maximumBeauty(flowers, newFlowers, target, full, partial)  
        CALL sort ON flowers  
        SET n TO length of flowers  
        SET max_beauty TO zero  
        
        SET prefix_sum TO list of zeros with length n plus one  
        FOR i FROM zero TO n MINUS one  
            SET prefix_sum entry at i plus one TO prefix_sum entry at i PLUS flowers entry at i  
        END FOR  
        
        SET complete_gardens TO zero  
        FOR i FROM n MINUS one DOWN TO zero  
            IF flowers entry at i GREATER THAN OR EQUALS target THEN  
                INCREMENT complete_gardens BY one  
            ELSE  
                BREAK loop  
            END IF  
        END FOR  
        
        SET remaining_flowers TO newFlowers  
        SET max_incomplete_flowers TO zero  
        
        FOR i FROM complete_gardens TO n  
            IF i GREATER THAN zero THEN  
                DECREMENT remaining_flowers BY target MINUS flowers entry at n MINUS i  
                IF remaining_flowers LESS THAN zero THEN  
                    BREAK loop  
                END IF  
            END IF  
            
            SET left TO zero  
            SET right TO n MINUS i MINUS one  
            WHILE left LESS THAN OR EQUALS right  
                SET mid TO integer division of left PLUS right BY two  
                SET cost TO flowers entry at mid MULTIPLIED BY mid PLUS one MINUS prefix_sum entry at mid PLUS one  
                IF cost GREATER THAN remaining_flowers THEN  
                    SET right TO mid MINUS one  
                ELSE  
                    SET left TO mid PLUS one  
                END IF  
            END WHILE  
            
            IF right GREATER THAN OR EQUALS zero THEN  
                SET max_incomplete_flowers TO flowers entry at right PLUS integer division of (remaining_flowers MINUS (flowers entry at right MULTIPLIED BY right PLUS one MINUS prefix_sum entry at right PLUS one)) BY right PLUS one  
            ELSE  
                SET max_incomplete_flowers TO zero  
            END IF  
            
            SET total_beauty TO i MULTIPLIED BY full PLUS minimum of max_incomplete_flowers AND target MINUS one MULTIPLIED BY partial  
            IF total_beauty GREATER THAN max_beauty THEN  
                SET max_beauty TO total_beauty  
            END IF  
        END FOR  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS