CLASS Solution  
    FUNCTION longestObstacleCourseAtEachPosition(self, obstacles)  
        SET n TO length of obstacles  
        SET ans TO empty list  
        SET increasing_subseq TO empty list  
        
        FOR each obstacle IN obstacles  
            SET idx TO position to insert obstacle into increasing_subseq such that all elements before idx are less than or equal to obstacle and elements at idx or after are greater than obstacle  
            
            IF idx EQUALS length of increasing_subseq THEN  
                APPEND obstacle TO increasing_subseq  
            ELSE  
                SET element at position idx in increasing_subseq TO obstacle  
            END IF  
            
            APPEND idx PLUS one TO ans  
        END FOR  
        
        RETURN ans  
    END FUNCTION  
END CLASS