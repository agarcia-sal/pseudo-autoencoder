CLASS Solution  
    FUNCTION countPyramids(self, grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid IS empty OR first element of grid IS empty THEN  
                RETURN zero  
            END IF  
            SET m TO length of grid  
            SET n TO length of first element of grid  
            CREATE dp AS two dimensional collection of zeros with m rows and n columns  
            SET count TO zero  
            
            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    IF element at grid position i j EQUALS one THEN  
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one THEN  
                            SET dp at position i j TO one  
                        ELSE  
                            SET dp at position i j TO minimum of dp at positions i MINUS one j MINUS one, i MINUS one j, and i MINUS one j PLUS one PLUS one  
                        END IF  
                        IF dp at position i j GREATER THAN one THEN  
                            INCREMENT count BY dp at position i j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid IS empty OR first element of grid IS empty THEN  
                RETURN zero  
            END IF  
            SET m TO length of grid  
            SET n TO length of first element of grid  
            CREATE dp AS two dimensional collection of zeros with m rows and n columns  
            SET count TO zero  
            
            FOR i FROM m MINUS one DOWN TO zero  
                FOR j FROM zero TO n MINUS one  
                    IF element at grid position i j EQUALS one THEN  
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one THEN  
                            SET dp at position i j TO one  
                        ELSE  
                            SET dp at position i j TO minimum of dp at positions i PLUS one j MINUS one, i PLUS one j, and i PLUS one j PLUS one PLUS one  
                        END IF  
                        IF dp at position i j GREATER THAN one THEN  
                            INCREMENT count BY dp at position i j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            
            RETURN count  
        END FUNCTION  
        
        RETURN result of count_pyramids_from_top with grid PLUS result of count_pyramids_from_bottom with grid  
    END FUNCTION  
END CLASS