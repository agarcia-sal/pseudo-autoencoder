CLASS TrieNode  
    FUNCTION __init__()  
        SET children TO empty dictionary  
        SET count TO zero  
    END FUNCTION  
END CLASS

CLASS Trie  
    FUNCTION __init__(bit_length)  
        ASSIGN reference TO a new TrieNode AS root  
        SET bit_length TO bit_length  
    END FUNCTION  

    FUNCTION insert(num)  
        ASSIGN reference TO root AS node  
        FOR index FROM bit_length TO zero DECREMENT BY one  
            SET bit TO the result of shifting num RIGHT BY index AND taking the remainder modulo two  
            IF bit NOT IN node children  
                ASSIGN reference TO a new TrieNode TO node children at key bit  
            END IF  
            ASSIGN reference TO node children at key bit AS node  
            INCREMENT node count BY one  
        END FOR  
    END FUNCTION  

    FUNCTION count_less_than(num, threshold)  
        SET count TO zero  
        ASSIGN reference TO root AS node  
        FOR index FROM bit_length TO zero DECREMENT BY one  
            IF node DOES NOT EXIST  
                BREAK  
            END IF  
            SET bit TO the result of shifting num RIGHT BY index AND taking the remainder modulo two  
            SET threshold_bit TO the result of shifting threshold RIGHT BY index AND taking the remainder modulo two  
            IF threshold_bit EQUALS one  
                INCREMENT count BY the count of node children at key bit IF EXISTS OTHERWISE zero  
                ASSIGN reference TO node children at key bit XOR one  
            ELSE  
                ASSIGN reference TO node children at key bit  
            END IF  
        END FOR  
        RETURN count  
    END FUNCTION  
END CLASS

CLASS Solution  
    FUNCTION countPairs(nums, low, high)  
        ASSIGN reference TO a new Trie AS trie  
        SET nice_pairs TO zero  
        FOR each num IN nums  
            INCREMENT nice_pairs BY the result of trie count_less_than with num and high PLUS one MINUS the result of trie count_less_than with num and low  
            CALL trie insert with num  
        END FOR  
        RETURN nice_pairs  
    END FUNCTION  
END CLASS