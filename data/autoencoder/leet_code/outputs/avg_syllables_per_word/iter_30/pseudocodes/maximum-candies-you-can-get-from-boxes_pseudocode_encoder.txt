CLASS Solution  
    FUNCTION maxCandies WITH PARAMETERS status keys containedBoxes initialBoxes  
        ASSIGN reference TO set of elements of initialBoxes AS boxes_we_have  
        ASSIGN reference TO empty set AS keys_we_have  
        SET total_candies TO zero  
        SET progress_made TO true  
        WHILE progress_made HOLDS  
            SET progress_made TO false  
            FOR each box IN COPY OF boxes_we_have AS list  
                IF element at position box OF status EQUALS one OR box IN keys_we_have  
                    INCREMENT total_candies BY element at position box OF candies  
                    ADD elements FROM collection at position box OF keys TO keys_we_have  
                    ADD elements FROM collection at position box OF containedBoxes TO boxes_we_have  
                    REMOVE box FROM boxes_we_have  
                    SET progress_made TO true  
                END IF  
            END FOR  
        END WHILE  
        RETURN total_candies  
    END FUNCTION  
END CLASS