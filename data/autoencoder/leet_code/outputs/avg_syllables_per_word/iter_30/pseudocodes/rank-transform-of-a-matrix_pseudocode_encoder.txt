CLASS UnionFind  
    FUNCTION __init__(self, size)  
        SET self.parent TO list of numbers from zero TO size MINUS one  
    END FUNCTION  

    FUNCTION find(self, u)  
        IF element at position u OF self.parent NOT EQUALS u  
            SET element at position u OF self.parent TO self.find(element at position u OF self.parent)  
        END IF  
        RETURN element at position u OF self.parent  
    END FUNCTION  

    FUNCTION union(self, u, v)  
        SET root_u TO self.find(u)  
        SET root_v TO self.find(v)  
        IF root_u NOT EQUALS root_v  
            SET element at position root_u OF self.parent TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform(self, matrix)  
        SET m TO the LENGTH OF matrix  
        SET n TO the LENGTH OF element at position zero OF matrix  
        SET value_to_indices TO a new default dictionary of list  
        
        FOR r FROM zero TO m MINUS one  
            FOR c FROM zero TO n MINUS one  
                APPEND tuple of r and c TO value_to_indices[element at position r AND c OF matrix]  
            END FOR  
        END FOR  
        
        SET row_rank TO list of zero repeated m times  
        SET col_rank TO list of zero repeated n times  
        SET result TO list of lists of zero with dimensions m BY n  
        
        FOR each value IN sorted keys OF value_to_indices  
            SET uf TO a new UnionFind with size m PLUS n  
            SET rank TO a new default dictionary of integer  
            
            FOR each tuple r, c IN value_to_indices[value]  
                CALL uf.union(r, c PLUS m)  
            END FOR  
            
            FOR each tuple r, c IN value_to_indices[value]  
                SET root TO uf.find(r)  
                SET element at position root OF rank TO the maximum OF element at position root OF rank AND the maximum OF element at position r OF row_rank AND element at position c OF col_rank PLUS one  
            END FOR  
            
            FOR each tuple r, c IN value_to_indices[value]  
                SET root TO uf.find(r)  
                SET element at position r AND c OF result TO element at position root OF rank  
                SET element at position r OF row_rank TO element at position root OF rank  
                SET element at position c OF col_rank TO element at position root OF rank  
            END FOR  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS