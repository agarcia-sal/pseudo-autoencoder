CLASS Solution  
    FUNCTION countPalindromicSubsequences(s)  
        SET MOD TO one billion PLUS seven  
        SET n TO the LENGTH OF s  
        
        SET next_occurrence TO a LIST OF four LISTS each of LENGTH n FILLED WITH minus one  
        SET prev_occurrence TO a LIST OF four LISTS each of LENGTH n FILLED WITH minus one  
        
        FOR c FROM zero TO three  
            SET char TO the CHARACTER REPRESENTED BY the CODE OF lowercase a PLUS c  
            SET last TO minus one  
            FOR i FROM zero TO n MINUS one  
                IF the CHARACTER at position i OF s EQUALS char THEN  
                    SET last TO i  
                END IF  
                SET prev_occurrence at position c and i TO last  
            END FOR  
            
            SET last TO minus one  
            FOR i FROM n MINUS one DOWN TO zero  
                IF the CHARACTER at position i OF s EQUALS char THEN  
                    SET last TO i  
                END IF  
                SET next_occurrence at position c and i TO last  
            END FOR  
        END FOR  
        
        SET dp TO a LIST OF n LISTS each of LENGTH n FILLED WITH zero  
        
        FOR i FROM zero TO n MINUS one  
            SET dp at i and i TO one  
        END FOR  
        
        FOR length FROM two TO n  
            FOR i FROM zero TO n MINUS length  
                SET j TO i PLUS length MINUS one  
                FOR c FROM zero TO three  
                    SET char TO the CHARACTER REPRESENTED BY the CODE OF lowercase a PLUS c  
                    SET left TO next_occurrence at position c and i  
                    SET right TO prev_occurrence at position c and j  
                    
                    IF left GREATER THAN j OR right LESS THAN i THEN  
                        CONTINUE  
                    ELSE IF left EQUALS right THEN  
                        SET dp at i and j TO the REMAINDER OF dp at i and j PLUS one DIVIDED BY MOD  
                    ELSE  
                        SET dp at i and j TO the REMAINDER OF dp at i and j PLUS dp at left PLUS one and right MINUS one PLUS two DIVIDED BY MOD  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN dp at zero and n MINUS one  
    END FUNCTION  
END CLASS