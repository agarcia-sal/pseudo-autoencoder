CLASS Solution  
    FUNCTION countPyramids(grid)  
        FUNCTION count_pyramids_from_top(grid)  
            IF grid IS empty OR the FIRST element of grid IS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF the FIRST element of grid  
            SET dp TO a new list containing m elements each of which is a list of n zeros  
            SET count TO zero  
            FOR i FROM zero TO m MINUS one  
                FOR j FROM zero TO n MINUS one  
                    IF the element at position i OF grid at position j EQUALS one  
                        IF i EQUALS zero OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET the element at position i OF dp at position j TO one  
                        ELSE  
                            SET the element at position i OF dp at position j TO the minimum of the element at position i MINUS one OF dp at position j MINUS one, the element at position i MINUS one OF dp at position j, the element at position i MINUS one OF dp at position j PLUS one PLUS one  
                        END IF  
                        IF the element at position i OF dp at position j GREATER THAN one  
                            INCREMENT count BY the element at position i OF dp at position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        FUNCTION count_pyramids_from_bottom(grid)  
            IF grid IS empty OR the FIRST element of grid IS empty  
                RETURN zero  
            END IF  
            SET m TO the LENGTH OF grid  
            SET n TO the LENGTH OF the FIRST element of grid  
            SET dp TO a new list containing m elements each of which is a list of n zeros  
            SET count TO zero  
            FOR i FROM m MINUS one DOWN TO zero  
                FOR j FROM zero TO n MINUS one  
                    IF the element at position i OF grid at position j EQUALS one  
                        IF i EQUALS m MINUS one OR j EQUALS zero OR j EQUALS n MINUS one  
                            SET the element at position i OF dp at position j TO one  
                        ELSE  
                            SET the element at position i OF dp at position j TO the minimum of the element at position i PLUS one OF dp at position j MINUS one, the element at position i PLUS one OF dp at position j, the element at position i PLUS one OF dp at position j PLUS one PLUS one  
                        END IF  
                        IF the element at position i OF dp at position j GREATER THAN one  
                            INCREMENT count BY the element at position i OF dp at position j MINUS one  
                        END IF  
                    END IF  
                END FOR  
            END FOR  
            RETURN count  
        END FUNCTION  
        RETURN the result of count_pyramids_from_top(grid) PLUS the result of count_pyramids_from_bottom(grid)  
    END FUNCTION  
END CLASS