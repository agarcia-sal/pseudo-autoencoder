CLASS Solution  
    FUNCTION numSquarefulPerms WITH PARAMETER nums  
        FUNCTION is_square WITH PARAMETER n  
            RETURN square of integer square root of n EQUALS n  
        END FUNCTION  
        
        FUNCTION backtrack WITH PARAMETERS path AND count  
            IF length of path EQUALS length of nums  
                RETURN one  
            END IF  
            
            SET ans TO zero  
            FOR each x IN count keys  
                IF value at x in count GREATER THAN zero AND (path is empty OR is_square WITH PARAMETER sum of element at last position of path PLUS x)  
                    DECREMENT value at x in count BY one  
                    INCREMENT ans BY result of backtrack WITH PARAMETERS path appended with x AND count  
                    INCREMENT value at x in count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO frequency mapping of elements in nums  
        RETURN result of backtrack WITH PARAMETERS empty list AND count  
    END FUNCTION  
END CLASS