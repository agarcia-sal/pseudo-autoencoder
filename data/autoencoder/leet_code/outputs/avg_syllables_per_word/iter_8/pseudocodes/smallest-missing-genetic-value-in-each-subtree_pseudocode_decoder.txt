CLASS Solution  
    FUNCTION smallestMissingValueSubtree(parents, nums)  
        SET n TO LENGTH OF parents  
        SET tree TO empty mapping of lists  
        
        FOR i FROM 1 TO n MINUS 1  
            APPEND i TO tree AT KEY parents[i]  
        
        SET node_with_one TO -1  
        FOR i FROM 0 TO n MINUS 1  
            IF nums[i] EQUALS 1 THEN  
                SET node_with_one TO i  
                BREAK  
        
        IF node_with_one EQUALS -1 THEN  
            RETURN list of 1 REPEATED n TIMES  
        
        SET result TO list of 1 REPEATED n TIMES  
        SET visited TO empty set  
        
        FUNCTION dfs(node)  
            ADD node TO visited  
            SET genetic_values TO set containing nums[node]  
            FOR each child IN tree[node]  
                IF child NOT IN visited THEN  
                    SET returned_values TO dfs(child)  
                    UPDATE genetic_values WITH returned_values  
            SET smallest_missing TO 1  
            WHILE smallest_missing IN genetic_values DO  
                INCREMENT smallest_missing BY 1  
            SET result[node] TO smallest_missing  
            RETURN genetic_values  
        END FUNCTION  
        
        SET path TO empty list  
        SET current TO node_with_one  
        WHILE current NOT EQUAL TO -1 DO  
            APPEND current TO path  
            SET current TO parents[current]  
        
        SET path_set TO set containing elements of path  
        FOR each node IN reverse order of path DO  
            IF node IN visited THEN  
                CONTINUE  
            CALL dfs(node)  
        
        RETURN result  
    END FUNCTION  
END CLASS