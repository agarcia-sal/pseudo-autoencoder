CLASS Solution  
    FUNCTION reversePairs(nums)  
        FUNCTION merge_and_count(nums, start, end)  
            IF start GREATER THAN OR EQUAL TO end THEN  
                RETURN 0  
            END IF  
              
            SET mid TO start PLUS end DIVIDED BY 2  
            SET count TO merge_and_count(nums, start, mid) PLUS merge_and_count(nums, mid PLUS 1, end)  
              
            SET j TO mid PLUS 1  
            FOR i FROM start TO mid DO  
                WHILE j LESS THAN OR EQUAL TO end AND nums[i] GREATER THAN 2 TIMES nums[j] DO  
                    INCREMENT j BY 1  
                END WHILE  
                INCREMENT count BY j MINUS (mid PLUS 1)  
            END FOR  
              
            SET merged TO empty list  
            SET left TO start  
            SET right TO mid PLUS 1  
            WHILE left LESS THAN OR EQUAL TO mid AND right LESS THAN OR EQUAL TO end DO  
                IF nums[left] LESS THAN OR EQUAL TO nums[right] THEN  
                    APPEND nums[left] TO merged  
                    INCREMENT left BY 1  
                ELSE  
                    APPEND nums[right] TO merged  
                    INCREMENT right BY 1  
                END IF  
            END WHILE  
              
            APPEND elements FROM nums[left TO mid] TO merged  
            APPEND elements FROM nums[right TO end] TO merged  
              
            SET elements FROM nums[start TO end] TO merged  
              
            RETURN count  
        END FUNCTION  
          
        RETURN merge_and_count(nums, 0, LENGTH OF nums MINUS 1)  
    END FUNCTION  
END CLASS