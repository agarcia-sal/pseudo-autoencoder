CLASS Solution  
    FUNCTION countSmaller(nums)  
        SET sorted_nums TO unique values of nums sorted in ascending order  
        SET rank TO dictionary mapping each value in sorted_nums to its position index plus one  
        SET bit TO list of zeros WITH LENGTH of sorted_nums plus one  
        
        FUNCTION get_sum(idx)  
            SET res TO 0  
            WHILE idx GREATER THAN 0  
                INCREMENT res BY bit at position idx  
                SET idx TO idx MINUS the lowest set bit of idx  
            RETURN res  
        END FUNCTION  
        
        FUNCTION update(idx, delta)  
            WHILE idx LESS THAN LENGTH OF bit  
                INCREMENT bit at position idx BY delta  
                SET idx TO idx PLUS the lowest set bit of idx  
        END FUNCTION  
        
        SET counts TO empty list  
        FOR each num IN nums iterated from last to first  
            SET r TO rank at num  
            APPEND get_sum(r MINUS 1) TO counts  
            CALL update(r, 1)  
        
        RETURN counts reversed  
    END FUNCTION  
END CLASS