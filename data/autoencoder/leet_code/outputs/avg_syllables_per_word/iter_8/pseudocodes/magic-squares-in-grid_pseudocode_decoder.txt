CLASS Solution  
    FUNCTION numMagicSquaresInside(grid)  
        FUNCTION is_magic(i, j)  
            IF grid at position (i, j) IS NOT 5  
                RETURN False  
            END IF  
            
            SET numbers TO empty set  
            FOR x FROM i MINUS 1 TO i PLUS 1  
                FOR y FROM j MINUS 1 TO j PLUS 1  
                    IF grid at position (x, y) IS LESS THAN 1 OR GREATER THAN 9 OR grid at position (x, y) IS IN numbers  
                        RETURN False  
                    END IF  
                    ADD grid at position (x, y) TO numbers  
                END FOR  
            END FOR  
            
            FOR start FROM i MINUS 1 TO i PLUS 1  
                IF sum of grid row at start from column (j MINUS 1) TO (j PLUS 1) IS NOT 15 OR  
                   sum of grid column at start from row (i MINUS 1) TO (i PLUS 1) IS NOT 15  
                    RETURN False  
                END IF  
            END FOR  
            
            IF sum of diagonal from (i MINUS 1, j MINUS 1) THROUGH (i, j) TO (i PLUS 1, j PLUS 1) IS NOT 15 OR  
               sum of diagonal from (i MINUS 1, j PLUS 1) THROUGH (i, j) TO (i PLUS 1, j MINUS 1) IS NOT 15  
                RETURN False  
            END IF  
            
            RETURN True  
        END FUNCTION  
        
        SET count TO 0  
        SET rows TO LENGTH OF grid  
        SET cols TO LENGTH OF grid at index 0  
        
        FOR i FROM 1 TO rows MINUS 2  
            FOR j FROM 1 TO cols MINUS 2  
                IF is_magic(i, j) IS True  
                    INCREMENT count BY 1  
                END IF  
            END FOR  
        END FOR  
        
        RETURN count  
    END FUNCTION  
END CLASS