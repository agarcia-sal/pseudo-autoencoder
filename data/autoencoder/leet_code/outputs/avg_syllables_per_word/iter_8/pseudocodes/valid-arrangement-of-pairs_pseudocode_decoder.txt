CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO a mapping from keys to empty lists  
        SET out_degree TO a counting mapping  
        SET in_degree TO a counting mapping  

        FOR each pair u, v IN pairs  
            APPEND v TO graph at key u  
            INCREMENT out_degree at key u BY 1  
            INCREMENT in_degree at key v BY 1  

        SET start_node TO none  
        FOR each node IN graph keys  
            IF out_degree at node IS EQUAL TO in_degree at node PLUS 1  
                SET start_node TO node  
                BREAK loop  
        IF start_node IS none  
            SET start_node TO any key from graph  

        SET path TO empty list  
        SET stack TO list containing start_node  

        WHILE stack IS NOT empty  
            SET u TO last element in stack  
            IF graph at key u IS NOT empty  
                REMOVE last element v FROM graph at key u  
                APPEND v TO stack  
            ELSE  
                REMOVE last element FROM stack AND APPEND it TO path  

        REVERSE path  

        SET result TO empty list  
        FOR i FROM 0 TO LENGTH OF path MINUS 2  
            APPEND list containing path at i AND path at i PLUS 1 TO result  

        RETURN result  
    END FUNCTION  
END CLASS