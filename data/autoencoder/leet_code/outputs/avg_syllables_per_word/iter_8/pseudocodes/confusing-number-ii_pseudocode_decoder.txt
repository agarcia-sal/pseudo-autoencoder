CLASS Solution  
    FUNCTION confusingNumberII(n)  
        SET rotate_map TO mapping of digits 0 to 0, 1 to 1, 6 to 9, 8 to 8, 9 to 6  
        SET valid_digits TO list containing 0, 1, 6, 8, 9  
        
        FUNCTION is_confusing(num)  
            SET original_num TO num  
            SET rotated_num TO 0  
            WHILE num GREATER THAN 0  
                SET digit TO remainder of num DIVIDED BY 10  
                SET rotated_num TO rotated_num MULTIPLIED BY 10 PLUS rotate_map at digit  
                SET num TO num DIVIDED BY 10 (integer division)  
            IF rotated_num NOT EQUAL TO original_num  
                RETURN true  
            ELSE  
                RETURN false  
        END FUNCTION  
        
        FUNCTION count_confusing_numbers(limit, current)  
            IF current GREATER THAN limit  
                RETURN 0  
            SET count TO 1 IF current NOT EQUAL TO 0 AND is_confusing(current) IS true ELSE 0  
            FOR each digit IN valid_digits  
                SET new_number TO current MULTIPLIED BY 10 PLUS digit  
                IF new_number EQUAL TO 0  
                    CONTINUE to next digit  
                INCREMENT count BY count_confusing_numbers(limit, new_number)  
            RETURN count  
        END FUNCTION  
        
        RETURN count_confusing_numbers(n, 0)  
    END FUNCTION  
END CLASS