CLASS Solution  
    FUNCTION countPalindromicSubsequences(s)  
        SET MOD TO ten power nine PLUS seven  
        SET n TO LENGTH OF s  
        
        SET next_occurrence TO 4 BY n MATRIX FILLED WITH -1  
        SET prev_occurrence TO 4 BY n MATRIX FILLED WITH -1  
        
        FOR c FROM 0 TO 3  
            SET char TO character at position (ASCII of 'a' PLUS c)  
            SET last TO -1  
            FOR i FROM 0 TO n MINUS 1  
                IF character at s position i EQUALS char THEN  
                    SET last TO i  
                SET prev_occurrence at c i TO last  
            END FOR  
            
            SET last TO -1  
            FOR i FROM n MINUS 1 DOWNTO 0  
                IF character at s position i EQUALS char THEN  
                    SET last TO i  
                SET next_occurrence at c i TO last  
            END FOR  
        END FOR  
        
        SET dp TO n BY n MATRIX FILLED WITH 0  
        
        FOR i FROM 0 TO n MINUS 1  
            SET dp at i i TO 1  
        END FOR  
        
        FOR length FROM 2 TO n  
            FOR i FROM 0 TO n MINUS length  
                SET j TO i PLUS length MINUS 1  
                FOR c FROM 0 TO 3  
                    SET char TO character at position (ASCII of 'a' PLUS c)  
                    SET left TO next_occurrence at c i  
                    SET right TO prev_occurrence at c j  
                    
                    IF left GREATER THAN j OR right LESS THAN i THEN  
                        CONTINUE TO NEXT c  
                    ELSE IF left EQUALS right THEN  
                        SET dp at i j TO (dp at i j PLUS 1) MODULO MOD  
                    ELSE  
                        SET dp at i j TO (dp at i j PLUS dp at (left PLUS 1) (right MINUS 1) PLUS 2) MODULO MOD  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN dp at 0 (n MINUS 1)  
    END FUNCTION  
END CLASS