CLASS Solution  
    FUNCTION validTicTacToe(board)  
        SET countX TO 0  
        SET countO TO 0  
        FOR each row IN board  
            INCREMENT countX BY number of occurrences of 'X' in row  
            INCREMENT countO BY number of occurrences of 'O' in row  
        
        IF countX LESS THAN countO OR countX GREATER THAN countO PLUS 1  
            RETURN False  
        
        FUNCTION check_win(player)  
            FOR each row IN board  
                IF row EQUALS player repeated 3 times  
                    RETURN True  
            
            FOR col FROM 0 TO 2  
                IF board at row 0 and col EQUALS player AND board at row 1 and col EQUALS player AND board at row 2 and col EQUALS player  
                    RETURN True  
            
            IF board at 0,0 EQUALS player AND board at 1,1 EQUALS player AND board at 2,2 EQUALS player  
                RETURN True  
            IF board at 0,2 EQUALS player AND board at 1,1 EQUALS player AND board at 2,0 EQUALS player  
                RETURN True  
            
            RETURN False  
        
        SET winX TO result of check_win with argument 'X'  
        SET winO TO result of check_win with argument 'O'  
        
        IF winX AND winO  
            RETURN False  
        IF winX AND countX EQUALS countO  
            RETURN False  
        IF winO AND countX NOT EQUAL TO countO  
            RETURN False  
        
        RETURN True  
    END FUNCTION  
END CLASS