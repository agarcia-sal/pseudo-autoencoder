CLASS Solution  
    FUNCTION maxValueOfCoins(piles, k)  
        SET n TO LENGTH OF piles  
        INITIALIZE dp AS 2D list of zeros with dimensions (n + 1) BY (k + 1)  
        
        FOR i FROM 1 TO n  
            FOR j FROM 1 TO k  
                SET current_pile TO piles AT POSITION (i MINUS 1)  
                SET current_value TO 0  
                FOR l FROM 0 TO MINIMUM OF j AND LENGTH OF current_pile  
                    IF l GREATER THAN 0  
                        INCREMENT current_value BY current_pile AT POSITION (l MINUS 1)  
                    SET dp AT POSITION i,j TO MAXIMUM OF dp AT POSITION i,j AND dp AT POSITION (i MINUS 1),(j MINUS l) PLUS current_value  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN dp AT POSITION n,k  
    END FUNCTION  
END CLASS