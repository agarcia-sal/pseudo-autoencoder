CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN 0  
            END IF  
            IF memo CONTAINS KEY (l, r, k) THEN  
                RETURN memo VALUE FOR KEY (l, r, k)  
            END IF  
            
            WHILE r GREATER THAN l AND boxes AT INDEX r EQUALS boxes AT INDEX r MINUS 1  
                DECREMENT r BY 1  
                INCREMENT k BY 1  
            END WHILE  
            
            SET res TO dp(l, r MINUS 1, 0, memo) PLUS (k PLUS 1) MULTIPLIED BY (k PLUS 1)  
            
            FOR i FROM l TO r MINUS 1  
                IF boxes AT INDEX i EQUALS boxes AT INDEX r THEN  
                    SET res TO MAXIMUM OF res AND dp(l, i, k PLUS 1, memo) PLUS dp(i PLUS 1, r MINUS 1, 0, memo)  
                END IF  
            END FOR  
            
            SET memo AT KEY (l, r, k) TO res  
            RETURN res  
        END FUNCTION  
        
        RETURN dp(0, LENGTH OF boxes MINUS 1, 0, EMPTY DICTIONARY)  
    END FUNCTION  
END CLASS