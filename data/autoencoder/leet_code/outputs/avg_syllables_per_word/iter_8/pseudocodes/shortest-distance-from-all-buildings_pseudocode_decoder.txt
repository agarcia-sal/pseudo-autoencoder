CLASS Solution  
    FUNCTION shortestDistance(grid)  
        IF grid IS EMPTY OR grid AT POSITION 0 IS EMPTY  
            RETURN -1  
        
        SET m TO LENGTH OF grid  
        SET n TO LENGTH OF grid AT POSITION 0  
        SET total_distance TO two-dimensional list of zeros with dimensions m BY n  
        SET reach_count TO two-dimensional list of zeros with dimensions m BY n  
        SET building_count TO 0  
        
        SET directions TO list of (1, 0), (-1, 0), (0, 1), (0, -1)  
        
        FUNCTION bfs(start_x, start_y)  
            INITIALIZE queue WITH start_x AND start_y  
            SET visited TO two-dimensional list of False with dimensions m BY n  
            SET distance TO 0  
            SET reachable TO 0  
            
            WHILE queue IS NOT EMPTY  
                SET size TO LENGTH OF queue  
                INCREMENT distance BY 1  
                FOR each index FROM 0 TO size MINUS 1  
                    REMOVE first element FROM queue AND ASSIGN TO x, y  
                    FOR each dx, dy IN directions  
                        SET nx TO x PLUS dx  
                        SET ny TO y PLUS dy  
                        IF nx IS GREATER THAN OR EQUAL TO 0 AND nx IS LESS THAN m  
                        AND ny IS GREATER THAN OR EQUAL TO 0 AND ny IS LESS THAN n  
                        AND visited AT nx, ny IS False  
                        AND grid AT nx, ny IS 0  
                            SET visited AT nx, ny TO True  
                            APPEND nx, ny TO queue  
                            INCREMENT total_distance AT nx, ny BY distance  
                            INCREMENT reach_count AT nx, ny BY 1  
                            INCREMENT reachable BY 1  
            RETURN reachable  
        END FUNCTION  
        
        FOR i FROM 0 TO m MINUS 1  
            FOR j FROM 0 TO n MINUS 1  
                IF grid AT i, j IS 1  
                    INCREMENT building_count BY 1  
                    IF bfs(i, j) IS LESS THAN building_count MINUS 1  
                        RETURN -1  
        
        SET min_distance TO infinity  
        FOR i FROM 0 TO m MINUS 1  
            FOR j FROM 0 TO n MINUS 1  
                IF grid AT i, j IS 0 AND reach_count AT i, j IS EQUAL TO building_count  
                    SET min_distance TO minimum OF min_distance AND total_distance AT i, j  
        
        IF min_distance IS EQUAL TO infinity  
            RETURN -1  
        ELSE  
            RETURN min_distance  
    END FUNCTION  
END CLASS