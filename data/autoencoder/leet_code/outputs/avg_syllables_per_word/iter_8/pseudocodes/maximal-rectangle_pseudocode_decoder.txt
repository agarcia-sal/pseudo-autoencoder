CLASS Solution  
    FUNCTION maximalRectangle(matrix)  
        IF matrix IS empty OR first row of matrix IS empty THEN  
            RETURN 0  
        END IF  
        
        SET rows TO length of matrix  
        SET cols TO length of first row of matrix  
        SET heights TO list of zeros with size cols  
        SET max_area TO 0  
        
        FOR i FROM 0 TO rows MINUS 1 DO  
            FOR j FROM 0 TO cols MINUS 1 DO  
                IF matrix at position i, j EQUALS '1' THEN  
                    INCREMENT heights at position j BY 1  
                ELSE  
                    SET heights at position j TO 0  
                END IF  
            END FOR  
            
            SET max_area TO greater of max_area and result of largestRectangleArea with heights  
        END FOR  
        
        RETURN max_area  
    END FUNCTION  
      
    FUNCTION largestRectangleArea(heights)  
        SET stack TO empty list  
        SET max_area TO 0  
        SET index TO 0  
        
        WHILE index IS LESS THAN length of heights DO  
            IF stack IS empty OR heights at position index IS GREATER THAN OR EQUAL TO heights at position at top of stack THEN  
                APPEND index TO stack  
                INCREMENT index BY 1  
            ELSE  
                SET top_of_stack TO pop from stack  
                IF stack IS NOT empty THEN  
                    SET width TO index MINUS top element of stack MINUS 1  
                ELSE  
                    SET width TO index  
                END IF  
                SET area TO heights at top_of_stack MULTIPLIED BY width  
                SET max_area TO greater of max_area and area  
            END IF  
        END WHILE  
        
        WHILE stack IS NOT empty DO  
            SET top_of_stack TO pop from stack  
            IF stack IS NOT empty THEN  
                SET width TO index MINUS top element of stack MINUS 1  
            ELSE  
                SET width TO index  
            END IF  
            SET area TO heights at top_of_stack MULTIPLIED BY width  
            SET max_area TO greater of max_area and area  
        END WHILE  
        
        RETURN max_area  
    END FUNCTION  
END CLASS