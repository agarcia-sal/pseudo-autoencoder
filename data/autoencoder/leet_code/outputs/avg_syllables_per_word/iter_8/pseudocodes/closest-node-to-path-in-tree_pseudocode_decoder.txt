CLASS Solution  
    FUNCTION closestNode(n, edges, query)  
        SET graph TO a new mapping with default empty list  
        FOR each u, v IN edges  
            APPEND v TO graph[u]  
            APPEND u TO graph[v]  
        
        FUNCTION find_path(start, end)  
            SET queue TO a new deque containing (start, list containing start)  
            SET visited TO a new set containing start  
            
            WHILE queue is not empty  
                SET node, path TO the first element removed from queue  
                IF node EQUALS end  
                    RETURN path  
                FOR each neighbor IN graph[node]  
                    IF neighbor NOT IN visited  
                        ADD neighbor TO visited  
                        APPEND (neighbor, path concatenated with neighbor) TO queue  
        
        FUNCTION closest_node_on_path(path, node)  
            SET min_distance TO infinity  
            SET closest_node TO null  
            FOR each p IN path  
                SET distance TO length of find_path(p, node) MINUS 1  
                IF distance LESS THAN min_distance  
                    SET min_distance TO distance  
                    SET closest_node TO p  
            RETURN closest_node  
        
        SET answer TO an empty list  
        FOR each start, end, node IN query  
            SET path TO find_path(start, end)  
            APPEND closest_node_on_path(path, node) TO answer  
        
        RETURN answer  
    END FUNCTION  
END CLASS