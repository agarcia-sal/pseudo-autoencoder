CLASS Solution
    FUNCTION numDistinctIslands2(grid)
        FUNCTION dfs(x, y, island)
            IF x LESS THAN 0 OR x GREATER THAN OR EQUAL TO LENGTH OF grid OR y LESS THAN 0 OR y GREATER THAN OR EQUAL TO LENGTH OF grid AT INDEX 0 OR grid AT x AT y EQUALS 0 THEN
                RETURN
            END IF
            SET grid AT x AT y TO 0
            APPEND (x, y) TO island
            CALL dfs WITH (x PLUS 1, y, island)
            CALL dfs WITH (x MINUS 1, y, island)
            CALL dfs WITH (x, y PLUS 1, island)
            CALL dfs WITH (x, y MINUS 1, island)
        END FUNCTION

        FUNCTION normalize(island)
            SET shapes TO empty list
            FOR each (dx, dy) IN list of (1, 1), (1, -1), (-1, 1), (-1, -1)
                SET new_island TO empty list
                FOR each (x, y) IN island
                    APPEND (x TIMES dx, y TIMES dy) TO new_island
                END FOR
                SORT new_island
                SET min_x TO minimum x VALUE IN new_island
                SET min_y TO minimum y VALUE IN new_island
                APPEND tuple of (each (x MINUS min_x, y MINUS min_y) IN new_island) TO shapes
            END FOR

            FOR i FROM 0 TO LENGTH OF shapes MINUS 1
                APPEND tuple of (each (y, NEGATIVE x) FOR each (x, y) IN shapes AT i) TO shapes
            END FOR

            RETURN minimum tuple IN shapes
        END FUNCTION

        SET islands TO empty set
        FOR i FROM 0 TO LENGTH OF grid MINUS 1
            FOR j FROM 0 TO LENGTH OF grid AT INDEX 0 MINUS 1
                IF grid AT i AT j EQUALS 1 THEN
                    SET island TO empty list
                    CALL dfs WITH (i, j, island)
                    ADD normalize(island) TO islands
                END IF
            END FOR
        END FOR

        RETURN LENGTH OF islands
    END FUNCTION
END CLASS