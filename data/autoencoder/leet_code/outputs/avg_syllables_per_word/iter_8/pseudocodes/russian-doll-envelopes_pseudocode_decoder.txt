CLASS Solution  
    FUNCTION maxEnvelopes(envelopes)  
        SORT envelopes BY width ascending AND BY height descending WHEN widths are equal  
        SET dp TO empty list  
        FOR each envelope WITH height h IN envelopes  
            SET idx TO position found by binary searching h in dp for insertion  
            IF idx EQUALS length of dp  
                APPEND h TO dp  
            ELSE  
                SET element at idx in dp TO h  
        RETURN length of dp  
    END FUNCTION  
END CLASS