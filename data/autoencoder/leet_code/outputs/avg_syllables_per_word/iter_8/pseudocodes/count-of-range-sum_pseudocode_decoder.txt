CLASS Solution  
    FUNCTION countRangeSum(nums, lower, upper)  
        SET prefix_sums TO list containing 0  
        SET current_sum TO 0  
        SET count TO 0  
        
        FOR each num IN nums  
            SET current_sum TO current_sum plus num  
            SET left TO current_sum minus upper  
            SET right TO current_sum minus lower  
            
            INCREMENT count BY the number of elements in prefix_sums less than or equal to right  
                MINUS the number of elements in prefix_sums strictly less than left  
            
            INSERT current_sum into prefix_sums maintaining sorted order  
        
        RETURN count  
    END FUNCTION  
END CLASS