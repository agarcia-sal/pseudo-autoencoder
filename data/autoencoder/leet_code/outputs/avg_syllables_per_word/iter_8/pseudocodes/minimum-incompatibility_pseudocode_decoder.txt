CLASS Solution  
    FUNCTION minimumIncompatibility(nums, k)  
        SET n TO LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  

        IF any count IN frequency counts of nums IS GREATER THAN k THEN  
            RETURN -1  
        END IF  

        SET subset_incompatibility TO empty map  
        FOR each mask FROM 0 TO 2 RAISED TO n MINUS 1  
            IF count of set bits IN mask IS EQUAL TO subset_size THEN  
                SET elements TO list of nums at positions corresponding to set bits in mask  
                IF unique elements IN elements ARE EQUAL TO subset_size THEN  
                    SET incompatibility TO maximum element OF elements MINUS minimum element OF elements  
                    SET subset_incompatibility at key mask TO incompatibility  
                END IF  
            END IF  
        END FOR  

        SET dp TO list of size 2 RAISED TO n FILLED WITH infinity  
        SET dp at index 0 TO 0  

        FOR each mask FROM 0 TO 2 RAISED TO n MINUS 1  
            IF count of set bits IN mask MODULO subset_size IS NOT EQUAL TO 0 THEN  
                CONTINUE  
            END IF  
            FOR each subset_mask IN keys of subset_incompatibility  
                IF subset_mask IS SUBSET OF mask THEN  
                    SET dp at index mask TO minimum OF dp at index mask AND dp at index mask WITHOUT subset_mask PLUS subset_incompatibility at subset_mask  
                END IF  
            END FOR  
        END FOR  

        IF dp at index 2 RAISED TO n MINUS 1 IS EQUAL TO infinity THEN  
            RETURN -1  
        ELSE  
            RETURN dp at index 2 RAISED TO n MINUS 1  
        END IF  
    END FUNCTION  
END CLASS