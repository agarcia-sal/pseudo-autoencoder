CLASS Solution  
    FUNCTION evaluate(expression)  
        FUNCTION get_tokens(expression)  
            SET tokens TO empty list  
            SET buf TO empty string  
            SET depth TO 0  
            FOR each char IN expression  
                IF char EQUALS space AND depth EQUALS 0 THEN  
                    APPEND buf TO tokens  
                    SET buf TO empty string  
                ELSE  
                    IF char EQUALS '(' THEN  
                        INCREMENT depth BY 1  
                    ELSE IF char EQUALS ')' THEN  
                        DECREMENT depth BY 1  
                    END IF  
                    APPEND char TO buf  
                END IF  
            END FOR  
            IF buf IS NOT empty THEN  
                APPEND buf TO tokens  
            END IF  
            RETURN tokens  
        END FUNCTION  

        FUNCTION evaluate_expression(tokens, context)  
            IF tokens AT position 0 EQUALS 'add' THEN  
                RETURN evaluate_expression(tokens AT position 1, context) PLUS evaluate_expression(tokens AT position 2, context)  
            ELSE IF tokens AT position 0 EQUALS 'mult' THEN  
                RETURN evaluate_expression(tokens AT position 1, context) TIMES evaluate_expression(tokens AT position 2, context)  
            ELSE IF tokens AT position 0 EQUALS 'let' THEN  
                SET new_context TO COPY OF context  
                SET i TO 1  
                WHILE i LESS THAN LENGTH OF tokens MINUS 1  
                    SET var TO tokens AT position i  
                    SET expr TO tokens AT position i PLUS 1  
                    SET new_context[var] TO evaluate_expression(expr, new_context)  
                    INCREMENT i BY 2  
                END WHILE  
                RETURN evaluate_expression(tokens AT last position, new_context)  
            ELSE  
                TRY  
                    RETURN CONVERT tokens AT position 0 TO integer  
                CATCH CONVERSION error  
                    RETURN context VALUE FOR tokens AT position 0  
                END TRY  
            END IF  
        END FUNCTION  

        FUNCTION parse_expression(expression)  
            IF expression AT position 0 IS NOT '(' THEN  
                RETURN expression  
            END IF  
            SET tokens TO get_tokens(expression SUBSTRING FROM position 1 TO second last position)  
            RETURN LIST OF parse_expression(token) FOR EACH token IN tokens  
        END FUNCTION  

        SET parsed_expression TO parse_expression(expression)  
        RETURN evaluate_expression(parsed_expression, empty dictionary)  
    END FUNCTION  
END CLASS