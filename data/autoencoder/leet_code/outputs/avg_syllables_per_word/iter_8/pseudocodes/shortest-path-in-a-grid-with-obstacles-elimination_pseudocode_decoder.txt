CLASS Solution  
    FUNCTION shortestPath(grid, k)  
        IF grid IS empty OR grid at first row IS empty  
            RETURN -1  
        
        SET m TO LENGTH OF grid  
        SET n TO LENGTH OF grid at first row  
        
        IF k IS GREATER THAN OR EQUAL TO m PLUS n MINUS 2  
            RETURN m PLUS n MINUS 2  
        
        SET directions TO list containing (0, 1), (1, 0), (0, -1), (-1, 0)  
        
        INITIALIZE queue WITH tuple (0, 0, k, 0)  
        INITIALIZE visited set WITH tuple (0, 0, k)  
        
        WHILE queue IS NOT empty  
            SET x, y, remaining_k, steps TO queue REMOVE FIRST ELEMENT  
            
            IF x EQUALS m MINUS 1 AND y EQUALS n MINUS 1  
                RETURN steps  
            
            FOR each dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx IS GREATER THAN OR EQUAL TO 0 AND nx IS LESS THAN m AND ny IS GREATER THAN OR EQUAL TO 0 AND ny IS LESS THAN n  
                    SET new_k TO remaining_k MINUS grid at position nx and ny  
                    
                    IF new_k IS GREATER THAN OR EQUAL TO 0 AND tuple (nx, ny, new_k) IS NOT IN visited  
                        ADD tuple (nx, ny, new_k) TO visited  
                        APPEND tuple (nx, ny, new_k, steps PLUS 1) TO queue  
        
        RETURN -1  
    END FUNCTION  
END CLASS