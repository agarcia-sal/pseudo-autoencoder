CLASS Solution  
    FUNCTION minimumIncompatibility(nums AS List OF Integer, k AS Integer) RETURNS Integer  
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        DEFINE FUNCTION count_occurrences_of_elements(input_list AS List OF Integer) RETURNS Map OF Integer TO Integer  
            CREATE a map to count the number of occurrences of each element in input_list  
            RETURN the map of element counts  
        END FUNCTION  
        
        SET element_counts TO the RESULT OF count_occurrences_of_elements WITH nums  
        
        IF there EXISTS any element_count IN the VALUES OF element_counts SUCH THAT element_count IS GREATER THAN k  
            RETURN negative one  
        END IF  
        
        DEFINE FUNCTION generate_valid_subsets() RETURNS Map OF Integer TO Integer  
            CREATE an empty map named subset_incompatibility  
            FOR each mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
                SET bit_count TO the NUMBER OF positions where the binary representation of mask has one  
                IF bit_count EQUALS subset_size  
                    CREATE an empty list named elements  
                    FOR each index FROM zero TO n MINUS one  
                        IF the bit at position index in mask IS SET  
                            APPEND the element at position index of nums TO elements  
                        END IF  
                    END FOR  
                    CREATE a set named unique_elements FROM elements  
                    IF the SIZE OF unique_elements EQUALS subset_size  
                        SET max_element TO the MAXIMUM value IN elements  
                        SET min_element TO the MINIMUM value IN elements  
                        SET incompatibility_value TO max_element MINUS min_element  
                        ASSIGN the incompatibility_value TO the entry for mask IN subset_incompatibility  
                    END IF  
                END IF  
            END FOR  
            RETURN subset_incompatibility  
        END FUNCTION  
        
        SET subset_incompatibility TO the RESULT OF generate_valid_subsets  
        
        CREATE a list dp WITH two RAISED TO THE POWER OF n ELEMENTS EACH INITIALIZED TO INFINITY  
        SET the element at position zero of dp TO zero  
        
        FOR each mask FROM zero TO two RAISED TO THE POWER OF n MINUS one  
            SET bit_count TO the NUMBER OF positions where the binary representation of mask has one  
            IF the bit_count MODULO subset_size IS NOT EQUAL TO zero  
                CONTINUE to the next iteration of the loop  
            END IF  
            FOR each subset_mask IN the KEYS OF subset_incompatibility  
                IF the bitwise AND of mask AND subset_mask IS EQUAL TO subset_mask  
                    SET current_value TO the element at position mask of dp  
                    SET possible_new_value TO the element at position (bitwise XOR of mask AND subset_mask) of dp PLUS the value at subset_mask in subset_incompatibility  
                    IF possible_new_value IS LESS THAN current_value  
                        SET element at position mask of dp TO possible_new_value  
                    END IF  
                END IF  
            END FOR  
        END FOR  
        
        SET full_mask TO two RAISED TO THE POWER OF n MINUS one  
        IF the element at position full_mask of dp IS NOT EQUAL TO INFINITY  
            RETURN the element at position full_mask of dp  
        ELSE  
            RETURN negative one  
        END IF  
    END FUNCTION  
END CLASS