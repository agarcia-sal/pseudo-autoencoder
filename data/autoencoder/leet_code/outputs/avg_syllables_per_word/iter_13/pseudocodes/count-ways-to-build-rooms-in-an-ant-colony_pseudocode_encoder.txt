CLASS Solution  
    FUNCTION waysToBuildRooms(prevRoom)  
        SET n TO the LENGTH OF prevRoom  
        CALL initialize an empty mapping graph FROM each key TO an empty list  
        FOR each room FROM one TO n MINUS one  
            APPEND room TO the list at key element at position room of prevRoom IN graph  
        END FOR  

        FUNCTION dp(node)  
            IF the list at key node IN graph IS empty  
                RETURN one AND one  
            END IF  
            
            SET total_ways TO one  
            SET total_size TO one  
            INITIALIZE an empty list child_results  
            
            FOR each child IN the list at key node IN graph  
                CALL dp with argument child AND RECEIVE ways AND size  
                APPEND the pair of ways AND size TO child_results  
                INCREMENT total_size BY size  
            END FOR  
            
            SET current_size TO one  
            FOR each pair ways AND size IN child_results  
                SET total_ways TO total_ways MULTIPLIED BY the number of combinations of current_size PLUS size MINUS one CHOOSE size MULTIPLIED BY ways  
                SET total_ways TO the remainder of total_ways DIVIDED BY MODULO constant  
                INCREMENT current_size BY size  
            END FOR  
            
            RETURN total_ways AND total_size  
        END FUNCTION  
        
        CALL dp with argument zero AND RETURN the first element of the result  
    END FUNCTION  
END CLASS