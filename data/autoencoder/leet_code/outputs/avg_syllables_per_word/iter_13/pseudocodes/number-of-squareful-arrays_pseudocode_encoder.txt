CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root TO the INTEGER PART OF the SQUARE ROOT OF n  
            RETURN IF square_root MULTIPLIED BY square_root EQUALS n THEN true ELSE false  
        END FUNCTION  

        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums THEN  
                RETURN one  
            END IF  

            SET ans TO zero  
            FOR each x IN the KEYS OF count  
                IF the VALUE ASSOCIATED WITH x IN count IS GREATER THAN zero AND (the LENGTH OF path EQUALS zero OR is_square(the LAST ELEMENT OF path PLUS x)) THEN  
                    DECREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                    INCREMENT ans BY backtrack(path WITH x APPENDED, count)  
                    INCREMENT the VALUE ASSOCIATED WITH x IN count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  

        SET count TO a COUNTER OF THE ELEMENTS IN nums  
        RETURN backtrack(an EMPTY LIST, count)  
    END FUNCTION  
END CLASS