CLASS Solution  
    FUNCTION waysToBuildRooms(prevRoom)  
        SET n TO the LENGTH OF prevRoom  
        INITIALIZE graph AS a mapping from keys to EMPTY lists  
        
        FOR each room FROM one TO n MINUS one  
            APPEND the value of room TO the element in graph at the position of element at position room of prevRoom  
        END FOR  
        
        FUNCTION dp(node)  
            IF the element in graph at position node EQUALS an EMPTY list THEN  
                RETURN one AND one  
            END IF  
            
            SET total_ways TO one  
            SET total_size TO one  
            INITIALIZE child_results AS an EMPTY list  
            
            FOR each child IN the element in graph at position node  
                SET ways AND size TO the result of calling dp with child  
                APPEND the pair of ways AND size TO child_results  
                INCREMENT total_size BY size  
            END FOR  
            
            SET current_size TO one  
            FOR each ways AND size IN child_results  
                SET total_ways TO total_ways MULTIPLIED BY the combination of current_size PLUS size MINUS one CHOOSE size MULTIPLIED BY ways  
                SET total_ways TO total_ways MODULO ten RAISED TO the power of nine PLUS seven  
                INCREMENT current_size BY size  
            END FOR  
            
            RETURN total_ways AND total_size  
        END FUNCTION  
        
        RETURN the first element of the result of calling dp with zero  
    END FUNCTION  
END CLASS