CLASS Solution  
    FUNCTION longestObstacleCourseAtEachPosition(obstacles)  
        SET n TO the LENGTH OF obstacles  
        SET ans TO an empty list  
        SET increasing_subseq TO an empty list  
        
        FOR each obstacle IN obstacles  
            SET idx TO the position found by locating the index where obstacle can be inserted in increasing_subseq so that all elements before are LESS THAN OR EQUAL TO obstacle and all elements after are GREATER THAN obstacle, favoring the rightmost insertion point  
            
            IF idx EQUALS the LENGTH OF increasing_subseq  
                APPEND obstacle TO increasing_subseq  
            ELSE  
                SET the element at position idx of increasing_subseq TO obstacle  
            END IF  
            
            APPEND idx PLUS one TO ans  
        END FOR  
        
        RETURN ans  
    END FUNCTION  
END CLASS