CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index LESS THAN the LENGTH OF expression  
                SET char TO element at position index of expression  
                
                IF char EQUALS open brace  
                    SET inner_set AND index TO parse_expression index PLUS one  
                    SET current_product TO empty list  
                    FOR each a IN current_product prior to update  
                        FOR each b IN inner_set  
                            APPEND concatenation of a AND b TO current_product  
                        END FOR  
                    END FOR
                
                ELSE IF char EQUALS close brace  
                    FOR each p IN current_product  
                        APPEND concatenation of elements of p TO list THEN ADD TO current_set  
                    END FOR  
                    RETURN current_set AND index
                
                ELSE IF char EQUALS comma  
                    FOR each p IN current_product  
                        APPEND concatenation of elements of p TO list THEN ADD TO current_set  
                    END FOR  
                    SET current_product TO list containing empty string
                
                ELSE  
                    SET current_product TO empty list  
                    FOR each a IN current_product prior to update  
                        APPEND concatenation of a AND char TO current_product  
                    END FOR
                
                END IF  
                INCREMENT index BY one  
            END WHILE  
            
            FOR each p IN current_product  
                APPEND concatenation of elements of p TO list THEN ADD TO current_set  
            END FOR  
            RETURN current_set AND index  
        END FUNCTION  
        
        SET result_set AND unused_index TO parse_expression zero  
        RETURN sorted list of elements in result_set  
    END FUNCTION  
END CLASS