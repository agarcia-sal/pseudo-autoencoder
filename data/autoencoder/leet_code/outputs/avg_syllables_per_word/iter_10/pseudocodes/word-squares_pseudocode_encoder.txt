CLASS Solution  
    FUNCTION wordSquares(words)  
        FROM the collections IMPORT defaultdict  
        SET prefix_to_words TO a new defaultdict of lists  
        FOR each word IN words  
            FOR i FROM zero TO the LENGTH OF word MINUS one  
                SET prefix TO substring of word FROM start TO position i  
                APPEND word TO the list at prefix_to_words for prefix  
            END FOR  
        END FOR  
        
        SET results TO an empty list  
        
        FUNCTION backtrack(square)  
            IF the LENGTH OF square EQUALS the LENGTH OF the element at position zero of words  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO the concatenation of the element at position equal to the LENGTH OF square of each word IN square  
            FOR each candidate IN the list at prefix_to_words for prefix  
                CALL backtrack with square APPENDED BY candidate  
            END FOR  
        END FUNCTION  
        
        FOR each word IN words  
            CALL backtrack with a list containing word  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS