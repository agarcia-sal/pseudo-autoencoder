CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        FROM collections IMPORT defaultdict  
        
        SET indices TO result of calling defaultdict with argument list  
        
        SET prefix_sum TO list of zeros WITH LENGTH equal to LENGTH OF flowers PLUS one  
        FOR i FROM zero TO LENGTH OF flowers MINUS one  
            SET element at position i PLUS one of prefix_sum TO element at position i of prefix_sum PLUS the greater of element at position i of flowers AND zero  
            APPEND i TO the list at key of element at position i of flowers IN indices  
        END FOR  
        
        SET max_beauty TO negative infinity  
        
        FOR each beauty IN indices  
            IF LENGTH OF the list at key beauty IN indices IS GREATER THAN OR EQUAL TO two  
                SET first TO element at position zero of the list at key beauty IN indices  
                SET last TO element at position negative one of the list at key beauty IN indices  
                
                SET current_beauty TO two MULTIPLIED BY beauty PLUS (element at position last of prefix_sum MINUS element at position first PLUS one of prefix_sum)  
                SET max_beauty TO the greater of max_beauty AND current_beauty  
            END IF  
        END FOR  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS