CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r  
                RETURN zero  
            END IF  
            IF the tuple consisting of l, r, and k IS IN memo  
                RETURN the value in memo at the tuple consisting of l, r, and k  
            END IF  
            WHILE r GREATER THAN l AND the element at position r of boxes EQUALS the element at position r MINUS one of boxes  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO the result of calling dp with parameters l, r MINUS one, zero, and memo PLUS the product of the sum of k PLUS one WITH itself  
            FOR index i FROM l TO r MINUS one  
                IF the element at position i of boxes EQUALS the element at position r of boxes  
                    SET res TO the maximum of res AND the sum of calling dp with parameters l, i, k PLUS one, and memo PLUS calling dp with parameters i PLUS one, r MINUS one, zero, and memo  
                END IF  
            END FOR  
            SET the value in memo at the tuple consisting of l, r, and k TO res  
            RETURN res  
        END FUNCTION  
        RETURN the result of calling dp with parameters zero, the length of boxes MINUS one, zero, and an empty dictionary  
    END FUNCTION  
END CLASS