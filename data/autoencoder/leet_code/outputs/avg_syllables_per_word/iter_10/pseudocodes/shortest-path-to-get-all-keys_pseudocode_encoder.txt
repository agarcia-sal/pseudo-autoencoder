CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        SET directions TO list containing pairs zero AND one, zero AND negative one, one AND zero, negative one AND zero  
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF element at position zero of grid  
        SET start TO none  
        SET num_keys TO zero  
        
        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF element at position i of grid at position j EQUALS the character AT symbol at  
                    SET start TO pair i AND j  
                ELSE IF element at position i of grid at position j IS a lowercase letter  
                    INCREMENT num_keys BY one  
                END IF  
            END FOR  
        END FOR  
        
        INITIALIZE queue AS deque containing tuple start x coordinate, start y coordinate, zero, zero  
        INITIALIZE visited AS set containing tuple start x coordinate, start y coordinate, zero  
        
        WHILE queue IS NOT empty  
            REMOVE first element FROM queue AND SET x, y, keys, steps TO its values  
            
            FOR each dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx GREATER THAN OR EQUAL TO zero AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO zero AND ny LESS THAN n  
                    SET cell TO element at position nx of grid at position ny  
                    
                    IF cell EQUALS character hash  
                        CONTINUE to next iteration  
                    END IF  
                    
                    IF cell IS an uppercase letter  
                        SET key_needed TO one LEFT SHIFTED BY (Unicode code point of lowercase of cell MINUS Unicode code point of character a)  
                        IF bitwise AND of keys AND key_needed EQUALS zero  
                            CONTINUE to next iteration  
                        END IF  
                    END IF  
                    
                    IF cell IS a lowercase letter  
                        SET new_keys TO bitwise OR of keys AND one LEFT SHIFTED BY (Unicode code point of cell MINUS Unicode code point of character a)  
                        IF new_keys EQUALS bitwise OR of one LEFT SHIFTED BY num_keys MINUS one  
                            RETURN steps PLUS one  
                        END IF  
                    ELSE  
                        SET new_keys TO keys  
                    END IF  
                    
                    IF tuple nx, ny, new_keys NOT IN visited  
                        ADD tuple nx, ny, new_keys TO visited  
                        APPEND tuple nx, ny, new_keys, steps PLUS one TO queue  
                    END IF  
                END IF  
            END FOR  
        END WHILE  
        
        RETURN negative one  
    END FUNCTION  
END CLASS