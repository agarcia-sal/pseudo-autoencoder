CLASS Solution  
    FUNCTION countPalindromicSubsequences(s)  
        SET MOD TO one billion PLUS seven  
        SET n TO the LENGTH OF s  
        
        CALL initialize_next_occurrence WITH n RETURNING next_occurrence  
        CALL initialize_prev_occurrence WITH n RETURNING prev_occurrence  
        
        FOR c FROM zero TO three  
            SET char TO the character REPRESENTED BY the ASCII value of lowercase letter a PLUS c  
            SET last TO negative one  
            FOR i FROM zero TO n MINUS one  
                IF the character AT position i OF s EQUALS char  
                    SET last TO i  
                END IF  
                SET the element at position i of next_occurrence at index c TO last  
            END FOR  
            
            SET last TO negative one  
            FOR i FROM n MINUS one DOWN TO zero  
                IF the character AT position i OF s EQUALS char  
                    SET last TO i  
                END IF  
                SET the element at position i of prev_occurrence at index c TO last  
            END FOR  
        END FOR  
        
        CALL initialize_dp_table WITH n RETURNING dp  
        
        FOR i FROM zero TO n MINUS one  
            SET the element at row i column i OF dp TO one  
        END FOR  
        
        FOR length FROM two TO n  
            FOR i FROM zero TO n MINUS length  
                SET j TO i PLUS length MINUS one  
                FOR c FROM zero TO three  
                    SET char TO the character REPRESENTED BY the ASCII value of lowercase letter a PLUS c  
                    SET left TO the element at position i OF next_occurrence at index c  
                    SET right TO the element at position j OF prev_occurrence at index c  
                    
                    IF left GREATER THAN j OR right LESS THAN i  
                        CONTINUE TO next iteration of FOR c  
                    ELSE IF left EQUALS right  
                        SET the element at row i column j OF dp TO the element at row i column j OF dp PLUS one  
                        SET the element at row i column j OF dp TO the element at row i column j OF dp MODULO MOD  
                    ELSE  
                        SET temp_value TO the element at row left PLUS one column right MINUS one OF dp PLUS two  
                        SET the element at row i column j OF dp TO the element at row i column j OF dp PLUS temp_value  
                        SET the element at row i column j OF dp TO the element at row i column j OF dp MODULO MOD  
                    END IF  
                END FOR  
            END FOR  
        END FOR  
        
        RETURN the element at row zero column n MINUS one OF dp  
    END FUNCTION  
    
    FUNCTION initialize_next_occurrence(n)  
        CREATE a list of four lists EACH containing n elements initialized TO negative one  
        RETURN this list  
    END FUNCTION  
    
    FUNCTION initialize_prev_occurrence(n)  
        CREATE a list of four lists EACH containing n elements initialized TO negative one  
        RETURN this list  
    END FUNCTION  
    
    FUNCTION initialize_dp_table(n)  
        CREATE a two-dimensional list of size n BY n EACH element initialized TO zero  
        RETURN this list  
    END FUNCTION  
END CLASS