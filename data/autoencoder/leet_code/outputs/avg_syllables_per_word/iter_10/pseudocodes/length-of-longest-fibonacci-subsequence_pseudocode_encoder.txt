CLASS Solution  
    FUNCTION lenLongestFibSubseq(arr)  
        SET index TO RESULT OF calling build_index_map(arr)  
        SET dp TO empty mapping  
        SET max_length TO zero  
        
        FOR k FROM zero TO LENGTH OF arr MINUS one  
            FOR j FROM zero TO k MINUS one  
                SET i TO VALUE OF index AT KEY OF element at position k of arr MINUS element at position j of arr IF EXISTS OTHERWISE minus one  
                IF i GREATER THAN OR EQUAL TO zero AND i LESS THAN j  
                    SET current_length TO VALUE OF dp AT KEY OF pair i and j IF EXISTS OTHERWISE two  
                    SET dp AT KEY OF pair j and k TO current_length PLUS one  
                    IF dp AT KEY OF pair j and k GREATER THAN max_length  
                        SET max_length TO dp AT KEY OF pair j and k  
                    END IF  
                END IF  
            END FOR  
        END FOR  
        
        IF max_length GREATER THAN OR EQUAL TO three  
            RETURN max_length  
        ELSE  
            RETURN zero  
        END IF  
    END FUNCTION  
    
    FUNCTION build_index_map(arr)  
        SET mapping TO empty mapping  
        FOR i FROM zero TO LENGTH OF arr MINUS one  
            SET mapping AT KEY element at position i of arr TO i  
        END FOR  
        RETURN mapping  
    END FUNCTION  
END CLASS