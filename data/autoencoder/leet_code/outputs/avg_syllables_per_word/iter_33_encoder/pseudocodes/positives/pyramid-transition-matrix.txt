CLASS Solution  
    FUNCTION pyramidTransition with parameters bottom AND allowed  
        SET allowed_map TO a mapping where each key maps to a mapping that maps to a list  
        FOR each rule IN allowed  
            SET left TO the first element of rule  
            SET right TO the second element of rule  
            SET top TO the third element of rule  
            APPEND top TO the list at allowed_map at left then at right  
        END FOR  
      
        FUNCTION can_build_pyramid with parameters current_bottom AND current_top  
            IF the LENGTH OF current_bottom EQUALS one  
                RETURN true  
            END IF  
            IF the LENGTH OF current_top EQUALS the LENGTH OF current_bottom MINUS one  
                RETURN the result of calling can_build_pyramid with parameters current_top AND empty string  
            END IF  
          
            SET left TO the element at position the LENGTH OF current_top of current_bottom  
            SET right TO the element at position the LENGTH OF current_top PLUS one of current_bottom  
            IF left EXISTS AS A KEY in allowed_map AND right EXISTS AS A KEY in allowed_map at left  
                FOR each top IN the list at allowed_map at left then at right  
                    IF calling can_build_pyramid with parameters current_bottom AND the concatenation of current_top AND top RETURNS true  
                        RETURN true  
                    END IF  
                END FOR  
            END IF  
            RETURN false  
        END FUNCTION  
      
        RETURN the result of calling can_build_pyramid with parameters bottom AND empty string  
    END FUNCTION  
END CLASS