CLASS Solution  
    FUNCTION uniquePathsIII(grid)  
        FUNCTION dfs(x, y, steps)  
            IF element at position x of grid IS GREATER THAN OR EQUAL TO zero AND element at position y of element at position x of grid EQUALS two THEN  
                RETURN steps EQUALS zero  
            END IF  
            
            SET original TO element at position y of element at position x of grid  
            SET element at position y of element at position x of grid TO negative two  
            SET count TO zero  
            
            FOR each dx dy IN list of values negative one zero AND one zero AND zero negative one AND zero one  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx IS GREATER THAN OR EQUAL TO zero AND nx IS LESS THAN LENGTH OF grid AND ny IS GREATER THAN OR EQUAL TO zero AND ny IS LESS THAN LENGTH OF element at position zero of grid AND element at position ny of element at position nx of grid IS GREATER THAN OR EQUAL TO zero THEN  
                    INCREMENT count BY result of dfs WITH PARAMETERS nx ny steps MINUS one  
                END IF  
            END FOR  
            
            SET element at position y of element at position x of grid TO original  
            RETURN count  
        END FUNCTION  
        
        SET m TO LENGTH OF grid  
        SET n TO LENGTH OF element at position zero of grid  
        SET start_x TO zero  
        SET start_y TO zero  
        SET empty_squares TO one  
        
        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF element at position j of element at position i of grid EQUALS one THEN  
                    SET start_x TO i  
                    SET start_y TO j  
                ELSE IF element at position j of element at position i of grid EQUALS zero THEN  
                    INCREMENT empty_squares BY one  
                END IF  
            END FOR  
        END FOR  
        
        RETURN result of dfs WITH PARAMETERS start_x start_y empty_squares  
    END FUNCTION  
END CLASS