CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET square_root_to_integer TO the INTEGER PART OF the SQUARE ROOT OF n  
            IF square_root_to_integer MULTIPLIED BY square_root_to_integer EQUALS n  
                RETURN true  
            ELSE  
                RETURN false  
            END IF  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums  
                RETURN one  
            END IF  
            
            SET ans TO zero  
            FOR each x IN the KEYS OF count  
                IF the VALUE OF count AT x GREATER THAN zero AND (the LENGTH OF path EQUALS zero OR is_square(the ELEMENT at the LAST POSITION OF path PLUS x))  
                    DECREMENT the VALUE OF count AT x BY one  
                    INCREMENT ans BY backtrack(the path WITH x APPENDED, count)  
                    INCREMENT the VALUE OF count AT x BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO a COUNTER OF nums  
        RETURN backtrack(an empty list, count)  
    END FUNCTION  
END CLASS