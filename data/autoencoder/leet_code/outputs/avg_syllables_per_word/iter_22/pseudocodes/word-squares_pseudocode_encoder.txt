CLASS Solution  
    FUNCTION wordSquares(words)  
        SET prefix_to_words TO a new empty mapping from prefixes to lists of words  

        FOR each word IN words  
            SET word_length TO the LENGTH OF word  
            FOR index FROM zero TO word_length MINUS one  
                SET prefix TO the substring from position zero TO position index MINUS one of word  
                APPEND word TO the list at key prefix in prefix_to_words  
            END FOR  
        END FOR  

        SET results TO an empty list  

        FUNCTION backtrack(square)  
            SET current_length TO the LENGTH OF square  
            SET word_length TO the LENGTH OF the element at position zero of words  
            IF current_length EQUALS word_length  
                APPEND square TO results  
                RETURN  
            END IF  

            SET prefix TO the empty string  
            FOR each word_element IN square  
                APPEND the element at position current_length of word_element TO prefix  
            END FOR  

            FOR each candidate_word IN the list at key prefix in prefix_to_words  
                CALL backtrack WITH square PLUS a list containing candidate_word  
            END FOR  
        END FUNCTION  

        FOR each initial_word IN words  
            CALL backtrack WITH a list containing initial_word  
        END FOR  

        RETURN results  
    END FUNCTION  
END CLASS