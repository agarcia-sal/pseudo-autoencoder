CLASS Solution  
    FUNCTION numBusesToDestination(routes AS List OF List OF integer, source AS integer, target AS integer) RETURNS integer  
        IF source EQUALS target  
            RETURN zero  
        END IF  

        SET stop_to_buses TO an empty mapping from stops to list of buses  
        SET bus_index TO zero  
        FOR each route IN routes  
            FOR each stop IN route  
                APPEND bus_index TO the list of buses at stop in stop_to_buses  
            END FOR  
            INCREMENT bus_index BY one  
        END FOR  

        SET bus_queue TO an empty sequence supporting removal from front  
        SET visited_buses TO an empty set  
        SET visited_stops TO an empty set  

        FOR each bus IN the list of buses at source in stop_to_buses  
            APPEND the pair consisting of bus and one TO bus_queue  
            ADD bus TO visited_buses  
        END FOR  
        ADD source TO visited_stops  

        WHILE bus_queue is not empty  
            REMOVE the first pair from bus_queue ASSIGN TO current_bus and bus_count  

            FOR each stop IN the list of stops at the current_bus route in routes  
                IF stop EQUALS target  
                    RETURN bus_count  
                END IF  

                IF stop IS NOT IN visited_stops  
                    ADD stop TO visited_stops  
                    FOR each next_bus IN the list of buses at stop in stop_to_buses  
                        IF next_bus IS NOT IN visited_buses  
                            ADD next_bus TO visited_buses  
                            APPEND the pair consisting of next_bus and bus_count PLUS one TO bus_queue  
                        END IF  
                    END FOR  
                END IF  
            END FOR  
        END WHILE  

        RETURN negation of one  
    END FUNCTION  
END CLASS