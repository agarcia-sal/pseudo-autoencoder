CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        SET directions TO list of pairs representing moving right, moving left, moving down, moving up  
        
        SET m TO the LENGTH OF grid  
        SET n TO the LENGTH OF element at position zero of grid  
        SET start TO no value  
        SET num_keys TO zero  
        
        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF element at position i of grid AT position j EQUALS the character at the start symbol  
                    SET start TO pair of values i and j  
                ELSE IF the element at position i of grid AT position j IS a lowercase letter  
                    INCREMENT num_keys BY one  
                END IF  
            END FOR  
        END FOR  
        
        CREATE a queue using a double ended queue structure initialized with a tuple of value at position zero of start, value at position one of start, zero representing collected keys, and zero representing steps  
        CREATE a set named visited initialized with a tuple of value at position zero of start, value at position one of start, and zero representing collected keys  
        
        WHILE the queue IS NOT empty  
            REMOVE the first element from the queue and unpack into variables x, y, keys, and steps  
            
            FOR each pair dx, dy IN directions  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                
                IF nx IS greater than or equal to zero AND nx IS less than m AND ny IS greater than or equal to zero AND ny IS less than n  
                    SET cell TO the element at position nx of grid AT position ny  
                    
                    IF cell EQUALS the wall symbol  
                        CONTINUE to the next iteration  
                    END IF  
                    
                    IF cell IS an uppercase letter  
                        SET key_needed TO the integer one SHIFTED LEFT BY the difference of the ASCII value of the lowercase form of cell MINUS the ASCII value of lowercase a  
                        IF the bitwise AND of keys AND key_needed EQUALS zero  
                            CONTINUE to the next iteration  
                        END IF  
                    END IF  
                    
                    IF cell IS a lowercase letter  
                        SET new_keys TO the bitwise OR of keys AND the integer one SHIFTED LEFT BY the difference of the ASCII value of cell MINUS the ASCII value of lowercase a  
                        IF new_keys EQUALS the integer one SHIFTED LEFT BY num_keys MINUS one  
                            RETURN steps PLUS one  
                        END IF  
                    ELSE  
                        SET new_keys TO keys  
                    END IF  
                    
                    IF the tuple of nx, ny, new_keys IS NOT IN visited  
                        ADD the tuple of nx, ny, new_keys TO the visited set  
                        APPEND the tuple of nx, ny, new_keys, steps PLUS one TO the queue  
                    END IF  
                END IF  
            END FOR  
        END WHILE  
        
        RETURN negative one  
    END FUNCTION  
END CLASS