CLASS Trie  
    FUNCTION __init__()  
        SET children TO list of size 26 filled with None  
        SET ref TO -1  
    END FUNCTION  

    FUNCTION insert(w, ref)  
        SET node TO self  
        FOR each character c IN w  
            SET idx TO position of c in alphabet starting from zero  
            IF node.children at idx IS None  
                SET node.children at idx TO new Trie instance  
            SET node TO node.children at idx  
        SET node.ref TO ref  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION findWords(board, words)  
        FUNCTION dfs(node, i, j)  
            SET idx TO position of character at board[i][j] in alphabet starting from zero  
            IF node.children at idx IS None  
                RETURN  
            SET node TO node.children at idx  
            IF node.ref GREATER THAN OR EQUAL TO 0  
                APPEND words at node.ref TO ans  
                SET node.ref TO -1  
            SET c TO board at position i, j  
            SET board at position i, j TO mark character  
            FOR each consecutive pair (a, b) IN (-1, 0, 1, 0, -1)  
                SET x TO i PLUS a  
                SET y TO j PLUS b  
                IF x GREATER THAN OR EQUAL TO 0 AND x LESS THAN m AND y GREATER THAN OR EQUAL TO 0 AND y LESS THAN n AND board at position x, y IS NOT mark character  
                    CALL dfs WITH node, x, y  
            SET board at position i, j TO c  
        END FUNCTION  

        SET tree TO new Trie instance  
        FOR each index i AND word w IN words  
            CALL tree.insert WITH w, i  
        SET m TO number of rows in board  
        SET n TO number of columns in board  
        SET ans TO empty list  
        FOR i FROM 0 TO m MINUS 1  
            FOR j FROM 0 TO n MINUS 1  
                CALL dfs WITH tree, i, j  
        RETURN ans  
    END FUNCTION  
END CLASS