CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        CALL import defaultdict FROM collections  
        
        SET indices TO new dictionary with default empty list  
        SET prefix_sum TO list of zero WITH length LENGTH OF flowers PLUS 1  
        
        FOR index FROM 0 TO LENGTH OF flowers MINUS 1  
            SET prefix_sum AT index PLUS 1 TO prefix_sum AT index PLUS maximum of flowers AT index AND 0  
            APPEND index TO indices AT key flowers AT index  
        
        SET max_beauty TO negative infinity  
        
        FOR each beauty IN keys of indices  
            IF LENGTH OF indices AT key beauty IS GREATER THAN OR EQUAL TO 2  
                SET first TO first element IN indices AT key beauty  
                SET last TO last element IN indices AT key beauty  
                
                SET current_beauty TO 2 MULTIPLIED BY beauty PLUS (prefix_sum AT last MINUS prefix_sum AT first PLUS 1)  
                IF current_beauty IS GREATER THAN max_beauty  
                    SET max_beauty TO current_beauty  
        
        RETURN max_beauty  
    END FUNCTION  
END CLASS