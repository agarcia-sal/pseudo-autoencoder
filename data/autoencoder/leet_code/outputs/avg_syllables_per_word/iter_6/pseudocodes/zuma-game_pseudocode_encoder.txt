CLASS Solution  
    FUNCTION findMinStep(board, hand)  
        FUNCTION clean(board)  
            SET stack TO empty list  
            FOR each ball IN board  
                IF stack is not empty AND last element's ball in stack NOT EQUALS ball AND last element's count in stack GREATER THAN OR EQUAL TO 3  
                    REMOVE last element FROM stack  
                IF stack is empty OR last element's ball in stack NOT EQUALS ball  
                    APPEND [ball, 1] TO stack  
                ELSE  
                    INCREMENT last element's count in stack BY 1  
            IF stack is not empty AND last element's count in stack GREATER THAN OR EQUAL TO 3  
                REMOVE last element FROM stack  
            SET result_string TO empty string  
            FOR each ball, count IN stack  
                APPEND ball REPEATED count TIMES TO result_string  
            RETURN result_string  
        END FUNCTION  

        FUNCTION dfs(board, hand_counter)  
            IF board is empty  
                RETURN 0  
            SET min_steps TO infinity  
            SET i TO 0  
            WHILE i LESS THAN length of board  
                SET j TO i PLUS 1  
                WHILE j LESS THAN length of board AND board at j EQUALS board at i  
                    INCREMENT j BY 1  
                SET increment TO 3 MINUS (j MINUS i)  
                IF hand_counter at board[i] GREATER THAN OR EQUAL TO increment  
                    SET new_hand_counter TO a copy of hand_counter  
                    DECREMENT new_hand_counter at board[i] BY increment  
                    SET new_board TO CALL clean WITH board from start TO i CONCATENATED WITH board from j TO end  
                    SET steps TO CALL dfs WITH new_board AND new_hand_counter  
                    IF steps GREATER THAN OR EQUAL TO 0  
                        SET min_steps TO minimum of min_steps AND steps PLUS increment  
                SET i TO j  
            IF min_steps EQUALS infinity  
                RETURN -1  
            ELSE  
                RETURN min_steps  
        END FUNCTION  

        SET hand_counter TO a count of characters in hand  
        RETURN CALL dfs WITH board AND hand_counter  
    END FUNCTION  
END CLASS