CLASS Solution  
    FUNCTION medianSlidingWindow(nums, k)  
        SET lo TO empty list  
        SET hi TO empty list  

        FUNCTION balance_heaps()  
            IF LENGTH OF lo GREATER THAN LENGTH OF hi PLUS 1  
                REMOVE maximum element FROM lo AND ADD its negation TO hi  
            ELSE IF LENGTH OF hi GREATER THAN LENGTH OF lo  
                REMOVE minimum element FROM hi AND ADD its negation TO lo  
            END IF  
        END FUNCTION  

        FUNCTION add_num(num)  
            IF lo IS empty OR num LESS THAN OR EQUAL TO negation OF first element IN lo  
                ADD negation OF num TO lo  
            ELSE  
                ADD num TO hi  
            END IF  
            CALL balance_heaps()  
        END FUNCTION  

        FUNCTION remove_num(num)  
            IF num LESS THAN OR EQUAL TO negation OF first element IN lo  
                REMOVE negation OF num FROM lo  
                IF lo IS NOT empty  
                    REHEAPIFY lo  
                END IF  
            ELSE  
                REMOVE num FROM hi  
                IF hi IS NOT empty  
                    REHEAPIFY hi  
                END IF  
            END IF  
            CALL balance_heaps()  
        END FUNCTION  

        FUNCTION get_median()  
            IF LENGTH OF lo GREATER THAN LENGTH OF hi  
                RETURN negation OF first element IN lo  
            ELSE  
                RETURN average OF negation OF first element IN lo AND first element IN hi  
            END IF  
        END FUNCTION  

        FOR index FROM 0 TO k MINUS 1  
            CALL add_num WITH nums AT index  
        END FOR  

        SET medians TO list CONTAINING get_median()  

        FOR index FROM k TO LENGTH OF nums MINUS 1  
            CALL add_num WITH nums AT index  
            CALL remove_num WITH nums AT index MINUS k  
            APPEND get_median() TO medians  
        END FOR  

        RETURN medians  
    END FUNCTION  
END CLASS