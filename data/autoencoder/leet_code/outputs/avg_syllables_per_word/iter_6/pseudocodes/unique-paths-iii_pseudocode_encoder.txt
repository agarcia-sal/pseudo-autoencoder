CLASS Solution  
    FUNCTION uniquePathsIII(grid)  
        FUNCTION dfs(x, y, steps)  
            IF grid AT position x, y EQUALS 2 THEN  
                RETURN steps EQUALS 0  
            END IF  

            SET original TO grid AT position x, y  
            SET grid AT position x, y TO negative two  
            SET count TO zero  

            FOR each pair dx, dy IN list of four direction pairs (negative one zero, one zero, zero negative one, zero one)  
                SET nx TO x PLUS dx  
                SET ny TO y PLUS dy  
                IF nx GREATER THAN OR EQUAL TO zero AND nx LESS THAN m AND ny GREATER THAN OR EQUAL TO zero AND ny LESS THAN n AND grid AT position nx, ny GREATER THAN OR EQUAL TO zero THEN  
                    INCREMENT count BY CALL dfs WITH nx, ny, steps MINUS one  
                END IF  
            END FOR  

            SET grid AT position x, y TO original  
            RETURN count  
        END FUNCTION  

        SET m TO LENGTH OF grid  
        SET n TO LENGTH OF grid AT position zero  
        SET start_x TO zero  
        SET start_y TO zero  
        SET empty_squares TO one  

        FOR i FROM zero TO m MINUS one  
            FOR j FROM zero TO n MINUS one  
                IF grid AT position i, j EQUALS one THEN  
                    SET start_x TO i  
                    SET start_y TO j  
                ELSE IF grid AT position i, j EQUALS zero THEN  
                    INCREMENT empty_squares BY one  
                END IF  
            END FOR  
        END FOR  

        RETURN CALL dfs WITH start_x, start_y, empty_squares  
    END FUNCTION  
END CLASS