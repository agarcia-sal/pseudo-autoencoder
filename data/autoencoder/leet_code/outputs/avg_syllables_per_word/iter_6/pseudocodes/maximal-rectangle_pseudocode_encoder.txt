CLASS Solution  
    FUNCTION maximalRectangle(matrix)  
        IF matrix IS EMPTY OR matrix AT ZERO INDEX IS EMPTY  
            RETURN 0  
        SET rows TO LENGTH OF matrix  
        SET cols TO LENGTH OF matrix AT ZERO INDEX  
        SET heights TO list OF ZERO VALUES WITH LENGTH cols  
        SET max_area TO 0  
        
        FOR i FROM 0 TO rows MINUS 1  
            FOR j FROM 0 TO cols MINUS 1  
                IF matrix AT i AT j EQUALS '1'  
                    INCREMENT heights AT j BY 1  
                ELSE  
                    SET heights AT j TO 0  
            SET max_area TO GREATER OF max_area AND CALL largestRectangleArea WITH heights  
        RETURN max_area  
    END FUNCTION  
    
    FUNCTION largestRectangleArea(heights)  
        SET stack TO empty list  
        SET max_area TO 0  
        SET index TO 0  
        
        WHILE index LESS THAN LENGTH OF heights  
            IF stack IS EMPTY OR heights AT index GREATER THAN OR EQUAL TO heights AT last element IN stack  
                APPEND index TO stack  
                INCREMENT index BY 1  
            ELSE  
                SET top_of_stack TO REMOVE last element FROM stack  
                IF stack IS NOT EMPTY  
                    SET width TO index MINUS last element IN stack MINUS 1  
                ELSE  
                    SET width TO index  
                SET area TO heights AT top_of_stack MULTIPLIED BY width  
                SET max_area TO GREATER OF max_area AND area  
        
        WHILE stack IS NOT EMPTY  
            SET top_of_stack TO REMOVE last element FROM stack  
            IF stack IS NOT EMPTY  
                SET width TO index MINUS last element IN stack MINUS 1  
            ELSE  
                SET width TO index  
            SET area TO heights AT top_of_stack MULTIPLIED BY width  
            SET max_area TO GREATER OF max_area AND area  
        
        RETURN max_area  
    END FUNCTION  
END CLASS