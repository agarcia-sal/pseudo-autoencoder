CLASS Solution  
    FUNCTION braceExpansionII(expression)  
        FUNCTION parse_expression(index)  
            SET current_set TO empty set  
            SET current_product TO list containing empty string  
            
            WHILE index LESS THAN length of expression  
                SET char TO character at position index in expression  
                
                IF char EQUALS '{'  
                    CALL parse_expression WITH index PLUS 1, RECEIVE inner_set AND index  
                    SET new_product TO empty list  
                    FOR each a IN current_product  
                        FOR each b IN inner_set  
                            APPEND concatenation of a PLUS b TO new_product  
                    SET current_product TO new_product  
                
                ELSE IF char EQUALS '}'  
                    FOR each p IN current_product  
                        ADD concatenation of p TO current_set  
                    RETURN current_set AND index  
                
                ELSE IF char EQUALS ','  
                    FOR each p IN current_product  
                        ADD concatenation of p TO current_set  
                    SET current_product TO list containing empty string  
                
                ELSE  
                    SET new_product TO empty list  
                    FOR each a IN current_product  
                        APPEND concatenation of a PLUS char TO new_product  
                    SET current_product TO new_product  
                
                INCREMENT index BY 1  
            
            FOR each p IN current_product  
                ADD concatenation of p TO current_set  
            RETURN current_set AND index  
        
        SET result_set AND ignore_index TO CALL parse_expression WITH 0  
        RETURN sorted list of result_set  
    END FUNCTION  
END CLASS