CLASS Solution  
    FUNCTION validArrangement(pairs)  
        SET graph TO new mapping from keys to list of values  
        SET out_degree TO new mapping from keys to counts  
        SET in_degree TO new mapping from keys to counts  
        
        FOR each element u, v IN pairs  
            APPEND v TO graph at key u  
            INCREMENT out_degree at key u BY 1  
            INCREMENT in_degree at key v BY 1  
        
        SET start_node TO None  
        FOR each node IN graph  
            IF out_degree at node EQUALS in_degree at node PLUS 1  
                SET start_node TO node  
                BREAK  
        IF start_node IS None  
            SET start_node TO any key from graph  
        
        SET path TO empty list  
        SET stack TO list containing start_node  
        
        WHILE stack IS NOT empty  
            SET u TO last element in stack  
            IF graph at u IS NOT empty  
                REMOVE last element v FROM graph at u  
                APPEND v TO stack  
            ELSE  
                REMOVE last element FROM stack and APPEND it TO path  
        
        REVERSE elements in path  
        
        SET result TO empty list  
        FOR index FROM 0 TO length of path MINUS 2  
            APPEND list containing path at index and path at index PLUS 1 TO result  
        
        RETURN result  
    END FUNCTION  
END CLASS