CLASS Solution  
    FUNCTION encode(s)  
        FUNCTION get_encoded_length(count, substring)  
            RETURN LENGTH OF string representation of count PLUS LENGTH OF substring PLUS 2  
        END FUNCTION  

        FUNCTION dp(i, j)  
            SET substring TO substring of s from index i TO j inclusive  
            SET n TO j MINUS i PLUS 1  
            IF n LESS THAN 5 THEN  
                RETURN substring  
            END IF  

            SET shortest TO substring  
            FOR k FROM 1 TO n DIVIDED BY 2  
                IF n MODULO k EQUALS 0 THEN  
                    SET repeat_count TO n DIVIDED BY k  
                    IF substring EQUALS substring from start TO k MULTIPLIED BY repeat_count THEN  
                        SET encoded_candidate TO string representation of repeat_count CONCATENATED WITH '[' CONCATENATED WITH CALL dp WITH i AND i PLUS k MINUS 1 CONCATENATED WITH ']'  
                        IF LENGTH OF encoded_candidate LESS THAN LENGTH OF shortest THEN  
                            SET shortest TO encoded_candidate  
                        END IF  
                    END IF  
                END IF  
            END FOR  

            FOR k FROM i TO j MINUS 1  
                SET left_encoded TO CALL dp WITH i AND k  
                SET right_encoded TO CALL dp WITH k PLUS 1 AND j  
                SET combined TO left_encoded CONCATENATED WITH right_encoded  
                IF LENGTH OF combined LESS THAN LENGTH OF shortest THEN  
                    SET shortest TO combined  
                END IF  
            END FOR  

            RETURN shortest  
        END FUNCTION  

        RETURN CALL dp WITH 0 AND LENGTH OF s MINUS 1  
    END FUNCTION  
END CLASS