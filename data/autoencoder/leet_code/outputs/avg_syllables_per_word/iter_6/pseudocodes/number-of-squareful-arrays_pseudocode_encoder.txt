CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            SET root TO CALL square root OF n  
            RETURN root MULTIPLIED BY root EQUALS n  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF LENGTH OF path EQUALS LENGTH OF nums THEN  
                RETURN 1  
            END IF  
            
            SET ans TO 0  
            FOR each x IN count  
                IF count[x] GREATER THAN 0 AND (path IS EMPTY OR CALL is_square WITH path LAST ELEMENT PLUS x) THEN  
                    DECREMENT count[x] BY 1  
                    INCREMENT ans BY CALL backtrack WITH path APPENDED WITH x, count  
                    INCREMENT count[x] BY 1  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO CALL Counter WITH nums  
        RETURN CALL backtrack WITH empty list, count  
    END FUNCTION  
END CLASS