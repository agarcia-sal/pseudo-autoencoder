CLASS TrieNode  
    FUNCTION __init__()  
        SET children TO empty dictionary  
        SET count TO 0  
    END FUNCTION  
END CLASS  

CLASS Trie  
    FUNCTION __init__(bit_length)  
        SET root TO new TrieNode  
        SET bit_length TO bit_length  
    END FUNCTION  

    FUNCTION insert(num)  
        SET node TO root  
        FOR i FROM bit_length DOWN TO 0  
            SET bit TO the i-th bit of num  
            IF bit NOT IN node.children THEN  
                SET node.children[bit] TO new TrieNode  
            END IF  
            SET node TO node.children[bit]  
            INCREMENT node.count BY 1  
        END FOR  
    END FUNCTION  

    FUNCTION count_less_than(num, threshold)  
        SET count TO 0  
        SET node TO root  
        FOR i FROM bit_length DOWN TO 0  
            IF node IS null THEN  
                BREAK  
            END IF  
            SET bit TO the i-th bit of num  
            SET threshold_bit TO the i-th bit of threshold  
            IF threshold_bit EQUALS 1 THEN  
                INCREMENT count BY count of node.children[bit] OR 0 if missing  
                SET node TO node.children[bit XOR 1]  
            ELSE  
                SET node TO node.children[bit]  
            END IF  
        END FOR  
        RETURN count  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION countPairs(nums, low, high)  
        SET trie TO new Trie with default bit_length  
        SET nice_pairs TO 0  

        FOR each num IN nums  
            INCREMENT nice_pairs BY CALL trie.count_less_than WITH num AND high PLUS 1 MINUS CALL trie.count_less_than WITH num AND low  
            CALL trie.insert WITH num  
        END FOR  

        RETURN nice_pairs  
    END FUNCTION  
END CLASS