CLASS Solution  
    FUNCTION maxEnvelopes(envelopes)  
        CALL sort envelopes BY width IN ascending ORDER AND BY height IN descending ORDER IF widths ARE EQUAL  
        SET dp TO empty list  
        FOR each element IN envelopes  
            SET h TO height OF element  
            SET idx TO position IN dp WHERE h CAN BE inserted TO maintain sorted order USING binary search  
            IF idx EQUALS length OF dp  
                APPEND h TO dp  
            ELSE  
                SET element AT idx IN dp TO h  
        RETURN length OF dp  
    END FUNCTION  
END CLASS