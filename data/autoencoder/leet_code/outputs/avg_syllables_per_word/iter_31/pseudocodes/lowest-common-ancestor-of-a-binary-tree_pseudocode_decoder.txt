CLASS TreeNode  
    FUNCTION __init__ WITH PARAMETERS val left right  
        SET the value property val TO parameter val  
        SET the left property left TO parameter left  
        SET the right property right TO parameter right  
    END FUNCTION  
END CLASS

FUNCTION tree_node WITH PARAMETER values  
    IF the collection values IS EMPTY  
        RETURN no value  
    END IF  
    SET variable root TO a new instance of TreeNode initialized with element at position one of values  
    SET variable i TO one  
    SET variable queue TO a new empty double ended queue structure  
    APPEND root TO queue  
    WHILE the queue HAS elements  
        REMOVE the first element FROM queue AND ASSIGN it TO variable node  
        IF variable i IS LESS THAN the length of collection values AND element at position i of values IS NOT no value  
            SET the left property of node TO a new instance of TreeNode initialized with element at position i of values  
            APPEND the left property of node TO queue  
        END IF  
        INCREMENT variable i BY one  
        IF variable i IS LESS THAN the length of collection values AND element at position i of values IS NOT no value  
            SET the right property of node TO a new instance of TreeNode initialized with element at position i of values  
            APPEND the right property of node TO queue  
        END IF  
        INCREMENT variable i BY one  
    END WHILE  
    RETURN root  
END FUNCTION

FUNCTION is_same_tree WITH PARAMETERS p q  
    IF parameter p IS no value AND parameter q IS no value  
        RETURN logical true  
    ELSE IF parameter p IS no value OR parameter q IS no value  
        RETURN logical false  
    ELSE IF the value property of p IS NOT EQUALS TO the value property of q  
        RETURN logical false  
    ELSE  
        RETURN the logical AND of calling is_same_tree with the left property of p and the left property of q AND calling is_same_tree with the right property of p and the right property of q  
    END IF  
END FUNCTION

CLASS Solution  
    FUNCTION lowestCommonAncestor WITH PARAMETERS self root p q  
        IF parameter root IS no value OR parameter root IS EQUALS TO parameter p OR parameter root IS EQUALS TO parameter q  
            RETURN parameter root  
        END IF  
        SET variable left TO the result of calling lowestCommonAncestor on parameter self with parameters the left property of root p q  
        SET variable right TO the result of calling lowestCommonAncestor on parameter self with parameters the right property of root p q  
        IF variable left IS NOT no value AND variable right IS NOT no value  
            RETURN parameter root  
        END IF  
        IF variable left IS NOT no value  
            RETURN variable left  
        ELSE  
            RETURN variable right  
        END IF  
    END FUNCTION  
END CLASS