CLASS Solution  
    FUNCTION wordSquares(words)  
        SET prefix_to_words TO an empty mapping from text sequences TO lists of text sequences  
        
        FOR each word IN words  
            FOR index FROM zero TO the LENGTH OF word MINUS one  
                SET prefix TO the substring from position zero TO position index MINUS one of word  
                APPEND word TO the list associated with prefix TO prefix_to_words  
            END FOR  
        END FOR  
        
        SET results TO an empty list  
        
        FUNCTION backtrack(square)  
            IF the LENGTH OF square EQUALS the LENGTH OF the first element in words THEN  
                APPEND square TO results  
                RETURN  
            END IF  
            
            SET prefix TO the empty text sequence  
            FOR each word_in_square IN square  
                APPEND the element at position the LENGTH OF square of word_in_square TO prefix  
            END FOR  
            
            FOR each candidate IN the list associated with prefix TO prefix_to_words  
                CALL backtrack WITH argument square PLUS a list consisting of candidate  
            END FOR  
        END FUNCTION  
        
        FOR each word IN words  
            CALL backtrack WITH argument a list consisting of word  
        END FOR  
        
        RETURN results  
    END FUNCTION  
END CLASS