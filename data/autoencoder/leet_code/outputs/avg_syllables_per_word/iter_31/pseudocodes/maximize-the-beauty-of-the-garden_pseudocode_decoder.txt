CLASS Solution  
    FUNCTION maximumBeauty(flowers)  
        CREATE indices AS a mapping from each flower beauty value TO a list of positions INITIALIZED as empty  
        CREATE prefix_sum AS a list of zeros WITH size EQUAL TO the LENGTH OF flowers PLUS one  
        FOR index FROM zero TO the LENGTH OF flowers MINUS one  
            SET position_after_index TO index PLUS one  
            SET value_at_index TO element at position index of flowers  
            SET element at position position_after_index of prefix_sum TO element at position index of prefix_sum PLUS the GREATER OF value_at_index AND zero  
            APPEND index TO the list ASSOCIATED WITH value_at_index IN indices  
        END FOR  
        SET max_beauty TO a very large negative value  
        FOR each beauty_value IN keys of indices  
            SET positions_list TO the list ASSOCIATED WITH beauty_value IN indices  
            IF the LENGTH OF positions_list IS GREATER THAN OR EQUAL TO two  
                SET first_position TO element at position zero of positions_list  
                SET last_position TO element at position of the last element of positions_list  
                SET sum_between TO element at position last_position of prefix_sum MINUS element at position first_position PLUS one of prefix_sum  
                SET current_beauty TO two MULTIPLIED BY beauty_value PLUS sum_between  
                IF current_beauty IS GREATER THAN max_beauty  
                    SET max_beauty TO current_beauty  
                END IF  
            END IF  
        END FOR  
        RETURN max_beauty  
    END FUNCTION  
END CLASS