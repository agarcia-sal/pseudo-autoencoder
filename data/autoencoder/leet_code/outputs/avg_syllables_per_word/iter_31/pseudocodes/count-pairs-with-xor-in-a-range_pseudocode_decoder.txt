CLASS TrieNode  
    FUNCTION __init__(self)  
        SET self.children TO an empty mapping from bit to TrieNode  
        SET self.count TO zero  
    END FUNCTION  
END CLASS  

CLASS Trie  
    FUNCTION __init__(self, bit_length)  
        SET self.root TO a new TrieNode  
        SET self.bit_length TO bit_length  
    END FUNCTION  

    FUNCTION insert(self, num)  
        SET node TO self.root  
        FOR i FROM self.bit_length DOWN TO zero  
            SET bit TO the element at position i of the binary representation of num interpreted as right shifted bits computed as the integer division by two raised to the power i MODULO two  
            IF bit is not a key in node.children THEN  
                SET element at key bit in node.children TO a new TrieNode  
            END IF  
            SET node TO the element at key bit in node.children  
            INCREMENT node.count BY one  
        END FOR  
    END FUNCTION  

    FUNCTION count_less_than(self, num, threshold)  
        SET count TO zero  
        SET node TO self.root  
        FOR i FROM self.bit_length DOWN TO zero  
            IF node is null or does not exist THEN  
                BREAK the loop  
            END IF  
            SET bit TO the element at position i of the binary representation of num interpreted as right shifted bits computed as the integer division by two raised to the power i MODULO two  
            SET threshold_bit TO the element at position i of the binary representation of threshold interpreted similarly  
            IF threshold_bit EQUALS one THEN  
                SET count TO count PLUS the count value of the child node at key bit in node.children if it exists otherwise zero  
                SET node TO the child node at key bit XOR one in node.children if it exists otherwise null  
            ELSE  
                SET node TO the child node at key bit in node.children if it exists otherwise null  
            END IF  
        END FOR  
        RETURN count  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION countPairs(self, nums, low, high)  
        SET trie TO a new Trie with bit_length set to fifteen  
        SET nice_pairs TO zero  
        FOR each num IN nums  
            SET nice_pairs TO nice_pairs PLUS the result of calling trie.count_less_than with arguments num and high PLUS one MINUS the result of calling trie.count_less_than with arguments num and low  
            CALL trie.insert with argument num  
        END FOR  
        RETURN nice_pairs  
    END FUNCTION  
END CLASS