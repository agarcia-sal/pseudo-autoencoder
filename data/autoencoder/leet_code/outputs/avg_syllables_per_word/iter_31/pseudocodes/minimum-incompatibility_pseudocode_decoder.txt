CLASS Solution  
    FUNCTION minimumIncompatibility(nums k)  
        SET n TO the LENGTH OF nums  
        SET subset_size TO n DIVIDED BY k  
        
        SET counts TO the COUNTER OF elements IN nums  
        IF any value IN counts VALUES GREATER THAN k THEN  
            RETURN negative one  
        END IF  
        
        SET subset_incompatibility TO an empty map  
        FOR mask FROM zero TO two RAISED TO THE power OF n MINUS one  
            SET bits_count TO the NUMBER OF set BITS IN mask  
            IF bits_count EQUALS subset_size THEN  
                SET elements TO an empty list  
                FOR i FROM zero TO n MINUS one  
                    IF the BIT at position i in mask IS set THEN  
                        APPEND the element at position i OF nums TO elements  
                    END IF  
                END FOR  
                SET unique_elements_count TO the SIZE OF the set of elements  
                IF unique_elements_count EQUALS subset_size THEN  
                    SET maximum_element TO the MAXIMUM VALUE IN elements  
                    SET minimum_element TO the MINIMUM VALUE IN elements  
                    SET incompatibility TO maximum_element MINUS minimum_element  
                    ASSIGN incompatibility TO subset_incompatibility AT key mask  
                END IF  
            END IF  
        END FOR  
        
        SET dp TO a list of size two RAISED TO THE power OF n FILLED WITH positive infinity  
        SET dp AT position zero TO zero  
        
        FOR mask FROM zero TO two RAISED TO THE power OF n MINUS one  
            SET bits_count TO the NUMBER OF set BITS IN mask  
            IF bits_count MODULO subset_size NOT EQUALS zero THEN  
                CONTINUE  
            END IF  
            FOR each subset_mask IN subset_incompatibility KEYS  
                IF subset_mask AND mask EQUALS subset_mask THEN  
                    SET candidate TO dp AT position mask XOR subset_mask PLUS subset_incompatibility AT key subset_mask  
                    IF candidate LESS THAN dp AT position mask THEN  
                        SET dp AT position mask TO candidate  
                    END IF  
                END IF  
            END FOR  
        END FOR  
        
        SET full_mask TO two RAISED TO THE power OF n MINUS one  
        IF dp AT position full_mask EQUALS positive infinity THEN  
            RETURN negative one  
        ELSE  
            RETURN dp AT position full_mask  
        END IF  
    END FUNCTION  
END CLASS