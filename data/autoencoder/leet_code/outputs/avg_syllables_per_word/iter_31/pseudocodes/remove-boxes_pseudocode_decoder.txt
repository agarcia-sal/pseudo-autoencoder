CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN zero  
            END IF  
            IF the tuple of l r and k EXISTS AS key IN memo THEN  
                RETURN the value ASSOCIATED WITH the tuple of l r and k IN memo  
            END IF  
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes DO  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            SET res TO the result of calling dp WITH l r MINUS one zero and memo PLUS the quantity of k PLUS one MULTIPLIED BY the quantity of k PLUS one  
            FOR i FROM l TO r MINUS one DO  
                IF element at position i of boxes EQUALS element at position r of boxes THEN  
                    SET possible_value TO the result of calling dp WITH l i k PLUS one and memo PLUS the result of calling dp WITH i PLUS one r MINUS one zero and memo  
                    SET res TO the GREATER OF res AND possible_value  
                END IF  
            END FOR  
            SET the value ASSOCIATED WITH the tuple of l r and k IN memo TO res  
            RETURN res  
        END FUNCTION  
        RETURN the result of calling dp WITH zero the LENGTH OF boxes MINUS one zero and an empty mapping  
    END FUNCTION  
END CLASS