CLASS Solution  
    FUNCTION removeBoxes(boxes)  
        FUNCTION dp(l, r, k, memo)  
            IF l GREATER THAN r THEN  
                RETURN zero  
            END IF  
            IF tuple composed of l r and k EXISTS IN memo THEN  
                RETURN value ASSOCIATED WITH tuple composed of l r and k IN memo  
            END IF  
            
            WHILE r GREATER THAN l AND element at position r of boxes EQUALS element at position r MINUS one of boxes DO  
                DECREMENT r BY one  
                INCREMENT k BY one  
            END WHILE  
            
            SET res TO value RETURNED BY dp WITH arguments l r MINUS one zero memo PLUS quantity k PLUS one MULTIPLIED BY quantity k PLUS one  
            
            FOR i FROM l TO r MINUS one DO  
                IF element at position i of boxes EQUALS element at position r of boxes THEN  
                    SET candidate TO value RETURNED BY dp WITH arguments l i k PLUS one memo PLUS value RETURNED BY dp WITH arguments i PLUS one r MINUS one zero memo  
                    IF candidate GREATER THAN res THEN  
                        SET res TO candidate  
                    END IF  
                END IF  
            END FOR  
            
            ASSIGN res TO key tuple composed of l r and k IN memo  
            RETURN res  
        END FUNCTION  
        
        RETURN value RETURNED BY dp WITH arguments zero LENGTH OF boxes MINUS one zero empty dictionary  
    END FUNCTION  
END CLASS