CLASS Solution  
    FUNCTION totalStrength(strength)  
        SET MOD TO the integer one billion PLUS seven  
        SET n TO the LENGTH OF strength  
        
        INITIALIZE a list prefix with n PLUS one elements all set TO zero  
        FOR index i FROM zero TO n MINUS one  
            SET element at position i PLUS one of prefix TO the REMAINDER WHEN the SUM of element at position i of prefix AND element at position i of strength IS DIVIDED BY MOD  
        END FOR  
        
        INITIALIZE a list prefix_prefix with n PLUS two elements all set TO zero  
        FOR index i FROM zero TO n  
            SET element at position i PLUS one of prefix_prefix TO the REMAINDER WHEN the SUM of element at position i of prefix_prefix AND element at position i of prefix IS DIVIDED BY MOD  
        END FOR  
        
        INITIALIZE a list prev_smaller with n elements all set TO minus one  
        INITIALIZE a list next_smaller_or_equal with n elements all set TO n  
        
        INITIALIZE an empty list stack  
        FOR index i FROM zero TO n MINUS one  
            WHILE stack IS NOT empty AND element at position at the last element of stack of strength IS GREATER THAN OR EQUAL TO element at position i of strength  
                REMOVE the last element FROM stack  
            END WHILE  
            IF stack IS NOT empty  
                SET element at position i of prev_smaller TO the last element of stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        CLEAR stack  
        FOR index i FROM n MINUS one DOWN TO zero  
            WHILE stack IS NOT empty AND element at position at the last element of stack of strength IS GREATER THAN element at position i of strength  
                REMOVE the last element FROM stack  
            END WHILE  
            IF stack IS NOT empty  
                SET element at position i of next_smaller_or_equal TO the last element of stack  
            END IF  
            APPEND i TO stack  
        END FOR  
        
        SET total_strength TO zero  
        FOR index i FROM zero TO n MINUS one  
            SET left TO element at position i of prev_smaller PLUS one  
            SET right TO element at position i of next_smaller_or_equal  
            
            SET sum_left TO the REMAINDER WHEN the PRODUCT of the QUANTITY of i MINUS left PLUS one AND the DIFFERENCE of element at position right PLUS one of prefix_prefix MINUS element at position i PLUS one of prefix_prefix IS DIVIDED BY MOD  
            SET sum_right TO the REMAINDER WHEN the PRODUCT of the QUANTITY of right MINUS i AND the DIFFERENCE of element at position i PLUS one of prefix_prefix MINUS element at position left of prefix_prefix IS DIVIDED BY MOD  
            
            SET contribution TO the REMAINDER WHEN the PRODUCT of element at position i of strength AND the DIFFERENCE of sum_left MINUS sum_right IS DIVIDED BY MOD  
            SET total_strength TO the REMAINDER WHEN the SUM of total_strength AND contribution IS DIVIDED BY MOD  
        END FOR  
        
        RETURN total_strength  
    END FUNCTION  
END CLASS