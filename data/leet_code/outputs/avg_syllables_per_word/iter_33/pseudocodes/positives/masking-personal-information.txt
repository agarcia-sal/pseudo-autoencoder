CLASS Solution  
    FUNCTION maskPII WITH PARAMETER s  
        IF string s CONTAINS character at position any_position EQUALS at symbol  
            SET local_part TO substring of s from position start TO position before at symbol  
            SET domain_part TO substring of s from position after at symbol TO position end  
            SET masked_local_part TO first character of local_part CONCATENATED WITH five times the character asterisk CONCATENATED WITH last character of local_part  
            SET lowercased_masked_local_part TO masked_local_part converted to lowercase letters  
            SET lowercased_domain_part TO domain_part converted to lowercase letters  
            RETURN lowercased_masked_local_part CONCATENATED WITH at symbol CONCATENATED WITH lowercased_domain_part  
        ELSE  
            SET digits_only TO empty string  
            FOR each character c IN string s  
                IF character c is a digit  
                    APPEND character c TO digits_only  
                END IF  
            END FOR  
            SET local_number_mask TO three times character asterisk CONCATENATED WITH hyphen CONCATENATED WITH three times character asterisk CONCATENATED WITH hyphen CONCATENATED WITH last four characters of digits_only  
            IF length of digits_only EQUALS ten  
                RETURN local_number_mask  
            ELSE  
                SET country_code_length TO length of digits_only MINUS ten  
                SET country_code_mask TO plus symbol CONCATENATED WITH country_code_length times character asterisk CONCATENATED WITH hyphen  
                RETURN country_code_mask CONCATENATED WITH local_number_mask  
            END IF  
        END IF  
    END FUNCTION  
END CLASS