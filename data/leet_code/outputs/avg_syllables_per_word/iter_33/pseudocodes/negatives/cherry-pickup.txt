CLASS Solution  
    FUNCTION cherryPickup(grid)  
        SET n TO the LENGTH OF grid  
        IF element at position zero of element at position zero of grid EQUALS minus one OR element at position n MINUS one of element at position n MINUS one of grid EQUALS minus one  
            RETURN zero  
        END IF  

        INITIALIZE dp AS a three dimensional collection of dimensions n by n by n with all elements SET TO minus one  
        SET element at position zero of element at position zero of element at position zero of dp TO element at position zero of element at position zero of grid  

        SET directions TO the collection containing the pair of zero and one AND the pair of one and zero  

        FOR t FROM one TO two MULTIPLIED BY n MINUS one  
            FOR i1 FROM the MAXIMUM of zero AND t MINUS (n MINUS one) TO the MINIMUM of n AND t PLUS one  
                FOR i2 FROM the MAXIMUM of zero AND t MINUS (n MINUS one) TO the MINIMUM of n AND t PLUS one  
                    SET j1 TO t MINUS i1  
                    SET j2 TO t MINUS i2  

                    IF element at position i1 of element at position j1 of grid EQUALS minus one OR element at position i2 of element at position j2 of grid EQUALS minus one  
                        CONTINUE to the next iteration  
                    END IF  

                    SET prev_max TO minus one  

                    FOR each pair di1 dj1 IN directions  
                        FOR each pair di2 dj2 IN directions  
                            SET pi1 TO i1 MINUS di1  
                            SET pj1 TO j1 MINUS dj1  
                            SET pi2 TO i2 MINUS di2  
                            SET pj2 TO j2 MINUS dj2  

                            IF pi1 GREATER THAN OR EQUAL TO zero AND pi1 LESS THAN n AND pj1 GREATER THAN OR EQUAL TO zero AND pj1 LESS THAN n AND pi2 GREATER THAN OR EQUAL TO zero AND pi2 LESS THAN n AND pj2 GREATER THAN OR EQUAL TO zero AND pj2 LESS THAN n  
                                SET prev_max TO the MAXIMUM of prev_max AND element at position pi1 of element at position pi2 of element at position pj1 of dp  
                            END IF  
                        END FOR  
                    END FOR  

                    IF prev_max GREATER THAN OR EQUAL TO zero  
                        IF i1 EQUALS i2  
                            SET cherries TO element at position i1 of element at position j1 of grid  
                        ELSE  
                            SET cherries TO element at position i1 of element at position j1 of grid PLUS element at position i2 of element at position j2 of grid  
                        END IF  

                        SET element at position i1 of element at position i2 of element at position j1 of dp TO prev_max PLUS cherries  
                    END IF  
                END FOR  
            END FOR  
        END FOR  

        SET result TO the MAXIMUM of zero AND element at position n MINUS one of element at position n MINUS one of element at position n MINUS one of dp  
        RETURN result  
    END FUNCTION  
END CLASS