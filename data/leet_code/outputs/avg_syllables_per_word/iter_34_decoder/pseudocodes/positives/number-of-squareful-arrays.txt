CLASS Solution  
    FUNCTION numSquarefulPerms(nums)  
        FUNCTION is_square(n)  
            RETURN integer part of the square root of n MULTIPLIED BY integer part of the square root of n EQUALS n  
        END FUNCTION  
        
        FUNCTION backtrack(path, count)  
            IF the LENGTH OF path EQUALS the LENGTH OF nums  
                RETURN one  
            END IF  
            
            SET ans TO zero  
            FOR each element x IN count  
                IF the value at x in count GREATER THAN zero AND (the LENGTH OF path EQUALS zero OR is_square(the element at the last position of path PLUS x))  
                    DECREMENT the value at x in count BY one  
                    INCREMENT ans BY backtrack(the concatenation of path AND the list containing x, count)  
                    INCREMENT the value at x in count BY one  
                END IF  
            END FOR  
            RETURN ans  
        END FUNCTION  
        
        SET count TO the frequency count of elements in nums  
        RETURN backtrack(empty list, count)  
    END FUNCTION  
END CLASS