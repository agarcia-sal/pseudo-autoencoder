CLASS UnionFind  
    FUNCTION __init__ (self size)  
        SET sequence FROM zero TO size MINUS one AS self.parent  
    END FUNCTION  

    FUNCTION find (self u)  
        IF element at position u of self.parent NOT EQUALS u THEN  
            SET element at position u of self.parent TO self.find(element at position u of self.parent)  
        END IF  
        RETURN element at position u of self.parent  
    END FUNCTION  

    FUNCTION union (self u v)  
        SET root_u TO self.find(u)  
        SET root_v TO self.find(v)  
        IF root_u NOT EQUALS root_v THEN  
            SET element at position root_u of self.parent TO root_v  
        END IF  
    END FUNCTION  
END CLASS  

CLASS Solution  
    FUNCTION matrixRankTransform (self matrix)  
        SET m TO LENGTH OF matrix  
        SET n TO LENGTH OF element at position zero of matrix  
        SET value_to_indices TO a default dictionary of list  
        
        FOR r FROM zero TO m MINUS one  
            FOR c FROM zero TO n MINUS one  
                APPEND pair consisting of r and c TO value_to_indices at key element at position r of matrix at position c  
            END FOR  
        END FOR  
        
        SET row_rank TO a list of zeros of length m  
        SET col_rank TO a list of zeros of length n  
        SET result TO a list of lists each of length n filled with zeros, total m lists  
        
        FOR each value IN keys of value_to_indices sorted in ascending order  
            SET uf TO a new UnionFind object initialized with m PLUS n  
            SET rank TO a default dictionary of integer  
            
            FOR each pair of r and c IN value_to_indices at key value  
                CALL uf.union with r and c PLUS m  
            END FOR  
            
            FOR each pair of r and c IN value_to_indices at key value  
                SET root TO uf.find(r)  
                SET current_max TO maximum of element at position r of row_rank AND element at position c of col_rank  
                SET rank at key root TO maximum of current value at rank key root AND current_max PLUS one  
            END FOR  
            
            FOR each pair of r and c IN value_to_indices at key value  
                SET root TO uf.find(r)  
                SET element at position r of result at position c TO rank at key root  
                SET element at position r of row_rank TO rank at key root  
                SET element at position c of col_rank TO rank at key root  
            END FOR  
        END FOR  
        
        RETURN result  
    END FUNCTION  
END CLASS