```
def maximumANDSum(nums, n):
    dp = cache(lambda i, s: 0 if i == len(nums) else
               max((nums[i] & (j+1)) + dp(i+1, s[:j]+(s[j]+1,)+s[j+1:])
                   for j in range(n) if s[j] < 2))
    return dp(0, (0,)*n)
```