CLASS Solution
    FUNCTION numMagicSquaresInside(grid)
        FUNCTION is_magic(a, b)
            IF grid[a][b] != 5 THEN
                RETURN False
            END IF

            SET seen TO empty set
            SET m TO a - 1
            WHILE m <= a + 1
                SET n TO b - 1
                WHILE n <= b + 1
                    SET val TO grid[m][n]
                    IF val < 1 OR val > 9 OR val IN seen THEN
                        RETURN False
                    END IF
                    INSERT val INTO seen
                    SET n TO n + 1
                END WHILE
                SET m TO m + 1
            END WHILE

            SET idx TO a - 1
            WHILE idx <= a + 1
                SET vertical_sum TO grid[idx][b - 1] + grid[idx][b] + grid[idx][b + 1]
                SET horizontal_sum TO grid[a - 1][idx] + grid[a][idx] + grid[a + 1][idx]
                IF vertical_sum != 15 OR horizontal_sum != 15 THEN
                    RETURN False
                END IF
                SET idx TO idx + 1
            END WHILE

            SET diagonal1 TO grid[a - 1][b - 1] + grid[a][b] + grid[a + 1][b + 1]
            SET diagonal2 TO grid[a - 1][b + 1] + grid[a][b] + grid[a + 1][b - 1]
            IF diagonal1 != 15 OR diagonal2 != 15 THEN
                RETURN False
            END IF

            RETURN True
        END FUNCTION

        SET total TO 0
        SET R TO LENGTH(grid)
        SET C TO LENGTH(grid[0])

        FUNCTION process_j(i, j)
            IF j == C - 1 THEN
                RETURN
            END IF
            IF is_magic(i, j) THEN
                SET total TO total + 1
            END IF
            CALL process_j(i, j + 1)
        END FUNCTION

        FUNCTION process_i(i)
            IF i == R - 1 THEN
                RETURN
            END IF
            CALL process_j(i, 1)
            CALL process_i(i + 1)
        END FUNCTION

        CALL process_i(1)
        RETURN total
    END FUNCTION
END CLASS