```
build graph: node -> top 3 (score, neighbor)
max_score = -1
for u, v in edges:
  for (s1, x) in graph[u]:
    for (s2, y) in graph[v]:
      if distinct(x, y, u, v):
        max_score = max(max_score, s1+s2+scores[u]+scores[v])
return max_score
```