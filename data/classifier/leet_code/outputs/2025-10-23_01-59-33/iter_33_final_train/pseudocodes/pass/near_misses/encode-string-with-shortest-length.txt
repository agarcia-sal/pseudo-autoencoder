CLASS Solution  
    FUNCTION encode(s)  
        FUNCTION get_encoded_length(count, substring)  
            SET count_length TO the LENGTH OF the STRING representation of count  
            SET substring_length TO the LENGTH OF substring  
            RETURN count_length PLUS substring_length PLUS two  
        END FUNCTION  

        FUNCTION dp(i, j)  
            SET substring TO the characters from position i TO position j IN s  
            SET n TO j MINUS i PLUS one  
            IF n LESS THAN five THEN  
                RETURN substring  
            END IF  

            SET shortest TO substring  

            FOR k FROM one TO n DIVIDED BY two  
                SET k_valid TO whether n MODULO k EQUALS zero  
                IF k_valid THEN  
                    SET repeat_count TO n DIVIDED BY k  
                    SET candidate_substring TO the characters from position zero TO position k MINUS one IN substring  
                    SET repeated_candidate TO candidate_substring REPEATED repeat_count TIMES  
                    IF substring EQUALS repeated_candidate THEN  
                        SET encoded_candidate TO the STRING representation of repeat_count CONCATENATED WITH an opening bracket CONCATENATED WITH dp(i, i PLUS k MINUS one) CONCATENATED WITH a closing bracket  
                        IF the LENGTH OF encoded_candidate LESS THAN the LENGTH OF shortest THEN  
                            SET shortest TO encoded_candidate  
                        END IF  
                    END IF  
                END IF  
            END FOR  

            FOR k FROM i TO j MINUS one  
                SET left_encoded TO dp(i, k)  
                SET right_encoded TO dp(k PLUS one, j)  
                SET combined TO left_encoded CONCATENATED WITH right_encoded  
                IF LENGTH OF combined LESS THAN LENGTH OF shortest THEN  
                    SET shortest TO combined  
                END IF  
            END FOR  

            RETURN shortest  
        END FUNCTION  

        RETURN dp(zero, the LENGTH OF s MINUS one)  
    END FUNCTION  
END CLASS