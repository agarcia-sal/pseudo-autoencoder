CLASS Solution  
    FUNCTION shortestPathAllKeys(grid)  
        SET vectors AS the collection of pairs [(1,0), (-1,0), (0,1), (0,-1)]  
        SET height AS LENGTH OF grid  
        SET width AS LENGTH OF grid AT INDEX zero  
        SET origin WITH NO INITIAL VALUE  
        SET total_keys AS 0  
        SET row_idx AS 0  
        WHILE row_idx < height  
            SET col_idx AS 0  
            WHILE col_idx < width  
                IF grid AT row_idx AND col_idx IS '@' THEN  
                    SET origin TO (row_idx, col_idx)  
                ELSE IF 'a' <= grid AT row_idx AND col_idx AND grid AT row_idx AND col_idx <= 'z' THEN  
                    SET total_keys TO total_keys + 1  
                END IF  
                SET col_idx TO col_idx + 1  
            END WHILE  
            SET row_idx TO row_idx + 1  
        END WHILE  
        SET frontier AS A new deque INITIALIZED WITH [(origin AT INDEX zero, origin AT INDEX one, 0, 0)]  
        SET encountered AS A set WITH {(origin AT INDEX zero, origin AT INDEX one, 0)}  
        
        WHILE NOT EMPTY frontier  
            SET curr_x, curr_y, acquired_keys, step_count TO POP LEFT frontier  
            FOR EACH vector_x, vector_y IN vectors  
                SET next_x TO curr_x + vector_x  
                SET next_y TO curr_y + vector_y  
                
                IF 0 <= next_x AND next_x < height AND 0 <= next_y AND next_y < width THEN  
                    SET cell_value TO grid AT next_x AND next_y  
                    IF cell_value = '#' THEN  
                        CONTINUE TO NEXT ITERATION  
                    END IF  
                    IF 'A' <= cell_value AND cell_value <= 'Z' THEN  
                        SET lock_bit TO 1 << (ORD(LOWERCASE cell_value) - ORD('a'))  
                        IF (acquired_keys & lock_bit) = 0 THEN  
                            CONTINUE TO NEXT ITERATION  
                        END IF  
                    END IF  
                    IF 'a' <= cell_value AND cell_value <= 'z' THEN  
                        SET updated_keys TO (acquired_keys | 1 << (ORD cell_value - ORD 'a'))  
                        IF updated_keys = (1 << total_keys) - 1 THEN  
                            RETURN step_count + 1  
                        END IF  
                    ELSE  
                        SET updated_keys TO acquired_keys  
                    END IF  
                    
                    IF (next_x, next_y, updated_keys) NOT IN encountered THEN  
                        ADD (next_x, next_y, updated_keys) TO encountered  
                        APPEND (next_x, next_y, updated_keys, step_count + 1) TO frontier  
                    END IF  
                END IF  
            END FOR  
        END WHILE  
        
        RETURN -1  
    END FUNCTION  
END CLASS