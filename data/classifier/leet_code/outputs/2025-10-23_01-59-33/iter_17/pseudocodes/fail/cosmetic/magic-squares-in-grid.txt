CLASS Solution  
    FUNCTION numMagicSquaresInside(grid)  
        FUNCTION is_magic(i, j)  
            IF grid[i][j] ≠ 5 THEN  
                RETURN False  
            END IF  

            SET unique_values AS empty set  
            SET a AS i - 1  
            WHILE a ≤ i + 1 DO  
                SET b AS j - 1  
                WHILE b ≤ j + 1 DO  
                    SET val AS grid[a][b]  
                    IF val < 1 OR val > 9 OR val IN unique_values THEN  
                        RETURN False  
                    END IF  
                    INSERT val INTO unique_values  
                    b ← b + 1  
                END WHILE  
                a ← a + 1  
            END WHILE  

            SET c AS i - 1  
            REPEAT UNTIL c > i + 1  
                SET row_sum AS grid[c][j - 1] + grid[c][j] + grid[c][j + 1]  
                SET col_sum AS grid[i - 1][c] + grid[i][c] + grid[i + 1][c]  

                IF row_sum ≠ 15 THEN  
                    RETURN False  
                ELSE IF col_sum ≠ 15 THEN  
                    RETURN False  
                END IF  

                c ← c + 1  
            END REPEAT  

            SWITCH TRUE  
                CASE grid[i - 1][j - 1] + grid[i][j] + grid[i + 1][j + 1] ≠ 15:  
                    RETURN False  
                CASE grid[i - 1][j + 1] + grid[i][j] + grid[i + 1][j - 1] ≠ 15:  
                    RETURN False  
            END SWITCH  

            RETURN True  
        END FUNCTION  

        SET total_count AS 0  
        SET row_count AS LENGTH(grid)  
        SET column_count AS LENGTH(grid[0])  
        SET idx_i AS 1  
        WHILE idx_i < row_count - 1 DO  
            SET idx_j AS 1  
            WHILE idx_j < column_count - 1 DO  
                IF is_magic(idx_i, idx_j) THEN  
                    total_count ← total_count + 1  
                END IF  
                idx_j ← idx_j + 1  
            END WHILE  
            idx_i ← idx_i + 1  
        END WHILE  

        RETURN total_count  
    END FUNCTION  
END CLASS