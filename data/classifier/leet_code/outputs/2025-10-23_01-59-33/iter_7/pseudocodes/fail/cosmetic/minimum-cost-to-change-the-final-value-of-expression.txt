CLASS Solution  
    FUNCTION minOperationsToFlip(expression)  
        INITIALIZE cache AS an empty list  
        SET index TO 0  
        WHILE index LESS THAN length of expression DO  
            SET token TO expression[index]  
            IF token IS "(" OR token IS "&" OR token IS "|" THEN  
                INSERT (token, 0) AT END OF cache  
                INCREMENT index BY 1  
                CONTINUE WHILE  
            ELSE IF token IS ")" THEN  
                SET group TO REMOVE and RETURN last element of cache  
                DISCARD last element from cache (which must be the opening parenthesis)  
            ELSE  
                SET group TO (token, 1)  
            END IF  

            IF length of cache GREATER THAN 0 AND (cache[-1][0] IS "&" OR cache[-1][0] IS "|") THEN  
                SET operatorPair TO REMOVE and RETURN last element of cache  
                SET operator TO operatorPair[0]  

                SET leftPair TO REMOVE and RETURN last element of cache  
                SET leftValue TO leftPair[0]  
                SET leftCost TO leftPair[1]  

                SET rightValue TO group[0]  
                SET rightCost TO group[1]  

                IF operator IS "&" THEN  
                    IF leftValue + rightValue EQUALS 0 THEN  
                        SET minCost TO leftCost  
                        IF rightCost LESS THAN minCost THEN  
                            SET minCost TO rightCost  
                        END IF  
                        SET group TO (0, 1 + minCost)  
                    ELSE IF leftValue IS 0 AND rightValue IS 1 THEN  
                        SET group TO (0, 1)  
                    ELSE IF leftValue IS 1 AND rightValue IS 0 THEN  
                        SET group TO (0, 1)  
                    ELSE  
                        SET minCost TO leftCost  
                        IF rightCost LESS THAN minCost THEN  
                            SET minCost TO rightCost  
                        END IF  
                        SET group TO (1, minCost)  
                    END IF  
                ELSE  /* operator IS "|" */  
                    IF leftValue + rightValue EQUALS 0 THEN  
                        SET minCost TO leftCost  
                        IF rightCost LESS THAN minCost THEN  
                            SET minCost TO rightCost  
                        END IF  
                        SET group TO (0, minCost)  
                    ELSE IF leftValue IS 0 AND rightValue IS 1 THEN  
                        SET group TO (1, 1)  
                    ELSE IF leftValue IS 1 AND rightValue IS 0 THEN  
                        SET group TO (1, 1)  
                    ELSE  
                        SET minCost TO leftCost  
                        IF rightCost LESS THAN minCost THEN  
                            SET minCost TO rightCost  
                        END IF  
                        SET group TO (1, 1 + minCost)  
                    END IF  
                END IF  
            END IF  

            INSERT group AT END OF cache  
            INCREMENT index BY 1  
        END WHILE  

        RETURN cache[-1][1]  
    END FUNCTION  
END CLASS