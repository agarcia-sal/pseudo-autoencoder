CLASS Solution  
    FUNCTION minOperationsToFlip(expression)  
        SET stack TO an empty list  
        FOR each element e IN expression  
            IF element e EQUALS an opening parenthesis OR element e EQUALS an ampersand OR element e EQUALS a vertical bar  
                APPEND a tuple containing element e AND zero TO stack  
                CONTINUE to the next iteration  
            ELSE IF element e EQUALS a closing parenthesis  
                SET lastPair TO the result of removing and returning the last element from stack  
                REMOVE and discard the last element from stack corresponding to an opening parenthesis  
            ELSE  
                SET lastPair TO a tuple containing element e AND one  
            END IF  
            IF the length of stack IS GREATER THAN zero AND the first item of the last tuple in stack IS EQUAL TO an ampersand OR a vertical bar  
                SET op TO the first element of the result of removing and returning the last tuple from stack  
                SET a AND costA TO the elements of the result of removing and returning the last tuple from stack  
                SET b AND costB TO the elements of lastPair  
                IF op EQUALS an ampersand  
                    IF a EQUALS zero AND b EQUALS zero  
                        SET lastPair TO a tuple containing zero AND one PLUS the smaller of costA AND costB  
                    ELSE IF a EQUALS zero AND b EQUALS one  
                        SET lastPair TO a tuple containing zero AND one  
                    ELSE IF a EQUALS one AND b EQUALS zero  
                        SET lastPair TO a tuple containing zero AND one  
                    ELSE  
                        SET lastPair TO a tuple containing one AND the smaller of costA AND costB  
                    END IF  
                ELSE  
                    IF a EQUALS zero AND b EQUALS zero  
                        SET lastPair TO a tuple containing zero AND the smaller of costA AND costB  
                    ELSE IF a EQUALS zero AND b EQUALS one  
                        SET lastPair TO a tuple containing one AND one  
                    ELSE IF a EQUALS one AND b EQUALS zero  
                        SET lastPair TO a tuple containing one AND one  
                    ELSE  
                        SET lastPair TO a tuple containing one AND one PLUS the smaller of costA AND costB  
                    END IF  
                END IF  
            END IF  
            APPEND lastPair TO stack  
        END FOR  
        RETURN the second element of the last tuple in stack  
    END FUNCTION  
END CLASS