```
n = len(nums)
if n < 3: return 0
dp = [dict() for _ in range(n)]
total = 0
for i in range(n):
  for j in range(i):
    d = nums[i]-nums[j]
    c = dp[j].get(d,0)
    dp[i][d] = dp[i].get(d,0) + c + 1
    total += c
return total
```