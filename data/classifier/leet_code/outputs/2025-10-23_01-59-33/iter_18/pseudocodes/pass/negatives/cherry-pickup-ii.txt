```
rows,cols = len(grid), len(grid[0])
dp(r,c1,c2) = 0 if c1<0 or c1>=cols or c2<0 or c2>=cols else
              grid[r][c1] if c1==c2 else grid[r][c1]+grid[r][c2] +
              (0 if r==rows-1 else max(dp(r+1,c1+dc1,c2+dc2) for dc1 in [-1,0,1] for dc2 in [-1,0,1]))
return dp(0,0,cols-1)
```