CLASS Solution  
    FUNCTION numDistinctIslands2(grid)  
        FUNCTION dfs(x, y, island)  
            IF x LESS THAN zero OR x GREATER THAN OR EQUAL TO the LENGTH OF grid OR y LESS THAN zero OR y GREATER THAN OR EQUAL TO the LENGTH OF element at position zero of grid OR element at position x of grid AT position y EQUALS zero  
                RETURN  
            END IF  
            SET element at position x of grid AT position y TO zero  
            APPEND the PAIR consisting of x AND y TO island  
            CALL dfs WITH x INCREMENTED BY one AND y AND island  
            CALL dfs WITH x DECREMENTED BY one AND y AND island  
            CALL dfs WITH x AND y INCREMENTED BY one AND island  
            CALL dfs WITH x AND y DECREMENTED BY one AND island  
        END FUNCTION

        FUNCTION normalize(island)  
            SET shapes TO an EMPTY list  
            FOR each PAIR dx AND dy IN the LIST of PAIRS consisting of one and one AND one and MINUS one AND MINUS one and one AND MINUS one and MINUS one  
                SET new_island TO an EMPTY list  
                FOR each PAIR x AND y IN island  
                    APPEND the PAIR consisting of x MULTIPLIED BY dx AND y MULTIPLIED BY dy TO new_island  
                END FOR  
                SORT new_island  
                SET min_x TO the MINIMUM x value IN new_island  
                SET min_y TO the MINIMUM y value IN new_island  
                APPEND to shapes the TUPLE of PAIRS where each PAIR consists of element x MINUS min_x AND element y MINUS min_y FOR each PAIR x AND y IN new_island  
            END FOR  
            SET length_of_shapes TO the LENGTH OF shapes  
            FOR i FROM zero TO length_of_shapes MINUS one  
                APPEND to shapes the TUPLE of PAIRS where each PAIR consists of element y AND MINUS element x FOR each PAIR x AND y IN element at position i of shapes  
            END FOR  
            RETURN the MINIMUM element in shapes  
        END FUNCTION

        SET islands TO an EMPTY set  
        FOR i FROM zero TO the LENGTH OF grid MINUS one  
            FOR j FROM zero TO the LENGTH OF element at position zero of grid MINUS one  
                IF element at position i of grid AT position j EQUALS one  
                    SET island TO an EMPTY list  
                    CALL dfs WITH i AND j AND island  
                    ADD the RESULT of normalize called with island TO islands  
                END IF  
            END FOR  
        END FOR  
        RETURN the LENGTH OF islands  
    END FUNCTION  
END CLASS