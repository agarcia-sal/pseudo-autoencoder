CLASS Solution
    FUNCTION sumOfFlooredPairs(nums)
        SET MOD TO 1000000000 + 1
        SET max_val TO -1
        SET freq_map TO empty mapping
        SET idx1 TO 0

        WHILE idx1 < LENGTH(nums)
            SET val TO nums[idx1]
            IF val > max_val THEN
                SET max_val TO val
            END IF
            IF freq_map CONTAINS KEY val THEN
                SET freq_map[val] TO freq_map[val] + 1
            ELSE
                SET freq_map[val] TO 1
            END IF
            SET idx1 TO idx1 + 1
        END WHILE

        SET prefix_arr TO list of zeros with length max_val + 1

        SET keys_list TO empty list
        FOR key IN freq_map
            APPEND key TO keys_list
        END FOR

        SET idx2 TO 0
        WHILE idx2 < LENGTH(keys_list)
            SET k TO keys_list[idx2]
            SET prefix_arr[k] TO prefix_arr[k] + freq_map[k]
            SET idx2 TO idx2 + 1
        END WHILE

        SET curr_idx TO 1
        FUNCTION buildPrefix(ps, mx, ci)
            IF ci > mx THEN RETURN END IF
            SET ps[ci] TO ps[ci] + ps[ci - 1]
            CALL buildPrefix(ps, mx, ci + 1)
        END FUNCTION
        CALL buildPrefix(prefix_arr, max_val, curr_idx)

        SET result_acc TO 0

        FUNCTION processNum(num_list, pos)
            IF pos >= LENGTH(num_list) THEN RETURN END IF
            SET curr_num TO num_list[pos]
            SET multiple_count TO max_val DIV curr_num

            FUNCTION processMultiple(mul, max_m, n)
                IF mul > max_m THEN RETURN END IF
                SET start_pos TO n * mul
                SET end_pos TO 0
                IF n * (mul + 1) - 1 <= max_val THEN
                    SET end_pos TO n * (mul + 1) - 1
                ELSE
                    SET end_pos TO max_val
                END IF
                SET count_sub TO prefix_arr[end_pos] - prefix_arr[start_pos - 1]
                SET result_delta TO count_sub * mul * freq_map[n]
                SET nonlocal result_acc TO (result_acc + result_delta) MOD MOD
                CALL processMultiple(mul + 1, max_m, n)
            END FUNCTION

            CALL processMultiple(1, multiple_count, curr_num)
            CALL processNum(num_list, pos + 1)
        END FUNCTION

        CALL processNum(keys_list, 0)

        RETURN result_acc
    END FUNCTION
END CLASS