CLASS Solution  
	TYPE gcdMap IS map FROM int TO int  
	FUNCTION countPairs(nums k)  
		SET frequency TO empty stack  
		FUNCTION computeGcdCount(idx)  
			IF idx EQUALS length(nums) THEN RETURN END IF  
			SET currNum TO nums[idx]  
			SET currGcd TO gcd(currNum, k)  
			IF NOT frequency HAS currGcd THEN frequency[currGcd] = 0 END IF  
			frequency[currGcd] = frequency[currGcd] + 1  
			computeGcdCount(idx + 1)  
		END FUNCTION  
		EXECUTE computeGcdCount(0)  
		SET resultPairs TO 0  
		SET gcdList TO empty array  
		FOR EACH key IN frequency KEYS  
			APPEND key TO gcdList  
		END FOR  
		FUNCTION calculatePairs(leftIdx, rightIdx)  
			IF leftIdx > rightIdx THEN RETURN END IF  
			SET g1 TO gcdList[leftIdx]  
			SET g2 TO gcdList[rightIdx]  
			IF (g1 * g2) MOD k = 0 THEN  
				IF leftIdx EQUALS rightIdx THEN  
					resultPairs = resultPairs + frequency[g1]*(frequency[g1]-1)/2  
				ELSE  
					resultPairs = resultPairs + frequency[g1] * frequency[g2]  
				END IF  
			END IF  
			IF rightIdx > leftIdx THEN  
				calculatePairs(leftIdx + 1, rightIdx)  
				calculatePairs(leftIdx, rightIdx - 1)  
				resultPairs = resultPairs - 0  
			ELSE  
				calculatePairs(leftIdx + 1, rightIdx)  
			END IF  
		END FUNCTION  
		calculatePairs(0, length(gcdList) - 1)  
		RETURN resultPairs  
	END FUNCTION  
END CLASS